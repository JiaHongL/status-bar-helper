<!DOCTYPE html>
<html>
<head>
    <title>快速模組測試</title>
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        button { margin: 10px; padding: 10px 20px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .hidden { display: none !important; }
        #confirm-dialog-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
        }
        #confirm-dialog {
            background: white; padding: 20px; border-radius: 8px; min-width: 300px; max-width: 500px;
        }
        .confirm-buttons { margin-top: 20px; text-align: right; }
        .confirm-buttons button { margin-left: 10px; padding: 8px 16px; }
        .secondary { background: #6c757d !important; }
        #output { margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>模組測試：確認對話框系統</h1>
    
    <button onclick="testGlobalFunction()">測試 showChoiceDialog 全域函式</button>
    <button onclick="testConfirmationSystem()">測試 ConfirmationSystem API</button>
    <button onclick="checkModuleStatus()">檢查模組狀態</button>
    
    <div id="output"></div>
    
    <!-- 確認對話框 HTML -->
    <div id="confirm-dialog-overlay" class="hidden">
        <div id="confirm-dialog">
            <h3 id="confirm-title"></h3>
            <p id="confirm-message"></p>
            <div class="confirm-buttons"></div>
        </div>
    </div>
    
    <!-- 模組載入 -->
    <script src="utils/i18n-helper.js"></script>
    <script src="utils/confirmation.js"></script>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += '<div>' + message + '</div>';
        }
        
        function clearOutput() {
            output.innerHTML = '';
        }
        
        async function testGlobalFunction() {
            clearOutput();
            log('=== 測試全域 showChoiceDialog 函式 ===');
            
            try {
                log('typeof showChoiceDialog: ' + typeof showChoiceDialog);
                
                if (typeof showChoiceDialog === 'undefined') {
                    log('❌ showChoiceDialog 未定義！');
                    return;
                }
                
                const choice = await showChoiceDialog(
                    '全域函式測試',
                    '這是使用全域 showChoiceDialog 函式的測試',
                    ['確定', '取消', '或許']
                );
                
                log('✅ 使用者選擇: ' + choice);
                
                // 測試 showToast
                if (typeof showToast !== 'undefined') {
                    showToast('測試成功！選擇了: ' + choice, 'success');
                } else {
                    log('❌ showToast 未定義');
                }
                
            } catch (error) {
                log('❌ 錯誤: ' + error.message);
                console.error(error);
            }
        }
        
        async function testConfirmationSystem() {
            clearOutput();
            log('=== 測試 ConfirmationSystem API ===');
            
            try {
                if (!window.ConfirmationSystem) {
                    log('❌ ConfirmationSystem 未載入');
                    return;
                }
                
                const choice = await ConfirmationSystem.showChoiceDialog(
                    'API 測試',
                    '這是使用 ConfirmationSystem API 的測試',
                    ['好的', '不要', '取消']
                );
                
                log('✅ 使用者選擇: ' + choice);
                ConfirmationSystem.showSuccessToast('API 測試成功！');
                
            } catch (error) {
                log('❌ 錯誤: ' + error.message);
                console.error(error);
            }
        }
        
        function checkModuleStatus() {
            clearOutput();
            log('=== 模組狀態檢查 ===');
            
            log('I18nHelper: ' + (window.I18nHelper ? '✅ 已載入' : '❌ 未載入'));
            log('ConfirmationSystem: ' + (window.ConfirmationSystem ? '✅ 已載入' : '❌ 未載入'));
            log('showChoiceDialog: ' + (typeof showChoiceDialog !== 'undefined' ? '✅ 可用' : '❌ 未定義'));
            log('showToast: ' + (typeof showToast !== 'undefined' ? '✅ 可用' : '❌ 未定義'));
            
            if (window.ConfirmationSystem) {
                const status = ConfirmationSystem.getDependencyStatus();
                log('依賴狀態: ' + JSON.stringify(status, null, 2));
            }
        }
        
        // 頁面載入完成後自動檢查
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkModuleStatus();
            }, 200);
        });
    </script>
</body>
</html>
