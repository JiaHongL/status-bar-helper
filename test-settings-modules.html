<!DOCTYPE html>
<html>
<head>
    <title>Settings Panel 模組測試</title>
    <style>
        .hidden { display: none !important; }
        #confirm-dialog-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
        }
        #confirm-dialog {
            background: white; padding: 20px; border-radius: 8px; min-width: 300px;
        }
        .confirm-buttons { margin-top: 20px; text-align: right; }
        .confirm-buttons button { margin-left: 10px; padding: 8px 16px; }
        .secondary { background: #6c757d; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Settings Panel 模組測試</h1>
    
    <button onclick="testI18n()">測試 I18n 功能</button>
    <button onclick="testConfirmation()">測試確認對話框</button>
    <div id="test-output"></div>
    
    <!-- 確認對話框 HTML -->
    <div id="confirm-dialog-overlay" class="hidden">
        <div id="confirm-dialog">
            <h3 id="confirm-title"></h3>
            <p id="confirm-message"></p>
            <div class="confirm-buttons"></div>
        </div>
    </div>
    
    <!-- 模組載入 -->
    <script src="utils/i18n-helper.js"></script>
    <script src="utils/confirmation.js"></script>
    
    <script>
        // 模擬 nls 資料
        const testNls = {
            'title': 'StatusBar Helper Settings',
            'ok': 'OK',
            'cancel': 'Cancel',
            'confirmDelete': 'Confirm Delete',
            'deleteMessage': 'Are you sure you want to delete "{0}"?',
            'statusBarItems': 'Status Bar Items',
            'storedData': 'Stored Data'
        };
        
        // 模擬 vscode 全域物件
        window.vscode = {
            postMessage: function(msg) {
                console.log('postMessage called:', msg);
            }
        };
        
        function testI18n() {
            console.log('=== I18n 測試 ===');
            
            // 初始化
            if (window.I18nHelper) {
                window.I18nHelper.initI18n(testNls, 'en');
                console.log('✅ I18nHelper 初始化成功');
                
                // 測試基本功能
                const title = window.I18nHelper.getNlsText('title', 'Default Title');
                console.log('title:', title);
                
                // 測試格式化
                const formatted = window.I18nHelper.formatText('Hello {0}, you have {1} messages', 'John', 5);
                console.log('formatted:', formatted);
                
                document.getElementById('test-output').innerHTML = `
                    <h3>I18n 測試結果:</h3>
                    <p>Title: ${title}</p>
                    <p>Formatted: ${formatted}</p>
                `;
            } else {
                console.error('❌ I18nHelper 未載入');
            }
        }
        
        async function testConfirmation() {
            console.log('=== Confirmation 測試 ===');
            
            if (window.ConfirmationSystem) {
                // 測試基本對話框
                const choice = await ConfirmationSystem.showChoiceDialog(
                    'Test Dialog',
                    'This is a test message',
                    ['Yes', 'No', 'Cancel']
                );
                console.log('使用者選擇:', choice);
                
                // 測試 Toast
                ConfirmationSystem.showSuccessToast(`您選擇了: ${choice}`);
                
                // 測試確認刪除
                setTimeout(async () => {
                    const deleteConfirm = await ConfirmationSystem.confirmDelete('Test Item');
                    console.log('刪除確認:', deleteConfirm);
                    
                    if (deleteConfirm) {
                        ConfirmationSystem.showSuccessToast('已確認刪除');
                    } else {
                        ConfirmationSystem.showWarningToast('已取消刪除');
                    }
                }, 1000);
                
                document.getElementById('test-output').innerHTML += `
                    <h3>Confirmation 測試結果:</h3>
                    <p>選擇結果: ${choice}</p>
                `;
            } else {
                console.error('❌ ConfirmationSystem 未載入');
            }
        }
        
        // 檢查模組載入狀態
        window.addEventListener('load', () => {
            console.log('=== 模組載入狀態檢查 ===');
            console.log('I18nHelper:', !!window.I18nHelper);
            console.log('ConfirmationSystem:', !!window.ConfirmationSystem);
            console.log('showChoiceDialog (backward compat):', !!window.showChoiceDialog);
            console.log('showToast (backward compat):', !!window.showToast);
            
            if (window.ConfirmationSystem) {
                const status = ConfirmationSystem.getDependencyStatus();
                console.log('依賴狀態:', status);
            }
        });
    </script>
</body>
</html>
