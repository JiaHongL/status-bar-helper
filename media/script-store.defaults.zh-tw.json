[
  {
    "command": "cmd.u9xttvbblr",
    "text": "$(code-oss) è…³æœ¬å•Ÿå‹•å™¨",
    "tooltip": "å¾ç‹€æ…‹åˆ—ä¸€éµå­˜å–ä¸¦åŸ·è¡Œæ‚¨çš„å¸¸ç”¨è…³æœ¬ã€‚",
    "hidden": true,
    "enableOnInit": true,
    "tags": [
      "default",
      "tool"
    ],
    "script": "const vscode = require(\"vscode\");\nconst { vm, storage } = statusBarHelper.v1;\n\nconst SETTINGS_KEY = 'scriptLauncher.visibleScripts';\nlet allScripts = [];\nlet statusBarItem;\nlet disposables = [];\nlet settingsPanel;\n\n(async function main() {\n  const rawScripts = await vm.scripts();\n  allScripts = rawScripts.map((script) => ({\n    label: script.text || script.command,\n    description: script.tooltip || '',\n    commandId: script.command,\n  }));\n\n  vm.onStop(() => {\n    console.log(\"Disposing hybrid launcher resources...\");\n    disposables.forEach((d) => {\n      try {\n        d.dispose();\n      } catch (e) {\n        console.error(\"Failed to dispose resource:\", e);\n      }\n    });\n    if (settingsPanel) {\n        settingsPanel.dispose();\n    }\n  });\n\n  const openSettingsCommand = vscode.commands.registerCommand(\n    \"sbh.scriptLauncher.openSettings\",\n    openSettingsWebview\n  );\n  disposables.push(openSettingsCommand);\n\n  await updateUI();\n\n  console.log(\"Hybrid script launcher with settings is ready.\");\n})();\n\nasync function updateUI() {\n  if (statusBarItem) {\n    statusBarItem.dispose();\n  }\n  const oldCommandHandlerIndex = disposables.findIndex(d => d.commandId === \"sbh.custom.showScriptLauncherQuickPick\");\n  if (oldCommandHandlerIndex > -1) {\n    disposables.splice(oldCommandHandlerIndex, 1)[0].dispose();\n  }\n\n  const settings = await storage.global.get(SETTINGS_KEY, {});\n  const visibleScripts = allScripts.filter(\n    (script) => settings[script.commandId] !== false\n  );\n  \n  const markdownTooltip = new vscode.MarkdownString(\"\", true);\n  markdownTooltip.supportThemeIcons = true;\n  markdownTooltip.isTrusted = true;\n\n  const markdownLines = visibleScripts.map((script) => {\n    const args = encodeURIComponent(JSON.stringify(script.commandArgs || []));\n    const commandUri = `command:${script.commandId}?${args}`;\n    return `[${script.label}](${commandUri} \"${script.description}\")`;\n  });\n\n  markdownTooltip.value = `**è…³æœ¬å•Ÿå‹•å™¨**\\n\\n---\\n\\n${markdownLines.join(\n    \"\\n\\n\"\n  )}\\n\\n---\\n\\n[$(gear) è¨­å®šå¯è¦‹è…³æœ¬...](command:sbh.scriptLauncher.openSettings \"æ‰“é–‹è…³æœ¬å¯è¦‹æ€§è¨­å®š\")`;\n\n  const launcherCommandId = \"sbh.custom.showScriptLauncherQuickPick\";\n  const commandHandler = vscode.commands.registerCommand(\n    launcherCommandId,\n    async () => {\n      const quickPickItems = [\n        ...visibleScripts,\n        { label: \"\", kind: vscode.QuickPickItemKind.Separator },\n        {\n          label: \"$(gear) è¨­å®šå¯è¦‹è…³æœ¬...\",\n          description: \"é¸æ“‡è¦åœ¨æ­¤æ¸…å–®ä¸­é¡¯ç¤ºçš„è…³æœ¬\",\n          commandId: \"sbh.scriptLauncher.openSettings\",\n        },\n      ];\n\n      const selected = await vscode.window.showQuickPick(quickPickItems, {\n        placeHolder: \"è«‹é¸æ“‡è¦åŸ·è¡Œçš„è…³æœ¬\",\n        title: \"è…³æœ¬å•Ÿå‹•å™¨\",\n      });\n\n      if (selected) {\n        try {\n          vscode.commands.executeCommand(\n            selected.commandId,\n            ...(selected.commandArgs || [])\n          );\n        } catch (e) {\n          vscode.window.showErrorMessage(\n            `åŸ·è¡ŒæŒ‡ä»¤å¤±æ•—: ${selected.commandId}. éŒ¯èª¤: ${\n              e?.message || e\n            }`\n          );\n        }\n      }\n    }\n  );\n  disposables.push(commandHandler);\n\n  statusBarItem = vscode.window.createStatusBarItem(\n    vscode.StatusBarAlignment.Left,\n    100\n  );\n  statusBarItem.text = \"$(list-selection) Scripts\";\n  statusBarItem.tooltip = markdownTooltip;\n  statusBarItem.command = launcherCommandId;\n  statusBarItem.show();\n  disposables.push(statusBarItem);\n}\n\nasync function openSettingsWebview() {\n  const column = vscode.window.activeTextEditor\n    ? vscode.window.activeTextEditor.viewColumn\n    : undefined;\n\n  if (settingsPanel) {\n    settingsPanel.reveal(column);\n    return;\n  }\n\n  settingsPanel = vscode.window.createWebviewPanel(\n    \"scriptLauncherSettings\",\n    \"è…³æœ¬å•Ÿå‹•å™¨è¨­å®š\",\n    column || vscode.ViewColumn.One,\n    {\n      enableScripts: true,\n      localResourceRoots: [],\n    }\n  );\n  \n  settingsPanel.onDidDispose(() => {\n    settingsPanel = undefined;\n  }, null, disposables);\n\n  settingsPanel.webview.html = getWebviewHtml(settingsPanel.webview);\n\n  settingsPanel.webview.onDidReceiveMessage(\n    async (message) => {\n      switch (message.command) {\n        case 'webviewReady':\n          const currentSettings = await storage.global.get(SETTINGS_KEY, {});\n          settingsPanel.webview.postMessage({\n            command: 'init',\n            payload: {\n              allScripts: allScripts,\n              settings: currentSettings\n            }\n          });\n          break;\n        case 'saveSettings':\n          await storage.global.set(SETTINGS_KEY, message.payload);\n          await updateUI();\n          vscode.window.showInformationMessage('è…³æœ¬å•Ÿå‹•å™¨è¨­å®šå·²å„²å­˜ï¼');\n          if (settingsPanel) {\n            settingsPanel.dispose();\n          }\n          break;\n      }\n    },\n    null,\n    disposables\n  );\n}\n\n/**\n * ç”¢ç”Ÿ Webview çš„ HTML å…§å®¹ (åŸç”Ÿ VS Code é¢¨æ ¼ - æœ€çµ‚ç‰ˆ)\n * @param {vscode.Webview} webview - The webview instance\n * @returns {string}\n */\nfunction getWebviewHtml(webview) {\n    const nonce = Math.random().toString(36).slice(2);\n    return `<!DOCTYPE html>\n    <html lang=\"zh-TW\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta http-equiv=\"Content-security-policy\" content=\"default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>è…³æœ¬å•Ÿå‹•å™¨è¨­å®š</title>\n        <style>\n            html, body { height: 100vh; margin: 0; padding: 0; display: flex; flex-direction: column; overflow: hidden; font-family: var(--vscode-font-family); color: var(--vscode-foreground); background-color: var(--vscode-editor-background); }\n            .header { padding: 1em 2em; border-bottom: 1px solid var(--vscode-divider-background); flex-shrink: 0; }\n            .main-content { flex: 1; overflow-y: auto; padding: 0.5em 2em; }\n            .footer { padding: 1em 2em; background-color: var(--vscode-editor-background); border-top: 1px solid var(--vscode-divider-background); display: flex; justify-content: flex-end; gap: 10px; flex-shrink: 0; }\n            h1 { font-weight: 500; margin: 0 0 0.5em 0; font-size: 1.5em; }\n            p { margin: 0; color: var(--vscode-descriptionForeground); }\n            .script-item { display: flex; align-items: center; padding: 0.6em 0.5em; margin-bottom: 2px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease; }\n            .script-item:hover { background-color: var(--vscode-list-hoverBackground); }\n            .script-info { display: flex; align-items: baseline; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n            .script-label { font-size: 1em; color: var(--vscode-settings-textInputForeground); margin-right: 0.6em; }\n            .script-description { font-size: 0.9em; color: var(--vscode-descriptionForeground); opacity: 0.9; }\n            .script-item input[type=\"checkbox\"] { appearance: none; -webkit-appearance: none; width: 16px; height: 16px; margin-right: 12px; border-radius: 3px; outline: none; cursor: pointer; position: relative; background-color: var(--vscode-checkbox-background); border: 1px solid var(--vscode-checkbox-border); }\n            .script-item input[type=\"checkbox\"]:checked { background-color: var(--vscode-checkbox-selectBackground); border-color: var(--vscode-checkbox-selectBackground); }\n            .script-item input[type=\"checkbox\"]:checked::before { content: ''; position: absolute; top: 2px; left: 5px; width: 4px; height: 8px; border-style: solid; border-color: var(--vscode-checkbox-foreground); border-width: 0 2px 2px 0; transform: rotate(45deg); }\n            .footer .actions-left { margin-right: auto; display: flex; gap: 10px; }\n            \n            /* --- ä¸»è¦ä¿®æ”¹è™• --- */\n            button {\n                padding: 8px 15px;\n                border-style: solid;\n                border-width: 1px;\n                cursor: pointer;\n                border-radius: 5px;\n                font-size: 0.9em;\n                background-color: var(--vscode-button-secondaryBackground);\n                color: var(--vscode-button-secondaryForeground);\n                border-color: var(--vscode-button-border, var(--vscode-contrastBorder));\n            }\n            button:hover {\n                 background-color: var(--vscode-button-secondaryHoverBackground);\n            }\n        </style>\n    </head>\n    <body>\n        <div class=\"header\"><h1>å¯è¦‹è…³æœ¬</h1><p>è«‹é¸æ“‡æ‚¨æƒ³åœ¨è…³æœ¬å•Ÿå‹•å™¨ä¸­é¡¯ç¤ºçš„è…³æœ¬ã€‚</p></div>\n        <div class=\"main-content\"><div id=\"script-list-container\"></div></div>\n        <div class=\"footer\">\n             <div class=\"actions-left\">\n                <button id=\"select-all-btn\">å…¨é¸</button>\n                <button id=\"deselect-all-btn\">å…¨éƒ¨å–æ¶ˆ</button>\n            </div>\n            <button id=\"save-btn\">å„²å­˜ä¸¦é—œé–‰</button>\n        </div>\n        <script nonce=\"${nonce}\">\n            const vscode = acquireVsCodeApi();\n            const container = document.getElementById('script-list-container');\n            const saveBtn = document.getElementById('save-btn');\n            const selectAllBtn = document.getElementById('select-all-btn');\n            const deselectAllBtn = document.getElementById('deselect-all-btn');\n            window.addEventListener('message', event => {\n                const message = event.data;\n                if (message.command === 'init') {\n                    const { allScripts, settings } = message.payload;\n                    renderCheckboxes(allScripts, settings);\n                }\n            });\n            function renderCheckboxes(scripts, currentSettings) {\n                container.innerHTML = '';\n                scripts.forEach(script => {\n                    const isVisible = currentSettings[script.commandId] !== false;\n                    const descriptionSpan = script.description ? \\`<span class=\"script-description\">\\${script.description}</span>\\` : '';\n                    const item = document.createElement('label');\n                    item.className = 'script-item';\n                    item.innerHTML = \\`<input type=\"checkbox\" data-command-id=\"\\${script.commandId}\" \\${isVisible ? 'checked' : ''}><div class=\"script-info\" title=\"\\${script.label} \\${script.description || ''}\"><span class=\"script-label\">\\${script.label}</span>\\${descriptionSpan}</div>\\`;\n                    container.appendChild(item);\n                });\n            }\n            saveBtn.addEventListener('click', () => {\n                const newSettings = {};\n                const checkboxes = container.querySelectorAll('input[type=\"checkbox\"]');\n                checkboxes.forEach(cb => { newSettings[cb.dataset.commandId] = cb.checked; });\n                vscode.postMessage({ command: 'saveSettings', payload: newSettings });\n            });\n            selectAllBtn.addEventListener('click', () => {\n                container.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => cb.checked = true);\n            });\n            deselectAllBtn.addEventListener('click', () => {\n                container.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => cb.checked = false);\n            });\n            vscode.postMessage({ command: 'webviewReady' });\n        </script>\n    </body>\n    </html>`;\n}"
  },
  {
    "command": "sbh.demo.toggleTheme",
    "text": "$(color-mode)",
    "tooltip": "åˆ‡æ›äº®/æš—è‰²ä¸»é¡Œ",
    "hidden": false,
    "enableOnInit": false,
    "tags": [
      "default",
      "ui"
    ],
    "script": "// Toggle between Light and Dark themes in VS Code (one-click)\n// Purpose: Demonstrates how to trigger a built-in VS Code command from a script\n// Note: This uses 'workbench.action.toggleLightDarkThemes' which toggles the current color theme\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(async () => {\n  try {\n    // Execute the built-in toggle theme command\n    await vscode.commands.executeCommand('workbench.action.toggleLightDarkThemes');\n  } catch (e) {\n    // Show an error message in VS Code if the command fails\n    vscode.window.showErrorMessage('Toggle theme failed: ' + (e?.message || e));\n  } finally {\n    vm.stop();\n  }\n})();"
  },
  {
    "command": "sbh.demo.logMinimalPlus",
    "text": "$(output) Log",
    "tooltip": "VS Code + Node å¿«é€Ÿç¤ºç¯„ï¼šåŒæ™‚è¼¸å‡ºåˆ° Output èˆ‡åº•éƒ¨æ—¥èªŒ",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "example"
    ],
    "script": "// Minimal Log: VS Code + Node (read-only, one-click, dual output)\n// Example: Demonstrates how to log messages in a VS Code extension\n// 1. Create a custom Output Channel in VS Code\n// 2. Define a helper function to log to both Output Channel and console\n// 3. Show environment info (Node version, platform, architecture)\n// 4. List a few files/directories from the current workspace\n// 5. Show the currently active file and its language\n// 6. Display a completion message in VS Code's UI\n\n// Import VS Code API\nconst vscode = require('vscode');\n// Import Node.js file system and path modules\nconst fs = require('fs');\nconst path = require('path');\n// Inject VM API\nconst { vm } = statusBarHelper.v1; \n\n(function main(){\n  // Create a new Output Channel named \"SBH Minimal Log\"\n  const ch = vscode.window.createOutputChannel('SBH Minimal Log');\n\n  // Helper function: log to both Output Channel and console\n  const emit = (...a) => {\n    const line = a.join(' ');\n    ch.appendLine(line);\n    console.log(line);\n  };\n\n  // Show the Output Channel immediately\n  ch.show(true);\n\n  // Start logging\n  emit('â–¶ Start');\n\n  // Show Node.js version, platform, and architecture\n  emit('Node: ' + process.version + '  Platform: ' + process.platform + '/' + process.arch);\n\n  // Get current workspace root (or fallback to process.cwd())\n  const ws = vscode.workspace.workspaceFolders;\n  const root = ws && ws.length ? ws[0].uri.fsPath : process.cwd();\n  emit('Workdir: ' + root);\n\n  // Try listing the first 8 entries in the workspace folder\n  try {\n    const entries = fs.readdirSync(root, { withFileTypes: true }).slice(0, 8);\n    entries.forEach(e => emit((e.isDirectory() ? '[D] ' : '[F] ') + e.name));\n  } catch (e) {\n    emit('readdir failed: ' + e.message);\n  }\n\n  // Show the active file name and language if available\n  const ed = vscode.window.activeTextEditor;\n  if (ed && ed.document.uri.scheme === 'file') {\n    emit('Active file: ' + path.basename(ed.document.uri.fsPath) + ' (' + ed.document.languageId + ')');\n  }\n\n  // Final message\n  emit('âœ” Done');\n\n  // Show a success message in VS Code\n  vscode.window.showInformationMessage('Log demo finished. Check \"SBH Minimal Log\" and the bottom run log.');\n\n  // Stop VM explicitly after completion\n  vm.stop();\n})();"
  },
  {
    "command": "sbh.demo.gitAdd",
    "text": "$(diff-added) Git Add",
    "tooltip": "å¿«é€ŸåŸ·è¡Œ git add .ï¼ˆç¬¬ä¸€å€‹å·¥ä½œå€ï¼‰",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "example"
    ],
    "script": "// Git Add: stage all in first workspace (one-click)\n// Example: How to run a terminal command from a VS Code extension\n// 1. Get the first opened workspace folder path\n// 2. Use Node.js child_process.exec to execute a system command (git add .)\n// 3. Convert the command output (stdout/stderr) to string and handle it\n// 4. Show messages in the VS Code UI\n\n// Import VS Code API\nconst vscode = require('vscode');\n// Import exec from Node.js (used to run system commands)\nconst { exec } = require('child_process');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  // Get the opened workspace folders\n  const ws = vscode.workspace.workspaceFolders;\n  if (!ws || !ws.length) {\n    console.log('[GitAdd] No workspace folder.');\n    vscode.window.showWarningMessage('No workspace folder â€” cannot run git add.');\n    vm.stop();\n    return;\n  }\n\n  // Get the first workspace's filesystem path\n  const cwd = ws[0].uri.fsPath;\n  console.log('[GitAdd] cwd:', cwd);\n\n  // Execute the git add . command in the workspace directory\n  exec('git add .', { cwd }, (err, stdout, stderr) => {\n    if (err) {\n      // stderr usually contains error messages\n      console.error('[GitAdd] error:', stderr || err.message);\n      vscode.window.showErrorMessage('Git add failed: ' + (stderr || err.message));\n      vm.stop();\n      return;\n    }\n\n    // stdout contains the command output (Buffer â†’ string)\n    if (stdout && stdout.trim()) console.log(stdout.trim());\n    console.log('[GitAdd] done.');\n\n    // Show a success message in VS Code\n    vscode.window.showInformationMessage('âœ… git add . done');\n\n    vm.stop();\n  });\n})();"
  },
  {
    "text": "$(database) Storage",
    "tooltip": "storage / files API ç¯„ä¾‹ï¼šæ–‡å­—ã€JSONã€ä½å…ƒçµ„ã€éµå€¼",
    "command": "cmd.x5pkqa0li7",
    "script": "// Status Bar Helper v1: Demonstrates how to use the custom statusBarHelper API\n// Purpose:\n//  1. Show how to use custom storage (global & workspace) for key-value data\n//  2. Show how to use custom file APIs to read/write text, JSON, and binary data\n//  3. Show how to check existence, calculate file sizes, and log results\n//  4. Intended for demo/testing inside a VS Code extension with SBH enabled\n\n// Import Node.js Buffer (for binary and base64 handling)\nconst { Buffer } = require('buffer');\n\n// Destructure storage and files API from statusBarHelper v1\nconst { secret, storage, files, vm } = statusBarHelper.v1;\n\nfunction main() {\n\n  // Helper: current timestamp in readable format\n  const now = () => new Date().toISOString().replace('T', ' ').replace('Z', '');\n\n  // Helper: pretty-print any value for logging\n  const dump = (x) => {\n    if (x instanceof Uint8Array)\n      return `Uint8Array(${x.length}) [${Array.from(x).slice(0, 16).join(',')}${x.length > 16 ? ',â€¦' : ''}]`;\n    try { return JSON.stringify(x, null, 2); } catch { return String(x); }\n  };\n\n  // Helper: prefixed log output\n  const log = (...a) => console.log('[SBH]', ...a.map(dump));\n\n  (async () => {\n    log('â–¶ start', now());\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ secret â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    await secret.set('github.token', 'ghp_xxx...');\n    const t = await secret.get('github.token');   // string | undefined\n    console.log('token', t);\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ storage / global â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    log('â€” storage / global â€”');\n    const gPrev = await storage.global.get('demo.keep', { runs: 0 });\n    await storage.global.set('demo.keep', { ...gPrev, runs: (gPrev.runs || 0) + 1, ts: now(), from: 'global' });\n    log('get keep =', await storage.global.get('demo.keep', null));\n    log('keys =', await storage.global.keys());\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ storage / workspace â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    log('â€” storage / workspace â€”');\n    try {\n      const wPrev = await storage.workspace.get('demo.keep', { runs: 0 });\n      await storage.workspace.set('demo.keep', { ...wPrev, runs: (wPrev.runs || 0) + 1, ts: now(), from: 'workspace' });\n      log('get keep =', await storage.workspace.get('demo.keep', null));\n      log('keys =', await storage.workspace.keys());\n    } catch (e) {\n      log('workspace storage not available:', e?.message || e);\n    }\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ files API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    const dirs = await files.dirs();\n    log('dirs =', dirs);\n\n    // Text file (global scope)\n    const txtRel = 'demo/notes/hello.txt';\n    const txtOld = (await files.exists('global', txtRel)) ? await files.readText('global', txtRel) : '';\n    await files.writeText('global', txtRel, txtOld + `hello @ ${now()}\\n`);\n    log('readText:', await files.readText('global', txtRel));\n\n    // JSON file (workspace if available, otherwise global)\n    /** @type {'global'|'workspace'} */\n    const jsonScope = dirs.workspace ? 'workspace' : 'global';\n    const jsonRel = 'demo/data/sample.json';\n    const cur = (await files.exists(jsonScope, jsonRel))\n      ? await files.readJSON(jsonScope, jsonRel)\n      : { a: 1, createdAt: now() };\n    cur.updatedAt = now();\n    cur.count = (cur.count || 0) + 1;\n    await files.writeJSON(jsonScope, jsonRel, cur);\n    log('readJSON:', await files.readJSON(jsonScope, jsonRel));\n\n    // Binary file (Uint8Array)\n    const binRel = 'demo/bin/demo.bin';\n    await files.writeBytes('global', binRel, new Uint8Array([1, 2, 3, 4, 5, 254, 255]));\n    log('readBytes demo.bin:', await files.readBytes('global', binRel));\n\n    // Binary file (base64 string)\n    const b64Rel = 'demo/bin/base64.bin';\n    await files.writeBytes('global', b64Rel, Buffer.from([9, 8, 7, 6]).toString('base64'));\n    log('exists base64.bin:', await files.exists('global', b64Rel));\n\n    // Simulated list of known demo files + calculate size\n    /** @type {Array<{scope:'global'|'workspace', rel:string, type:'text'|'json'|'bytes'}>} */\n    const candidates = [\n      { scope: 'global', rel: 'demo/notes/hello.txt', type: 'text' },\n      { scope: jsonScope, rel: 'demo/data/sample.json', type: 'json' },\n      { scope: 'global', rel: 'demo/bin/demo.bin', type: 'bytes' },\n      { scope: 'global', rel: 'demo/bin/base64.bin', type: 'bytes' },\n      { scope: 'global', rel: 'demo/tmp/kept.txt', type: 'text' },\n    ];\n\n    /** @type {Array<{scope:string, path:string, type:string, size:number}>} */\n    const rows = [];\n    for (const c of candidates) {\n      if (await files.exists(c.scope, c.rel)) {\n        let size = 0;\n        if (c.type === 'text') {\n          const s = await files.readText(c.scope, c.rel);\n          size = Buffer.byteLength(s, 'utf8');\n        } else if (c.type === 'json') {\n          const obj = await files.readJSON(c.scope, c.rel);\n          size = Buffer.byteLength(JSON.stringify(obj), 'utf8');\n        } else {\n          const b = await files.readBytes(c.scope, c.rel);\n          size = b?.length || 0;\n        }\n        rows.push({ scope: c.scope, path: c.rel, type: c.type, size });\n      }\n    }\n    log('files (simulated list):', rows);\n\n    // // Optional cleanup â€” user can delete via UI or uncomment below:\n    // await secret.delete('github.token');\n    // await storage.global.remove('demo.keep');\n    // await storage.workspace.remove('demo.keep').catch(()=>{});\n    // await files.remove('global', b64Rel);\n\n    log('âœ” done', now());\n    vm.stop();\n  })().catch(e => {\n    console.error('âŒ', e);\n    vm.stop();\n  });\n}\n\nmain();",
    "enableOnInit": false,
    "hidden": true,
    "tags": [
      "example"
    ]
  },
  {
    "command": "cmd.e0eq7ivl1t",
    "text": "$(bookmark) æ›¸ç±¤",
    "tooltip": "å¸¸ç”¨æª”æ¡ˆå¿«æ·åˆ—",
    "hidden": false,
    "enableOnInit": false,
    "script": "// Bookmarks â€” Sidebar ç‰ˆï¼ˆä½¿ç”¨ statusBarHelper.v1.sidebarï¼‰\n// åŠŸèƒ½åŒåŸç‰ˆï¼šåŠ å…¥ç›®å‰æª” / æª”æ¡ˆæŒ‘é¸ / é–‹å•Ÿ / é‡æ–°å‘½å / ç·¨è¼¯(åç¨±+å‚™è¨») / è¤‡è£½è·¯å¾‘(åœ¨ webview ç«¯) / ä¸Šä¸‹ç§»å‹• / æœå°‹ / åŒ¯å…¥åŒ¯å‡º / ä¿®å¾©è·¯å¾‘\n// é‡è¦ï¼šå®Œå…¨ä¸ä½¿ç”¨ vscode.Uri ä¾†é–‹æª” â†’ ç”¨å­—ä¸²è·¯å¾‘äº¤çµ¦ openTextDocument\n// å„²å­˜ï¼šworkspace å„ªå…ˆï¼Œfallback globalï¼›é—œé–‰ Sidebarï¼ˆæˆ–è¢«å–ä»£ï¼‰å³è‡ªåœ\n\nconst vscode = require('vscode');\nconst fs = require('fs');\nconst path = require('path');\nconst { storage, vm, sidebar } = statusBarHelper.v1;\n\n(async function () {\n  // ç‹€æ…‹åˆ—æ–‡æ¡ˆï¼ˆå¯é¸ï¼‰\n  const setText = (t) => (typeof vm.setLabel === 'function' ? vm.setLabel(t) : vm.setText?.(t));\n  const setTip  = (t) => vm.setTooltip?.(t);\n  setText('Bookmarks'); setTip('å¸¸ç”¨æª”æ¡ˆå¿«æ·åˆ—');\n\n  // å„²å­˜ (workspace > global)\n  const store = storage?.workspace || storage?.global;\n  if (!store) throw new Error('statusBarHelper.v1.storage ä¸å¯ç”¨');\n  const KEY = 'favorites.files.v6';\n  const defState = { items: [] }; // {id,name,fsPath,note,ts}\n  async function load(){ const s = await store.get(KEY, null); return (s && Array.isArray(s.items)) ? s : defState; }\n  async function save(st){ await store.set(KEY, st); }\n\n  // è¨˜ä½æœ€å¾Œä¸€å€‹æœ‰ç„¦é»çš„ç·¨è¼¯å™¨æª”æ¡ˆè·¯å¾‘\n  let lastFilePath = null;\n  function rememberEditor(ed){ try{ const p = ed?.document?.uri?.fsPath; if(p) lastFilePath = String(p); }catch{} }\n  rememberEditor(vscode.window.activeTextEditor);\n  vscode.window.onDidChangeActiveTextEditor(rememberEditor);\n  vscode.window.onDidChangeTextEditorSelection(e=>rememberEditor(e?.textEditor));\n\n  // è·¯å¾‘å·¥å…·\n  function normalizeFsPath(p) {\n    if (!p) return '';\n    p = String(p).trim();\n    if (process.platform === 'win32') {\n      const isUNC = p.startsWith('\\\\\\\\');\n      p = p.replace(/\\//g, '\\\\');\n      if (!isUNC) p = p.replace(/\\\\{2,}/g, '\\\\');\n    } else {\n      p = p.replace(/\\\\/g, '/').replace(/\\/{2,}/g, '/');\n    }\n    return p;\n  }\n  function cleanPath(raw){\n    if (!raw) return '';\n    let p = String(raw)\n      .replace(/^[\\s'\"]+|[\\s'\"]+$/g, '')\n      .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n    p = normalizeFsPath(p);\n    try { p = path.resolve(p); } catch {}\n    return p;\n  }\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Sidebar é–‹å•Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  await sidebar.open({\n    html: getHtml(),\n    // Sidebar çœŸæ­£è¢«é—œé–‰æ‰åœ VMï¼›è‹¥æ˜¯è¢«æ–° open å–ä»£('replaced')ä¸è™•ç†\n    onClose: (reason) => { if (reason === 'closed') vm.stop(); }\n  });\n  // åå‘ï¼šVM åœæ­¢æ™‚ï¼ŒæŠŠ Sidebar é‚„åŸé è¨­é \n  vm.onStop(() => { try { sidebar.close(); } catch {} });\n\n  // Webview â†’ Host è¨Šæ¯\n  sidebar.onMessage(async (msg) => {\n    try {\n      switch (msg?.type) {\n        case 'ping': {\n          sidebar.postMessage({ type: 'pong' });\n          vscode.window.showInformationMessage('Bookmarks å·²é€£ç·š');\n          break;\n        }\n\n        case 'req:init': {\n          const st = await load();\n          st.items = (st.items || []).map(x => ({\n            id: String(x.id || ''),\n            name: String(x.name || ''),\n            fsPath: normalizeFsPath(String(x.fsPath || '')),\n            note: String(x.note || ''),\n            ts: Number(x.ts || Date.now())\n          }));\n          sidebar.postMessage({ type: 'init', state: st });\n          break;\n        }\n\n        case 'save': {\n          const st = msg.state;\n          if (st && Array.isArray(st.items)){\n            st.items = st.items.map(x=>({\n              id: String(x.id||''),\n              name: String(x.name||''),\n              fsPath: normalizeFsPath(String(x.fsPath||'')),\n              note: String(x.note||''),\n              ts: Number(x.ts||Date.now())\n            }));\n            await save({ items: st.items });\n            sidebar.postMessage({ type: 'saved' });\n          }\n          break;\n        }\n\n        case 'addCurrent': {\n          const fp = normalizeFsPath(String(lastFilePath||'')) || null;\n          sidebar.postMessage({ type: 'current', fsPath: fp });\n          break;\n        }\n\n        case 'pickFile': {\n          const picked = await vscode.window.showOpenDialog({\n            canSelectFiles:true, canSelectFolders:false, canSelectMany:false, openLabel:'é¸æ“‡æª”æ¡ˆ'\n          });\n          const uri = picked?.[0];\n          sidebar.postMessage({ type: 'picked', fsPath: normalizeFsPath(uri?.fsPath || '') || null });\n          break;\n        }\n\n        // åªç”¨å­—ä¸²è·¯å¾‘é–‹æª”ï¼ˆä¸å»ºç«‹ Uriï¼‰\n        case 'openFile': {\n          const raw = (msg && msg.fsPath) ? String(msg.fsPath) : '';\n          const fp  = cleanPath(raw);\n          if (!fp || !fs.existsSync(fp)) {\n            vscode.window.showWarningMessage('Cannot open file:\\n' + (fp || raw || '(empty)'));\n            break;\n          }\n          try {\n            const doc = await vscode.workspace.openTextDocument(fp);\n            await vscode.window.showTextDocument(doc, { preview: false });\n          } catch (e) {\n            vscode.window.showWarningMessage('Cannot open file:\\n' + fp);\n            console.log('[Bookmarks/openFile][fail]', String(e));\n          }\n          break;\n        }\n\n        case 'repath': {\n          const id = String(msg.id || '');\n          if (!id) break;\n          const picked = await vscode.window.showOpenDialog({\n            canSelectFiles: true, canSelectFolders: false, canSelectMany: false,\n            openLabel: 'é¸æ“‡æª”æ¡ˆï¼ˆä¿®å¾©è·¯å¾‘ï¼‰'\n          });\n          const uri = picked?.[0];\n          const newPath = normalizeFsPath(uri?.fsPath || '');\n          if (!newPath) break;\n\n          const st = await load();\n          const idx = st.items.findIndex(x => x.id === id);\n          if (idx >= 0) {\n            st.items[idx].fsPath = newPath;\n            await save(st);\n            sidebar.postMessage({ type: 'init', state: st });\n            vscode.window.showInformationMessage('å·²ä¿®å¾©è·¯å¾‘');\n          }\n          break;\n        }\n\n        case 'copyPath': {\n          const text = String(msg.fsPath || '');\n          sidebar.postMessage({ type: 'doCopy', text });\n          break;\n        }\n\n        case 'notify': {\n          const m = msg.message || '';\n          if (msg.level==='warn') vscode.window.showWarningMessage(m);\n          else if (msg.level==='error') vscode.window.showErrorMessage(m);\n          else vscode.window.showInformationMessage(m);\n          break;\n        }\n      }\n    } catch (e) {\n      vscode.window.showErrorMessage('[Host Error] ' + (e?.message || String(e)));\n    }\n  });\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HTMLï¼ˆWebviewï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  // ä¸åŠ  CSP metaï¼Œæœ€å¤§åŒ–ç›¸å®¹ï¼ˆç´”å…§åµŒ JS/CSSï¼›ä¸é€£å¤–ï¼‰\n  function getHtml(){\n    return [\n'<!doctype html><html lang=\"zh-TW\"><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/>',\n'<title>Bookmarks</title>',\n'<style>',\n'body{margin:0;background:#1e1e1e;color:#ddd;font:12px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}',\n'.bar{display:flex;gap:8px;align-items:center;padding:8px;border-bottom:1px solid #3c3c3c;position:sticky;top:0;background:#1e1e1e;z-index:5;flex-wrap:wrap}',\n'.btn{border:1px solid #3c3c3c;background:rgba(255,255,255,.03);color:#ddd;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:12px}',\n'.btn.primary{background:#0e639c;border-color:transparent;color:#fff}',\n'.list{display:grid;grid-template-columns:1fr;gap:8px;padding:8px}',\n'.card{border:1px solid #3c3c3c;border-radius:10px;background:rgba(255,255,255,.03);padding:8px;display:flex;flex-direction:column;gap:6px}',\n'.row{display:flex;gap:6px;flex-wrap:wrap;align-items:center}',\n'.title{margin:0;font-size:12px}',\n'.path{margin:0;color:#999;font-size:11px;word-break:break-all}',\n'.note{margin:0;color:#ccc;font-size:11px;white-space:pre-wrap;overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3}',\n'input[type=text]{background:rgba(255,255,255,.03);border:1px solid #3c3c3c;color:#ddd;border-radius:8px;padding:6px 10px;font-size:12px;width:240px}',\n'dialog{border:1px solid #3c3c3c;background:#1e1e1e;color:#ddd;border-radius:10px;padding:0;width:min(560px,90vw)}',\n'dialog header{padding:8px;border-bottom:1px solid #3c3c3c}',\n'dialog main{padding:8px}',\n'textarea{width:100%;min-height:96px;background:rgba(255,255,255,.03);border:1px solid #3c3c3c;color:#ddd;border-radius:8px;padding:6px 10px;font-size:12px}',\n'.flex-end{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}',\n'</style></head><body>',\n'<div class=\"bar\">',\n'  <button id=\"btnAddCurrent\" class=\"btn primary\" type=\"button\">åŠ å…¥ç›®å‰æª”</button>',\n'  <button id=\"btnPick\" class=\"btn\" type=\"button\">å¾æª”æ¡ˆæŒ‘é¸</button>',\n'  <button id=\"btnExport\" class=\"btn\" type=\"button\">åŒ¯å‡ºJSON</button>',\n'  <button id=\"btnImport\" class=\"btn\" type=\"button\">åŒ¯å…¥JSON</button>',\n'  <input id=\"q\" type=\"text\" placeholder=\"æœå°‹åç¨±/è·¯å¾‘/å‚™è¨» (å³æ™‚)\"/>',\n'</div>',\n'<div id=\"list\" class=\"list\"></div>',\n'<dialog id=\"editDlg\"><header>æ›¸ç±¤</header><main>',\n'  <div style=\"margin:6px 0\">åç¨±</div><input id=\"fName\" type=\"text\" />',\n'  <div style=\"margin:8px 0 6px\">å‚™è¨»</div><textarea id=\"fNote\" placeholder=\"å¯ç•™ç©º\"></textarea>',\n'  <div class=\"flex-end\"><button id=\"editCancel\" class=\"btn\" type=\"button\">å–æ¶ˆ</button><button id=\"editOk\" class=\"btn primary\" type=\"button\">ç¢ºå®š</button></div>',\n'</main></dialog>',\n'<dialog id=\"renameDlg\"><header>é‡æ–°å‘½å</header><main>',\n'  <input id=\"renameText\" type=\"text\" />',\n'  <div class=\"flex-end\"><button id=\"renameCancel\" class=\"btn\" type=\"button\">å–æ¶ˆ</button><button id=\"renameOk\" class=\"btn primary\" type=\"button\">ç¢ºå®š</button></div>',\n'</main></dialog>',\n'<script>',\n'var vscode = acquireVsCodeApi();',\n'var state = {items:[]};',\n'var listEl = document.getElementById(\"list\"); var qEl = document.getElementById(\"q\");',\n'var editDlg=document.getElementById(\"editDlg\"), fName=document.getElementById(\"fName\"), fNote=document.getElementById(\"fNote\"), editOk=document.getElementById(\"editOk\"), editCancel=document.getElementById(\"editCancel\");',\n'var renameDlg=document.getElementById(\"renameDlg\"), renameText=document.getElementById(\"renameText\"), renameOk=document.getElementById(\"renameOk\"), renameCancel=document.getElementById(\"renameCancel\");',\n'var pendingNewPath=null, editingId=null;',\n'function send(t,d){ var o=d||{}; o.type=t; vscode.postMessage(o); }',\n'function uid(){ return Math.random().toString(36).slice(2)+Date.now().toString(36); }',\n'function base(p){ if(!p) return \"\"; var i=Math.max(p.lastIndexOf(\"/\"),p.lastIndexOf(\"\\\\\\\\\")); return i>=0?p.slice(i+1):p; }',\n'function persist(){ send(\"save\",{state:state}); }',\n'function render(){ var q=(qEl.value||\"\").toLowerCase().trim(); var items=state.items.filter(function(it){ return !q || (it.name||\"\").toLowerCase().indexOf(q)>=0 || (it.fsPath||\"\").toLowerCase().indexOf(q)>=0 || (it.note||\"\").toLowerCase().indexOf(q)>=0; }); listEl.innerHTML=\"\"; if(!items.length){ var d=document.createElement(\"div\"); d.className=\"path\"; d.textContent=q?\"æ²’æœ‰ç¬¦åˆçš„é …ç›®\":\"å°šæœªåŠ å…¥ä»»ä½•æ›¸ç±¤ï¼Œä½¿ç”¨ä¸Šæ–¹æŒ‰éˆ•æ–°å¢ã€‚\"; d.style.padding=\"6px\"; listEl.appendChild(d); return; } items.forEach(function(it){ listEl.appendChild(card(it)); }); }',\n'function card(it){ var c=document.createElement(\"div\"); c.className=\"card\"; var h=document.createElement(\"h4\"); h.className=\"title\"; h.textContent=it.name||base(it.fsPath)||\"(æœªå‘½å)\"; c.appendChild(h); var p=document.createElement(\"p\"); p.className=\"path\"; p.textContent=it.fsPath||\"\"; c.appendChild(p); if(it.note){ var n=document.createElement(\"p\"); n.className=\"note\"; n.textContent=it.note; c.appendChild(n); } var r=document.createElement(\"div\"); r.className=\"row\"; ',\n'  r.appendChild(btn(\"é–‹å•Ÿ\", function(){ if(!it.fsPath){ alert(\"é€™å€‹æ›¸ç±¤ç›®å‰æ²’æœ‰è·¯å¾‘ï¼Œè«‹å…ˆé»ã€Œä¿®å¾©è·¯å¾‘ã€ã€‚\"); return; } send(\"openFile\",{fsPath:it.fsPath}); }));',\n'  r.appendChild(btn(\"ä¸Šç§»\", function(){ move(it.id,-1);}));',\n'  r.appendChild(btn(\"ä¸‹ç§»\", function(){ move(it.id,1);}));',\n'  r.appendChild(btn(\"ç·¨è¼¯\", function(){ openEdit(it.id);}));',\n'  r.appendChild(btn(\"é‡æ–°å‘½å\", function(){ openRename(it.id, it.name||base(it.fsPath)); }));',\n'  r.appendChild(btn(\"è¤‡è£½è·¯å¾‘\", function(){ if(!it.fsPath){ alert(\"æ²’æœ‰å¯è¤‡è£½çš„è·¯å¾‘ï¼Œè«‹å…ˆã€Œä¿®å¾©è·¯å¾‘ã€ã€‚\"); return; } send(\"copyPath\",{fsPath:it.fsPath}); }));',\n'  r.appendChild(btn(\"ä¿®å¾©è·¯å¾‘\", function(){ send(\"repath\",{id: it.id}); }));',\n'  r.appendChild(btn(\"ç§»é™¤\", function(){ removeItem(it.id);}));',\n'  c.appendChild(r); return c; }',\n'function btn(t,fn){ var b=document.createElement(\"button\"); b.className=\"btn\"; b.type=\"button\"; b.textContent=t; b.onclick=fn; return b; }',\n'function addItem(fsPath,name,note){ if(!fsPath){ send(\"notify\",{level:\"warn\",message:\"æ²’æœ‰å¯åŠ å…¥çš„æª”æ¡ˆ\"}); return; } state.items.unshift({id:uid(),name:(name||\"\").trim()||base(fsPath),fsPath:fsPath,note:(note||\"\"),ts:Date.now()}); persist(); render(); }',\n'function removeItem(id){ state.items = state.items.filter(function(x){return x.id!==id;}); persist(); render(); }',\n'function move(id,d){ var i=state.items.findIndex(function(x){return x.id===id;}); if(i<0) return; var j=i+d; if(j<0||j>=state.items.length) return; var x=state.items.splice(i,1)[0]; state.items.splice(j,0,x); persist(); render(); }',\n'function openRename(id,cur){ editingId=id; renameText.value=cur||\"\"; renameDlg.showModal(); renameText.focus(); renameText.select(); }',\n'renameOk.onclick=function(){ var it=state.items.find(function(x){return x.id===editingId;}); if(it){ var v=(renameText.value||\"\").trim(); it.name=v||base(it.fsPath); persist(); render(); } renameDlg.close(); };',\n'renameCancel.onclick=function(){ renameDlg.close(); };',\n'function openEdit(id){ editingId=id; var it=state.items.find(function(x){return x.id===id;}); if(!it) return; pendingNewPath=it.fsPath; fName.value=it.name||base(it.fsPath); fNote.value=it.note||\"\"; editDlg.showModal(); fName.focus(); fName.select(); }',\n'function openCreate(fp){ editingId=null; pendingNewPath=fp; fName.value=base(fp)||\"\"; fNote.value=\"\"; editDlg.showModal(); fName.focus(); fName.select(); }',\n'editOk.onclick=function(){ var name=(fName.value||\"\").trim(); var note=(fNote.value||\"\"); if(editingId){ var it=state.items.find(function(x){return x.id===editingId;}); if(it){ it.name=name||base(it.fsPath); it.note=note; persist(); render(); } }else{ addItem(pendingNewPath,name,note); } editDlg.close(); };',\n'editCancel.onclick=function(){ editDlg.close(); };',\n'document.getElementById(\"btnAddCurrent\").onclick=function(){ send(\"addCurrent\"); };',\n'document.getElementById(\"btnPick\").onclick=function(){ send(\"pickFile\"); };',\n'document.getElementById(\"btnExport\").onclick=function(){ try{ var blob=new Blob([JSON.stringify(state,null,2)],{type:\"application/json\"}); var url=URL.createObjectURL(blob); var a=document.createElement(\"a\"); a.href=url; a.download=\"favorites.files.json\"; a.click(); setTimeout(function(){URL.revokeObjectURL(url);},0);}catch(e){ alert(\"åŒ¯å‡ºå¤±æ•—: \"+e); } };',\n'document.getElementById(\"btnImport\").onclick=function(){ try{ var i=document.createElement(\"input\"); i.type=\"file\"; i.accept=\"application/json\"; i.onchange=function(){ var f=i.files&&i.files[0]; if(!f) return; var rd=new FileReader(); rd.onload=function(){ try{ var j=JSON.parse(String(rd.result||\"{}\")); if(Array.isArray(j.items)){ state={items:j.items.map(function(x){ return {id:x.id||uid(),name:x.name||\"\",fsPath:x.fsPath||\"\",note:x.note||\"\",ts:x.ts||Date.now()}; })}; persist(); render(); } else { alert(\"æ ¼å¼ä¸æ­£ç¢º: ç¼ºå°‘ items\"); } }catch(ex){ alert(\"JSON è§£æå¤±æ•—: \"+ex); } }; rd.readAsText(f); }; i.click(); }catch(e){ alert(\"åŒ¯å…¥å¤±æ•—: \"+e); } };',\n'qEl.oninput=function(){ render(); };',\n'window.addEventListener(\"message\",function(e){ var m=e.data||{};',\n'  if(m.type===\"init\"){ state=m.state||{items:[]}; render(); }',\n'  if(m.type===\"picked\"&&m.fsPath){ openCreate(m.fsPath); }',\n'  if(m.type===\"current\"&&m.fsPath){ openCreate(m.fsPath); }',\n'  if(m.type===\"doCopy\"){ var text=m.text||\"\"; if(navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(text).then(function(){ send(\"notify\",{message:\"å·²è¤‡è£½è·¯å¾‘\"}); }).catch(function(){ fallbackCopy(text); }); } else { fallbackCopy(text); } }',\n'});',\n'function fallbackCopy(text){ try{ var ta=document.createElement(\"textarea\"); ta.value=text; ta.setAttribute(\"readonly\",\"\"); ta.style.position=\"fixed\"; ta.style.opacity=\"0\"; document.body.appendChild(ta); ta.select(); document.execCommand(\"copy\"); document.body.removeChild(ta); send(\"notify\",{message:\"å·²è¤‡è£½è·¯å¾‘\"}); }catch(e){ send(\"notify\",{level:\"error\",message:\"è¤‡è£½å¤±æ•—: \"+(e&&e.message||e)}); } }',\n'window.addEventListener(\"load\",function(){ send(\"ping\"); send(\"req:init\"); });',\n'</script></body></html>'\n    ].join('');\n  }\n})();\n",
    "tags": [
      "default",
      "tool"
    ]
  },
  {
    "command": "sbh.demo.whiteboard",
    "text": "$(paintcan) Board",
    "tooltip": "ç°¡æ˜“ç™½æ¿ Webviewï¼ˆç¯„ä¾‹ï¼‰",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "tool"
    ],
    "script": "// Whiteboard (no save): draw-only Webview + Export PNG + correct Undo/Redo scaling\nconst vscode = require('vscode');\nconst fs = require('fs');\nconst path = require('path');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhWhiteboard',\n    'Whiteboard â€” Draw Only',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  vm.onStop(reason => {\n    try { panel.dispose(); } catch {}\n  });\n\n  panel.onDidDispose(() => {\n    vm.stop();\n  });\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n\n  // æ¥æ”¶ webview çš„åŒ¯å‡ºè«‹æ±‚ â†’ å­˜æª”\n  panel.webview.onDidReceiveMessage(async (msg) => {\n    if (msg?.type !== 'exportPNG' || typeof msg.dataURL !== 'string') return;\n    try {\n      const now = new Date();\n      const y = now.getFullYear();\n      const m = String(now.getMonth()+1).padStart(2,'0');\n      const d = String(now.getDate()).padStart(2,'0');\n      const hh = String(now.getHours()).padStart(2,'0');\n      const mm = String(now.getMinutes()).padStart(2,'0');\n      const ss = String(now.getSeconds()).padStart(2,'0');\n      const defaultName = `whiteboard-${y}${m}${d}-${hh}${mm}${ss}.png`;\n\n      const uri = await vscode.window.showSaveDialog({\n        saveLabel: 'Export PNG',\n        defaultUri: vscode.Uri.file(path.join(process.cwd(), defaultName)),\n        filters: { 'PNG Image': ['png'] }\n      });\n      if (!uri) return;\n\n      const base64 = msg.dataURL.split(',')[1] || '';\n      fs.writeFileSync(uri.fsPath, Buffer.from(base64, 'base64'));\n\n      vscode.window.showInformationMessage(`âœ… Exported: ${path.basename(uri.fsPath)}`);\n      panel.webview.postMessage({ type: 'exported', file: uri.fsPath });\n    } catch (e) {\n      vscode.window.showErrorMessage('Export failed: ' + (e?.message || e));\n    }\n  });\n\n  function getHtml(nonce){\n    return `<!doctype html>\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n<title>Whiteboard (Draw Only)</title>\n<style>\n  :root{ --h:32px }\n  body{font-family:var(--vscode-font-family);color:var(--vscode-foreground);background:var(--vscode-editor-background);margin:0}\n  .bar{display:flex;align-items:center;gap:8px;border-bottom:1px solid var(--vscode-editorGroup-border);padding:6px 8px;height:var(--h);user-select:none;background:var(--vscode-sideBar-background)}\n  .bar input[type=\"color\"]{width:28px;height:20px;border:1px solid var(--vscode-input-border);background:var(--vscode-input-background)}\n  .bar input[type=\"range\"]{width:120px}\n  button{background:var(--vscode-button-background);color:var(--vscode-button-foreground);border:1px solid var(--vscode-button-border,transparent);padding:4px 10px;border-radius:4px;cursor:pointer}\n  button:hover{background:var(--vscode-button-hoverBackground)}\n  #wrap{position:relative;height:calc(100vh - var(--h) - 2px)}\n  canvas{width:100%;height:100%}\n  #grid{position:absolute;inset:0;background:\n        linear-gradient(to right, transparent 99%, var(--vscode-editorGroup-border) 0) 0 0/20px 20px,\n        linear-gradient(to bottom, transparent 99%, var(--vscode-editorGroup-border) 0) 0 0/20px 20px;pointer-events:none;opacity:.2}\n  #msg{margin-left:auto;opacity:.85;font-size:.9em}\n</style>\n<div class=\"bar\">\n  <span>Color</span><input id=\"color\" type=\"color\" value=\"#00d3a7\">\n  <span>Size</span><input id=\"size\" type=\"range\" min=\"1\" max=\"32\" value=\"4\">\n  <button id=\"undo\">Undo</button>\n  <button id=\"redo\">Redo</button>\n  <button id=\"clear\">Clear</button>\n  <span style=\"flex:1\"></span>\n  <button id=\"export\">Export PNG</button>\n  <span id=\"msg\"></span>\n</div>\n<div id=\"wrap\">\n  <canvas id=\"c\"></canvas>\n  <div id=\"grid\"></div>\n</div>\n<script nonce=\"${nonce}\">\n  const vscode = acquireVsCodeApi();\n  const c = document.getElementById('c');\n  const ctx = c.getContext('2d');\n  let drawing=false, last=null;\n  let color=document.getElementById('color').value;\n  let size=+document.getElementById('size').value;\n  const undoStack=[], redoStack=[];\n  const msgEl = document.getElementById('msg');\n\n  function flash(t){ msgEl.textContent=t; setTimeout(()=>msgEl.textContent='', 2000); }\n  function dpr(){ return window.devicePixelRatio || 1; }\n  function applyScale(){ ctx.setTransform(1,0,0,1,0,0); ctx.scale(dpr(), dpr()); }\n\n  function resize(){\n    const r=c.getBoundingClientRect();\n    const tmp=document.createElement('canvas');\n    tmp.width=c.width; tmp.height=c.height;\n    tmp.getContext('2d').drawImage(c,0,0);\n\n    c.width = Math.max(1, Math.round(r.width  * dpr()));\n    c.height= Math.max(1, Math.round(r.height * dpr()));\n    applyScale();\n    try { ctx.drawImage(tmp, 0,0, tmp.width, tmp.height, 0,0, c.width, c.height); } catch {}\n  }\n  new ResizeObserver(resize).observe(document.getElementById('wrap'));\n  setTimeout(resize,0);\n\n  function line(p1,p2){\n    ctx.strokeStyle=color; ctx.lineWidth=size; ctx.lineCap='round'; ctx.lineJoin='round';\n    ctx.beginPath(); ctx.moveTo(p1.x,p1.y); ctx.lineTo(p2.x,p2.y); ctx.stroke();\n  }\n  function pos(e){ const r=c.getBoundingClientRect(); return { x:e.clientX-r.left, y:e.clientY-r.top }; }\n\n  function makeSnap(){ return { w: c.width, h: c.height, url: c.toDataURL('image/png') }; }\n  function snapshot(){ try{ undoStack.push(makeSnap()); if(undoStack.length>30) undoStack.shift(); }catch{} redoStack.length=0; }\n  function restore(snap){\n    return new Promise(res=>{\n      const img=new Image();\n      img.onload=()=>{\n        ctx.setTransform(1,0,0,1,0,0);\n        ctx.clearRect(0,0,c.width,c.height);\n        ctx.drawImage(img, 0,0, snap.w, snap.h, 0,0, c.width, c.height);\n        applyScale();\n        res();\n      };\n      img.src=snap.url;\n    });\n  }\n\n  c.addEventListener('pointerdown', e=>{ e.preventDefault(); snapshot(); drawing=true; last=pos(e); });\n  c.addEventListener('pointermove', e=>{ if(!drawing) return; const p=pos(e); line(last,p); last=p; });\n  c.addEventListener('pointerup',   ()=>{ drawing=false; last=null; });\n  c.addEventListener('pointerleave',()=>{ drawing=false; last=null; });\n\n  document.getElementById('color').oninput=e=>color=e.target.value;\n  document.getElementById('size').oninput =e=>size=+e.target.value;\n\n  document.getElementById('undo').onclick = async ()=>{\n    if(!undoStack.length) return;\n    const snap = undoStack.pop();\n    redoStack.push(makeSnap());\n    await restore(snap);\n  };\n  document.getElementById('redo').onclick = async ()=>{\n    if(!redoStack.length) return;\n    const snap = redoStack.pop();\n    undoStack.push(makeSnap());\n    await restore(snap);\n  };\n  document.getElementById('clear').onclick = ()=>{\n    snapshot();\n    ctx.setTransform(1,0,0,1,0,0);\n    ctx.clearRect(0,0,c.width,c.height);\n    applyScale();\n  };\n\n  document.getElementById('export').onclick= ()=>{\n    try{\n      const url=c.toDataURL('image/png');\n      vscode.postMessage({ type:'exportPNG', dataURL: url });\n      flash('Exportingâ€¦');\n    }catch(e){ flash('Export failed'); }\n  };\n  window.addEventListener('message', e=>{\n    const m=e.data||{};\n    if(m.type==='exported'){\n      const name=(m.file||'').split(/[\\\\/]/).pop()||m.file;\n      flash('Saved: '+name);\n    }\n  });\n<\\/script>`;\n  }\n})();"
  },
  {
    "command": "sbh.demo.pomodoro",
    "text": "ğŸ… Pomodoro",
    "tooltip": "ç•ªèŒ„é˜è¨ˆæ™‚å™¨ï¼ˆç‹€æ…‹åˆ—ï¼‰",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "tool"
    ],
    "script": "// @ts-check\n// ğŸ… Pomodoro in Status Bar â€” Quick Pick (Start / Stop, auto-clean on abort)\nconst vscode = require('vscode');\nconst { setInterval, clearInterval } = require('timers');\nconst { randomUUID } = require('crypto');\nconst { vm } = statusBarHelper.v1;\n\n(function () {\n  const DEFAULT_MIN = 25;\n  const PRIORITY = 1000;\n  const KEY = '__SBH_POMODORO_SINGLETON__';\n  /** @type {{\n   *  item?: vscode.StatusBarItem,\n   *  timer?: NodeJS.Timeout|null,\n   *  endAt?: number,\n   *  mode?: 'idle'|'running',\n   *  minutes?: number,\n   *  cmdId?: string,\n   *  disposable?: vscode.Disposable|null\n   * }} */\n  const S = (globalThis[KEY] ||= {\n    timer: null, endAt: 0, mode: 'idle', minutes: DEFAULT_MIN, disposable: null\n  });\n\n  const fmt = (secs) => {\n    const m = Math.floor(secs / 60);\n    const s = secs % 60;\n    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;\n  };\n\n  const createItem = () => {\n    if (!S.item) {\n      S.item = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right, PRIORITY);\n      S.item.command = getCommandId();\n      S.item.tooltip = 'Pomodoro â€” click to open menu';\n      S.item.show();\n    }\n  };\n\n  const getCommandId = () => {\n    if (!S.cmdId) S.cmdId = `sbh.pomodoro.menu.${randomUUID()}`;\n    if (!S.disposable) {\n      try {\n        S.disposable = vscode.commands.registerCommand(S.cmdId, openMenu);\n      } catch {}\n    }\n    return S.cmdId;\n  };\n\n  const update = () => {\n    if (!S.item) return;\n    if (S.mode !== 'running') {\n      S.item.text = `ğŸ… ${String(S.minutes).padStart(2,'0')}:00`;\n      S.item.tooltip = 'Pomodoro â€” click to open menu';\n      return;\n    }\n    const remain = Math.max(0, Math.ceil((S.endAt - Date.now()) / 1000));\n    S.item.text = `ğŸ… ${fmt(remain)}`;\n    S.item.tooltip = 'Counting down â€” click to open menu';\n    if (remain <= 0) finish();\n  };\n\n  const start = (minutes = S.minutes) => {\n    createItem();\n    clearTimer();\n    S.minutes = minutes;\n    S.endAt = Date.now() + minutes * 60 * 1000;\n    S.mode = 'running';\n    update();\n    S.timer = setInterval(update, 1000);\n    vscode.window.showInformationMessage(`ğŸ… Started ${minutes} minutes`);\n  };\n\n  const finish = () => {\n    clearTimer();\n    S.mode = 'idle';\n    update();\n    vscode.window.showInformationMessage('â° Timeâ€™s up! Take a break.');\n    vscode.window.showWarningMessage('â° Pomodoro is over! Start another round?', 'Restart', 'Cancel')\n      .then(choice => { if (choice === 'Restart') start(S.minutes); });\n  };\n\n  const closeAll = () => {\n    clearTimer();\n    S.mode = 'idle';\n    if (S.item) { S.item.dispose(); S.item = undefined; }\n    if (S.disposable) { S.disposable.dispose(); S.disposable = null; }\n    S.cmdId = undefined;\n  };\n\n  const clearTimer = () => {\n    if (S.timer) { clearInterval(S.timer); S.timer = null; }\n  };\n\n  async function openMenu() {\n    const remain = S.mode === 'running' ? Math.max(0, Math.ceil((S.endAt - Date.now())/1000)) : null;\n    /** @type {Array<{label:string, detail?:string, action:'start'|'close'|'custom'|'stop'}>} */\n    const picks = [];\n\n    if (S.mode === 'running') {\n      picks.push({ label: 'Stop', detail: `Stop current timer (remaining ${fmt(remain)})`, action: 'stop' });\n      picks.push({ label: 'Start', detail: `Restart ${S.minutes} minutes`, action: 'start' });\n    } else {\n      picks.push({ label: 'Start', detail: `Start ${S.minutes} minute timer`, action: 'start' });\n    }\n    picks.push({ label: 'Custom minutesâ€¦', detail: 'Enter 1â€“120 minutes to start', action: 'custom' });\n    picks.push({ label: 'Close', detail: 'Remove status bar item', action: 'close' });\n\n    const picked = await vscode.window.showQuickPick(picks, {\n      placeHolder: 'Pomodoro â€” choose an action',\n      ignoreFocusOut: true\n    });\n    if (!picked) return;\n\n    if (picked.action === 'start') start(S.minutes);\n    else if (picked.action === 'stop') { clearTimer(); S.mode = 'idle'; update(); }\n    else if (picked.action === 'close') closeAll();\n    else if (picked.action === 'custom') {\n      const v = await vscode.window.showInputBox({\n        prompt: 'Enter minutes (1â€“120)',\n        value: String(S.minutes),\n        validateInput: (s) => {\n          const n = Number(s);\n          if (!Number.isFinite(n) || n < 1 || n > 120) return 'Enter an integer between 1 and 120';\n          return null;\n        }\n      });\n      if (v) start(Number(v));\n    }\n  }\n\n  // Automatically clean up when externally stopped (e.g., rerun, delete, hide, script change, or disable).\n  vm.onStop(reason => {\n    try { closeAll(); } catch {}\n  });\n\n  createItem();\n  update();\n})();"
  },
  {
    "command": "sbh.demo.vmChatA",
    "text": "$(comment) Chat A",
    "tooltip": "VM è¨Šæ¯å‚³éç¤ºä¾‹ (A) â€” vm.open / sendMessage / onMessage",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "example"
    ],
    "script": "// VM Chat A â€” demonstrates vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop\n// Commands assumed:\n//   A: sbh.demo.vmChatA\n//   B: sbh.demo.vmChatB\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  const SELF = 'sbh.demo.vmChatA';\n  const PEER = 'sbh.demo.vmChatB';\n  let panel;\n\n  vm.onStop(() => { try { panel?.dispose(); } catch {} });\n\n  function ensurePanel () {\n    if (panel) return panel;\n    panel = vscode.window.createWebviewPanel(\n      'sbhVmChatA',\n      'VM Chat A',\n      vscode.ViewColumn.Active,\n      { enableScripts: true, retainContextWhenHidden: true }\n    );\n    panel.onDidDispose(() => { try { vm.stop(); } catch {} });\n\n    const nonce = Math.random().toString(36).slice(2);\n    panel.webview.html = getHtml(nonce, 'A', SELF, PEER);\n    panel.webview.onDidReceiveMessage(onWebviewMessage);\n    return panel;\n  }\n\n  function log (line) { try { panel?.webview.postMessage({ type: 'append', line }); } catch {} }\n\n  function onWebviewMessage (msg) {\n    if (!msg || typeof msg !== 'object') return;\n\n    if (msg.type === 'send') {\n      const text = String(msg.text || '').trim();\n      if (!text) return;\n      vm.sendMessage(PEER, { from: SELF, text, at: Date.now() });\n      log('[me -> B] ' + text);\n    } else if (msg.type === 'openPeer') {\n      vm.open(PEER, { from: SELF, text: 'ğŸ‘‹ Hello (started from A)', at: Date.now() })\n        .catch(e => log('[open error] ' + (e?.message || e)));\n      log('[system] Requested to open B');\n    } else if (msg.type === 'stopPeer') {\n      try { vm.stopByCommand(PEER, { type: 'peerStop', from: SELF, at: Date.now() }); }\n      catch (e) { log('[stopPeer error] ' + (e?.message || e)); }\n      log('[system] Requested to stop B');\n    } else if (msg.type === 'stopSelf') {\n      try { vm.stop({ type: 'selfStop', from: SELF, at: Date.now() }); } catch {}\n    }\n  }\n\n  // Receive messages from peer\n  vm.onMessage((from, payload) => {\n    try {\n      if (from !== PEER) return; // Only show peer messages\n      const text = (payload && payload.text != null) ? String(payload.text) : JSON.stringify(payload);\n      const ts = new Date(payload?.at || Date.now()).toLocaleTimeString();\n      log('[B -> me @ ' + ts + '] ' + text);\n    } catch (e) {\n      log('[recv error] ' + (e?.message || e));\n    }\n  });\n\n  ensurePanel();\n  log('[system] Chat A ready. Use the buttons to interact with Chat B.');\n})();\n\nfunction getHtml (nonce, label, selfCmd, peerCmd) {\n  return `<!doctype html>\n<meta charset=\"utf-8\" />\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'\">\n<title>VM Chat ${label}</title>\n<style>\n  body{font-family:var(--vscode-font-family);margin:0;background:var(--vscode-editor-background);color:var(--vscode-foreground);}\n  header{padding:8px;border-bottom:1px solid var(--vscode-editorGroup-border);display:flex;gap:8px;align-items:center;flex-wrap:wrap;}\n  button{background:var(--vscode-button-background);color:var(--vscode-button-foreground);border:1px solid var(--vscode-button-border,transparent);padding:4px 10px;border-radius:4px;cursor:pointer;font-size:.9em;}\n  button:hover{background:var(--vscode-button-hoverBackground);}\n  input{flex:1;min-width:160px;padding:4px 6px;background:var(--vscode-input-background);color:var(--vscode-input-foreground);border:1px solid var(--vscode-input-border);border-radius:3px;}\n  #log{padding:8px;font:12px var(--vscode-editor-font-family,monospace);white-space:pre-wrap;overflow:auto;max-height:60vh;}\n  footer{padding:6px 8px;border-top:1px solid var(--vscode-editorGroup-border);font-size:11px;opacity:.7;}\n  .cmd{opacity:.7;font-size:.8em}\n</style>\n<header>\n  <strong>Chat ${label}</strong>\n  <button id=\"openPeer\" title=\"Start peer script if not running\">Open Peer</button>\n  <button id=\"stopPeer\" title=\"Stop peer script\">Stop Peer</button>\n  <button id=\"stopSelf\" title=\"Stop this script\">Stop Self</button>\n  <input id=\"msg\" placeholder=\"Type messageâ€¦\" />\n  <button id=\"send\">Send</button>\n</header>\n<div id=\"log\" tabindex=\"0\"></div>\n<footer>self: <code>${selfCmd}</code> &nbsp; peer: <code>${peerCmd}</code> â€” Demonstrating vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop</footer>\n<script nonce=\"${nonce}\">\n  const vscode = acquireVsCodeApi();\n  const logEl = document.getElementById('log');\n\n  function append(line){\n    const at = new Date().toLocaleTimeString();\n    logEl.textContent += \\`[\\${at}] \\${line}\\\\n\\`;\n    logEl.scrollTop = logEl.scrollHeight;\n  }\n\n  append('script injected');\n\n  window.addEventListener('message', e => {\n    const m = e.data || {};\n    if (m.type === 'append') append(m.line);\n  });\n\n  document.getElementById('send').onclick = () => {\n    const el = document.getElementById('msg');\n    vscode.postMessage({ type: 'send', text: el.value });\n    el.value = '';\n  };\n\n  document.getElementById('openPeer').onclick = () => vscode.postMessage({ type: 'openPeer' });\n  document.getElementById('stopPeer').onclick = () => vscode.postMessage({ type: 'stopPeer' });\n  document.getElementById('stopSelf').onclick = () => vscode.postMessage({ type: 'stopSelf' });\n\n  document.getElementById('msg').addEventListener('keydown', e => {\n    if (e.key === 'Enter') document.getElementById('send').click();\n  });\n\n  append('UI loaded.');\n</script>`;\n}\n"
  },
  {
    "command": "sbh.demo.vmChatB",
    "text": "$(comment-discussion) Chat B",
    "tooltip": "VM è¨Šæ¯å‚³éç¤ºä¾‹ (B) â€” vm.open / sendMessage / onMessage",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "example"
    ],
    "script": "// VM Chat B â€” demonstrates vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop\n// Commands assumed:\n//   A: sbh.demo.vmChatA\n//   B: sbh.demo.vmChatB\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  const SELF = 'sbh.demo.vmChatB';\n  const PEER = 'sbh.demo.vmChatA';\n  let panel;\n\n  vm.onStop(() => { try { panel?.dispose(); } catch {} });\n\n  function ensurePanel () {\n    if (panel) return panel;\n    panel = vscode.window.createWebviewPanel(\n      'sbhVmChatB',\n      'VM Chat B',\n      vscode.ViewColumn.Active,\n      { enableScripts: true, retainContextWhenHidden: true }\n    );\n    panel.onDidDispose(() => { try { vm.stop(); } catch {} });\n\n    const nonce = Math.random().toString(36).slice(2);\n    panel.webview.html = getHtml(nonce, 'B', SELF, PEER);\n    panel.webview.onDidReceiveMessage(onWebviewMessage);\n    return panel;\n  }\n\n  function log (line) { try { panel?.webview.postMessage({ type: 'append', line }); } catch {} }\n\n  function onWebviewMessage (msg) {\n    if (!msg || typeof msg !== 'object') return;\n\n    if (msg.type === 'send') {\n      const text = String(msg.text || '').trim();\n      if (!text) return;\n      vm.sendMessage(PEER, { from: SELF, text, at: Date.now() });\n      log('[me -> A] ' + text);\n    } else if (msg.type === 'openPeer') {\n      vm.open(PEER, { from: SELF, text: 'ğŸ‘‹ Hello (started from B)', at: Date.now() })\n        .catch(e => log('[open error] ' + (e?.message || e)));\n      log('[system] Requested to open A');\n    } else if (msg.type === 'stopPeer') {\n      try { vm.stopByCommand(PEER, { type: 'peerStop', from: SELF, at: Date.now() }); }\n      catch (e) { log('[stopPeer error] ' + (e?.message || e)); }\n      log('[system] Requested to stop A');\n    } else if (msg.type === 'stopSelf') {\n      try { vm.stop({ type: 'selfStop', from: SELF, at: Date.now() }); } catch {}\n    }\n  }\n\n  // Receive messages from peer\n  vm.onMessage((from, payload) => {\n    try {\n      if (from !== PEER) return; // Only show peer messages\n      const text = (payload && payload.text != null) ? String(payload.text) : JSON.stringify(payload);\n      const ts = new Date(payload?.at || Date.now()).toLocaleTimeString();\n      log('[A -> me @ ' + ts + '] ' + text);\n    } catch (e) {\n      log('[recv error] ' + (e?.message || e));\n    }\n  });\n\n  ensurePanel();\n  log('[system] Chat B ready. Use the buttons to interact with Chat A.');\n})();\n\nfunction getHtml (nonce, label, selfCmd, peerCmd) {\n  return `<!doctype html>\n<meta charset=\"utf-8\" />\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'\">\n<title>VM Chat ${label}</title>\n<style>\n  body{font-family:var(--vscode-font-family);margin:0;background:var(--vscode-editor-background);color:var(--vscode-foreground);}\n  header{padding:8px;border-bottom:1px solid var(--vscode-editorGroup-border);display:flex;gap:8px;align-items:center;flex-wrap:wrap;}\n  button{background:var(--vscode-button-background);color:var(--vscode-button-foreground);border:1px solid var(--vscode-button-border,transparent);padding:4px 10px;border-radius:4px;cursor:pointer;font-size:.9em;}\n  button:hover{background:var(--vscode-button-hoverBackground);}\n  input{flex:1;min-width:160px;padding:4px 6px;background:var(--vscode-input-background);color:var(--vscode-input-foreground);border:1px solid var(--vscode-input-border);border-radius:3px;}\n  #log{padding:8px;font:12px var(--vscode-editor-font-family,monospace);white-space:pre-wrap;overflow:auto;max-height:60vh;}\n  footer{padding:6px 8px;border-top:1px solid var(--vscode-editorGroup-border);font-size:11px;opacity:.7;}\n  .cmd{opacity:.7;font-size:.8em}\n</style>\n<header>\n  <strong>Chat ${label}</strong>\n  <button id=\"openPeer\" title=\"Start peer script if not running\">Open Peer</button>\n  <button id=\"stopPeer\" title=\"Stop peer script\">Stop Peer</button>\n  <button id=\"stopSelf\" title=\"Stop this script\">Stop Self</button>\n  <input id=\"msg\" placeholder=\"Type messageâ€¦\" />\n  <button id=\"send\">Send</button>\n</header>\n<div id=\"log\" tabindex=\"0\"></div>\n<footer>self: <code>${selfCmd}</code> &nbsp; peer: <code>${peerCmd}</code> â€” Demonstrating vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop</footer>\n<script nonce=\"${nonce}\">\n  const vscode = acquireVsCodeApi();\n  const logEl = document.getElementById('log');\n\n  function append(line){\n    const at = new Date().toLocaleTimeString();\n    logEl.textContent += \\`[\\${at}] \\${line}\\\\n\\`;\n    logEl.scrollTop = logEl.scrollHeight;\n  }\n\n  append('script injected');\n\n  window.addEventListener('message', e => {\n    const m = e.data || {};\n    if (m.type === 'append') append(m.line);\n  });\n\n  document.getElementById('send').onclick = () => {\n    const el = document.getElementById('msg');\n    vscode.postMessage({ type: 'send', text: el.value });\n    el.value = '';\n  };\n\n  document.getElementById('openPeer').onclick = () => vscode.postMessage({ type: 'openPeer' });\n  document.getElementById('stopPeer').onclick = () => vscode.postMessage({ type: 'stopPeer' });\n  document.getElementById('stopSelf').onclick = () => vscode.postMessage({ type: 'stopSelf' });\n\n  document.getElementById('msg').addEventListener('keydown', e => {\n    if (e.key === 'Enter') document.getElementById('send').click();\n  });\n\n  append('UI loaded.');\n</script>`;\n}\n"
  },
  {
    "command": "cmd.nsg81ahcgm",
    "text": "â›… å¤©æ°£é å ±",
    "tooltip": "é»æ“ŠæŸ¥çœ‹å¤©æ°£é å ±",
    "hidden": false,
    "enableOnInit": false,
    "script": "// Weather Forecast â€” Webview (Open-Meteo, no API key)\n// ç›´æ¥è²¼åˆ° status-bar-helper çš„æŸå€‹ Script æ¬„ä½å³å¯ä½¿ç”¨\n// é»æ“Šç‹€æ…‹åˆ— â†’ é–‹å•Ÿå¤©æ°£é å ± Webview\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  // é»æ“Šå°±é–‹ä¸€å€‹ webview é¢æ¿\n  const panel = vscode.window.createWebviewPanel(\n    'sbhWeather',\n    'Weather â€” å¤©æ°£é å ±',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  // é—œé–‰/åœæ­¢æ™‚æ¸…ç†\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\n/** ---------- HTML (Webview) ---------- */\nfunction getHtml (nonce) {\n  // åŸå¸‚æ¸…å–®ï¼ˆå¯è‡ªè¡Œå¢æ¸›ï¼‰\n  const cities = [\n    { name: 'å°åŒ—',   lat: 25.0375, lon: 121.5637, tz: 'Asia/Taipei' },\n    { name: 'æ–°ç«¹',   lat: 24.8066, lon: 120.9686, tz: 'Asia/Taipei' },\n    { name: 'å°ä¸­',   lat: 24.1477, lon: 120.6736, tz: 'Asia/Taipei' },\n    { name: 'å°å—',   lat: 22.9997, lon: 120.2270, tz: 'Asia/Taipei' },\n    { name: 'é«˜é›„',   lat: 22.6273, lon: 120.3014, tz: 'Asia/Taipei' },\n    { name: 'èŠ±è“®',   lat: 23.9872, lon: 121.6015, tz: 'Asia/Taipei' },\n    { name: 'å°æ±',   lat: 22.7972, lon: 121.0717, tz: 'Asia/Taipei' },\n    { name: 'æ±äº¬',   lat: 35.6762, lon: 139.6503, tz: 'Asia/Tokyo' },\n    { name: 'é¦–çˆ¾',   lat: 37.5665, lon: 126.9780, tz: 'Asia/Seoul' },\n    { name: 'ç´ç´„',   lat: 40.7128, lon: -74.0060, tz: 'America/New_York' },\n  ];\n\n  // è½‰æˆ <option>\n  const options = cities.map((c, i) =>\n    `<option value=\"${i}\">${c.name}</option>`).join('');\n\n  return /* html */`\n  <!doctype html>\n  <html lang=\"zh-Hant\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"Content-Security-Policy\"\n          content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'; connect-src https:;\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n    <title>Weather â€” å¤©æ°£é å ±</title>\n    <style>\n      :root { --fg:#e7e7e7; --muted:#a7a7a7; --bg:#1e1e1e; --card:#252526; --accent:#5da5ff; }\n      body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Noto Sans TC\", Arial; background:var(--bg); color:var(--fg); }\n      .wrap { padding:14px 16px 24px; max-width: 980px; margin: 0 auto; }\n      .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }\n      select, button, input { background:var(--card); color:var(--fg); border:1px solid #333; border-radius:10px; padding:8px 10px; }\n      button { cursor:pointer; }\n      .card { background:var(--card); border:1px solid #333; border-radius:16px; padding:14px; margin-top:14px; box-shadow: 0 8px 24px rgba(0,0,0,.2); }\n      .title { font-weight:700; font-size:18px; margin-bottom:8px; }\n      .muted { color:var(--muted); }\n      .grid { display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:10px; }\n      .day { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:14px; padding:10px; text-align:center; }\n      .big { font-size:32px; font-weight:800; line-height:1; }\n      .kpis { display:flex; gap:16px; flex-wrap:wrap; }\n      .kpi { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:14px; padding:12px 14px; min-width: 130px; }\n      canvas { width:100%; height:160px; }\n      .sp { flex:1 }\n      .link { color:var(--accent); text-decoration:none; }\n      .row-right { margin-left:auto; display:flex; gap:10px; }\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"row\">\n        <div class=\"title\" style=\"margin:0;\">ğŸŒ¤ï¸ å¤©æ°£é å ±</div>\n        <div class=\"sp\"></div>\n        <select id=\"city\">${options}</select>\n        <button id=\"useCustom\">è‡ªè¨‚åº§æ¨™</button>\n        <input id=\"lat\" placeholder=\"lat\" style=\"width:110px; display:none;\">\n        <input id=\"lon\" placeholder=\"lon\" style=\"width:110px; display:none;\">\n        <button id=\"saveCustom\" style=\"display:none;\">å¥—ç”¨</button>\n        <button id=\"refresh\">é‡æ–°æ•´ç†</button>\n      </div>\n\n      <div id=\"now\" class=\"card\">\n        <div class=\"row\">\n          <div class=\"title\" style=\"margin:0;\">ç›®å‰å¤©æ°£</div>\n          <div class=\"row-right\"><span id=\"updateAt\" class=\"muted\"></span></div>\n        </div>\n        <div class=\"row\" style=\"align-items:flex-end;\">\n          <div class=\"big\" id=\"nowTemp\">--Â°</div>\n          <div id=\"nowText\" style=\"font-size:16px; margin-left:6px;\">--</div>\n        </div>\n        <div class=\"kpis\" style=\"margin-top:8px;\">\n          <div class=\"kpi\">ğŸ’¨ é¢¨é€Ÿ <b id=\"nowWind\">-- m/s</b></div>\n          <div class=\"kpi\">ğŸŒ§ï¸ é™é›¨é‡(ä»Šæ—¥) <b id=\"dayRain\">-- mm</b></div>\n          <div class=\"kpi\">ğŸ”º é«˜æº« <b id=\"dayMax\">--Â°</b></div>\n          <div class=\"kpi\">ğŸ”» ä½æº« <b id=\"dayMin\">--Â°</b></div>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">24 å°æ™‚æº«åº¦èµ°å‹¢</div>\n        <canvas id=\"hourlyChart\" width=\"1000\" height=\"200\"></canvas>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">æœªä¾† 5 æ—¥</div>\n        <div id=\"days\" class=\"grid\"></div>\n      </div>\n\n      <p class=\"muted\" style=\"margin-top:14px;\">\n        è³‡æ–™ä¾†æºï¼š<a class=\"link\" href=\"https://open-meteo.com/\" target=\"_blank\" rel=\"noreferrer\">Open-Meteo</a>ï¼ˆå…é‡‘é‘°ï¼‰\n      </p>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // --- å·¥å…· & å¸¸æ•¸ ---\n      const CITIES = ${JSON.stringify(cities)};\n      const $ = (id) => document.getElementById(id);\n      const fmtTime = (d) => new Date(d).toLocaleString();\n      const WMO = {\n        // ç°¡æ˜“å°ç…§ (WMO weathercode)\n        0:'æ™´æœ—',1:'å¤šé›²',2:'å¤šé›²',3:'é™°',45:'éœ§',48:'éœ§éœœ',\n        51:'æ¯›æ¯›é›¨',53:'æ¯›æ¯›é›¨',55:'æ¯›æ¯›é›¨',56:'å‡éœ§é›¨',57:'å‡éœ§é›¨',\n        61:'å°é›¨',63:'ä¸­é›¨',65:'å¤§é›¨',66:'å‡é›¨',67:'å‡é›¨',\n        71:'å°é›ª',73:'ä¸­é›ª',75:'å¤§é›ª',77:'éœ°',\n        80:'çŸ­æš«å°é›¨',81:'çŸ­æš«ä¸­é›¨',82:'çŸ­æš«å¤§é›¨',\n        85:'çŸ­æš«å°é›ª',86:'çŸ­æš«å¤§é›ª',\n        95:'é›·é›¨',96:'é›·é›¨å¤¾é›¹',99:'å¼·é›·é›¨å¤¾é›¹'\n      };\n      const ICON = (code) => {\n        if ([0].includes(code)) return 'â˜€ï¸';\n        if ([1,2].includes(code)) return 'â›…';\n        if ([3].includes(code)) return 'â˜ï¸';\n        if ([45,48].includes(code)) return 'ğŸŒ«ï¸';\n        if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return 'ğŸŒ§ï¸';\n        if ([71,73,75,77,85,86].includes(code)) return 'â„ï¸';\n        if ([95,96,99].includes(code)) return 'â›ˆï¸';\n        return 'ğŸŒ¡ï¸';\n      };\n\n      // å„²å­˜åå¥½\n      const LS_KEY = 'sbh_weather_pref';\n      function savePref(obj){ localStorage.setItem(LS_KEY, JSON.stringify(obj)); }\n      function loadPref(){ try { return JSON.parse(localStorage.getItem(LS_KEY)||'{}'); } catch { return {}; } }\n\n      // ç•«ç°¡æ˜“æŠ˜ç·š (ä¸ä¾è³´å¤–éƒ¨å¥—ä»¶)\n      function drawLine(canvas, values, labels){\n        const ctx = canvas.getContext('2d');\n        const W = canvas.width, H = canvas.height;\n        ctx.clearRect(0,0,W,H);\n        if (!values || !values.length) return;\n        const min = Math.min(...values), max = Math.max(...values);\n        const padL=40, padR=10, padT=20, padB=24;\n        const X = (i)=> padL + (W - padL - padR) * (i/(values.length-1));\n        const Y = (v)=> padT + (H - padT - padB) * (1 - (v - min) / Math.max(0.0001, (max - min)));\n        // è»¸ç·š\n        ctx.globalAlpha=0.5; ctx.strokeStyle = '#444'; ctx.beginPath();\n        ctx.moveTo(padL, padT); ctx.lineTo(padL, H - padB); ctx.lineTo(W - padR, H - padB); ctx.stroke();\n        ctx.globalAlpha=1;\n        // y æ¨™ç±¤\n        ctx.fillStyle = '#a7a7a7'; ctx.font='12px system-ui';\n        [min, (min+max)/2, max].forEach((v, idx) => {\n          const y = Y(v);\n          ctx.fillText(v.toFixed(1)+'Â°', 6, y+4);\n          ctx.globalAlpha=0.15; ctx.strokeStyle='#888'; ctx.beginPath();\n          ctx.moveTo(padL, y); ctx.lineTo(W-padR, y); ctx.stroke(); ctx.globalAlpha=1;\n        });\n        // æŠ˜ç·š\n        ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });\n        ctx.stroke();\n        // ç¯€é»\n        ctx.fillStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); ctx.beginPath(); ctx.arc(x,y,2.5,0,Math.PI*2); ctx.fill(); });\n        // x æ¨™ç±¤ï¼ˆæ¯ 3 å°æ™‚ï¼‰\n        ctx.fillStyle='#a7a7a7'; ctx.textAlign='center';\n        labels.forEach((t,i)=>{ if(i%3===0){ const x=X(i); ctx.fillText(t, x, H-6); } });\n        ctx.textAlign='left';\n      }\n\n      // API è«‹æ±‚\n      async function fetchWeather(lat, lon, tz){\n        const url = new URL('https://api.open-meteo.com/v1/forecast');\n        url.searchParams.set('latitude', lat);\n        url.searchParams.set('longitude', lon);\n        url.searchParams.set('timezone', tz || 'auto');\n        url.searchParams.set('current_weather', 'true');\n        url.searchParams.set('hourly', 'temperature_2m');\n        url.searchParams.set('daily', 'weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum');\n        url.searchParams.set('forecast_days', '5');\n        const res = await fetch(url.toString(), { cache:'no-store' });\n        if (!res.ok) throw new Error('Network error: ' + res.status);\n        return res.json();\n      }\n\n      // UI ç¶å®š\n      const citySel = $('city');\n      const useCustomBtn = $('useCustom');\n      const latIn = $('lat'), lonIn = $('lon'), saveCustomBtn = $('saveCustom');\n      const refreshBtn = $('refresh');\n      const nowTemp = $('nowTemp'), nowText = $('nowText');\n      const nowWind = $('nowWind'), dayRain = $('dayRain'), dayMax = $('dayMax'), dayMin = $('dayMin'), updAt = $('updateAt');\n      const hourlyChart = $('hourlyChart');\n      const daysWrap = $('days');\n\n      // åˆå§‹åŒ–ï¼šè¼‰å…¥åå¥½\n      const pref = loadPref();\n      if (pref.mode === 'custom' && typeof pref.lat === 'number' && typeof pref.lon === 'number') {\n        citySel.value = String(Math.max(0, Math.min(CITIES.length-1, pref.cityIndex||0))); // UI ä»æŒ‡å‘ä¸€å€‹åŸå¸‚ï¼Œä½†å¯¦éš›ç”¨è‡ªè¨‚\n        latIn.value = String(pref.lat);\n        lonIn.value = String(pref.lon);\n      } else {\n        citySel.value = String(pref.cityIndex ?? 0);\n      }\n\n      let timer = null;\n      async function refresh(){\n        try {\n          const mode = (pref.mode || 'city');\n          const idx = Number(citySel.value) || 0;\n          const city = CITIES[idx];\n          let lat = city.lat, lon = city.lon, tz = city.tz;\n          if (mode === 'custom') {\n            const cla = parseFloat(latIn.value), clo = parseFloat(lonIn.value);\n            if (!Number.isFinite(cla) || !Number.isFinite(clo)) throw new Error('è‡ªè¨‚åº§æ¨™æ ¼å¼éŒ¯èª¤');\n            lat = cla; lon = clo;\n          }\n          const data = await fetchWeather(lat, lon, tz);\n          render(data);\n        } catch (err) {\n          console.error(err);\n          vscode?.postMessage?.({ type:'error', message: String(err) });\n          updAt.textContent = 'æ›´æ–°å¤±æ•—ï¼š' + String(err).slice(0, 80);\n        }\n      }\n\n      function render(data){\n        // ç›®å‰\n        const cw = data.current_weather || {};\n        nowTemp.textContent = (cw.temperature != null ? cw.temperature.toFixed(1) : '--') + 'Â°';\n        nowText.textContent = (ICON(cw.weathercode) + ' ' + (WMO[cw.weathercode] || 'â€”'));\n        nowWind.textContent = (cw.windspeed != null ? cw.windspeed : '--') + ' m/s';\n        updAt.textContent = 'æ›´æ–°æ–¼ ' + fmtTime(new Date());\n\n        // ä»Šæ—¥æ¯æ—¥è³‡è¨Š\n        const d = data.daily || {};\n        if (d.temperature_2m_max && d.temperature_2m_max.length) {\n          dayMax.textContent = d.temperature_2m_max[0].toFixed(1) + 'Â°';\n          dayMin.textContent = d.temperature_2m_min[0].toFixed(1) + 'Â°';\n          dayRain.textContent = (d.precipitation_sum?.[0] ?? 0).toFixed(1) + ' mm';\n        }\n\n        // 24 å°æ™‚\n        const h = data.hourly || {};\n        const nowISO = data.current_weather?.time || new Date().toISOString();\n        const startIdx = Math.max(0, (h.time||[]).indexOf(nowISO));\n        const range = 24;\n        const temps = (h.temperature_2m||[]).slice(startIdx, startIdx+range);\n        const labels = (h.time||[]).slice(startIdx, startIdx+range).map(t => {\n          const dt = new Date(t); return dt.getHours().toString().padStart(2,'0') + ':00';\n        });\n        drawLine(hourlyChart, temps, labels);\n\n        // æœªä¾† 5 æ—¥\n        const days = [];\n        for (let i=0; i<Math.min(5, (d.time||[]).length); i++){\n          const code = d.weathercode?.[i];\n          days.push({\n            date: d.time[i],\n            icon: ICON(code),\n            text: WMO[code] || 'â€”',\n            max: d.temperature_2m_max?.[i],\n            min: d.temperature_2m_min?.[i],\n            rain: d.precipitation_sum?.[i] ?? 0\n          });\n        }\n        daysWrap.innerHTML = days.map(x => {\n          const dd = new Date(x.date);\n          const md = (dd.getMonth()+1) + '/' + dd.getDate();\n          return \\`\n            <div class=\"day\">\n              <div class=\"muted\">\\${md}</div>\n              <div style=\"font-size:24px\">\\${x.icon}</div>\n              <div style=\"margin:2px 0;\">\\${x.text}</div>\n              <div>ğŸ”º \\${x.max?.toFixed?.(1)??'--'}Â°</div>\n              <div>ğŸ”» \\${x.min?.toFixed?.(1)??'--'}Â°</div>\n              <div>ğŸŒ§ï¸ \\${x.rain?.toFixed?.(1)??'--'} mm</div>\n            </div>\\`;\n        }).join('');\n      }\n\n      // äº‹ä»¶\n      citySel.addEventListener('change', () => {\n        const idx = Number(citySel.value)||0;\n        const city = CITIES[idx];\n        // åˆ‡æ›åŸå¸‚ â†’ è‡ªå‹•æ”¹ç‚º city æ¨¡å¼\n        const p = loadPref();\n        p.cityIndex = idx;\n        p.mode = 'city';\n        savePref(p);\n        latIn.style.display='none'; lonIn.style.display='none'; saveCustomBtn.style.display='none';\n        refresh();\n      });\n\n      useCustomBtn.addEventListener('click', () => {\n        // æ‰“é–‹è‡ªè¨‚åº§æ¨™è¼¸å…¥\n        latIn.style.display='inline-block';\n        lonIn.style.display='inline-block';\n        saveCustomBtn.style.display='inline-block';\n        if (!latIn.value || !lonIn.value) {\n          // é å¡«ç›®å‰é¸ä¸­åŸå¸‚åº§æ¨™\n          const c = CITIES[Number(citySel.value)||0];\n          latIn.value = c.lat; lonIn.value = c.lon;\n        }\n      });\n\n      saveCustomBtn.addEventListener('click', () => {\n        const la = parseFloat(latIn.value), lo = parseFloat(lonIn.value);\n        if (!Number.isFinite(la) || !Number.isFinite(lo)) {\n          alert('è«‹è¼¸å…¥æ­£ç¢ºçš„ç¶“ç·¯åº¦');\n          return;\n        }\n        const p = loadPref();\n        p.mode = 'custom';\n        p.lat = la; p.lon = lo;\n        savePref(p);\n        refresh();\n      });\n\n      refreshBtn.addEventListener('click', refresh);\n\n      // å®šæ™‚æ›´æ–°ï¼ˆæ¯ 20 åˆ†é˜ï¼‰\n      clearInterval(timer);\n      timer = setInterval(refresh, 20 * 60 * 1000);\n\n      // é¦–æ¬¡è¼‰å…¥\n      refresh();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "tags": [
      "default",
      "tool"
    ]
  },
  {
    "text": "$(game) è²ªåƒè›‡",
    "tooltip": "é»æ“Šé–‹å§‹ç©è²ªåƒè›‡",
    "command": "cmd.bwfywnftv1",
    "script": "// Snake â€” Webview Game (English UI, for status-bar-helper)\n// Features: Walls Kill/Wrap toggle (persistent), Pause/Resume, Restart, Speed, High Score\n// Canvas 400x400, grid 25x25 (smaller cells)\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhSnake',\n    'ğŸ Snake â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Snake</title>\n    <style>\n      :root {\n        --bg:#0f1115; --card:#161a22; --line:#222838; --fg:#e6e6e6; --muted:#9aa2b1;\n        --accent:#7bd88f; --danger:#ff6b6b; --btn:#1d2330; --btnBorder:#2a3247;\n      }\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:760px;margin:0 auto;padding:16px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px;box-shadow:0 10px 24px rgba(0,0,0,.25)}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:10px 12px;min-width:100px}\n      .btn{background:var(--btn);border:1px solid var(--btnBorder);border-radius:10px;padding:8px 12px;cursor:pointer;color:var(--fg)}\n      .btn:hover{filter:brightness(1.1)}\n      .btn-danger{background:#2a1212;border-color:#502222;color:#ffbbbb}\n      .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .muted{color:var(--muted)}\n      canvas{width:100%;height:auto;display:block;background:#000;border-radius:12px}\n      input[type=range]{accent-color:var(--accent)}\n      .legend{font-size:12px;color:var(--muted)}\n      .title{font-size:18px;font-weight:700}\n      .frame{padding:10px;border-radius:14px;border:1px solid #2b3144;background:#0e1219}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ Snake â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnWalls\" class=\"btn\">ğŸ§± Walls: Kill</button>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn btn-danger\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n          <div class=\"kpi\">Speed: <b id=\"speedLabel\">120ms</b></div>\n          <input id=\"speed\" type=\"range\" min=\"60\" max=\"220\" step=\"10\" value=\"120\">\n        </div>\n      </div>\n\n      <div class=\"card frame\">\n        <canvas id=\"game\" width=\"600\" height=\"500\"></canvas>\n        <div class=\"legend\" style=\"margin-top:8px\">\n          Controls: Arrow keys / WASD Â· P = Pause/Resume Â· R = Restart Â· Walls: Kill/Wrap (toggle above)\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Config & Elements ======\n      const $ = (id)=>document.getElementById(id);\n      const cvs = $('game'), ctx = cvs.getContext('2d');\n      const scoreEl=$('score'), bestEl=$('best');\n      const btnWalls=$('btnWalls'), btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const speedRange=$('speed'), speedLabel=$('speedLabel');\n\n      const GRID = 30;                       // grid size (NxN)\n      const CELL = Math.floor(cvs.width/GRID); // pixels per cell, derived from canvas size\n      const BEST_LS_KEY = 'sbh_snake_best';\n      const WALL_LS_KEY = 'sbh_snake_wall_mode'; // 'kill' | 'wrap'\n\n      // ====== State ======\n      let snake, dir, nextDir, food, score, best, timer, tickMs, paused, dead;\n      let wallMode; // 'kill' or 'wrap'\n\n      function loadWallMode(){ const v = localStorage.getItem(WALL_LS_KEY); return v==='wrap'?'wrap':'kill'; }\n      function saveWallMode(v){ localStorage.setItem(WALL_LS_KEY, v); }\n      function updateWallBtn(){ btnWalls.textContent = (wallMode==='kill') ? 'ğŸ§± Walls: Kill' : 'ğŸŒ€ Walls: Wrap'; }\n\n      function init(){\n        snake = [\n          {x: Math.floor(GRID/2),   y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-1, y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-2, y: Math.floor(GRID/2)},\n        ];\n        dir='RIGHT'; nextDir='RIGHT';\n        score=0; paused=false; dead=false;\n        spawnFood();\n        updateScore();\n        tickMs = Number(speedRange.value);\n        wallMode = loadWallMode();\n        updateWallBtn();\n        loopStart();\n      }\n\n      function loopStart(){ clearInterval(timer); timer=setInterval(tick, tickMs); }\n      function loopPause(p=true){\n        paused=p;\n        if (paused){ clearInterval(timer); btnPause.textContent='â–¶ï¸ Resume'; }\n        else { loopStart(); btnPause.textContent='â¸ï¸ Pause'; }\n      }\n\n      function updateScore(){\n        scoreEl.textContent = String(score);\n        best = Math.max(Number(localStorage.getItem(BEST_LS_KEY)||0), score);\n        localStorage.setItem(BEST_LS_KEY, best);\n        bestEl.textContent = String(best);\n      }\n\n      function spawnFood(){\n        while(true){\n          const fx = Math.floor(Math.random()*GRID);\n          const fy = Math.floor(Math.random()*GRID);\n          if (!snake.some(s=>s.x===fx && s.y===fy)){ food={x:fx,y:fy}; break; }\n        }\n      }\n\n      // ====== Input ======\n      const dirMap = {\n        'ArrowLeft':'LEFT','ArrowUp':'UP','ArrowRight':'RIGHT','ArrowDown':'DOWN',\n        'a':'LEFT','w':'UP','d':'RIGHT','s':'DOWN','A':'LEFT','W':'UP','D':'RIGHT','S':'DOWN'\n      };\n      window.addEventListener('keydown', e=>{\n        if (e.key==='p'||e.key==='P'){ loopPause(!paused); return; }\n        if (e.key==='r'||e.key==='R'){ restart(); return; }\n        const nd = dirMap[e.key];\n        if (!nd) return;\n        if ((dir==='LEFT' && nd==='RIGHT')||(dir==='RIGHT'&&nd==='LEFT')||\n            (dir==='UP'&&nd==='DOWN')||(dir==='DOWN'&&nd==='UP')) return;\n        nextDir = nd;\n      });\n      window.addEventListener('blur', ()=>{ if(!dead) loopPause(true); });\n      window.addEventListener('focus', ()=>{ if(!dead) loopPause(false); });\n\n      // ====== Game Loop ======\n      function tick(){\n        if (paused || dead) return;\n\n        dir = nextDir;\n        const head = {...snake[0]};\n        if (dir==='LEFT') head.x--;\n        else if (dir==='RIGHT') head.x++;\n        else if (dir==='UP') head.y--;\n        else if (dir==='DOWN') head.y++;\n\n        // Walls: Kill or Wrap\n        if (wallMode === 'kill') {\n          if (head.x<0 || head.y<0 || head.x>=GRID || head.y>=GRID){ return gameOver(); }\n        } else {\n          head.x = (head.x + GRID) % GRID;\n          head.y = (head.y + GRID) % GRID;\n        }\n\n        // Self-collision\n        if (snake.some(s=>s.x===head.x && s.y===head.y)){ return gameOver(); }\n\n        // Eat\n        const ate = (head.x===food.x && head.y===food.y);\n        snake.unshift(head);\n        if (ate){ score++; updateScore(); spawnFood(); } else { snake.pop(); }\n\n        draw();\n      }\n\n      // ====== Drawing ======\n      function draw(){\n        ctx.fillStyle='#000'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        for (let y=0;y<GRID;y++){\n          for (let x=0;x<GRID;x++){\n            ctx.fillStyle = ((x+y)%2===0)?'#0a0a0a':'#0c0c0c';\n            ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n          }\n        }\n        // food\n        ctx.fillStyle='#ff5252'; roundRect(xpx(food.x), ypx(food.y), CELL, CELL, 4);\n        // snake\n        for (let i=0;i<snake.length;i++){\n          const s=snake[i];\n          ctx.fillStyle = (i===0)?'#7bd88f':'#57c274';\n          roundRect(xpx(s.x), ypx(s.y), CELL, CELL, i===0?6:4);\n        }\n      }\n\n      function xpx(gx){ return gx*CELL; }\n      function ypx(gy){ return gy*CELL; }\n      function roundRect(x,y,w,h,r){\n        ctx.beginPath();\n        ctx.moveTo(x+r,y);\n        ctx.arcTo(x+w,y,x+w,y+h,r);\n        ctx.arcTo(x+w,y+h,x,y+h,r);\n        ctx.arcTo(x,y+h,x,y,r);\n        ctx.arcTo(x,y,x+w,y,r);\n        ctx.closePath();\n        ctx.fill();\n      }\n\n      function gameOver(){\n        dead = true; clearInterval(timer);\n        ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        ctx.fillStyle='#fff'; ctx.textAlign='center';\n        ctx.font='bold 28px system-ui'; ctx.fillText('Game Over', cvs.width/2, cvs.height/2 - 10);\n        ctx.font='16px system-ui'; ctx.fillText('Press R to Restart', cvs.width/2, cvs.height/2 + 18);\n        return true;\n      }\n\n      function restart(){ clearInterval(timer); init(); draw(); }\n\n      // ====== UI Events ======\n      btnPause.addEventListener('click', ()=> loopPause(!paused));\n      btnRestart.addEventListener('click', restart);\n      btnWalls.addEventListener('click', ()=>{\n        wallMode = (wallMode==='kill') ? 'wrap' : 'kill';\n        saveWallMode(wallMode);\n        updateWallBtn();\n      });\n\n      speedRange.addEventListener('input', ()=>{\n        tickMs = Number(speedRange.value);\n        speedLabel.textContent = tickMs + 'ms';\n        if (!paused && !dead) loopStart();\n      });\n\n      // init\n      speedLabel.textContent = speedRange.value + 'ms';\n      bestEl.textContent = String(localStorage.getItem(BEST_LS_KEY)||0);\n      init();\n      draw();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": true,
    "tags": [
      "game"
    ]
  },
  {
    "text": "$(game) ä¿„ç¾…æ–¯æ–¹å¡Š",
    "tooltip": "é»æ“Šé–‹å§‹ç©ä¿„ç¾…æ–¯æ–¹å¡Š",
    "command": "cmd.mv36wj9976",
    "script": "// Tetris â€” Webview Game (centered board + lock delay so you can rotate on landing)\n// Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n// Canvas 240x480 (10x20, 24px cell). Start Level adjustable. Gravity base 700ms (âˆ’60ms/level, min 80). Soft drop 60ms.\n// NEW: Lock Delay 500ms â†’ when piece touches the ground, you can still rotate/move before it locks.\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhTetris',\n    'ğŸ§± Tetris â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Tetris</title>\n    <style>\n      :root{--bg:#0f1115;--fg:#e6e6e6;--muted:#9aa2b1;--card:#161a22;--line:#222838;--btn:#1d2330;--btnb:#2a3247;--accent:#7bd88f}\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:860px;margin:0 auto;padding:14px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .btn{background:var(--btn);border:1px solid var(--btnb);border-radius:10px;padding:8px 12px;color:var(--fg);cursor:pointer}\n      .btn:hover{filter:brightness(1.1)}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:8px 12px;min-width:120px}\n      .title{font-weight:700}\n      .legend{font-size:12px;color:var(--muted)}\n      canvas{display:block;background:#000;border-radius:8px}\n      /* éŠæˆ²å€å¡Šç½®ä¸­ */\n      .board{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap;justify-content:center}\n      .side{display:flex;flex-direction:column;gap:10px}\n      .panel{background:#0e1219;border:1px solid #2b3144;border-radius:12px;padding:8px}\n      .grid{display:grid;grid-template-columns:repeat(2,auto);gap:10px;align-items:center}\n      input[type=range]{accent-color:var(--accent)}\n      .num{min-width:42px;display:inline-block;text-align:right}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ§± Tetris â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">Lines: <b id=\"lines\">0</b></div>\n          <div class=\"kpi\">Level: <b id=\"level\">1</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n        </div>\n        <div class=\"legend\" style=\"margin-top:6px\">\n          Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n        </div>\n      </div>\n\n      <!-- Settingsï¼šåªä¿ç•™ Start Level -->\n      <div class=\"card\">\n        <div class=\"title\" style=\"margin-bottom:8px\">Settings</div>\n        <div class=\"grid\">\n          <div>Start Level</div>\n          <div style=\"display:flex;align-items:center;gap:8px\">\n            <input id=\"startLevel\" type=\"range\" min=\"1\" max=\"20\" step=\"1\" value=\"1\">\n            <span id=\"startLevelLabel\" class=\"num\">1</span>\n          </div>\n        </div>\n        <div style=\"margin-top:10px;display:flex;gap:10px;align-items:center\">\n          <button id=\"btnApply\" class=\"btn\">âœ… Apply & Restart</button>\n          <span class=\"legend\">Gravity speeds up by 60ms per level (min 80ms).</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"board\">\n          <!-- å°ç•«é¢ï¼š240x480 / 10x20 / 24px cell -->\n          <canvas id=\"game\" width=\"240\" height=\"480\"></canvas>\n          <div class=\"side\">\n            <div class=\"panel\">\n              <div class=\"title\">Hold</div>\n              <canvas id=\"hold\" width=\"96\" height=\"96\" style=\"margin-top:6px\"></canvas>\n            </div>\n            <div class=\"panel\">\n              <div class=\"title\">Next</div>\n              <canvas id=\"next\" width=\"96\" height=\"240\" style=\"margin-top:6px\"></canvas>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Elements / Persistent Setting ======\n      const $ = id => document.getElementById(id);\n      const gc = $('game').getContext('2d');\n      const hc = $('hold').getContext('2d');\n      const nc = $('next').getContext('2d');\n\n      const scoreEl=$('score'), linesEl=$('lines'), levelEl=$('level'), bestEl=$('best');\n      const btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const startLevelInput=$('startLevel'), startLevelLabel=$('startLevelLabel');\n      const btnApply=$('btnApply');\n\n      const SETTINGS_KEY = 'sbh_tetris_settings_v3';\n      function loadSettings(){\n        try{\n          const v = JSON.parse(localStorage.getItem(SETTINGS_KEY)||'{}');\n          return { startLevel: Number.isFinite(v.startLevel)? v.startLevel : 1 };\n        }catch{ return { startLevel:1 }; }\n      }\n      function saveSettings(s){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(s)); }\n\n      const S = loadSettings();\n      startLevelInput.value = String(S.startLevel);\n      startLevelLabel.textContent = S.startLevel;\n\n      // å›ºå®šåƒæ•¸\n      const BASE_MS  = 700; // åŸºç¤é‡åŠ›ï¼ˆms/æ ¼ï¼‰\n      const SOFT_MS  = 60;  // æŒ‰ä½â†“ çš„é€£çºŒ soft drop é–“éš”ï¼ˆms/æ ¼ï¼‰\n      const MIN_MS   = 80;  // æœ€å¿«é‡åŠ›\n      const LOCK_DELAY_MS = 500; // â˜… è½åœ°å¾Œçš„ã€Œå»¶é²é–å®šã€æ™‚é–“ï¼Œå¯åœ¨é€™è£¡èª¿æ•´\n\n      // ====== Game Constants ======\n      const W = 10, H = 20, CELL = 24;\n      const BEST_KEY = 'sbh_tetris_high';\n      const COLORS = {\n        I:'#00f0f0', O:'#f0f000', T:'#a020f0', S:'#00d000', Z:'#d00000', J:'#0000d0', L:'#f0a000', GHOST:'rgba(255,255,255,0.15)'\n      };\n      const ROT = {\n        I: [\n          [[0,1],[1,1],[2,1],[3,1]],\n          [[2,0],[2,1],[2,2],[2,3]],\n          [[0,2],[1,2],[2,2],[3,2]],\n          [[1,0],[1,1],[1,2],[1,3]],\n        ],\n        O: [[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]]],\n        T: [\n          [[1,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[2,1],[1,2]],\n          [[1,0],[0,1],[1,1],[1,2]],\n        ],\n        S: [\n          [[1,0],[2,0],[0,1],[1,1]],\n          [[1,0],[1,1],[2,1],[2,2]],\n          [[1,1],[2,1],[0,2],[1,2]],\n          [[0,0],[0,1],[1,1],[1,2]],\n        ],\n        Z: [\n          [[0,0],[1,0],[1,1],[2,1]],\n          [[2,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[1,2],[2,2]],\n          [[1,0],[0,1],[1,1],[0,2]],\n        ],\n        J: [\n          [[0,0],[0,1],[1,1],[2,1]],\n          [[1,0],[2,0],[1,1],[1,2]],\n          [[0,1],[1,1],[2,1],[2,2]],\n          [[1,0],[1,1],[0,2],[1,2]],\n        ],\n        L: [\n          [[2,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[1,2],[2,2]],\n          [[0,1],[1,1],[2,1],[0,2]],\n          [[0,0],[1,0],[1,1],[1,2]],\n        ]\n      };\n      const TYPES = Object.keys(ROT);\n\n      // ====== Game State ======\n      let board, queue, cur, hold=null, canHold=true;\n      let score=0, lines=0, level=S.startLevel, best=Number(localStorage.getItem(BEST_KEY)||0);\n      let paused=false, over=false, timer=null;\n\n      // Soft drop\n      let softHeld=false, softTimer=null;\n\n      // â˜… Lock Delay ç‹€æ…‹\n      let grounded=false;      // æ˜¯å¦å·²ç¶“ã€Œæ¥åœ°ã€ï¼ˆä¸‹ä¸€æ ¼ä¸‹ä¸å»ï¼‰\n      let lockExpire=0;        // ä½•æ™‚åˆ°æœŸé–å®šï¼ˆtime msï¼‰\n\n      bestEl.textContent = String(best);\n\n      // ====== Helpers ======\n      function emptyBoard(){ return Array.from({length:H},()=>Array(W).fill(null)); }\n      function newBag(){ const a=[...TYPES]; for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]] } return a; }\n      function ensureQueue(){ if(queue.length<7) queue.push(...newBag()); }\n      function spawn(){\n        const type = queue.shift(); ensureQueue();\n        cur = { type, r:0, x:3, y:0 };\n        grounded=false; lockExpire=0;\n        if (!canPlace(cur, cur.x, cur.y)){ gameOver(); }\n        canHold = true;\n      }\n      function cells(p){ return ROT[p.type][p.r]; }\n      function canPlace(p, nx, ny, nr=p.r){\n        const shape = ROT[p.type][nr];\n        for(const [dx,dy] of shape){\n          const x = nx+dx, y = ny+dy;\n          if (x<0 || x>=W || y<0 || y>=H) return false;\n          if (board[y][x]) return false;\n        }\n        return true;\n      }\n      function startLockDelay(){ grounded=true; lockExpire = Date.now() + LOCK_DELAY_MS; }\n      function clearLock(){ grounded=false; lockExpire=0; }\n\n      function lock(){\n        for(const [dx,dy] of cells(cur)){\n          const x=cur.x+dx, y=cur.y+dy;\n          if (y>=0 && y<H) board[y][x] = cur.type;\n        }\n        grounded=false; lockExpire=0;\n        clearLines(); spawn();\n      }\n      function clearLines(){\n        let cleared=0;\n        for(let y=H-1;y>=0;){\n          if (board[y].every(Boolean)){ board.splice(y,1); board.unshift(Array(W).fill(null)); cleared++; }\n          else y--;\n        }\n        if (cleared>0){\n          score += [0,100,300,500,800][cleared] * level;\n          lines += cleared;\n          const newLevel = Math.max(1, S.startLevel + Math.floor(lines/10));\n          if (newLevel!==level){ level=newLevel; restartGravity(); }\n          updateHUD();\n        }\n      }\n      function holdSwap(){\n        if (!canHold || over) return;\n        if (hold===null){ hold=cur.type; spawn(); }\n        else { const t=hold; hold=cur.type; cur={type:t, r:0, x:3, y:0}; if(!canPlace(cur,cur.x,cur.y)){ gameOver(); return; } }\n        canHold=false; drawSide();\n      }\n\n      // æˆåŠŸç§»å‹•/æ—‹è½‰å¾Œï¼Œæ›´æ–°æ¥åœ°ç‹€æ…‹ï¼šå¦‚æœä»æ¥åœ°å°±é‡ç½® lock delay\n      function refreshLockAfterAction(){\n        if (canPlace(cur, cur.x, cur.y+1)) {\n          clearLock();\n        } else {\n          startLockDelay(); // still grounded â†’ reset timer\n        }\n      }\n\n      function rotate(dir){ // +1 CW / -1 CCW\n        if (over) return;\n        const nr = (cur.r + (dir>0?1:3)) % 4;\n        const kicks = [[0,0],[1,0],[-1,0],[0,-1],[2,0],[-2,0]];\n        for (const [kx,ky] of kicks){\n          const nx = cur.x+kx, ny=cur.y+ky;\n          if (canPlace(cur,nx,ny,nr)){ cur.r=nr; cur.x=nx; cur.y=ny; refreshLockAfterAction(); draw(); return; }\n        }\n      }\n\n      function move(dx){\n        if (over) return;\n        const nx = cur.x + dx;\n        if (canPlace(cur, nx, cur.y)){ cur.x = nx; refreshLockAfterAction(); draw(); }\n      }\n\n      function softDropStep(){\n        if (paused || over) return;\n        if (canPlace(cur, cur.x, cur.y+1)){\n          cur.y++; score += 1; updateHUD(false);\n          clearLock(); // ä¸€æ—¦å¾€ä¸‹æˆåŠŸï¼Œå–æ¶ˆæ¥åœ°ç‹€æ…‹\n          draw();\n        } else {\n          if (!grounded) { startLockDelay(); }\n          // å·²æ¥åœ°ï¼šç­‰åˆ°æ™‚é–“åˆ°æ‰ lock\n          if (Date.now() >= lockExpire){ lock(); }\n          draw();\n        }\n      }\n\n      function hardDrop(){\n        if (over) return;\n        let dist=0; while (canPlace(cur,cur.x,cur.y+1)){ cur.y++; dist++; }\n        score += dist*2; updateHUD(false);\n        lock(); draw(); // Hard drop ç«‹å³é–å®š\n      }\n\n      // ====== Gravity ======\n      function gravityMs(lv){\n        return Math.max(MIN_MS, BASE_MS - (lv-1)*60);\n      }\n      function restartGravity(){\n        clearInterval(timer);\n        timer = setInterval(()=>{\n          if (paused || over) return;\n          if (canPlace(cur, cur.x, cur.y+1)){\n            cur.y++;\n            clearLock();\n          } else {\n            if (!grounded) { startLockDelay(); }\n            else if (Date.now() >= lockExpire) { lock(); }\n          }\n          draw();\n        }, gravityMs(level));\n      }\n\n      // ====== Drawing ======\n      function drawCell(ctx,x,y,color){\n        ctx.fillStyle=color;\n        ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n        ctx.fillStyle='rgba(255,255,255,0.07)';\n        ctx.fillRect(x*CELL, y*CELL, CELL, Math.max(2, CELL*0.18));\n      }\n      function ghostY(){ let gy=cur.y; while (canPlace(cur,cur.x,gy+1)) gy++; return gy; }\n      function draw(){\n        const c = gc.canvas; gc.clearRect(0,0,c.width,c.height);\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ gc.fillStyle=((x+y)%2===0)?'#0a0a0a':'#0c0c0c'; gc.fillRect(x*CELL,y*CELL,CELL,CELL); } }\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ const t=board[y][x]; if(t) drawCell(gc,x,y,COLORS[t]); } }\n        const gy = ghostY();\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=gy+dy; gc.fillStyle=COLORS.GHOST; gc.fillRect(x*CELL,y*CELL,CELL,CELL); }\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=cur.y+dy; drawCell(gc,x,y,COLORS[cur.type]); }\n\n        // å¦‚æœæ¥åœ°ä¸­ï¼Œå¯åœ¨åº•éƒ¨ç•«ä¸€åœˆæ·¡é‚Šæç¤ºï¼ˆå¯é¸ï¼‰\n        // if (grounded) { gc.strokeStyle='rgba(255,255,255,.15)'; gc.lineWidth=2; gc.strokeRect(0, (H-1)*CELL+1, W*CELL, CELL-2); }\n\n        drawSide();\n        if (over) drawGameOver();\n      }\n      function drawGameOver(){\n        const c = gc.canvas; gc.fillStyle='rgba(0,0,0,0.6)'; gc.fillRect(0,0,c.width,c.height);\n        gc.fillStyle='#fff'; gc.textAlign='center'; gc.font='bold 22px system-ui'; gc.fillText('Game Over', c.width/2, c.height/2 - 10);\n        gc.font='14px system-ui'; gc.fillText('Press R to Restart', c.width/2, c.height/2 + 16);\n      }\n      function drawMini(ctx,type,cell=16){\n        ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);\n        if(!type) return;\n        const shape=ROT[type][0]; const ox=2, oy=2;\n        for(const [dx,dy] of shape){\n          ctx.fillStyle=COLORS[type]; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,cell);\n          ctx.fillStyle='rgba(255,255,255,0.08)'; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,Math.max(2,cell*0.18));\n        }\n      }\n      function drawSide(){\n        drawMini(hc, hold, 16);\n        nc.clearRect(0,0,nc.canvas.width,nc.canvas.height);\n        const show = queue.slice(0,5), cell=14;\n        show.forEach((t,i)=>{\n          const offY = i*46 + 4;\n          const shape = ROT[t][0];\n          for(const [dx,dy] of shape){\n            nc.fillStyle=COLORS[t];\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, cell);\n            nc.fillStyle='rgba(255,255,255,0.08)';\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, Math.max(2,cell*0.18));\n          }\n        });\n      }\n\n      // ====== HUD ======\n      function updateHUD(updateBest=true){\n        scoreEl.textContent = String(score);\n        linesEl.textContent = String(lines);\n        levelEl.textContent = String(level);\n        if (updateBest){\n          const b = Math.max(Number(localStorage.getItem(BEST_KEY)||0), score);\n          localStorage.setItem(BEST_KEY, b);\n          bestEl.textContent = String(b);\n        }\n      }\n      function gameOver(){ over=true; clearInterval(timer); stopSoftHeld(); updateHUD(); draw(); }\n\n      // ====== Reset / Init ======\n      function resetGame(){\n        board = emptyBoard();\n        queue = [...newBag(), ...newBag()];\n        cur=null; hold=null; canHold=true;\n        score=0; lines=0; level=S.startLevel; paused=false; over=false;\n        grounded=false; lockExpire=0;\n        updateHUD();\n        spawn();\n        restartGravity();\n        draw();\n      }\n\n      // ====== Input ======\n      function stopSoftHeld(){ softHeld=false; clearInterval(softTimer); softTimer=null; }\n      window.addEventListener('keydown', (e)=>{\n        if (e.key===' '){ e.preventDefault(); }\n        if (over){ if (e.key==='r'||e.key==='R'){ resetGame(); } return; }\n\n        if (e.key==='p'||e.key==='P'){ paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; return; }\n        if (paused) return;\n\n        if (e.key==='ArrowLeft'){ move(-1); }\n        else if (e.key==='ArrowRight'){ move(1); }\n        else if (e.key==='ArrowDown'){\n          if (!softHeld){ softHeld=true; softDropStep(); softTimer=setInterval(softDropStep, Math.max(10, SOFT_MS)); }\n        }\n        else if (e.key==='ArrowUp' || e.key==='x' || e.key==='X'){ rotate(+1); }\n        else if (e.key==='z' || e.key==='Z'){ rotate(-1); }\n        else if (e.key==='c' || e.key==='C' || e.key==='Shift'){ holdSwap(); }\n        else if (e.key===' '){ hardDrop(); }\n        else if (e.key==='r' || e.key==='R'){ resetGame(); }\n      });\n      window.addEventListener('keyup', (e)=>{ if (e.key==='ArrowDown'){ stopSoftHeld(); } });\n      window.addEventListener('blur', ()=>{ if(!over){ paused=true; btnPause.textContent='â–¶ï¸ Resume'; stopSoftHeld(); } });\n\n      // Buttons\n      btnPause.addEventListener('click', ()=>{ if(over) return; paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; });\n      btnRestart.addEventListener('click', resetGame);\n\n      // Settings UI\n      startLevelInput.addEventListener('input', ()=> startLevelLabel.textContent = startLevelInput.value);\n      btnApply.addEventListener('click', ()=>{\n        S.startLevel = Number(startLevelInput.value);\n        saveSettings(S);\n        resetGame();\n      });\n\n      // Init\n      resetGame();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": false,
    "tags": [
      "game"
    ]
  },
  {
    "command": "cmd.dwqxu09lgm",
    "text": "ğŸ§© 2048",
    "tooltip": "é»æ“Šé–‹å§‹éŠç© 2048",
    "hidden": true,
    "enableOnInit": false,
    "script": "// 2048 â€” for status-bar-helper (VSCode Webview)\n// Controls: â†â†‘â†’â†“ / WASD Â· U Undo Â· R Restart\n// Features: 4x4ã€åˆ†æ•¸/æœ€é«˜åˆ†ã€Undo(ä¸€æ­¥)ã€æ–°å±€ã€è‡ªå‹•èšç„¦ã€ç°¡å–®å‹•ç•«\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbh2048',\n    'ğŸ§© 2048',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"zh-Hant\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <title>2048</title>\n    <style>\n      :root{\n        --bg:#0f1115; --fg:#e6e6e6; --muted:#9aa2b1; --card:#161a22; --line:#222838;\n        --accent:#7bd88f; --board:#111722; --cell:#0e1219; --gap:10px; --size:360px; --radius:12px;\n      }\n      html,body{height:100%} body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:860px;margin:0 auto;padding:14px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .btn{background:#1d2330;border:1px solid #2a3247;border-radius:10px;color:var(--fg);padding:8px 12px;cursor:pointer}\n      .btn:hover{filter:brightness(1.08)}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:8px 12px;min-width:120px}\n      .legend{font-size:12px;color:var(--muted)}\n      .boardWrap{display:flex;justify-content:center}\n      .board{position:relative;width:var(--size);height:var(--size);background:var(--board);border-radius:16px;padding:var(--gap);box-sizing:border-box}\n      .grid{position:absolute;left:var(--gap);top:var(--gap);right:var(--gap);bottom:var(--gap);display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);gap:var(--gap)}\n      .bgcell{background:var(--cell);border-radius:var(--radius)}\n      .tiles{position:absolute;left:var(--gap);top:var(--gap);right:var(--gap);bottom:var(--gap)}\n      .tile{\n        position:absolute; display:flex;align-items:center;justify-content:center;\n        font-weight:800; border-radius:var(--radius); user-select:none;\n        transition: transform 120ms ease, background 120ms ease, color 120ms ease;\n        will-change: transform;\n      }\n      .pop{animation:pop .12s ease}\n      @keyframes pop{0%{transform:scale(.6)}100%{transform:scale(1)}}\n      .bump{animation:bump .12s ease}\n      @keyframes bump{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}\n\n      /* é¡è‰²è¡¨ï¼ˆå¯è‡ªè¡Œå¾®èª¿ï¼‰ */\n      .v2 {background:#2b364d;color:#e6eefc}\n      .v4 {background:#31405b;color:#eef4ff}\n      .v8 {background:#3a6eea;color:#fff}\n      .v16{background:#2aa3ef;color:#fff}\n      .v32{background:#22c6b8;color:#102a2a}\n      .v64{background:#7bd88f;color:#0e2414}\n      .v128{background:#ffd34d;color:#40320a}\n      .v256{background:#ffb14d;color:#3b2510}\n      .v512{background:#ff8a5c;color:#3a1710}\n      .v1024{background:#ff6b6b;color:#3a0f12}\n      .v2048{background:#b892ff;color:#1e123a}\n      .v4096,.v8192,.v16384{background:#64d7d6;color:#0c1e21}\n\n      /* å°ç•«é¢æ™‚å¯æ”¹å°ºå¯¸ï¼šæŠŠ --size æ”¹ 320px æˆ– 300px */\n      @media (max-width:480px){ :root{ --size:320px } }\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div style=\"font-weight:700\">ğŸ§© 2048</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnUndo\" class=\"btn\" title=\"Undo (U)\">â†©ï¸ Undo</button>\n        <button id=\"btnNew\" class=\"btn\" title=\"Restart (R)\">ğŸ”„ New Game</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">Best: <b id=\"best\">0</b></div>\n        </div>\n        <div class=\"legend\" style=\"margin-top:6px\">Use â†â†‘â†’â†“ / WASD ç§»å‹•ï¼›U æ‚”ä¸€æ­¥ï¼›R é‡æ–°é–‹å§‹ã€‚</div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"boardWrap\">\n          <div id=\"board\" class=\"board\" tabindex=\"0\" title=\"Use Arrow Keys / WASD to move\">\n            <div class=\"grid\" id=\"grid\"></div>\n            <div class=\"tiles\" id=\"tiles\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      const $ = id => document.getElementById(id);\n      const boardEl = $('board'), gridEl = $('grid'), tilesEl = $('tiles');\n      const scoreEl=$('score'), bestEl=$('best'), btnNew=$('btnNew'), btnUndo=$('btnUndo');\n\n      const N = 4;\n      const LS_KEY = 'sbh_2048_state_v1';\n      const BEST_KEY = 'sbh_2048_best';\n      const SIZE = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--size')) || 360;\n      const GAP = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap')) || 10;\n      const inner = SIZE - GAP*2;\n      const cell = Math.floor((inner - GAP*3)/4); // 4 cols => 3 gaps\n\n      // èƒŒæ™¯æ ¼\n      function buildBg(){\n        gridEl.innerHTML='';\n        for(let i=0;i<N*N;i++){\n          const c=document.createElement('div');\n          c.className='bgcell';\n          gridEl.appendChild(c);\n        }\n      }\n\n      // ç‹€æ…‹\n      let grid, score=0, best=Number(localStorage.getItem(BEST_KEY)||0);\n      let prevState=null; // Undo å°ˆç”¨ï¼š{grid,score}\n\n      // å·¥å…·\n      function cloneGrid(g){ return g.map(r=>r.slice()); }\n      function emptyGrid(){ return Array.from({length:N}, ()=>Array(N).fill(0)); }\n      function randChoice(a){ return a[(Math.random()*a.length)|0]; }\n\n      function saveState(){\n        localStorage.setItem(LS_KEY, JSON.stringify({ grid, score }));\n        localStorage.setItem(BEST_KEY, String(best));\n      }\n      function loadState(){\n        try{\n          const v = JSON.parse(localStorage.getItem(LS_KEY)||'null');\n          if (v && v.grid && Array.isArray(v.grid) && v.grid.length===4) {\n            grid = v.grid; score = v.score||0;\n          } else {\n            newGame(true);\n          }\n        }catch{\n          newGame(true);\n        }\n        best = Math.max(best, Number(localStorage.getItem(BEST_KEY)||0));\n      }\n\n      // æ–¹å¡Šåº§æ¨™è½‰æ›åˆ° pxï¼ˆç”¨ transform å®šä½ï¼‰\n      function posToTransform(r,c){\n        const x = c*(cell+GAP);\n        const y = r*(cell+GAP);\n        return \\`translate(\\${x}px, \\${y}px)\\`;\n      }\n\n      // ç”¢ç”Ÿæ–°æ–¹å¡Šï¼ˆ2 çš„æ©Ÿç‡ 90%ï¼Œ4 çš„æ©Ÿç‡ 10%ï¼‰\n      function spawn(pop=true){\n        const empties=[];\n        for(let r=0;r<N;r++) for(let c=0;c<N;c++) if(grid[r][c]===0) empties.push([r,c]);\n        if (empties.length===0) return false;\n        const [r,c]=randChoice(empties);\n        grid[r][c] = Math.random()<0.9 ? 2 : 4;\n        draw(true, [{r,c,pop}]);\n        return true;\n      }\n\n      // åˆä½µèˆ‡ç§»å‹•\n      function slideRowLeft(row){\n        // å£“ç¸®é 0\n        const a = row.filter(v=>v!==0);\n        let moved=false, gained=0, mergedIndex=new Set();\n        for(let i=0;i<a.length-1;i++){\n          if (a[i]!==0 && a[i]===a[i+1] && !mergedIndex.has(i)){\n            a[i]*=2; gained+=a[i]; a.splice(i+1,1); mergedIndex.add(i);\n            moved=true;\n          }\n        }\n        while(a.length<N) a.push(0);\n        for(let i=0;i<N;i++) if(a[i]!==row[i]) moved=true;\n        return {row:a, moved, gained};\n      }\n\n      function rotateGrid(g){\n        // æ—‹è½‰ 90 åº¦ï¼ˆé †æ™‚é‡ï¼‰\n        const r = emptyGrid();\n        for(let i=0;i<N;i++) for(let j=0;j<N;j++) r[j][N-1-i]=g[i][j];\n        return r;\n      }\n\n      function move(dir){ // 'left'|'right'|'up'|'down'\n        // ä¿å­˜ Undo\n        prevState = { grid: cloneGrid(grid), score };\n\n        let g = cloneGrid(grid);\n        let totalGained=0, movedAny=false;\n\n        function applyLeft(){\n          for(let r=0;r<N;r++){\n            const res = slideRowLeft(g[r]);\n            g[r]=res.row;\n            if (res.moved) movedAny=true;\n            totalGained+=res.gained;\n          }\n        }\n\n        if (dir==='left'){ applyLeft(); }\n        else if (dir==='right'){ // åè½‰ -> å·¦ç§» -> åè½‰\n          g = g.map(row=>row.slice().reverse());\n          applyLeft();\n          g = g.map(row=>row.slice().reverse());\n        }\n        else if (dir==='up'){ // æ—‹è½‰ -> å·¦ç§» -> åæ—‹\n          g = rotateGrid(g);      // CW\n          g = rotateGrid(g);      // 180\n          g = rotateGrid(g);      // CCW => ç­‰æ–¼è½‰åˆ°å·¦ç§»å°é½Š\n          applyLeft();\n          g = rotateGrid( rotateGrid( rotateGrid(g) ) ); // å›æ­£ï¼šCW\n        }\n        else if (dir==='down'){\n          g = rotateGrid(g); // CW\n          applyLeft();\n          g = rotateGrid( rotateGrid( rotateGrid(g) ) ); // CCW\n        }\n\n        if (!movedAny){\n          prevState=null; // å‹•ä¸äº†å°±ä¸ä¿ç•™ undo\n          return false;\n        }\n\n        grid = g;\n        score += totalGained;\n        best = Math.max(best, score);\n        draw(totalGained>0, [], totalGained>0); // bump åˆä½µçš„æ ¼\n        saveState();\n        setTimeout(()=>{\n          if (!spawn(true)) checkGameOver();\n          saveState();\n        }, 80);\n        return true;\n      }\n\n      function checkGameOver(){\n        // æœ‰ç©ºä½å°±æ²’çµæŸ\n        for(let r=0;r<N;r++) for(let c=0;c<N;c++) if(grid[r][c]===0) return false;\n        // æª¢æŸ¥ç›¸é„°å¯åˆä½µ\n        for(let r=0;r<N;r++){\n          for(let c=0;c<N;c++){\n            const v=grid[r][c];\n            if (r+1<N && grid[r+1][c]===v) return false;\n            if (c+1<N && grid[r][c+1]===v) return false;\n          }\n        }\n        overlay('Game Over ğŸ˜µ  æŒ‰ R é‡ä¾†');\n        return true;\n      }\n\n      // ä»‹é¢ç¹ªè£½\n      function tileClass(v){\n        if (v<=2048) return 'v'+v;\n        if (v<=4096) return 'v4096';\n        if (v<=8192) return 'v8192';\n        return 'v16384';\n      }\n      function fontSizeFor(v){\n        const len=String(v).length;\n        if (len<=2) return Math.floor(cell*0.42)+'px';\n        if (len===3) return Math.floor(cell*0.36)+'px';\n        if (len===4) return Math.floor(cell*0.30)+'px';\n        return Math.floor(cell*0.26)+'px';\n      }\n\n      function draw(popNew=false, newTiles=[], bump=false){\n        tilesEl.innerHTML='';\n\n        // èƒŒæ™¯æ ¼å¤§å°ç”± CSS Grid æ§åˆ¶ï¼Œé€™è£¡åªç•«å‹•æ…‹æ–¹å¡Š\n        for(let r=0;r<N;r++){\n          for(let c=0;c<N;c++){\n            const v=grid[r][c];\n            if (!v) continue;\n            const t=document.createElement('div');\n            t.className='tile '+tileClass(v);\n            t.style.width=cell+'px'; t.style.height=cell+'px';\n            t.style.transform=posToTransform(r,c);\n            t.style.fontSize=fontSizeFor(v);\n            t.textContent=String(v);\n            // æ–°æ–¹å¡Šå½ˆå‡º\n            if (newTiles.some(p=>p.r===r && p.c===c)) t.classList.add('pop');\n            if (bump) t.classList.add('bump');\n            tilesEl.appendChild(t);\n          }\n        }\n        scoreEl.textContent = String(score);\n        bestEl.textContent  = String(best);\n      }\n\n      // é®ç½©è¨Šæ¯\n      let overlayDiv=null;\n      function overlay(text){\n        if (overlayDiv){ overlayDiv.remove(); overlayDiv=null; }\n        overlayDiv=document.createElement('div');\n        overlayDiv.style.position='absolute';\n        overlayDiv.style.inset='0';\n        overlayDiv.style.background='rgba(0,0,0,.55)';\n        overlayDiv.style.borderRadius='16px';\n        overlayDiv.style.display='flex';\n        overlayDiv.style.alignItems='center';\n        overlayDiv.style.justifyContent='center';\n        overlayDiv.style.flexDirection='column';\n        overlayDiv.style.color='#fff';\n        overlayDiv.style.font='bold 22px system-ui';\n        overlayDiv.innerHTML = \\`<div>\\${text}</div><div style=\"font:14px system-ui;margin-top:8px\">æŒ‰ R é‡æ–°é–‹å§‹</div>\\`;\n        boardEl.appendChild(overlayDiv);\n      }\n      function clearOverlay(){ if (overlayDiv){ overlayDiv.remove(); overlayDiv=null; } }\n\n      // æ“ä½œ\n      function handleKey(e){\n        const k = e.key;\n        if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown',' '].includes(k)) e.preventDefault();\n        if (k==='ArrowLeft' || k==='a' || k==='A') move('left');\n        else if (k==='ArrowRight' || k==='d' || k==='D') move('right');\n        else if (k==='ArrowUp' || k==='w' || k==='W') move('up');\n        else if (k==='ArrowDown' || k==='s' || k==='S') move('down');\n        else if (k==='u' || k==='U') undo();\n        else if (k==='r' || k==='R') newGame();\n      }\n      window.addEventListener('keydown', handleKey);\n      boardEl.addEventListener('click', ()=>boardEl.focus());\n      boardEl.addEventListener('mouseenter', ()=>boardEl.focus());\n\n      // Undoï¼ˆå›åˆ°ä¸Šä¸€æ­¥ï¼‰\n      function undo(){\n        if (!prevState) return;\n        grid = cloneGrid(prevState.grid);\n        score = prevState.score;\n        prevState = null;\n        clearOverlay();\n        draw();\n        saveState();\n      }\n\n      // æ–°å±€\n      function newGame(first=false){\n        grid = emptyGrid();\n        score=0; prevState=null; clearOverlay();\n        // èµ·æ‰‹ 2 å¡Š\n        spawn(false); spawn(false);\n        draw();\n        if (!first) saveState();\n      }\n\n      // åˆå§‹åŒ–\n      buildBg();\n      loadState();\n      draw();\n      if (!grid || grid.flat().every(v=>v===0)){ newGame(); }\n      btnNew.addEventListener('click', newGame);\n      btnUndo.addEventListener('click', undo);\n\n      // è‡ªå‹•èšç„¦ï¼Œç¢ºä¿éµç›¤å¯ç”¨\n      setTimeout(()=>boardEl.focus(), 0);\n    </script>\n  </body>\n  </html>`;\n}\n",
    "tags": [
      "game"
    ]
  },
  {
    "command": "cmd.tik4pdi6qo",
    "text": "âš«ï¸âšªï¸  äº”å­æ£‹",
    "tooltip": "é»æ“Šé–‹å§‹äº”å­æ£‹",
    "hidden": true,
    "enableOnInit": false,
    "script": "// Gomoku (äº”å­æ£‹) â€” PvE only with AI levels 1..6\n// For: status-bar-helper (VSCode Webview)\n// æ“ä½œï¼šæ»‘é¼ é»æ ¼è½å­ï¼›New Game é–‹æ–°å±€ï¼›Undo æ‚”æ£‹ï¼ˆæœƒå›åˆ°ä½ çš„å›åˆï¼‰ï¼›å¯é¸ä½ ä¸‹é»‘/ç™½ã€AI é›£åº¦ 1..6\n// é›£åº¦ï¼š1=è¶…ä¼‘é–’(éš¨æ©Ÿ+å¨è„…)ã€2=è²ªå©ªã€3=å¼·è²ªå©ª(å³æ™‚å µ/æ®º)ã€4=æœå°‹2å±¤ã€5=æœå°‹2å±¤(æ›´å¤šå€™é¸)ã€6=æœå°‹3å±¤(é™æ™‚)\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhGomoku',\n    'âš«ï¸âšªï¸ Gomoku â€” äº”å­æ£‹ (PvE)',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n  vm.onStop(() => { try{ panel.dispose(); } catch{} });\n  panel.onDidDispose(() => vm.stop());\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"zh-Hant\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/>\n    <title>Gomoku</title>\n    <style>\n      :root{ --bg:#0f1115; --fg:#e6e6e6; --muted:#9aa2b1; --card:#161a22; --line:#222838; --btn:#1d2330; --btnb:#2a3247; --accent:#7bd88f; }\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:860px;margin:0 auto;padding:14px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .btn{background:var(--btn);border:1px solid var(--btnb);border-radius:10px;padding:8px 12px;color:var(--fg);cursor:pointer}\n      .btn:hover{filter:brightness(1.06)}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px}\n      .grid{display:grid;grid-template-columns:repeat(6,auto);gap:10px;align-items:center}\n      .legend{font-size:12px;color:var(--muted)}\n      .board{display:flex;justify-content:center}\n      canvas{display:block;background:#0b0f18;border-radius:12px;outline:none}\n      select,input[type=range]{background:#101522;border:1px solid var(--line);color:var(--fg);padding:6px 8px;border-radius:10px}\n      input[type=range]{accent-color:var(--accent)}\n      .num{min-width:24px;display:inline-block;text-align:right}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:8px 12px;min-width:120px}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\" style=\"font-weight:700\">âš«ï¸âšªï¸ Gomoku â€” äº”å­æ£‹ï¼ˆäººæ©Ÿå°æˆ°ï¼‰</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnUndo\" class=\"btn\">â†©ï¸ Undo</button>\n        <button id=\"btnNew\" class=\"btn\">ğŸ”„ New Game</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">å›åˆï¼š<b id=\"turnLabel\">ä½ ï¼ˆé»‘ï¼‰</b></div>\n          <div class=\"kpi\">AI é›£åº¦ï¼š<b id=\"lvlLabel\">3</b>/6</div>\n        </div>\n        <div class=\"grid\" style=\"margin-top:8px\">\n          <div>ä½ è¦ä¸‹</div>\n          <select id=\"selSide\">\n            <option value=\"black\">é»‘å­ (å…ˆæ‰‹)</option>\n            <option value=\"white\">ç™½å­ (å¾Œæ‰‹)</option>\n          </select>\n\n          <div>AI é›£åº¦</div>\n          <div style=\"display:flex;align-items:center;gap:8px\">\n            <input id=\"level\" type=\"range\" min=\"1\" max=\"6\" step=\"1\" value=\"3\">\n            <span id=\"lvl\" class=\"num\">3</span>\n          </div>\n\n          <div class=\"legend\" style=\"grid-column:1/-1\">æç¤ºï¼šé»æ£‹ç›¤ä¸‹å­ï¼›Undo æœƒå›é€€ã€Œä½ èˆ‡ AI çš„æœ€å¾Œå…©æ‰‹ã€ï¼Œç¢ºä¿å›åˆ°ä½ çš„å›åˆã€‚</div>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"board\">\n          <!-- 420Ã—420ï¼Œ15Ã—15 ç›¤ï¼Œæ ¼è·æœƒè‡ªç®— -->\n          <canvas id=\"board\" width=\"420\" height=\"420\" tabindex=\"0\"></canvas>\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      const $ = id => document.getElementById(id);\n      const cvs = $('board'), ctx = cvs.getContext('2d');\n      const selSide=$('selSide'), levelEl=$('level'), lvlText=$('lvl'), lvlLabel=$('lvlLabel'), turnLabel=$('turnLabel');\n      const btnNew=$('btnNew'), btnUndo=$('btnUndo');\n\n      // ----- ç›¤é¢è¨­å®š -----\n      const N = 15;               // 15Ã—15\n      const PAD = 20;             // å…§è·\n      const W = cvs.width, H = cvs.height;\n      const GAP = Math.floor((W - PAD*2) / (N-1));  // æ ¼è·\n      const R = Math.floor(GAP * 0.42);             // æ£‹å­åŠå¾‘\n      const EMPTY=0, BLACK=1, WHITE=2;\n\n      // ç‹€æ…‹\n      let board, turn, human=BLACK, ai=WHITE, lastMove=null, over=false;\n      const history=[]; // push {x,y,side}\n\n      // é›£åº¦å°æ‡‰ï¼ˆå€™é¸æ•¸ã€æœå°‹æ·±åº¦ã€æ™‚é–“ä¸Šé™ï¼‰\n      function cfgFor(level){\n        switch(+level){\n          case 1: return { topK:8, depth:0, limitMs:40 };            // éš¨æ©Ÿæ–¼å‰å¹¾å + å¨è„…è™•ç†\n          case 2: return { topK:8, depth:0, limitMs:80 };            // è²ªå©ª\n          case 3: return { topK:10, depth:1, limitMs:120 };          // å¼·è²ªå©ªï¼ˆå³æ™‚å µ/æ®ºï¼‰\n          case 4: return { topK:10, depth:2, limitMs:180 };          // 2 å±¤\n          case 5: return { topK:14, depth:2, limitMs:220 };          // 2 å±¤æ›´å¤šå€™é¸\n          case 6: return { topK:10, depth:3, limitMs:350 };          // 3 å±¤é™æ™‚\n          default: return { topK:10, depth:1, limitMs:120 };\n        }\n      }\n\n      // ----- åˆå§‹åŒ– -----\n      function newBoard(){\n        board = Array.from({length:N}, ()=>Array(N).fill(EMPTY));\n        history.length=0; lastMove=null; over=false;\n      }\n      function setSides(){\n        if (selSide.value==='black'){ human=BLACK; ai=WHITE; }\n        else { human=WHITE; ai=BLACK; }\n        turn = BLACK; // é»‘å…ˆ\n        updateLabels();\n      }\n      function updateLabels(){\n        lvlText.textContent = String(levelEl.value);\n        lvlLabel.textContent = String(levelEl.value);\n        const t = (turn===human)?'ä½ ':'AI';\n        const tside = (turn===BLACK)?'é»‘':'ç™½';\n        turnLabel.textContent = \\`\\${t}ï¼ˆ\\${tside}ï¼‰\\`;\n      }\n\n      // ----- ç¹ªè£½ -----\n      function drawBoard(){\n        ctx.clearRect(0,0,W,H);\n        // æ£‹ç›¤åº•\n        for(let y=0;y<H;y+=20){\n          for(let x=0;x<W;x+=20){\n            ctx.fillStyle = ((x+y)%40===0)?'#0b0f18':'#0c111a';\n            ctx.fillRect(x,y,20,20);\n          }\n        }\n        // ç·š\n        ctx.strokeStyle='#2b3144'; ctx.lineWidth=1.2;\n        for(let i=0;i<N;i++){\n          const x=PAD+i*GAP, y=PAD+i*GAP;\n          ctx.beginPath(); ctx.moveTo(PAD, PAD+i*GAP); ctx.lineTo(W-PAD, PAD+i*GAP); ctx.stroke();\n          ctx.beginPath(); ctx.moveTo(PAD+i*GAP, PAD); ctx.lineTo(PAD+i*GAP, H-PAD); ctx.stroke();\n        }\n        // æ˜Ÿä½ (3,3)(3,11)(7,7)(11,3)(11,11)\n        const stars=[[3,3],[3,11],[7,7],[11,3],[11,11]];\n        ctx.fillStyle='#9aa2b1';\n        for(const [gx,gy] of stars){\n          const {cx,cy}=cellXY(gx,gy);\n          ctx.beginPath(); ctx.arc(cx,cy,3,0,Math.PI*2); ctx.fill();\n        }\n        // æ£‹å­\n        for(let y=0;y<N;y++){\n          for(let x=0;x<N;x++){\n            const v=board[y][x];\n            if (v!==EMPTY){\n              const {cx,cy}=cellXY(x,y);\n              const grad=ctx.createRadialGradient(cx,cy,2,cx,cy,R);\n              if (v===BLACK){ grad.addColorStop(0,'#555'); grad.addColorStop(1,'#111'); }\n              else { grad.addColorStop(0,'#fff'); grad.addColorStop(1,'#d9d9d9'); }\n              ctx.fillStyle=grad; ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.fill();\n            }\n          }\n        }\n        // æœ€å¾Œä¸€æ­¥é«˜äº®\n        if (lastMove){\n          const {cx,cy}=cellXY(lastMove.x,lastMove.y);\n          ctx.strokeStyle='#ffd34d'; ctx.lineWidth=2;\n          ctx.beginPath(); ctx.arc(cx,cy,R+3,0,Math.PI*2); ctx.stroke();\n        }\n        // å‹è² æç¤º\n        if (over){\n          ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(0,0,W,H);\n          ctx.fillStyle='#fff'; ctx.font='bold 22px system-ui'; ctx.textAlign='center';\n          ctx.fillText((winnerSide===human?'ä½ è´äº† ğŸ‰':'AI å‹å‡º ğŸ¤–'), W/2, H/2 - 12);\n          ctx.font='14px system-ui'; ctx.fillText('æŒ‰ New Game é‡æ–°é–‹å§‹', W/2, H/2 + 16);\n        }\n      }\n\n      function cellXY(x,y){ return { cx: PAD + x*GAP, cy: PAD + y*GAP }; }\n      function posToCell(px,py){\n        // å°‡æ»‘é¼ åº§æ¨™ snap åˆ°æœ€è¿‘æ ¼é»\n        function snap(v){ return Math.round((v - PAD) / GAP); }\n        const x=snap(px), y=snap(py);\n        if (x<0||x>=N||y<0||y>=N) return null;\n        const {cx,cy}=cellXY(x,y);\n        const dist=Math.hypot(px-cx, py-cy);\n        if (dist<=GAP*0.5) return {x,y};\n        return null;\n      }\n\n      // ----- å‹è² åˆ¤å®š -----\n      function countDir(x,y,dx,dy,side){\n        let c=0, i=1;\n        while(true){\n          const nx=x+dx*i, ny=y+dy*i;\n          if (nx<0||ny<0||nx>=N||ny>=N) break;\n          if (board[ny][nx]!==side) break;\n          c++; i++;\n        }\n        return c;\n      }\n      function isFive(x,y,side){\n        const dirs=[[1,0],[0,1],[1,1],[1,-1]];\n        for (const [dx,dy] of dirs){\n          const c = 1 + countDir(x,y,dx,dy,side) + countDir(x,y,-dx,-dy,side);\n          if (c>=5) return true;\n        }\n        return false;\n      }\n      let winnerSide=null;\n\n      // ----- è©•åˆ†ï¼ˆå•Ÿç™¼å¼ï¼‰ -----\n      // ä»¥ã€Œé€£å­æ•¸ + é›™é‚Šæ˜¯å¦é–‹æ”¾ã€è©•åˆ†ï¼›AI åˆ†æ•¸ - å°æ‰‹åˆ†æ•¸\n      function evaluate(sideView=ai){\n        let scoreAI=0, scoreHu=0;\n        const dirs=[[1,0],[0,1],[1,1],[1,-1]];\n\n        function lineScore(x,y,dx,dy,side){\n          // åªåœ¨ã€Œæ­¤æ–¹å‘çš„èµ·é»ã€è¨ˆåˆ†ï¼šå‰ä¸€æ ¼ä¸æ˜¯åŒè‰²\n          const px=x-dx, py=y-dy;\n          if (px>=0&&py>=0&&px<N&&py<N && board[py][px]===side) return 0;\n\n          let i=0, len=0;\n          while(true){\n            const nx=x+dx*i, ny=y+dy*i;\n            if (nx<0||ny<0||nx>=N||ny>=N) break;\n            if (board[ny][nx]!==side) break;\n            len++; i++;\n          }\n          const leftOpen = (px>=0&&py>=0&&px<N&&py<N && board[py][px]===EMPTY);\n          const rx=x+dx*len, ry=y+dy*len;\n          const rightOpen = (rx>=0&&ry>=0&&rx<N&&ry<N && board[ry][rx]===EMPTY);\n          const open = (leftOpen?1:0)+(rightOpen?1:0);\n\n          // åŸºç¤æ¬Šé‡\n          if (len>=5) return 1000000;\n          if (len===4 && open===2) return 100000;\n          if (len===4 && open===1) return 8000;\n          if (len===3 && open===2) return 1500;\n          if (len===3 && open===1) return 200;\n          if (len===2 && open===2) return 80;\n          if (len===2 && open===1) return 20;\n          if (len===1 && open===2) return 6;\n          return 0;\n        }\n\n        for(let y=0;y<N;y++){\n          for(let x=0;x<N;x++){\n            const v=board[y][x];\n            if (v===EMPTY) continue;\n            for(const [dx,dy] of dirs){\n              const s = lineScore(x,y,dx,dy,v);\n              if (v===ai) scoreAI += s; else scoreHu += s;\n            }\n          }\n        }\n        return scoreAI - scoreHu;\n      }\n\n      // å±€éƒ¨è©•åˆ†ï¼šæŠŠ (x,y) ç•¶ä½œ side ä¸‹ï¼Œå›å‚³æ­¤é»çš„å¨è„…å€¼\n      function pointScore(x,y,side){\n        if (board[y][x]!==EMPTY) return -Infinity;\n        let score=0;\n        const dirs=[[1,0],[0,1],[1,1],[1,-1]];\n        for(const [dx,dy] of dirs){\n          // å¾€å…©é‚Šå»¶ä¼¸ï¼Œè¨ˆç®—é€£å­èˆ‡ç©ºä½æƒ…æ³\n          let a=0,b=0,blockA=false,blockB=false;\n          for(let i=1;i<5;i++){\n            const nx=x+dx*i, ny=y+dy*i;\n            if (nx<0||ny<0||nx>=N||ny>=N){ blockA=true; break; }\n            const v=board[ny][nx];\n            if (v===side) a++; else { if (v!==EMPTY) blockA=true; break; }\n          }\n          for(let i=1;i<5;i++){\n            const nx=x-dx*i, ny=y-dy*i;\n            if (nx<0||ny<0||nx>=N||ny>=N){ blockB=true; break; }\n            const v=board[ny][nx];\n            if (v===side) b++; else { if (v!==EMPTY) blockB=true; break; }\n          }\n          const len=a+b+1;\n          const open = (blockA?0:1)+(blockB?0:1);\n          if (len>=5){ score += 1e6; continue; }\n          if (len===4 && open===2) score += 1e5;\n          else if (len===4 && open===1) score += 6e3;\n          else if (len===3 && open===2) score += 1200;\n          else if (len===3 && open===1) score += 150;\n          else if (len===2 && open===2) score += 60;\n          else if (len===2 && open===1) score += 16;\n        }\n        return score;\n      }\n\n      // å€™é¸èµ°æ³•ï¼šåªå–ã€Œè·é›¢ä»»ä¸€æ£‹å­ 2 æ ¼å…§ã€çš„ç©ºé»\n      function hasNeighbor2(x,y){\n        for(let dy=-2; dy<=2; dy++){\n          for(let dx=-2; dx<=2; dx++){\n            if (dx===0 && dy===0) continue;\n            const nx=x+dx, ny=y+dy;\n            if (nx<0||ny<0||nx>=N||ny>=N) continue;\n            if (board[ny][nx]!==EMPTY) return true;\n          }\n        }\n        return false;\n      }\n      function genCandidates(topK, biasForSide=ai){\n        const list=[];\n        let hasStone=false;\n        for(let y=0;y<N;y++) for(let x=0;x<N;x++) if(board[y][x]!==EMPTY){ hasStone=true; break; }\n        if (!hasStone){\n          // ç©ºç›¤ â†’ å–ä¸­å¿ƒ\n          const c = Math.floor(N/2);\n          return [{x:c,y:c,score:0}];\n        }\n        for(let y=0;y<N;y++){\n          for(let x=0;x<N;x++){\n            if (board[y][x]!==EMPTY) continue;\n            if (!hasNeighbor2(x,y)) continue;\n            const off = pointScore(x,y,biasForSide);\n            const def = pointScore(x,y,biasForSide===ai?human:ai) * 0.96; // é˜²å®ˆç¨å¾®å¼±åŒ–\n            const sc = Math.max(off, def);\n            list.push({x,y,score:sc, offensive:off, defensive:def});\n          }\n        }\n        list.sort((a,b)=>b.score-a.score);\n        return list.slice(0, topK);\n      }\n\n      // å³æ™‚æ®º/å µï¼šè‹¥æœ‰ç›´æ¥äº”é€£ï¼Œæˆ–å°æ‰‹å¯äº”é€£ï¼Œå…ˆè™•ç†\n      function immediateMove(){\n        const cand = genCandidates(30, ai);\n        // 1) æˆ‘æ–¹ç›´æ¥å–å‹\n        for(const c of cand){\n          board[c.y][c.x]=ai;\n          const win=isFive(c.x,c.y,ai);\n          board[c.y][c.x]=EMPTY;\n          if (win) return c;\n        }\n        // 2) æ“‹å°æ‰‹è‡´å‹\n        for(const c of cand){\n          board[c.y][c.x]=human;\n          const oppWin=isFive(c.x,c.y,human);\n          board[c.y][c.x]=EMPTY;\n          if (oppWin) return c; // æ”¾åœ¨é€™è£¡å µ\n        }\n        return null;\n      }\n\n      // Minimax + Alpha-Beta + é™æ™‚\n      function search(depth, alpha, beta, curSide, cfg, deadline){\n        if (performance.now() > deadline) return { score:evaluate(), move:null, cutoff:true };\n        if (depth===0) return { score:evaluate(), move:null };\n\n        // å³æ™‚å‹è² å¿«é€Ÿåˆ¤\n        if (lastMove && isFive(lastMove.x,lastMove.y,lastMove.side)){\n          const s = (lastMove.side===ai)? 999999 : -999999;\n          return { score:s, move:null };\n        }\n\n        const cand = genCandidates(cfg.topK, curSide);\n        if (cand.length===0) return { score:evaluate(), move:null };\n\n        let bestMove=null;\n\n        if (curSide===ai){\n          let best=-Infinity;\n          for(const c of cand){\n            board[c.y][c.x]=curSide;\n            const prev=lastMove; lastMove={x:c.x,y:c.y,side:curSide};\n            let val;\n            // å¿«é€Ÿçµ‚æ­¢ï¼šæ”¾ä¸‹å³å‹\n            if (isFive(c.x,c.y,curSide)){\n              val=999999 - (cfg.depth-depth); // åå¥½æ›´å¿«å‹\n            }else{\n              const r = search(depth-1, alpha, beta, human, cfg, deadline);\n              val=r.score;\n              if (r.cutoff) { board[c.y][c.x]=EMPTY; lastMove=prev; return { score:best, move:bestMove, cutoff:true }; }\n            }\n            board[c.y][c.x]=EMPTY; lastMove=prev;\n\n            if (val>best){ best=val; bestMove={x:c.x,y:c.y}; }\n            if (val>alpha) alpha=val;\n            if (beta<=alpha) break; // beta-cut\n          }\n          return { score:best, move:bestMove };\n        }else{\n          let best=Infinity;\n          for(const c of cand){\n            board[c.y][c.x]=curSide;\n            const prev=lastMove; lastMove={x:c.x,y:c.y,side:curSide};\n            let val;\n            if (isFive(c.x,c.y,curSide)){\n              val=-999999 + (cfg.depth-depth);\n            }else{\n              const r = search(depth-1, alpha, beta, ai, cfg, deadline);\n              val=r.score;\n              if (r.cutoff) { board[c.y][c.x]=EMPTY; lastMove=prev; return { score:best, move:bestMove, cutoff:true }; }\n            }\n            board[c.y][c.x]=EMPTY; lastMove=prev;\n\n            if (val<best){ best=val; bestMove={x:c.x,y:c.y}; }\n            if (val<beta) beta=val;\n            if (beta<=alpha) break; // alpha-cut\n          }\n          return { score:best, move:bestMove };\n        }\n      }\n\n      // AI ä¸‹å­\n      async function aiMove(){\n        if (over || turn!==ai) return;\n\n        const level = +levelEl.value;\n        const cfg = cfgFor(level);\n        const deadline = performance.now() + cfg.limitMs;\n\n        // Lv1/Lv2/Lv3 éƒ½å…ˆæª¢æŸ¥å³æ™‚æ®º/å µ\n        if (level<=3){\n          const imm = immediateMove();\n          if (imm){ place(imm.x,imm.y,ai); return; }\n        }\n\n        let move=null;\n        if (cfg.depth===0){\n          // è²ªå©ªï¼éš¨æ©Ÿæ–¼å‰K\n          const cand = genCandidates(cfg.topK, ai);\n          if (cand.length===0){ // å¹¾ä¹ä¸æœƒ\n            const c = Math.floor(N/2); move={x:c,y:c};\n          }else{\n            if (level===1){\n              const k = Math.max(1, Math.min(6, cand.length));\n              move = cand[(Math.random()*k)|0];\n            }else{\n              move = cand[0];\n            }\n          }\n        }else{\n          const res = search(cfg.depth, -Infinity, Infinity, ai, cfg, deadline);\n          move = res.move;\n          if (!move){\n            // è¶…æ™‚æˆ–æ²’æœ‰æ›´å¥½ â†’ ç”¨å³æ™‚æˆ–è²ªå©ªåšä¿åº•\n            const imm = immediateMove();\n            if (imm) move=imm; else move = genCandidates(1, ai)[0];\n          }\n        }\n\n        if (move) place(move.x, move.y, ai);\n      }\n\n      // è½å­ï¼ˆå«å‹è² æª¢æŸ¥ï¼‰\n      function place(x,y,side){\n        if (board[y][x]!==EMPTY || over) return false;\n        board[y][x]=side;\n        history.push({x,y,side});\n        lastMove={x,y,side};\n        // å‹è² \n        if (isFive(x,y,side)){\n          over=true; winnerSide=side;\n        }else{\n          // æ›æ‰‹\n          turn = (side===BLACK)? WHITE : BLACK;\n        }\n        updateLabels(); drawBoard();\n        // è‹¥è¼ªåˆ° AIï¼Œæ’ä¸€ä¸‹\n        if (!over && turn===ai){\n          setTimeout(aiMove, 30);\n        }\n        return true;\n      }\n\n      // æ‚”æ£‹ï¼šå›åˆ°ç©å®¶å›åˆï¼ˆä¸€æ¬¡åƒæ‰ AI èˆ‡ç©å®¶å„ä¸€æ­¥ï¼Œå¦‚æœ AI é‚„æ²’ä¸‹å°±åªé€€ç©å®¶ä¸€æ­¥ï¼‰\n      function undo(){\n        if (history.length===0 || over) return;\n        // å¦‚æœæœ€å¾Œä¸€æ­¥æ˜¯ AIï¼Œå°±å…ˆé€€ AIï¼›å†çœ‹ç©å®¶\n        let popped = history.pop();\n        board[popped.y][popped.x]=EMPTY;\n\n        if (popped.side===ai && history.length>0){\n          popped = history.pop();\n          board[popped.y][popped.x]=EMPTY;\n        }\n        over=false; winnerSide=null;\n        // è¨­å®šå›åˆï¼šè‹¥æœ‰æ£‹å‰‡ç›¸åæ–¼æœ€å¾Œæ­¥ï¼Œå¦å‰‡é»‘å…ˆ\n        const last = history[history.length-1];\n        if (last){ turn = (last.side===BLACK)? WHITE : BLACK; lastMove=last; }\n        else { turn = BLACK; lastMove=null; }\n        // ç¢ºä¿æ˜¯ç©å®¶å›åˆï¼Œå¦‚ä¸æ˜¯å°±å†é€€ä¸€æ­¥\n        if (turn!==human && history.length>0){\n          const p = history.pop(); board[p.y][p.x]=EMPTY;\n          const last2 = history[history.length-1];\n          turn = last2 ? ((last2.side===BLACK)? WHITE : BLACK) : BLACK;\n          lastMove = last2 || null;\n        }\n        updateLabels(); drawBoard();\n      }\n\n      // äº‹ä»¶ï¼šä¸‹å­\n      cvs.addEventListener('mousedown', (e)=>{\n        if (over || turn!==human) return;\n        const rect=cvs.getBoundingClientRect();\n        const pos = posToCell(e.clientX - rect.left, e.clientY - rect.top);\n        if (!pos) return;\n        place(pos.x,pos.y,human);\n      });\n\n      // æ§åˆ¶åˆ—\n      btnNew.addEventListener('click', ()=>{\n        newBoard(); setSides(); drawBoard();\n        // è‹¥ AI å…ˆæ‰‹\n        if (turn===ai) setTimeout(aiMove, 60);\n        cvs.focus();\n      });\n      btnUndo.addEventListener('click', ()=>{ undo(); cvs.focus(); });\n      selSide.addEventListener('change', ()=>{\n        const wasHuman=human;\n        newBoard(); setSides(); drawBoard();\n        if (turn===ai) setTimeout(aiMove, 60);\n      });\n      levelEl.addEventListener('input', ()=>{ lvlText.textContent=String(levelEl.value); lvlLabel.textContent=String(levelEl.value); });\n\n      // å•Ÿå‹•\n      newBoard(); setSides(); drawBoard();\n      if (turn===ai) setTimeout(aiMove, 80);\n      setTimeout(()=>cvs.focus(), 0);\n    </script>\n  </body>\n  </html>`;\n}\n",
    "tags": [
      "game"
    ]
  },
  {
    "command": "cmd.400h8zg4uc",
    "text": "å‰ªè²¼ç°¿",
    "tooltip": "",
    "hidden": true,
    "enableOnInit": false,
    "script": "// Clipboard Tabs â€” åˆ†é å¼å‰ªè²¼ç°¿ï¼ˆä½¿ç”¨ statusBarHelper.v1.storage æ°¸ä¹…ä¿å­˜ï¼‰\n// å°å°ºå¯¸ / å¯ç·¨è¼¯ / toolbar æœƒè‡ªå‹•æ›è¡Œ / é—œé–‰é¢æ¿è‡ªå‹• vm.stop\nconst vscode = require('vscode');\nconst { storage, vm } = statusBarHelper.v1;\n\n(async function main () {\n  const setText = (t) => (typeof vm.setLabel === 'function' ? vm.setLabel(t) : (vm.setText?.(t)));\n  const setTip  = (t) => vm.setTooltip?.(t);\n  setText('ğŸ“‹ Tabs');\n  setTip('Clipboard Tabsï¼šåŸ·è¡Œå³é–‹å•Ÿ/èšç„¦é¢æ¿ï¼ˆè³‡æ–™å­˜æ–¼ SBH storageï¼‰');\n\n  // ------------- storageï¼ˆworkspace å„ªå…ˆï¼Œå¦å‰‡ç”¨ globalï¼‰ -------------\n  const store = storage?.workspace || storage?.global;\n  if (!store) throw new Error('statusBarHelper.v1.storage ä¸å¯ç”¨');\n\n  const STORE_KEY = 'clipboard.tabs.v1';\n  const defaultState = { active: 'default', tabs: [ { id: 'default', name: 'Default', items: [] } ] };\n\n  async function loadState() {\n    const s = await store.get(STORE_KEY, null);\n    return s && s.tabs ? s : defaultState;\n  }\n  async function saveState(state) {\n    await store.set(STORE_KEY, state);\n  }\n\n  // ------------- å–®ä¾‹é¢æ¿ -------------\n  const g = globalThis;\n  const panel = await createOrRevealPanel();\n\n  vm.onStop?.(() => {\n    try { panel?.dispose(); } catch {}\n  });\n\n  function safeStop(reason){\n    try{\n      if (g.__sbhStopping) return;\n      g.__sbhStopping = true;\n      vm.stop?.(reason);\n    } finally { setTimeout(()=>{ g.__sbhStopping = false; }, 0); }\n  }\n\n  async function createOrRevealPanel(){\n    if (g.__sbhClipboardTabsPanel && !g.__sbhClipboardTabsPanel._disposed) {\n      try { g.__sbhClipboardTabsPanel.reveal(); return g.__sbhClipboardTabsPanel; } catch {}\n    }\n    const p = vscode.window.createWebviewPanel(\n      'sbhClipboardTabs', 'Clipboard Tabs', vscode.ViewColumn.Active,\n      { enableScripts: true, retainContextWhenHidden: true }\n    );\n    const nonce = Math.random().toString(36).slice(2);\n    p.webview.html = getHtml(nonce);\n\n    // åˆå§‹è³‡æ–™ï¼šç­‰ webview è¦ï¼ˆreq:initï¼‰å†çµ¦ï¼Œä¸¦å›å¡« storage çš„è³‡æ–™\n    p.webview.onDidReceiveMessage(async (msg) => {\n      switch (msg.type) {\n        case 'req:init': {\n          const state = await loadState();\n          p.webview.postMessage({ type: 'init', state });\n          break;\n        }\n        case 'save': {\n          // Webview é€šçŸ¥è³‡æ–™æ”¹è®Š â†’ å¯«å…¥ storage\n          if (msg.state && msg.state.tabs) {\n            await saveState(msg.state);\n            // å¯å›å€‹ ACKï¼ˆä¸ä¸€å®šè¦ç”¨ï¼‰\n            p.webview.postMessage({ type: 'saved' });\n          }\n          break;\n        }\n        case 'getSelection': {\n          const ed = vscode.window.activeTextEditor;\n          const text = ed ? ed.document.getText(ed.selection) : '';\n          p.webview.postMessage({ type: 'selection', text });\n          break;\n        }\n        case 'getClipboard': {\n          const text = await vscode.env.clipboard.readText();\n          p.webview.postMessage({ type: 'clipboard', text });\n          break;\n        }\n        case 'writeClipboard': {\n          await vscode.env.clipboard.writeText(String(msg.text || ''));\n          vscode.window.showInformationMessage('å·²è¤‡è£½åˆ°ç³»çµ±å‰ªè²¼ç°¿');\n          break;\n        }\n        case 'notify': {\n          if (msg.level === 'warn') vscode.window.showWarningMessage(msg.message || '');\n          else if (msg.level === 'error') vscode.window.showErrorMessage(msg.message || '');\n          else vscode.window.showInformationMessage(msg.message || '');\n          break;\n        }\n      }\n    });\n\n    p.onDidDispose(() => {\n      p._disposed = true;\n      // é—œé–‰åˆ†é  â†’ çµæŸè…³æœ¬\n      safeStop('webview-closed');\n    });\n\n    g.__sbhClipboardTabsPanel = p;\n    return p;\n  }\n\n  // ---------------- Webview ----------------\n  function getHtml(nonce) {\n    const csp = [\n      \"default-src 'none'\",\n      \"img-src https:\",\n      \"style-src 'unsafe-inline'\",\n      `script-src 'nonce-${nonce}'`,\n    ].join('; ');\n    return /*html*/`\n<!DOCTYPE html>\n<html lang=\"zh-Hant\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Security-Policy\" content=\"${csp}\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n<title>Clipboard Tabs</title>\n<style>\n  :root{\n    --bg: var(--vscode-editor-background, #1e1e1e);\n    --fg: var(--vscode-foreground, #ddd);\n    --muted: var(--vscode-descriptionForeground, #999);\n    --accent: var(--vscode-button-background, #0e639c);\n    --accentHover: var(--vscode-button-hoverBackground, #1177bb);\n    --border: var(--vscode-editorWidget-border, #3c3c3c);\n    --card: rgba(255,255,255,0.03);\n    --shadow: rgba(0,0,0,0.2);\n    --fs: 12px; --fs-sm: 11px; --pad: 8px; --pad-sm: 6px; --gap: 8px; --radius: 8px;\n  }\n  *{ box-sizing: border-box; }\n  body{ margin:0; background:var(--bg); color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, \"Noto Sans TC\", \"PingFang TC\", sans-serif; font-size:var(--fs); }\n  .toolbar{ display:flex; align-items:center; gap:var(--gap); padding:var(--pad); border-bottom:1px solid var(--border); position:sticky; top:0; background:var(--bg); z-index:5; flex-wrap:wrap; }\n  .actions{ display:flex; gap:var(--gap); flex-wrap:wrap; }\n  .search{ margin-left:auto; }\n  .search input{ background:var(--card); border:1px solid var(--border); color:var(--fg); border-radius:var(--radius); padding:var(--pad-sm) 10px; width:220px; font-size:var(--fs); }\n  @media (max-width: 560px){ .search{ flex-basis:100%; order:2; margin-left:0; } .search input{ width:100%; } .actions{ order:1; } }\n  .btn{ border:1px solid var(--border); background:var(--card); color:var(--fg); padding:var(--pad-sm) 10px; border-radius:var(--radius); cursor:pointer; box-shadow:0 1px 2px var(--shadow); font-size:var(--fs); }\n  .btn.primary{ background:var(--accent); border-color:transparent; color:white; }\n  .btn.primary:hover{ background:var(--accentHover); }\n  .btn:hover{ filter:brightness(1.08); }\n  .btn.danger{ border-color:#a11; }\n  .tabs{ display:flex; gap:6px; padding:8px var(--pad); border-bottom:1px solid var(--border); flex-wrap:wrap; }\n  .tab{ padding:4px 10px; border:1px solid var(--border); border-radius:999px; background:var(--card); cursor:pointer; font-size:var(--fs); }\n  .tab.active{ background:var(--accent); color:white; border-color:transparent; }\n  .grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:8px; padding:8px; }\n  .card{ border:1px solid var(--border); border-radius:10px; background:var(--card); padding:8px; display:flex; flex-direction:column; gap:6px; }\n  .card h4{ margin:0; font-size:var(--fs); }\n  .card pre{ margin:0; font-size:var(--fs-sm); white-space:pre-wrap; word-break:break-word; font-family: ui-monospace,\"SFMono-Regular\",Menlo,Consolas,monospace; max-height:120px; overflow:auto; }\n  .row{ display:flex; align-items:center; gap:6px; flex-wrap:wrap; }\n  .muted{ color:var(--muted); font-size:var(--fs-sm); }\n  footer{ padding:6px var(--pad); border-top:1px solid var(--border); font-size:var(--fs-sm); color:var(--muted); }\n  dialog{ border:1px solid var(--border); background:var(--bg); color:var(--fg); border-radius:10px; padding:0; width:min(560px, 90vw); }\n  dialog header{ padding:8px var(--pad); border-bottom:1px solid var(--border); font-size:var(--fs); }\n  dialog main{ padding:var(--pad); }\n  textarea, input[type=\"text\"].full{ width:100%; background:var(--card); color:var(--fg); border:1px solid var(--border); border-radius:8px; padding:8px; font-size:var(--fs); }\n</style>\n</head>\n<body>\n  <header class=\"toolbar\">\n    <div class=\"actions\">\n      <button id=\"add-snippet\" class=\"btn primary\">ï¼‹ æ–°å¢ç‰‡æ®µ</button>\n      <button id=\"add-tab\" class=\"btn\">â• æ–°åˆ†é </button>\n      <button id=\"rename-tab\" class=\"btn\">âœï¸ é‡æ–°å‘½å</button>\n      <button id=\"delete-tab\" class=\"btn danger\">ğŸ—‘ åˆªé™¤åˆ†é </button>\n    </div>\n    <div class=\"search\"><input id=\"q\" type=\"text\" placeholder=\"æœå°‹æ¨™é¡Œ/å…§å®¹ï¼ˆå³æ™‚ï¼‰\"/></div>\n  </header>\n\n  <div class=\"tabs\" id=\"tabs\"></div>\n  <div class=\"grid\" id=\"grid\"></div>\n  <footer>æç¤ºï¼šæŒ‰ã€Œè¤‡è£½ã€åªæ”¾åˆ°å‰ªè²¼ç°¿ã€‚</footer>\n\n  <!-- æ–°å¢/ç·¨è¼¯ç‰‡æ®µ -->\n  <dialog id=\"dlg\">\n    <header><strong id=\"dlg-title\">æ–°å¢ç‰‡æ®µ</strong></header>\n    <main>\n      <div class=\"row\" style=\"margin-bottom:6px\">\n        <button id=\"from-selection\" class=\"btn\">å¾é¸å–æ–‡å­—</button>\n        <button id=\"from-clipboard\" class=\"btn\">å¾ç³»çµ±å‰ªè²¼ç°¿</button>\n      </div>\n      <input id=\"f-title\" class=\"full\" type=\"text\" placeholder=\"æ¨™é¡Œï¼ˆå¯ç©ºç™½ï¼‰\" />\n      <div style=\"height:6px\"></div>\n      <textarea id=\"f-text\" rows=\"8\" placeholder=\"è²¼ä¸Šæˆ–è¼¸å…¥å…§å®¹...\"></textarea>\n      <div style=\"height:6px\"></div>\n      <div class=\"row\" style=\"justify-content:flex-end\">\n        <button id=\"dlg-cancel\" class=\"btn\">å–æ¶ˆ</button>\n        <button id=\"dlg-ok\" class=\"btn primary\">ç¢ºå®š</button>\n      </div>\n    </main>\n  </dialog>\n\n  <!-- è¼¸å…¥ï¼ˆæ–°åˆ†é  / é‡æ–°å‘½åï¼‰ -->\n  <dialog id=\"input-dlg\">\n    <header><strong id=\"input-title\">è¼¸å…¥</strong></header>\n    <main>\n      <input id=\"input-text\" class=\"full\" type=\"text\" />\n      <div style=\"height:6px\"></div>\n      <div class=\"row\" style=\"justify-content:flex-end\">\n        <button id=\"input-cancel\" class=\"btn\">å–æ¶ˆ</button>\n        <button id=\"input-ok\" class=\"btn primary\">ç¢ºå®š</button>\n      </div>\n    </main>\n  </dialog>\n\n  <!-- è‡ªè£½ confirm -->\n  <dialog id=\"confirm-dlg\">\n    <header><strong>ç¢ºèª</strong></header>\n    <main>\n      <p id=\"confirm-msg\" style=\"margin:0 0 8px\"></p>\n      <div class=\"row\" style=\"justify-content:flex-end\">\n        <button id=\"confirm-cancel\" class=\"btn\">å–æ¶ˆ</button>\n        <button id=\"confirm-ok\" class=\"btn primary\">ç¢ºå®š</button>\n      </div>\n    </main>\n  </dialog>\n\n  <script nonce=\"${nonce}\">\n    const vscode = acquireVsCodeApi();\n\n    // ------- Stateï¼ˆç”±å¤–å±¤ storage æä¾›ï¼›webview åªç¶­æŒè¨˜æ†¶é«”ï¼ŒæŒä¹…åŒ–é  postMessageï¼‰ -------\n    let state = null; // { active, tabs }\n\n    // è¦æ±‚åˆå§‹åŒ–\n    window.addEventListener('load', () => {\n      vscode.postMessage({ type: 'req:init' });\n    });\n\n    // ------- Refs -------\n    const tabsEl = document.getElementById('tabs');\n    const gridEl = document.getElementById('grid');\n    const qEl = document.getElementById('q');\n    const btnAddSnippet = document.getElementById('add-snippet');\n    const btnAddTab = document.getElementById('add-tab');\n    const btnRenameTab = document.getElementById('rename-tab');\n    const btnDeleteTab = document.getElementById('delete-tab');\n\n    const dlg = document.getElementById('dlg');\n    const dlgTitle = document.getElementById('dlg-title');\n    const fTitle = document.getElementById('f-title');\n    const fText = document.getElementById('f-text');\n    const btnOk = document.getElementById('dlg-ok');\n    const btnCancel = document.getElementById('dlg-cancel');\n    const btnFromSel = document.getElementById('from-selection');\n    const btnFromClip = document.getElementById('from-clipboard');\n\n    const inputDlg = document.getElementById('input-dlg');\n    const inputTitle = document.getElementById('input-title');\n    const inputText = document.getElementById('input-text');\n    const inputOk = document.getElementById('input-ok');\n    const inputCancel = document.getElementById('input-cancel');\n\n    const confirmDlg = document.getElementById('confirm-dlg');\n    const confirmMsg = document.getElementById('confirm-msg');\n    const confirmOk = document.getElementById('confirm-ok');\n    const confirmCancel = document.getElementById('confirm-cancel');\n\n    let editingItem = null; // {tabId, itemId} | null\n\n    // ------- Helpersï¼šsave / confirm / prompt -------\n    function persist(){ vscode.postMessage({ type: 'save', state }); }\n    function notify(message, level){ vscode.postMessage({ type:'notify', message, level }); }\n\n    function confirmWeb(message){\n      return new Promise((resolve) => {\n        confirmMsg.textContent = message; confirmDlg.showModal();\n        const onOk = () => { cleanup(); resolve(true); };\n        const onCancel = () => { cleanup(); resolve(false); };\n        const onKey = (e)=>{ if(e.key==='Escape') onCancel(); if(e.key==='Enter') onOk(); };\n        function cleanup(){ confirmOk.removeEventListener('click',onOk); confirmCancel.removeEventListener('click',onCancel); confirmDlg.removeEventListener('keydown',onKey); confirmDlg.close(); }\n        confirmOk.addEventListener('click', onOk, {once:true});\n        confirmCancel.addEventListener('click', onCancel, {once:true});\n        confirmDlg.addEventListener('keydown', onKey);\n      });\n    }\n    function promptWeb(title, def=''){\n      return new Promise((resolve)=>{\n        inputTitle.textContent = title; inputText.value = def; inputDlg.showModal();\n        inputText.focus(); inputText.select();\n        const onOk = () => { cleanup(); resolve(inputText.value.trim() || null); };\n        const onCancel = () => { cleanup(); resolve(null); };\n        const onKey = (e)=>{ if(e.key==='Escape') onCancel(); if(e.key==='Enter') onOk(); };\n        function cleanup(){ inputOk.removeEventListener('click',onOk); inputCancel.removeEventListener('click',onCancel); inputDlg.removeEventListener('keydown',onKey); inputDlg.close(); }\n        inputOk.addEventListener('click', onOk, {once:true});\n        inputCancel.addEventListener('click', onCancel, {once:true});\n        inputDlg.addEventListener('keydown', onKey);\n      });\n    }\n\n    // ------- Render -------\n    function render(){\n      // tabs\n      tabsEl.innerHTML = '';\n      for (const t of state.tabs) {\n        const el = document.createElement('button');\n        el.className = 'tab' + (t.id === state.active ? ' active' : '');\n        el.textContent = t.name;\n        el.onclick = () => { state.active = t.id; persist(); render(); };\n        tabsEl.appendChild(el);\n      }\n\n      // items\n      const tab = activeTab();\n      const q = (qEl.value || '').toLowerCase().trim();\n      const items = tab.items.filter(it =>\n        !q || (it.title || '').toLowerCase().includes(q) || (it.text || '').toLowerCase().includes(q)\n      );\n\n      gridEl.innerHTML = '';\n      if (!items.length) {\n        const empty = document.createElement('div'); empty.className = 'muted';\n        empty.style.padding = '6px var(--pad)'; empty.textContent = q ? 'æ‰¾ä¸åˆ°ç¬¦åˆçš„ç‰‡æ®µ' : 'å°šç„¡ç‰‡æ®µï¼Œé»ã€Œæ–°å¢ç‰‡æ®µã€é–‹å§‹å§ï¼';\n        gridEl.appendChild(empty); return;\n      }\n      for (const it of items) gridEl.appendChild(card(tab.id, it));\n    }\n\n    function card(tabId, it){\n      const card = document.createElement('div'); card.className = 'card';\n      const title = document.createElement('h4'); title.textContent = it.title || preview(it.text); card.appendChild(title);\n      const pre = document.createElement('pre'); pre.textContent = it.text; card.appendChild(pre);\n      const row = document.createElement('div'); row.className = 'row';\n      const bCopy = button('è¤‡è£½', async () => {\n        try { await navigator.clipboard.writeText(it.text); notify('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿'); }\n        catch { vscode.postMessage({ type:'writeClipboard', text: it.text }); }\n      });\n      const bEdit = button('ç·¨è¼¯', () => openEdit(tabId, it.id));\n      const bDel  = button('åˆªé™¤', async () => { const ok = await confirmWeb('ç¢ºå®šåˆªé™¤æ­¤ç‰‡æ®µï¼Ÿ'); if(!ok) return; removeItem(tabId, it.id); });\n      row.append(bCopy, bEdit, bDel); card.appendChild(row);\n      const ts = document.createElement('div'); ts.className = 'muted'; ts.textContent = new Date(it.ts).toLocaleString(); card.appendChild(ts);\n      return card;\n    }\n\n    function button(text, onClick){ const b=document.createElement('button'); b.className='btn'; b.textContent=text; b.onclick=onClick; return b; }\n    function preview(s){ s=(s||'').replace(/\\\\s+/g,' ').trim(); return s.length>30? s.slice(0,30)+'â€¦' : s || '(ç„¡æ¨™é¡Œ)'; }\n    function activeTab(){ let t = state.tabs.find(t=>t.id===state.active); if(!t){ state.active = state.tabs[0]?.id || 'default'; t = state.tabs[0] || {id:'default',name:'Default',items:[]}; } return t; }\n\n    // ------- Actions: toolbar -------\n    btnAddTab.onclick = async () => {\n      const name = await promptWeb('æ–°åˆ†é åç¨±', 'New Tab'); if(!name) return;\n      const id = uid(); state.tabs.push({ id, name, items:[] }); state.active = id; persist(); render();\n    };\n    btnRenameTab.onclick = async () => {\n      const tab = activeTab(); const name = await promptWeb('åˆ†é æ–°åç¨±', tab.name); if(!name) return;\n      tab.name = name; persist(); render();\n    };\n    btnDeleteTab.onclick = async () => {\n      const tab = activeTab();\n      const ok = await confirmWeb(\\`ç¢ºå®šåˆªé™¤åˆ†é ã€Œ\\${tab.name}ã€ï¼Ÿï¼ˆç‰‡æ®µå°‡ä¸€ä½µåˆªé™¤ï¼‰\\`);\n      if(!ok) return;\n      state.tabs = state.tabs.filter(t => t.id !== tab.id);\n      if (!state.tabs.length) state = { active:'default', tabs:[{id:'default', name:'Default', items:[]}] };\n      else if (!state.tabs.find(t => t.id === state.active)) state.active = state.tabs[0].id;\n      persist(); render();\n    };\n    qEl.oninput = () => render();\n\n    // ------- Actions: items -------\n    btnAddSnippet.onclick = () => openCreate();\n\n    function openCreate(){\n      editingItem = null;\n      dlgTitle.textContent = 'æ–°å¢ç‰‡æ®µ';\n      fTitle.value = ''; fText.value = '';\n      dlg.showModal(); fTitle.focus();\n    }\n    function openEdit(tabId, itemId){\n      editingItem = { tabId, itemId };\n      const tab = state.tabs.find(t => t.id === tabId);\n      const item = tab.items.find(i => i.id === itemId);\n      dlgTitle.textContent = 'ç·¨è¼¯ç‰‡æ®µ'; fTitle.value = item.title || ''; fText.value = item.text || '';\n      dlg.showModal(); fTitle.focus(); fTitle.select();\n    }\n\n    btnFromSel.onclick  = () => vscode.postMessage({ type:'getSelection' });\n    btnFromClip.onclick = () => vscode.postMessage({ type:'getClipboard' });\n    btnCancel.onclick   = () => dlg.close();\n\n    btnOk.onclick = () => {\n      const title = fTitle.value.trim(); const text = fText.value;\n      if(!text){ notify('å…§å®¹ä¸å¯ç‚ºç©º', 'warn'); return; }\n      if (editingItem) {\n        const tab = state.tabs.find(t => t.id === editingItem.tabId);\n        const item = tab.items.find(i => i.id === editingItem.itemId);\n        item.title = title || undefined; item.text = text; item.ts = Date.now();\n      } else {\n        const tab = activeTab();\n        tab.items.unshift({ id: uid(), title: title || undefined, text, ts: Date.now() });\n      }\n      persist(); render(); dlg.close();\n    };\n\n    function removeItem(tabId, itemId){\n      const tab = state.tabs.find(t => t.id === tabId);\n      tab.items = tab.items.filter(i => i.id !== itemId);\n      persist(); render();\n    }\n\n    // ------- Messages from extension -------\n    window.addEventListener('message', (e) => {\n      const msg = e.data || {};\n      if (msg.type === 'init') {\n        state = msg.state;\n        render();\n      }\n      if (msg.type === 'selection' && dlg.open) {\n        if (fText.value) fText.value += '\\\\n';\n        fText.value += msg.text || '';\n      }\n      if (msg.type === 'clipboard' && dlg.open) {\n        if (fText.value) fText.value += '\\\\n';\n        fText.value += msg.text || '';\n      }\n      // msg.type === 'saved' å¯å¿½ç•¥æˆ–é¡¯ç¤º toast\n    });\n\n    function uid(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }\n\n  </script>\n</body>\n</html>\n    `;\n  }\n})();\n",
    "tags": [
      "tool"
    ]
  },
  {
    "command": "cmd.7bme1yyizp",
    "text": "$(layout-sidebar-left) å´é‚Šæ¬„",
    "tooltip": "ç¯„ä¾‹",
    "hidden": true,
    "enableOnInit": false,
    "script": "// === Demo: åŒæ™‚é–‹ Sidebar + Tabï¼Œäº’å‚³è¨Šæ¯ï¼›ä»»ä¸€é‚Šé—œé–‰å‰‡å…©é‚Šéƒ½é—œ ===\nconst vscode = require('vscode');\nconst { sidebar, vm } = statusBarHelper.v1;\n\n// å…±ç”¨ï¼šå»ºç«‹ç°¡å–® HTMLï¼ˆæœ‰è¼¸å…¥æ¡†ã€é€åˆ°å°æ–¹ã€é—œé–‰å…©é‚Šï¼‰\nconst html = (who) => `<!doctype html>\n<html><head><meta charset=\"utf-8\"/>\n<style>\n :root { color-scheme: light dark; }\n body { margin:0; padding:14px; font-family: var(--vscode-font-family);\n        color: var(--vscode-editor-foreground);\n        background: var(--vscode-editor-background); }\n h3 { margin:0 0 10px; font-weight:600; }\n .row { display:flex; gap:8px; margin:10px 0; }\n input { flex:1; padding:6px 8px; border-radius:6px;\n         background:var(--vscode-input-background);\n         color:var(--vscode-input-foreground);\n         border:1px solid var(--vscode-input-border); }\n button { padding:6px 10px; border-radius:6px; cursor:pointer;\n          border:1px solid var(--vscode-input-border);\n          background:var(--vscode-button-secondaryBackground,transparent);\n          color:var(--vscode-button-secondaryForeground,var(--vscode-editor-foreground)); }\n #log { margin-top:10px; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }\n #log div { margin:4px 0; opacity:.9; }\n</style></head>\n<body>\n  <h3>${who}</h3>\n  <div class=\"row\">\n    <input id=\"msg\" placeholder=\"type somethingâ€¦\"/>\n    <button id=\"send\">Send â†’ Other</button>\n    <button id=\"closeBoth\">Close Both</button>\n  </div>\n  <div id=\"log\"></div>\n<script>\n  const vscode = acquireVsCodeApi();\n  const log = (t) => { const d=document.createElement('div'); d.textContent=t; document.getElementById('log').prepend(d); };\n\n  document.getElementById('send').onclick = () => {\n    const v = document.getElementById('msg').value || '(empty)';\n    vscode.postMessage({ type:'relay', from:'${who}', text:v });\n    document.getElementById('msg').value = '';\n  };\n  document.getElementById('closeBoth').onclick = () => {\n    vscode.postMessage({ type:'closeAll', from:'${who}' });\n  };\n\n  window.addEventListener('message', (e) => {\n    const { type, text } = e.data || {};\n    if (type === 'note') log(text);\n  });\n</script></body></html>`;\n\n// 1) é–‹ Sidebar\nawait sidebar.open({ \n  html: html('Sidebar'),\n  onClose: () => vm.stop()\n});\n\n// 2) é–‹ Tabï¼ˆWebviewPanelï¼‰\nconst panel = vscode.window.createWebviewPanel(\n  'sbh.dualDemo',\n  'SBH Demo (Tab)',\n  vscode.ViewColumn.Active,\n  { enableScripts: true, retainContextWhenHidden: true }\n);\npanel.webview.html = html('Tab');\n\n// å‚³è¨Šå·¥å…·\nconst sendToSidebar = (m) => sidebar.postMessage(m);\nconst sendToTab = (m) => panel.webview.postMessage(m);\n\n// 3) VM ç•¶ä¸­ç¹¼ï¼šå…©é‚Š relay\nconst offSidebarMsg = sidebar.onMessage((m) => {\n  if (!m || typeof m !== 'object') return;\n  if (m.type === 'relay') sendToTab({ type:'note', text:`Sidebar â†’ ${m.text}` });\n  if (m.type === 'closeAll') closeBoth();\n});\nconst dTabMsg = panel.webview.onDidReceiveMessage((m) => {\n  if (!m || typeof m !== 'object') return;\n  if (m.type === 'relay') sendToSidebar({ type:'note', text:`Tab â†’ ${m.text}` });\n  if (m.type === 'closeAll') closeBoth();\n});\n\n// 4) é—œé–‰é‚è¼¯ï¼šä»»ä¸€é‚Šé—œéƒ½ä¸€èµ·é—œï¼ˆé¿å…é‡å…¥ï¼‰\nlet closing = false;\nfunction closeBoth() {\n  if (closing) return;\n  closing = true;\n  try { panel.dispose(); } catch {}\n  try { sidebar.close(); } catch {}\n  try { vm.stop(); } catch {}\n}\n// ä½¿ç”¨è€…æ‰‹å‹•é—œå…¶ä¸­ä¹‹ä¸€æ™‚ä¹Ÿè¦é—œå¦ä¸€é‚Š\nconst offSidebarClose = sidebar.onClose(() => { if (!closing) { closing = true; try { \n  vm.stop();\n} catch {} } });\nconst dTabClose = panel.onDidDispose(() => { if (!closing) { closing = true; try { \n  vm.stop();\n} catch {} } });\n\n// 5) ç°¡å–®æ­¡è¿è¨Šæ¯\nsendToSidebar({ type:'note', text:'Hello from VM â†’ Sidebar' });\nsendToTab({ type:'note', text:'Hello from VM â†’ Tab' });\n\n// 6) è…³æœ¬åœæ­¢æ™‚æ¸…ç†\nvm?.onStop?.(() => {\n  try { offSidebarMsg?.dispose?.(); } catch {}\n  try { offSidebarClose?.dispose?.(); } catch {}\n  try { dTabMsg?.dispose?.(); } catch {}\n  try { dTabClose?.dispose?.(); } catch {}\n  try { panel.dispose(); } catch {}\n  try { sidebar.colse(); } catch {}\n});\n",
    "tags": [
      "example"
    ]
  },
  {
    "command": "cmd.vy4kb0r94x",
    "text": "$(cloud) å¤©æ°£ (å´æ¬„)",
    "tooltip": "æœªä¾†24å°æ™‚å¤©æ°£",
    "hidden": true,
    "enableOnInit": false,
    "script": "// Sidebar â€” å¤©æ°£ï¼ˆæœªä¾† 24 å°æ™‚ï¼›åˆ—è¡¨ç‰ˆï¼›å«é™é›¨ç‡é€²åº¦æ¢ãƒ»ç¹ä¸­ï¼‰\nconst vscode = require('vscode');\nconst { vm, sidebar } = statusBarHelper.v1;\n\n(async function main () {\n  const nonce = Math.random().toString(36).slice(2);\n  await sidebar.open({ \n    html: getHtml(nonce),\n    onClose: () => vm.stop()\n  });\n  vm.onStop(() => { try { sidebar.close(); } catch {} });\n})();\n\nfunction getHtml (nonce) {\n  const cities = [\n    { name: 'å°åŒ—', lat: 25.0375, lon: 121.5637, tz: 'Asia/Taipei' },\n    { name: 'æ–°ç«¹', lat: 24.8066, lon: 120.9686, tz: 'Asia/Taipei' },\n    { name: 'å°ä¸­', lat: 24.1477, lon: 120.6736, tz: 'Asia/Taipei' },\n    { name: 'å°å—', lat: 22.9997, lon: 120.2270, tz: 'Asia/Taipei' },\n    { name: 'é«˜é›„', lat: 22.6273, lon: 120.3014, tz: 'Asia/Taipei' },\n    { name: 'èŠ±è“®', lat: 23.9872, lon: 121.6015, tz: 'Asia/Taipei' },\n    { name: 'å°æ±', lat: 22.7972, lon: 121.0717, tz: 'Asia/Taipei' },\n    { name: 'æ±äº¬', lat: 35.6762, lon: 139.6503, tz: 'Asia/Tokyo' },\n    { name: 'é¦–çˆ¾', lat: 37.5665, lon: 126.9780, tz: 'Asia/Seoul' },\n    { name: 'ç´ç´„', lat: 40.7128, lon: -74.0060, tz: 'America/New_York' },\n  ];\n  const options = cities.map((c,i)=>`<option value=\"${i}\">${c.name}</option>`).join('');\n\n  return `<!doctype html>\n<html lang=\"zh-Hant\">\n<head>\n  <meta charset=\"UTF-8\"/>\n  <meta http-equiv=\"Content-Security-Policy\"\n        content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'; connect-src https:;\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>å¤©æ°£ â€” æœªä¾† 24 å°æ™‚</title>\n  <style>\n    :root{\n      --fg:#e7e7e7; --muted:#a7a7a7; --bg:#1e1e1e; --card:#232323; --line:#2f2f2f;\n      --pill:#1a1a1a; --green:#2ed39a;\n    }\n    *{box-sizing:border-box}\n    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans TC\",Arial;background:var(--bg);color:var(--fg)}\n    .wrap{padding:16px;max-width:860px;margin:0 auto}\n    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n    h1{font-size:28px;margin:0 8px 0 0;line-height:1.2}\n    .muted{color:var(--muted)}\n    select,button{background:var(--pill);color:var(--fg);border:1px solid var(--line);border-radius:12px;padding:8px 12px;cursor:pointer}\n\n    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;margin-top:16px;box-shadow:0 10px 26px rgba(0,0,0,.22)}\n    .big{font-size:44px;font-weight:800;letter-spacing:1px;line-height:1}\n    .wx{font-size:20px;font-weight:700;margin-left:12px}\n    .when{margin-top:8px;color:var(--muted)}\n    .windRow{margin-top:6px;color:var(--muted);display:flex;align-items:center;gap:6px;font-size:14px}\n\n    .kpis{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}\n    .kpi{background:var(--pill);border:1px solid var(--line);border-radius:14px;padding:10px 14px;display:flex;align-items:center;gap:10px;font-weight:700}\n\n    .legend{display:flex;align-items:center;gap:12px;margin-bottom:8px}\n    .lg{background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:8px 12px;display:flex;align-items:center;gap:8px}\n    .dot{width:10px;height:10px;border-radius:50%}\n    .blue{background:#5da5ff}.green{background:var(--green)}\n\n    /* åˆ—è¡¨ + é™é›¨ç‡é€²åº¦æ¢ï¼ˆæ¢å¾©ï¼‰ */\n    .list{margin-top:10px}\n    .item{padding:14px 6px;border-top:1px solid var(--line);display:grid;grid-template-columns:70px 90px 1fr 74px;gap:14px;align-items:center}\n    .time{color:var(--muted);width:70px}\n    .tval{font-weight:800;font-size:18px;min-width:90px}\n\n    .bar{position:relative;height:8px;border-radius:999px;background:#181818;border:1px solid #2a2a2a;overflow:hidden}\n    .fill{position:absolute;top:-1px;left:-1px;bottom:-1px;width:0;border-radius:999px;background:var(--green)}\n    .emoji{text-align:right;opacity:.95}\n    .pct{font-weight:700;text-align:right}\n\n    @media (max-width:560px){\n      .big{font-size:38px}\n      .wx{font-size:18px}\n      .item{grid-template-columns:62px 82px 1fr 60px}\n      .tval{font-size:17px}\n    }\n  </style>\n</head>\n<body>\n  <div class=\"wrap\">\n    <div class=\"row\">\n      <h1 style=\"font-size:16px;\">ğŸŒ¤ï¸ å¤©æ°£ â€” æœªä¾† 24 å°æ™‚</h1>\n      <div style=\"flex:1\"></div>\n      <button id=\"btnRefresh\">é‡æ–°æ•´ç†</button>\n      <select id=\"city\">${options}</select>\n    </div>\n\n    <div class=\"card\" id=\"cardNow\">\n      <div class=\"row\" style=\"align-items:flex-end;\">\n        <div class=\"big\" id=\"nowTemp\">--Â°</div>\n        <div class=\"wx\" id=\"nowWx\">â€”</div>\n      </div>\n      <div class=\"windRow\"><span>ğŸ’¨</span><span id=\"nowWind\">-- m/s</span></div>\n      <div class=\"when\" id=\"updateAt\">â€”</div>\n      <div class=\"kpis\">\n        <div class=\"kpi\">ğŸ”º <span id=\"dayMax\">--Â°</span></div>\n        <div class=\"kpi\">ğŸ”» <span id=\"dayMin\">--Â°</span></div>\n      </div>\n    </div>\n\n    <div class=\"card\">\n      <div class=\"legend\">\n        <div class=\"lg\"><span class=\"dot blue\"></span><b>æº«åº¦</b></div>\n        <div class=\"lg\"><span class=\"dot green\"></span><b>é™é›¨%</b></div>\n      </div>\n      <div class=\"list\" id=\"list\"></div>\n    </div>\n\n    <p class=\"muted\" style=\"margin-top:14px;\">\n      è³‡æ–™ä¾†æºï¼š<a href=\"https://open-meteo.com/\" target=\"_blank\" rel=\"noreferrer\" style=\"color:#79a9ff;text-decoration:none;\">Open-Meteo</a>ï¼ˆå…é‡‘é‘°ï¼‰\n    </p>\n  </div>\n\n  <script nonce=\"${nonce}\">\n    const CITIES = ${JSON.stringify(cities)};\n    const vscodeApi = acquireVsCodeApi?.() || null;\n\n    const $ = (id)=>document.getElementById(id);\n    const citySel=$('city'), btnRefresh=$('btnRefresh');\n    const nowTemp=$('nowTemp'), nowWx=$('nowWx'), nowWind=$('nowWind'), updAt=$('updateAt');\n    const dayMax=$('dayMax'), dayMin=$('dayMin'), list=$('list');\n\n    const WMO={0:'æ™´æœ—',1:'å¤šé›²',2:'å¤šé›²',3:'é™°',45:'éœ§',48:'éœ§éœœ',51:'æ¯›æ¯›é›¨',53:'æ¯›æ¯›é›¨',55:'æ¯›æ¯›é›¨',56:'å‡éœ§é›¨',57:'å‡éœ§é›¨',\n               61:'å°é›¨',63:'ä¸­é›¨',65:'å¤§é›¨',66:'å‡é›¨',67:'å‡é›¨',71:'å°é›ª',73:'ä¸­é›ª',75:'å¤§é›ª',77:'éœ°',\n               80:'çŸ­æš«å°é›¨',81:'çŸ­æš«ä¸­é›¨',82:'çŸ­æš«å¤§é›¨',85:'çŸ­æš«å°é›ª',86:'çŸ­æš«å¤§é›ª',95:'é›·é›¨',96:'é›·é›¨å¤¾é›¹',99:'å¼·é›·é›¨å¤¾é›¹'};\n    const ICON=(code)=>{ if([0].includes(code))return'â˜€ï¸'; if([1,2].includes(code))return'â›…';\n      if([3].includes(code))return'â˜ï¸'; if([45,48].includes(code))return'ğŸŒ«ï¸';\n      if([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code))return'ğŸŒ§ï¸';\n      if([71,73,75,77,85,86].includes(code))return'â„ï¸'; if([95,96,99].includes(code))return'â›ˆï¸'; return'ğŸŒ¡ï¸'; };\n\n    const LS_KEY='sbh_w_sidebar_pref';\n    const loadPref=()=>{ try{return JSON.parse(localStorage.getItem(LS_KEY)||'{}');}catch{return{}}};\n    const savePref=(o)=>localStorage.setItem(LS_KEY, JSON.stringify(o));\n    const pref=loadPref(); citySel.value=String(pref.cityIndex??0);\n\n    async function fetchWeather(lat,lon,tz){\n      const url=new URL('https://api.open-meteo.com/v1/forecast');\n      url.searchParams.set('latitude',lat); url.searchParams.set('longitude',lon);\n      url.searchParams.set('timezone',tz||'auto');\n      url.searchParams.set('current_weather','true');\n      url.searchParams.set('hourly','temperature_2m,precipitation_probability,weathercode');\n      url.searchParams.set('forecast_days','2'); // å…©å¤©ï¼Œç¢ºä¿è¶³å¤ çš„æœªä¾†æ™‚æ®µ\n      const res=await fetch(url.toString(),{cache:'no-store'}); if(!res.ok) throw new Error('Network '+res.status);\n      return res.json();\n    }\n    const hh=(d)=>String(new Date(d).getHours()).padStart(2,'0')+':00';\n    const fmt=(d)=>new Date(d).toLocaleString();\n\n    async function refresh(){\n      const idx=Number(citySel.value)||0; const c=CITIES[idx]; savePref({cityIndex:idx});\n      const data=await fetchWeather(c.lat,c.lon,c.tz);\n\n      // ç¾åœ¨\n      const cw=data.current_weather||{};\n      nowTemp.textContent=(cw.temperature!=null?cw.temperature.toFixed(1):'--')+'Â°';\n      nowWx.textContent=(ICON(cw.weathercode)+' '+(WMO[cw.weathercode]||'â€”'));\n      nowWind.textContent=(cw.windspeed!=null?cw.windspeed:'--')+' m/s';\n      updAt.textContent=fmt(new Date());\n      const d=data.daily||{};\n      if(d.temperature_2m_max){ dayMax.textContent=d.temperature_2m_max[0].toFixed(1)+'Â°'; dayMin.textContent=d.temperature_2m_min[0].toFixed(1)+'Â°'; }\n\n      // æœªä¾† 24 å°æ™‚\n      const h=data.hourly||{}; const times=h.time||[];\n      let start=times.indexOf(cw.time);\n      if(start<0){\n        const now=new Date(); const y=now.getFullYear(),m=now.getMonth(),da=now.getDate(),hr=now.getHours();\n        const isoHour=new Date(y,m,da,hr,0,0).toISOString().slice(0,13);\n        start=times.findIndex(t=>t.startsWith(isoHour));\n        if(start<0) start=0;\n      }\n\n      const items=[];\n      for(let i=0;i<24 && start+i<times.length;i++){\n        const k=start+i;\n        items.push({\n          hh: hh(times[k]),\n          t:  h.temperature_2m?.[k],\n          p:  Math.max(0, Math.min(100, h.precipitation_probability?.[k] ?? 0)),\n          ic: ICON(h.weathercode?.[k])\n        });\n      }\n\n      // ç”Ÿæˆï¼šæ™‚é–“ / æº«åº¦ / é™é›¨ç‡é€²åº¦æ¢ / å³å´åœ–ç¤º+ç™¾åˆ†æ¯”\n      list.innerHTML = items.map(it =>\n        '<div class=\"item\" role=\"listitem\">' +\n          '<div class=\"time\">'+ it.hh +'</div>' +\n          '<div class=\"tval\">'+ (it.t!=null?it.t.toFixed(1):'--') +'Â°</div>' +\n          '<div class=\"bar\" aria-label=\"é™é›¨æ©Ÿç‡ '+ it.p +'%\"><div class=\"fill\" style=\"width:'+ it.p +'%\"></div></div>' +\n          '<div class=\"emoji\">'+ it.ic +' <span class=\"pct\">'+ it.p +'%</span></div>' +\n        '</div>'\n      ).join('');\n    }\n\n    citySel.addEventListener('change',refresh);\n    btnRefresh.addEventListener('click',refresh);\n\n    refresh().catch(err=>{ updAt.textContent='è¼‰å…¥å¤±æ•—ï¼š'+String(err).slice(0,80); });\n  </script>\n</body>\n</html>`;\n}\n",
    "tags": [
      "example",
      "tool"
    ]
  },
  {
    "command": "cmd.oqkr4ig1al",
    "text": "$(comment-discussion) Gemini èŠå¤©",
    "tooltip": "èˆ‡ Gemini å°è©±ï¼Œæ”¯æ´ Markdownã€é™„æª”çŸ¥è­˜ã€æº«åº¦/å®‰å…¨èª¿æ•´ã€‚",
    "hidden": true,
    "enableOnInit": false,
    "script": "// Gemini â€” Copilot Chatï¼ˆStatus Bar Helper è…³æœ¬ï¼‰\n// å„²å­˜ï¼šAPI Key ç”¨ secretï¼›å…¶ä»–æ¯å€‹æ¬„ä½å„è‡ªå¯«å…¥ storageï¼ˆworkspace > globalï¼‰\n// é€™ç‰ˆæ‰€æœ‰ key å‰ç¶´ä¸€å¾‹ä½¿ç”¨ gemini_chat.*ï¼›ä¸¦æŠŠå›æ‡‰ä»¥ Markdown æ¨£å¼å‘ˆç¾\n// ä¸¦ä¸”åœ¨å‘¼å« API æ™‚ï¼ŒåŒæ­¥é€å‡º systemInstructionã€æ­·å²å°è©±ã€é™„æª”ï¼ˆæ–‡å­—/äºŒé€²ä½ï¼‰\n\nconst vscode = require('vscode');\nconst { secret, storage, vm, sidebar } = statusBarHelper.v1;\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å…±ç”¨å„²å­˜å·¥å…· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nconst store = (storage && storage.workspace) || (storage && storage.global) || null;\nif (!store) throw new Error('statusBarHelper.v1.storage ä¸å¯ç”¨');\n\nconst K = (name) => `gemini_chat.${name}`;               // çµ±ä¸€å‰ç¶´\nconst SECRET_KEY = K('apiKey');                           // secret key\n\nconst FIELD_KEYS = [\n  'customerServiceName', 'tone', 'verbosity', 'banned',\n  'kb', 'kbFiles', 'model', 'temperature', 'maxTokens',\n  'safety', 'history'\n];\n\nasync function sget (name, def) {\n  try { return await store.get(K(name), def); } catch { return def; }\n}\nasync function sset (name, val) {\n  try { await store.set(K(name), val); return null; } catch (e) { return String(e && e.message || e); }\n}\nasync function sremove (name) {\n  try { await store.remove(K(name)); } catch {}\n}\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Sidebar lifecycle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\n(async function main () {\n  await sidebar.open({\n    html: getHtml(),\n    onClose: (reason) => { if (reason === 'closed') vm.stop(); } // çœŸæ­£é—œé–‰æ‰åœ VM\n  });\n  vm.onStop(() => { try { sidebar.close(); } catch {} });        // VM åœæ™‚æŠŠé¢æ¿é‚„å›é è¨­é \n})();\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Webview â†” Host â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nsidebar.onMessage(async (msg) => {\n  try {\n    const t = msg && msg.type;\n\n    if (t === 'ping') {\n      sidebar.postMessage({ type: 'pong' });\n      return;\n    }\n\n    if (t === 'req:init') {\n      const apiKey = (await secret.get(SECRET_KEY)) || '';\n      const [\n        customerServiceName, tone, verbosity, banned,\n        kb, kbFiles, model, temperature, maxTokens,\n        safety, history\n      ] = await Promise.all([\n        sget('customerServiceName', 'å°å¹«æ‰‹'),\n        sget('tone', 'è¦ªåˆ‡å°ˆæ¥­'),\n        sget('verbosity', 'é©ä¸­'),\n        sget('banned', ''),\n        sget('kb', ''),\n        sget('kbFiles', []),\n        sget('model', 'gemini-1.5-flash'),\n        sget('temperature', 0.3),\n        sget('maxTokens', 2048),\n        sget('safety', 'neutral'),\n        sget('history', [])\n      ]);\n\n      sidebar.postMessage({\n        type: 'init',\n        data: {\n          apiKey, customerServiceName, tone, verbosity, banned,\n          kb, kbFiles: Array.isArray(kbFiles) ? kbFiles : [],\n          model, temperature, maxTokens, safety,\n          history: Array.isArray(history) ? history : []\n        }\n      });\n      return;\n    }\n\n    if (t === 'save') {\n      const d = (msg && msg.data) || {};\n      const errors = {};\n\n      // secret\n      try { await secret.set(SECRET_KEY, String(d.apiKey || '')); }\n      catch (e) { errors.apiKey = String(e && e.message || e); }\n\n      // storageï¼ˆé€ä¸€å¯«å…¥ï¼Œæ”¶é›†éŒ¯èª¤ï¼‰\n      for (const k of FIELD_KEYS) {\n        if (!(k in d)) continue;\n        const err = await sset(k, d[k]);\n        if (err) errors[k] = err;\n      }\n\n      sidebar.postMessage({ type: 'saved', errors });\n      return;\n    }\n\n    if (t === 'history.set') {\n      const arr = Array.isArray(msg.history) ? msg.history : [];\n      await sset('history', arr);\n      return;\n    }\n\n    if (t === 'openExternal') {\n      const url = String(msg.url || '');\n      if (url) {\n        try { await vscode.env.openExternal(vscode.Uri.parse(url)); }\n        catch (e) { vscode.window.showWarningMessage('ç„¡æ³•é–‹å•Ÿé€£çµï¼š' + url); }\n      }\n      return;\n    }\n\n    if (t === 'storage.clearAll') {\n      await Promise.all(FIELD_KEYS.map(sremove));\n      await secret.set(SECRET_KEY, '');\n      sidebar.postMessage({ type: 'saved', errors: {} });\n      return;\n    }\n\n  } catch (e) {\n    try { sidebar.postMessage({ type: 'error', message: String(e && e.message || e) }); } catch {}\n  }\n});\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HTMLï¼ˆç”¨ data:URI è¼‰å…¥ webview JSï¼Œé¿å… document.write å•é¡Œï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction getHtml () {\n  const js = getClientJs();\n  const jsBase64 = Buffer.from(js, 'utf8').toString('base64');\n\n  return [\n'<!doctype html><html lang=\"zh-Hant\"><head><meta charset=\"utf-8\"/>',\n'<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/>',\n'<title>Gemini â€” Copilot Chat</title>',\n'<style>',\n':root{--bg:#0f1115;--panel:#0b0d12;--card:#11141b;--text:#d7dce2;--sub:#9aa3ad;--brand:#5a9cff;--danger:#ff6b6b;--line:#222735}',\n'*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:var(--bg);color:var(--text);font:13px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}',\n'.wrap{height:100vh;display:grid;grid-template-rows:auto 1fr auto}',\n'header{display:flex;gap:10px;align-items:center;padding:10px 12px;background:var(--panel);border-bottom:1px solid var(--line)}',\n'.title{font-weight:600;margin-right:auto}',\n'select,button,input[type=\"text\"],input[type=\"password\"],textarea{background:#0f1420;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:6px 10px}',\n'button{cursor:pointer}.ghost{background:transparent}.danger{background:#341315;border-color:#522322;color:#ffd1cf}',\n'.content{padding:14px;overflow:auto}.bubble{max-width:860px;margin:0 auto 12px;background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px 14px}',\n'.role{font-size:11px;color:var(--sub);margin-bottom:6px}',\n'.composer{position:sticky;bottom:0;background:linear-gradient(180deg,transparent,rgba(15,17,21,.95));border-top:1px solid var(--line);padding:10px 12px}',\n'.box{max-width:900px;margin:0 auto;background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:10px;display:grid;grid-template-columns:1fr auto;gap:10px}',\n'.tools{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;align-items:center}',\n'textarea{width:100%;min-height:68px;max-height:180px;resize:vertical;background:#0f1420;border:1px solid var(--line);color:var(--text);border-radius:10px;padding:10px}',\n'.actions{display:flex;gap:8px}.btn{padding:8px 14px;border-radius:10px}.primary{background:var(--brand);border-color:#2a64ff;color:#fff}.hidden{display:none}',\n'.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center}',\n'.card{width:640px;background:#11141b;border:1px solid var(--line);border-radius:14px;padding:16px}.grid{display:grid;grid-template-columns:140px 1fr;gap:10px;align-items:center}',\n'.atts{display:flex;gap:6px;flex-wrap:wrap}.chip{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#0f1420}.x{cursor:pointer;opacity:.8}',\n'.muted{color:#9aa3ad}',\n\n/* Markdown æ¨£å¼ */\n'.md{line-height:1.65;word-wrap:break-word}',\n'.md h1{font-size:20px;margin:12px 0 6px} .md h2{font-size:18px;margin:12px 0 6px} .md h3{font-size:16px;margin:10px 0 6px}',\n'.md p{margin:6px 0} .md ul,.md ol{margin:6px 0 6px 22px} .md li{margin:4px 0}',\n'.md code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:#0b1020;border:1px solid #23304b;padding:1px 5px;border-radius:6px}',\n'.md pre{background:#0b1020;border:1px solid #23304b;border-radius:10px;padding:10px;overflow:auto}',\n'.md pre code{background:transparent;border:0;padding:0}',\n'.md blockquote{margin:6px 0;padding:6px 10px;border-left:3px solid #324457;background:rgba(255,255,255,.03);border-radius:6px}',\n'.md a{color:#8ab4ff;text-decoration:underline} .md hr{border:0;border-top:1px solid var(--line);margin:10px 0}',\n'</style>',\n'</head><body>',\n'  <div class=\"wrap\">',\n'    <header>',\n'      <div class=\"title\">Gemini â€” Copilot Chat</div>',\n'      <div>æ¨¡å‹ <select id=\"model\"><option value=\"gemini-1.5-flash\" selected>gemini-1.5-flash</option><option value=\"gemini-1.5-pro\">gemini-1.5-pro</option></select></div>',\n'      <button id=\"btnSettings\" class=\"ghost\">è¨­å®š</button>',\n'      <button id=\"btnClear\" class=\"ghost danger\">æ¸…é™¤å°è©±</button>',\n'    </header>',\n'    <div id=\"content\" class=\"content\"></div>',\n'    <div class=\"composer\"><div class=\"box\">',\n'      <div>',\n'        <div class=\"tools\">',\n'          <span>æº«åº¦ <input id=\"temp\" type=\"range\" min=\"0\" max=\"1\" step=\"0.05\" value=\"0.3\"> <span id=\"tempV\">0.3</span></span>',\n'          <span>è¼¸å‡ºTokens <input id=\"tokens\" type=\"range\" min=\"256\" max=\"8192\" step=\"64\" value=\"2048\"> <span id=\"tokensV\">2048</span></span>',\n'          <span>å®‰å…¨ <select id=\"safety\"><option value=\"relaxed\">å¯¬é¬†</option><option value=\"neutral\" selected>ä¸­ç«‹</option><option value=\"strict\">åš´æ ¼</option></select></span>',\n'          <input id=\"file\" type=\"file\" multiple class=\"hidden\"/> <button id=\"btnFile\" class=\"ghost\">é™„æª”</button> <div id=\"attList\" class=\"atts\"></div>',\n'        </div>',\n'        <textarea id=\"input\" placeholder=\"è¼¸å…¥è¨Šæ¯â€¦ Enter é€å‡ºï¼›Shift+Enter æ›è¡Œ\"></textarea>',\n'      </div>',\n'      <div class=\"actions\"><button id=\"btnStop\" class=\"btn hidden\">åœæ­¢</button><button id=\"btnSend\" class=\"btn primary\">é€å‡º</button></div>',\n'    </div></div>',\n'  </div>',\n\n'  <div id=\"dlg\" class=\"modal\"><div class=\"card\">',\n'    <h3 style=\"margin:0 0 8px 0\">è¨­å®š</h3>',\n'    <div class=\"grid\">',\n'      <label for=\"apiKey\">Gemini API Key</label><input id=\"apiKey\" type=\"password\" placeholder=\"AI...\">',\n'      <label for=\"agentName\">å®¢æœåç¨±</label><input id=\"agentName\" type=\"text\" placeholder=\"å¦‚ï¼šå°å¹«æ‰‹\">',\n'      <label for=\"tone\">èªæ°£</label><select id=\"tone\"><option>è¦ªåˆ‡å°ˆæ¥­</option><option>æ´»æ½‘å‹å–„</option><option>åš´è¬¹æ­£å¼</option><option>æŠ€è¡“å°å‘</option></select>',\n'      <label for=\"verbosity\">å›è¦†é•·åº¦</label><select id=\"verbosity\"><option>ç²¾ç°¡</option><option selected>é©ä¸­</option><option>è©³ç´°</option></select>',\n'      <label for=\"banned\">ç¦èª</label><textarea id=\"banned\" rows=\"2\" placeholder=\"é€—è™Ÿåˆ†éš”ï¼Œå¦‚ï¼šä¿è­‰ã€çµ•å°\"></textarea>',\n'      <label for=\"kb\">åƒè€ƒè³‡æ–™</label><textarea id=\"kb\" rows=\"4\" placeholder=\"è²¼ FAQ / æ–‡ä»¶ç‰‡æ®µï¼›å°‡è¢«åŠ å…¥ system æŒ‡ä»¤\"></textarea>',\n'      <label>åƒè€ƒæª”æ¡ˆ</label>',\n'      <div><input id=\"kbFile\" type=\"file\" multiple class=\"hidden\"/> <button id=\"btnKbAdd\" class=\"ghost\">æ–°å¢æª”æ¡ˆ</button> <div id=\"kbList\" class=\"atts\" style=\"margin-top:8px\"></div> <p class=\"muted\" style=\"margin:6px 0 0\">å»ºè­°æ¯æª” &lt; 1MBï¼›æ–‡å­—æª”ç›´æ¥å…§æ–‡æ³¨å…¥ï¼Œå½±åƒ/äºŒé€²ä½ä»¥ inlineData å‚³çµ¦æ¨¡å‹ã€‚</p></div>',\n'    </div>',\n'    <p class=\"muted\" style=\"margin:10px 0 0\">é‡‘é‘°å­˜æ–¼ secretï¼›å…¶é¤˜å„²å­˜æ–¼ workspace storageï¼ˆè‹¥ä¸å¯ç”¨å‰‡å­˜ globalï¼‰ã€‚</p>',\n'    <div style=\"display:flex;gap:8px;justify-content:flex-end;margin-top:10px\"><button id=\"btnSave\" class=\"btn primary\">å„²å­˜</button></div>',\n'  </div></div>',\n\n`<script src=\"data:text/javascript;base64,${jsBase64}\"></script>`,\n'</body></html>'\n  ].join('');\n}\n\n/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Webview è…³æœ¬ï¼ˆdata:URIï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\nfunction getClientJs () {\n  return `\n(function(){\n  // ====== åŸºæœ¬æ©‹æ¥ & Polyfills ======\n  var vscode = acquireVsCodeApi();\n  function send(type, data){ var o=data||{}; o.type=type; vscode.postMessage(o); }\n  function $(s){ return document.querySelector(s); }\n\n  if (typeof window.URL === 'undefined' && typeof self !== 'undefined') { window.URL = self.URL; }\n  var AbortC = (typeof AbortController !== 'undefined') ? AbortController : null;\n\n  // ====== å…ƒä»¶ ======\n  var dlg=$(\"#dlg\"), btnSave=$(\"#btnSave\"), btnSettings=$(\"#btnSettings\"), btnClear=$(\"#btnClear\");\n  var apiKeyEl=$(\"#apiKey\"), agentNameEl=$(\"#agentName\"), toneEl=$(\"#tone\"), verbEl=$(\"#verbosity\"), bannedEl=$(\"#banned\"), kbEl=$(\"#kb\");\n  var kbList=$(\"#kbList\"), kbFileEl=$(\"#kbFile\"), btnKbAdd=$(\"#btnKbAdd\");\n  var modelSel=$(\"#model\"), temp=$(\"#temp\"), tempV=$(\"#tempV\"), tokens=$(\"#tokens\"), tokensV=$(\"#tokensV\"), safetySel=$(\"#safety\");\n  var content=$(\"#content\"), inputEl=$(\"#input\"), btnSend=$(\"#btnSend\"), btnStop=$(\"#btnStop\");\n  var attList=$(\"#attList\"), fileEl=$(\"#file\"), btnFile=$(\"#btnFile\");\n\n  var state={ \n    apiKey:\"\", customerServiceName:\"å°å¹«æ‰‹\", tone:\"è¦ªåˆ‡å°ˆæ¥­\", verbosity:\"é©ä¸­\", banned:\"\", \n    kb:\"\", kbFiles:[], \n    attFiles:[], // â† èŠå¤©è‡¨æ™‚é™„æª”ï¼ˆä¸å¯«å…¥ storageï¼‰\n    model:\"gemini-1.5-flash\", temperature:0.3, maxTokens:2048, safety:\"neutral\", history:[]\n  };\n\n  // ====== Toast ======\n  function toast(t){ var d=document.createElement('div'); d.textContent=t; d.style.cssText='position:fixed;right:12px;bottom:12px;background:#183a2e;border:1px solid #2f5d4b;color:#fff;padding:8px 10px;border-radius:8px;z-index:9;opacity:.98'; document.body.appendChild(d); setTimeout(function(){d.remove();},2200); }\n\n  // ====== Markdownï¼ˆç°¡æ˜“ rendererï¼‰ ======\n  function escapeHtml(s){\n    return String(s).replace(/[&<>\"]/g, function(c){return c==='&'?'&amp;':c==='<'?'&lt;':c==='>'?'&gt;':'&quot;';});\n  }\n  function mdLinks(html){\n    return html.replace(/\\\\[([^\\\\]]+)\\\\]\\\\(([^)\\\\s]+)\\\\)/g, function(_,text,url){\n      var safe = escapeHtml(text); var u = escapeHtml(url);\n      return '<a href=\"'+u+'\" data-ext=\"'+u+'\">'+safe+'</a>';\n    });\n  }\n  function mdInline(html){\n    html = html.replace(/\\\\\\`([^\\\\\\`]+)\\\\\\`/g, '<code>$1</code>');\n    html = html.replace(/\\\\*\\\\*([^*]+)\\\\*\\\\*/g, '<strong>$1</strong>');\n    html = html.replace(/\\\\*([^*]+)\\\\*/g, '<em>$1</em>');\n    return mdLinks(html);\n  }\n  function renderMarkdown(src){\n    if(!src) return '';\n    var s = escapeHtml(String(src));\n    s = s.replace(/\\\\n?\\\\\\`\\\\\\`\\\\\\`([a-zA-Z0-9_-]+)?\\\\n([\\\\s\\\\S]*?)\\\\n\\\\\\`\\\\\\`\\\\\\`/g,\n      function(_,lang,code){ return '<pre><code class=\"lang-'+(lang||'')+'\">'+code.replace(/</g,'&lt;')+'</code></pre>'; });\n\n    var out=[], lines=s.split(/\\\\r?\\\\n/), i=0;\n    while(i<lines.length){\n      var line=lines[i];\n      var m=line.match(/^(#{1,6})\\\\s+(.*)$/);\n      if(m){ out.push('<h'+m[1].length+'>'+mdInline(m[2])+'</h'+m[1].length+'>'); i++; continue; }\n      if(/^>\\\\s?/.test(line)){ var buf=[]; while(i<lines.length && /^>\\\\s?/.test(lines[i])){ buf.push(lines[i].replace(/^>\\\\s?/, '')); i++; } out.push('<blockquote>'+mdInline(buf.join('\\\\n'))+'</blockquote>'); continue; }\n      if(/^\\\\s*[-*+]\\\\s+/.test(line)){ var items=[]; while(i<lines.length && /^\\\\s*[-*+]\\\\s+/.test(lines[i])){ items.push('<li>'+mdInline(lines[i].replace(/^\\\\s*[-*+]\\\\s+/, ''))+'</li>'); i++; } out.push('<ul>'+items.join('')+'</ul>'); continue; }\n      if(/^\\\\s*\\\\d+\\\\.\\\\s+/.test(line)){ var items2=[]; while(i<lines.length && /^\\\\s*\\\\d+\\\\.\\\\s+/.test(lines[i])){ items2.push('<li>'+mdInline(lines[i].replace(/^\\\\s*\\\\d+\\\\.\\\\s+/, ''))+'</li>'); i++; } out.push('<ol>'+items2.join('')+'</ol>'); continue; }\n      if(/^\\\\s*([-*_])\\\\1{2,}\\\\s*$/.test(line)){ out.push('<hr/>'); i++; continue; }\n      if(line.trim().length){ var buf2=[line]; i++; while(i<lines.length && lines[i].trim().length && !/^(#{1,6})\\\\s+|^>\\\\s?|^\\\\s*[-*+]\\\\s+|^\\\\s*\\\\d+\\\\.\\\\s+|^\\\\s*([-*_])\\\\1{2,}\\\\s*$/.test(lines[i])){ buf2.push(lines[i]); i++; } out.push('<p>'+mdInline(buf2.join(' '))+'</p>'); continue; }\n      i++;\n    }\n    return '<div class=\"md\">'+out.join('')+'</div>';\n  }\n\n  function hookExternalLinks(root){\n    (root||document).querySelectorAll('a[data-ext]').forEach(function(a){\n      a.addEventListener('click', function(ev){\n        ev.preventDefault();\n        var url = a.getAttribute('data-ext') || a.href;\n        if(url){ send('openExternal', { url:url }); }\n      });\n    });\n  }\n\n  // ====== UIï¼šè¨Šæ¯æ¸²æŸ“ ======\n  function addBubble(role, html){\n    var wrap=document.createElement('div'); wrap.className='bubble';\n    var r=document.createElement('div'); r.className='role'; r.textContent = (role==='user'?'ä½ ':'Gemini'); wrap.appendChild(r);\n    var b=document.createElement('div'); b.className='body'; b.innerHTML = html; wrap.appendChild(b);\n    content.appendChild(wrap);\n    content.scrollTop=content.scrollHeight;\n    hookExternalLinks(b);\n    return b;\n  }\n  function addUser(text){ return addBubble('user', renderMarkdown(text)); }\n  function addBot(text){ return addBubble('assistant', renderMarkdown(text)); }\n  function addBotThinking(){ return addBubble('assistant', '<div class=\"md\"><em>â€¦æ€è€ƒä¸­</em></div>'); }\n  function replaceBody(el, text){ if(!el) return; el.innerHTML = renderMarkdown(text); hookExternalLinks(el); }\n\n  // ====== Webview æ”¶è¨Š ======\n  window.addEventListener('message', function(e){\n    var m=e.data||{};\n    if(m.type==='init'){\n      Object.assign(state, m.data||{});\n      apiKeyEl.value=state.apiKey||'';\n      agentNameEl.value=state.customerServiceName||'';\n      toneEl.value=state.tone||'è¦ªåˆ‡å°ˆæ¥­';\n      verbEl.value=state.verbosity||'é©ä¸­';\n      bannedEl.value=state.banned||'';\n      kbEl.value=state.kb||'';\n      modelSel.value=state.model||'gemini-1.5-flash';\n      temp.value=String(state.temperature||0.3); tempV.textContent=temp.value;\n      tokens.value=String(state.maxTokens||2048); tokensV.textContent=tokens.value;\n      safetySel.value=state.safety||'neutral';\n      renderKbList(); renderAttList(); renderHistory();\n    }\n    if(m.type==='saved'){\n      if(m.errors && Object.keys(m.errors).length){ toast('éƒ¨åˆ†æ¬„ä½å„²å­˜å¤±æ•—ï¼ˆè©³è¦‹ Consoleï¼‰'); console.log('[saved errors]', m.errors); }\n      else toast('å·²å„²å­˜');\n      dlg.style.display='none';\n    }\n    if(m.type==='error'){ toast('éŒ¯èª¤ï¼š'+(m.message||'')); }\n  });\n\n  function renderHistory(){\n    content.innerHTML='';\n    (state.history||[]).forEach(function(x){ addBubble(x.role, renderMarkdown(x.content||'')); });\n  }\n\n  // ====== æª”æ¡ˆè™•ç†ï¼ˆå…±ç”¨çµ¦ kbFiles / attFilesï¼‰ ======\n  function isTextLike(file){\n    if (file.type && file.type.indexOf('text/') === 0) return true;\n    var n=file.name||''; return /\\\\.(txt|md|markdown|csv|json|log|yaml|yml|xml|html|css|js|ts|tsx|jsx|py|rb|php|java|kt|go|rs|c|cpp|h|hpp|cs|sql)$/i.test(n);\n  }\n  function toBase64FromDataURL(s){ var i=s.indexOf(','); return i>=0 ? s.slice(i+1) : s; }\n\n  function readFilesTo(targetArr, files, onDone){\n    var max=1024*1024, list=[].slice.call(files||[]), pending=list.length; if(!pending){ onDone&&onDone(); return; }\n    for(var k=0;k<list.length;k++){\n      (function(file){\n        if(file.size>max){ pending--; if(!pending) onDone&&onDone(); return; }\n        var item={ name:file.name, size:file.size, mime:(file.type||'application/octet-stream'), kind:'text', text:'', base64:'' };\n        if(isTextLike(file)){\n          var fr=new FileReader();\n          fr.onload=function(){ item.kind='text'; item.text=String(fr.result||''); targetArr.push(item); pending--; if(!pending) onDone&&onDone(); };\n          fr.onerror=function(){ pending--; if(!pending) onDone&&onDone(); };\n          fr.readAsText(file);\n        }else{\n          var fr2=new FileReader();\n          fr2.onload=function(){ item.kind='binary'; item.base64=toBase64FromDataURL(String(fr2.result||'')); targetArr.push(item); pending--; if(!pending) onDone&&onDone(); };\n          fr2.onerror=function(){ pending--; if(!pending) onDone&&onDone(); };\n          fr2.readAsDataURL(file);\n        }\n      })(list[k]);\n    }\n  }\n\n  // ====== kbFilesï¼ˆè¨­å®šè¦–çª—ï¼‰ ======\n  function renderKbList(){\n    kbList.innerHTML=(state.kbFiles||[]).map(function(a,idx){\n      var sz=a.size?(Math.round(a.size/1024)+'KB'):'';\n      return '<span class=\"chip\" data-i=\"'+idx+'\">'+ (a.name||'file') +' <span class=\"muted\">'+sz+'</span> <span class=\"x\" title=\"ç§»é™¤\">âœ•</span></span>';\n    }).join('');\n    var xs=kbList.querySelectorAll('.chip .x');\n    for(var i=0;i<xs.length;i++){\n      xs[i].addEventListener('click', function(ev){\n        var p=ev.target.closest('.chip'); var ii=Number(p.getAttribute('data-i'));\n        state.kbFiles.splice(ii,1); renderKbList();\n      });\n    }\n  }\n  btnKbAdd.addEventListener('click', function(){ kbFileEl.click(); });\n  kbFileEl.addEventListener('change', function(){ readFilesTo(state.kbFiles, kbFileEl.files, renderKbList); kbFileEl.value=''; });\n\n  // ====== attFilesï¼ˆèŠå¤©è‡¨æ™‚é™„æª”ï¼‰ ======\n  function renderAttList(){\n    attList.innerHTML=(state.attFiles||[]).map(function(a,idx){\n      var sz=a.size?(Math.round(a.size/1024)+'KB'):'';\n      return '<span class=\"chip\" data-i=\"'+idx+'\">'+ (a.name||'file') +' <span class=\"muted\">'+sz+'</span> <span class=\"x\" title=\"ç§»é™¤\">âœ•</span></span>';\n    }).join('');\n    var xs=attList.querySelectorAll('.chip .x');\n    for(var i=0;i<xs.length;i++){\n      xs[i].addEventListener('click', function(ev){\n        var p=ev.target.closest('.chip'); var ii=Number(p.getAttribute('data-i'));\n        state.attFiles.splice(ii,1); renderAttList();\n      });\n    }\n  }\n  btnFile.addEventListener('click', function(){ fileEl.click(); });\n  fileEl.addEventListener('change', function(){ readFilesTo(state.attFiles, fileEl.files, renderAttList); fileEl.value=''; });\n\n  // ====== Helpersï¼šæŠŠè¨­å®š/æ­·å²/é™„æª” çµ„æˆ Gemini éœ€è¦çš„æ ¼å¼ ======\n  function buildSystemText(state) {\n    const name = state.customerServiceName || 'å°å¹«æ‰‹';\n    const tone = state.tone || 'è¦ªåˆ‡å°ˆæ¥­';\n    const verbosity = state.verbosity || 'é©ä¸­';\n    const banned = String(state.banned || '').split(/[ï¼Œ,ã€\\\\s]+/).filter(Boolean);\n\n    const lines = [\n      'ä½ æ˜¯ã€Œ' + name + 'ã€ï¼Œè«‹ä»¥ç¹é«”ä¸­æ–‡å›è¦†ã€‚',\n      'èªæ°£ï¼š' + tone + 'ã€‚',\n      (verbosity === 'ç²¾ç°¡'\n        ? 'å›è¦†å‹™å¿…ç²¾ç°¡ï¼ˆç´„ 2â€“4 è¡Œï¼‰ï¼Œé‡é»åˆ—é»ã€‚'\n        : (verbosity === 'è©³ç´°'\n          ? 'å›è¦†å¯è¼ƒè©³ç´°ï¼Œå¿…è¦æ™‚åŠ ä¸Šæ­¥é©Ÿèˆ‡å°ç¯„ä¾‹ã€‚'\n          : 'å›è¦†é•·åº¦é©ä¸­ï¼Œæ¢åˆ—æ¸…æ¥šã€‚')),\n      (banned.length ? ('é¿å…å‡ºç¾ä¸‹åˆ—ç¦èªï¼š' + banned.join('ã€') + 'ã€‚å¦‚éœ€ä½¿ç”¨ï¼Œè«‹æ”¹å¯«åŒç¾©è©ã€‚') : '')\n    ];\n    if (state.kb) lines.push('åƒè€ƒè³‡æ–™ï¼ˆå¯é…Œæƒ…å¼•ç”¨ï¼‰ï¼š\\\\n' + state.kb);\n    return lines.filter(Boolean).join('\\\\n\\\\n');\n  }\n\n  function mapHistoryToContents(history){\n    return (history||[]).slice(-10).map(function(m){\n      return { role: (m.role === 'assistant' ? 'model' : 'user'), parts: [{ text: String(m.content || '') }] };\n    });\n  }\n\n  function buildUserPartsWithRefs(prompt, kbFiles, attFiles){\n    var parts = [];\n    // kbFilesï¼ˆæŒä¹…ï¼‰\n    (kbFiles||[]).forEach(function(f){\n      if (f && f.kind === 'text' && f.text) {\n        parts.push({ text: 'ã€åƒè€ƒæª”æ¡ˆï¼š' + (f.name||'file') + 'ã€‘\\\\n' + String(f.text) });\n      } else if (f && f.base64) {\n        parts.push({ text: 'ã€åƒè€ƒæª”æ¡ˆï¼ˆéæ–‡å­—ï¼‰ã€‘ï¼š' + (f.name||'file') });\n        parts.push({ inlineData: { mimeType: (f.mime||'application/octet-stream'), data: f.base64 } });\n      }\n    });\n    // attFilesï¼ˆè‡¨æ™‚ï¼‰\n    (attFiles||[]).forEach(function(f){\n      if (f && f.kind === 'text' && f.text) {\n        parts.push({ text: 'ã€é™„æª”ï¼š' + (f.name||'file') + 'ã€‘\\\\n' + String(f.text) });\n      } else if (f && f.base64) {\n        parts.push({ text: 'ã€é™„æª”ï¼ˆéæ–‡å­—ï¼‰ã€‘ï¼š' + (f.name||'file') });\n        parts.push({ inlineData: { mimeType: (f.mime||'application/octet-stream'), data: f.base64 } });\n      }\n    });\n    parts.push({ text: String(prompt||'') });\n    return parts;\n  }\n\n  // ====== é€å‡º/åœæ­¢ & å‘¼å« Gemini ======\n  var inflight = null;\n  function setBusy(on){\n    btnSend.disabled = on;\n    btnStop.classList.toggle('hidden', !on);\n    inputEl.disabled = on;\n  }\n\n  async function callGemini(prompt){\n    var apiKey = state.apiKey || '';\n    if(!apiKey){ toast('è«‹å…ˆåœ¨ã€Œè¨­å®šã€å¡«å…¥ Gemini API Key'); return '(éŒ¯èª¤) å°šæœªè¨­å®š API Key'; }\n\n    var url = 'https://generativelanguage.googleapis.com/v1beta/models/'\n      + encodeURIComponent(state.model||'gemini-1.5-flash')\n      + ':generateContent?key=' + encodeURIComponent(apiKey);\n\n    var thr = (state.safety === 'strict')\n      ? 'BLOCK_MEDIUM_AND_ABOVE'\n      : (state.safety === 'relaxed' ? 'BLOCK_NONE' : 'BLOCK_ONLY_HIGH');\n\n    var payload = {\n      systemInstruction: { parts: [{ text: buildSystemText(state) }] },\n      contents: [\n        ...mapHistoryToContents(state.history),\n        { role: 'user', parts: buildUserPartsWithRefs(prompt, state.kbFiles, state.attFiles) }\n      ],\n      generationConfig: {\n        temperature: Number(state.temperature||0.3),\n        maxOutputTokens: Number(state.maxTokens||2048)\n      },\n      safetySettings: [\n        { category: 'HARM_CATEGORY_HATE_SPEECH',       threshold: thr },\n        { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: thr },\n        { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: thr },\n        { category: 'HARM_CATEGORY_HARASSMENT',        threshold: thr },\n        { category: 'HARM_CATEGORY_CIVIC_INTEGRITY',   threshold: thr }\n      ]\n    };\n\n    var opts = { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) };\n    if (AbortC){ inflight = new AbortC(); opts.signal = inflight.signal; } else { inflight = { abort:function(){} }; }\n\n    try{\n      var res = await fetch(url, opts);\n      if(!res.ok){ throw new Error('HTTP '+res.status+' : '+(await res.text())); }\n      var j = await res.json();\n      var text = j && j.candidates && j.candidates[0] && j.candidates[0].content && j.candidates[0].content.parts && j.candidates[0].content.parts[0] && j.candidates[0].content.parts[0].text || '';\n      return text || '(ç„¡å…§å®¹)';\n    }catch(e){\n      return '(éŒ¯èª¤) ' + (e && e.message || String(e));\n    }finally{\n      inflight = null;\n    }\n  }\n\n  async function onSend(){\n    var msg = (inputEl.value||'').trim();\n    if(!msg) return;\n    inputEl.value='';\n    addUser(msg);\n    var thinkingBody = addBotThinking();\n    setBusy(true);\n    var reply = await callGemini(msg);\n    replaceBody(thinkingBody, reply);\n    state.history.push({ role:'user', content:msg });\n    state.history.push({ role:'assistant', content:reply });\n    send('history.set', { history: state.history });\n    setBusy(false);\n    // è‹¥å¸Œæœ›æ¯æ¬¡é€å‡ºå°±æ¸…ç©ºè‡¨æ™‚é™„æª”ï¼Œå¯è§£è¨»ä¸‹å…©è¡Œï¼š\n    // state.attFiles = []; \n    // renderAttList();\n  }\n\n  // ====== ä¸­æ–‡è¼¸å…¥æ³•ï¼šæ‹¼å­—æœŸé–“ä¸è¦é€å‡º ======\n  var __imeComposing = false;\n  inputEl.addEventListener('compositionstart', function(){ __imeComposing = true; });\n  inputEl.addEventListener('compositionend',   function(){ __imeComposing = false; });\n  inputEl.addEventListener('keydown', function(e){\n    if (__imeComposing && e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      e.stopImmediatePropagation();\n    }\n  }, true);\n  (function(){ var __origOnSend = onSend; onSend = function(){ if(__imeComposing) return; return __origOnSend.apply(this, arguments); }; })();\n\n  btnSend.addEventListener('click', onSend);\n  inputEl.addEventListener('keydown', function(ev){\n    if(ev.key==='Enter' && !ev.shiftKey){ ev.preventDefault(); onSend(); }\n  });\n  btnStop.addEventListener('click', function(){\n    if(inflight && inflight.abort) try{ inflight.abort(); }catch{}\n    setBusy(false);\n  });\n\n  // ====== è¨­å®šå„²å­˜ ======\n  btnSave.addEventListener('click', function(){\n    state.apiKey=(apiKeyEl.value||'').trim();\n    state.customerServiceName=(agentNameEl.value||'').trim();\n    state.tone=toneEl.value||'è¦ªåˆ‡å°ˆæ¥­';\n    state.verbosity=verbEl.value||'é©ä¸­';\n    state.banned=(bannedEl.value||'').trim();\n    state.kb=(kbEl.value||'').trim();\n    state.model=modelSel.value||'gemini-1.5-flash';\n    state.temperature=Number(temp.value||0.3);\n    state.maxTokens=Number(tokens.value||2048);\n    state.safety=safetySel.value||'neutral';\n    send('save',{data:{\n      apiKey:state.apiKey, customerServiceName:state.customerServiceName, tone:state.tone, verbosity:state.verbosity, banned:state.banned, kb:state.kb, kbFiles:state.kbFiles, model:state.model, temperature:state.temperature, maxTokens:state.maxTokens, safety:state.safety\n    }});\n  });\n\n  // ====== å…¶ä»– UI ======\n  btnSettings.addEventListener('click', function(){ dlg.style.display='flex'; setTimeout(function(){ apiKeyEl.focus(); },0); });\n  btnClear.addEventListener('click', function(){ state.history=[]; send('history.set',{history:[]}); content.innerHTML=''; });\n  temp.addEventListener('input', function(){ tempV.textContent=temp.value; });\n  tokens.addEventListener('input', function(){ tokensV.textContent=tokens.value; });\n\n  // å•Ÿå‹•æ¡æ‰‹\n  send('ping'); send('req:init');\n})();\n`;\n}\n",
    "tags": [
      "tool"
    ]
  },
  {
    "command": "cmd.5451rjsft9",
    "text": "$(vm) ç³»çµ±ç›£è¦–å™¨",
    "tooltip": "é¡¯ç¤ºç•¶å‰ CPU èˆ‡ RAM çš„ä½¿ç”¨é‡",
    "hidden": true,
    "enableOnInit": false,
    "script": "// SBH â€” System Monitor: Status Bar + Sidebar (æŒä¹…åŒ–æ¨¡å¼/é »ç‡ã€ä¸­æ–‡æ¨™ç±¤ã€ç·Šæ¹Šç‰ˆé¢)\n// - ç‹€æ…‹åˆ—ï¼šCPU åªé¡¯ç¤º $(pulse)ï¼›RAM é¡¯ç¤º $(server)\n// - é¡¯ç¤ºæ¨¡å¼ï¼špercentï¼ˆç™¾åˆ†æ¯”ï¼‰| detailï¼ˆRAM å·²ç”¨/ç¸½ï¼‹ç™¾åˆ†æ¯”ï¼‰ï¼Œä¿å­˜åˆ° storage.global\n// - åˆ·æ–°é »ç‡ï¼š0.5s / 1s / 2s / 5sï¼Œä¿å­˜åˆ° storage.global\n// - Sidebarï¼šå–®æ¬„ã€Œç³»çµ±ç¸½è¦½ã€ï¼ˆå·¦æ¬„ä¸­æ–‡ï¼‰ã€æ¯æ ¸å¿ƒé•·æ¢åœ–ã€è¨˜æ†¶é«”è©³æƒ…ï¼›key/value é–“è·æ›´ç·Šæ¹Š\n\nconst vscode = require(\"vscode\");\nconst os = require(\"os\");\nconst { monitorEventLoopDelay } = require(\"perf_hooks\");\nconst { setInterval, clearInterval, setTimeout, clearTimeout } = require(\"timers\");\nconst { vm, sidebar, storage } = statusBarHelper.v1;\n\n(function main() {\n  const K_MODE = \"sbh.sys.monitor.mode\";\n  const K_INTERVAL = \"sbh.sys.monitor.intervalMs\";\n\n  const item = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right, 1000);\n  item.name = \"System Monitor\";\n  item.command = \"sbh.sys.monitor.menu\";\n  item.tooltip = \"ç³»çµ±ç›£è¦–ï¼šé»æ“Šåˆ‡æ›é¡¯ç¤ºæ¨¡å¼ / èª¿æ•´åˆ·æ–°é »ç‡ / æš«åœ / é–‹å•Ÿå´é‚Šæ¬„\";\n  item.show();\n\n  let mode = \"percent\";          // \"percent\" | \"detail\"\n  let intervalMs = 1000;         // 500 | 1000 | 2000 | 5000\n  let paused = false;\n  let timer = null, warmupT = null;\n\n  const eld = monitorEventLoopDelay({ resolution: 10 });\n  eld.enable();\n\n  // å•Ÿå‹•å‰è®€å–ä¿å­˜è¨­å®š\n  (async () => {\n    try {\n      const savedMode = await storage.global.get(K_MODE);\n      if (savedMode === \"percent\" || savedMode === \"detail\") mode = savedMode;\n    } catch {}\n    try {\n      const savedInterval = await storage.global.get(K_INTERVAL);\n      if ([500, 1000, 2000, 5000].includes(savedInterval)) intervalMs = savedInterval;\n    } catch {}\n    startLoop();\n  })();\n\n  // â”€â”€ é¸å–®\n  const disposables = [];\n  disposables.push(\n    vscode.commands.registerCommand(\"sbh.sys.monitor.menu\", async () => {\n      const pick = await vscode.window.showQuickPick(\n        [\n          { label: mode === \"percent\" ? \"åˆ‡åˆ°ï¼šè©³ç´°æ¨¡å¼\" : \"åˆ‡åˆ°ï¼šç™¾åˆ†æ¯”æ¨¡å¼\", value: \"toggleMode\" },\n          { label: \"é–‹å•Ÿå´é‚Šæ¬„ï¼ˆè©³æƒ…ï¼‰\", value: \"openSidebar\" },\n          { label: intervalMs === 500 ? \"âœ“ æ¯ 0.5 ç§’\" : \"æ¯ 0.5 ç§’\", value: 500 },\n          { label: intervalMs === 1000 ? \"âœ“ æ¯ 1 ç§’\" : \"æ¯ 1 ç§’\", value: 1000 },\n          { label: intervalMs === 2000 ? \"âœ“ æ¯ 2 ç§’\" : \"æ¯ 2 ç§’\", value: 2000 },\n          { label: intervalMs === 5000 ? \"âœ“ æ¯ 5 ç§’\" : \"æ¯ 5 ç§’\", value: 5000 },\n          { label: paused ? \"â–¶ æ¢å¾©\" : \"â¸ æš«åœ\", value: \"toggle\" },\n          { label: \"âœ– é—œé–‰ï¼ˆåœæ­¢è…³æœ¬ï¼‰\", value: \"stop\" },\n        ],\n        { placeHolder: \"ç³»çµ±ç›£è¦–ï¼šé¡¯ç¤ºæ¨¡å¼ / åˆ·æ–°é »ç‡ / å´é‚Šæ¬„\" }\n      );\n      if (!pick) return;\n\n      if (pick.value === \"toggleMode\") {\n        mode = mode === \"percent\" ? \"detail\" : \"percent\";\n        try { await storage.global.set(K_MODE, mode); } catch {}\n        tick();\n        return;\n      }\n      if (pick.value === \"openSidebar\") { openSidebar(); return; }\n      if (pick.value === \"toggle\") {\n        paused = !paused;\n        if (paused) { stopLoop(); tick({ paused: true }); item.tooltip = \"å·²æš«åœï¼ˆé»æ“Šæ¢å¾©æˆ–èª¿æ•´è¨­å®šï¼‰\"; }\n        else { item.tooltip = \"ç³»çµ±ç›£è¦–ï¼šé»æ“Šåˆ‡æ›é¡¯ç¤ºæ¨¡å¼ / èª¿æ•´åˆ·æ–°é »ç‡ / æš«åœ / é–‹å•Ÿå´é‚Šæ¬„\"; startLoop(); }\n        return;\n      }\n      if (pick.value === \"stop\") { try { vm.stop(); } catch {} return; }\n\n      if (typeof pick.value === \"number\") {\n        intervalMs = pick.value;\n        try { await storage.global.set(K_INTERVAL, intervalMs); } catch {}\n        if (!paused) startLoop();\n      }\n    })\n  );\n\n  // â”€â”€ CPUï¼ˆç¸½é«”/æ¯æ ¸å¿ƒï¼‰â€” tick å·®åˆ†\n  let prevTotal = snapshotCpuTotal();\n  let prevCores = snapshotCpuCores();\n\n  function snapshotCpuTotal() {\n    const list = os.cpus();\n    let idle = 0, total = 0;\n    for (const c of list) {\n      const t = c.times;\n      idle += t.idle;\n      total += t.user + t.nice + t.sys + t.irq + t.idle;\n    }\n    return { idle, total };\n  }\n  function snapshotCpuCores() {\n    return os.cpus().map(c => {\n      const t = c.times;\n      return { idle: t.idle, total: t.user + t.nice + t.sys + t.irq + t.idle };\n    });\n  }\n  function cpuPercentTotal() {\n    const cur = snapshotCpuTotal();\n    const idleDelta = cur.idle - prevTotal.idle;\n    const totalDelta = cur.total - prevTotal.total;\n    prevTotal = cur;\n    return totalDelta > 0 ? clamp01(1 - idleDelta / totalDelta) : 0;\n  }\n  function cpuPercentPerCore() {\n    const cur = snapshotCpuCores();\n    const out = cur.map((c, i) => {\n      const idleDelta = c.idle - prevCores[i].idle;\n      const totalDelta = c.total - prevCores[i].total;\n      return totalDelta > 0 ? clamp01(1 - idleDelta / totalDelta) : 0;\n    });\n    prevCores = cur;\n    return out;\n  }\n\n  // â”€â”€ RAM\n  function memStats() {\n    const total = os.totalmem();\n    const free  = os.freemem();\n    const used  = Math.max(0, total - free);\n    const pct   = total > 0 ? used / total : 0;\n    return { total, free, used, pct: clamp01(pct) };\n  }\n\n  // â”€â”€ å·¥å…· / Render\n  function clamp01(x){ return x < 0 ? 0 : x > 1 ? 1 : x; }\n  function pct0(p){ return (p * 100).toFixed(0) + \"%\"; }\n  function pct1(p){ return (p * 100).toFixed(1) + \"%\"; }\n  function bytesToGB(n){ return (n / (1024 ** 3)).toFixed(1) + \" GB\"; }\n  function formatUptime(sec){\n    const d = Math.floor(sec / 86400);\n    const h = Math.floor((sec % 86400) / 3600);\n    const m = Math.floor((sec % 3600) / 60);\n    return `${d}d ${h}h ${m}m`;\n  }\n\n  function renderText(cpuPct, mem, opt = {}) {\n    const pausedMark = opt.paused ? \" â¸\" : \"\";\n    if (mode === \"detail\") {\n      return `$(pulse) ${pct0(cpuPct)} Â· $(server) ${bytesToGB(mem.used)}/${bytesToGB(mem.total)} (${pct0(mem.pct)})${pausedMark}`;\n    }\n    return `$(pulse) ${pct0(cpuPct)} Â· $(server) ${pct0(mem.pct)}${pausedMark}`;\n  }\n\n  function renderTooltip(cpuPct, mem) {\n    const la = os.loadavg?.() || [];\n    const pm = process.memoryUsage?.() || {};\n    const pmStr = pm.rss ? `Process RSS: ${bytesToGB(pm.rss)}` : \"\";\n    return [\n      `CPUï¼š${pct1(cpuPct)}`,\n      mode === \"detail\"\n        ? `è¨˜æ†¶é«”ï¼š${bytesToGB(mem.used)} / ${bytesToGB(mem.total)}ï¼ˆ${pct1(mem.pct)}ï¼‰`\n        : `è¨˜æ†¶é«”ï¼š${pct1(mem.pct)}ï¼ˆå·²ç”¨ ${bytesToGB(mem.used)} / ç¸½ ${bytesToGB(mem.total)}ï¼‰`,\n      `è² è¼‰å¹³å‡ï¼š${la.map(n => n.toFixed(2)).join(\" / \")}`,\n      pmStr,\n      `é–‹æ©Ÿæ™‚é–“ï¼š${formatUptime(os.uptime?.() || 0)}`,\n      \"é»æ“Šå¯åˆ‡æ›æ¨¡å¼ / èª¿æ•´é »ç‡ / æš«åœ / é–‹å•Ÿå´é‚Šæ¬„\",\n    ].filter(Boolean).join(\"\\n\");\n  }\n\n  // â”€â”€ æ›´æ–°å›åœˆ\n  let lastCpuPct = 0, lastMem = memStats(), lastCoresPct = [];\n  function tick(opt={}) {\n    const cpu = cpuPercentTotal();\n    const cores = cpuPercentPerCore();\n    const mem = memStats();\n    lastCpuPct = cpu; lastMem = mem; lastCoresPct = cores;\n\n    item.text = renderText(cpu, mem, opt);\n    item.tooltip = renderTooltip(cpu, mem);\n\n    if (_sidebarOpen) {\n      const ldMean = Math.max(0, eld.mean / 1e6 || 0);\n      const ldP95  = Math.max(0, eld.percentiles?.[95] / 1e6 || 0);\n      sidebar.postMessage({\n        type: \"metrics\",\n        payload: {\n          ts: Date.now(),\n          cpuPct: cpu,\n          coresPct: cores,\n          mem,\n          loadavg: os.loadavg?.() || [],\n          uptime: os.uptime?.() || 0,\n          arch: os.arch?.() || \"\",\n          platform: os.platform?.() || \"\",\n          release: os.release?.() || \"\",\n          cpumodel: (os.cpus?.()[0]?.model) || \"\",\n          elDelay: { meanMs: +ldMean.toFixed(2), p95Ms: +ldP95.toFixed(2) },\n        },\n      });\n    }\n  }\n  function startLoop() {\n    stopLoop();\n    warmupT = setTimeout(() => { tick(); timer = setInterval(tick, intervalMs); }, 400);\n  }\n  function stopLoop() {\n    if (timer) { clearInterval(timer); timer = null; }\n    if (warmupT) { clearTimeout(warmupT); warmupT = null; }\n  }\n\n  // â”€â”€ Sidebarï¼ˆå–®æ¬„ç³»çµ±ç¸½è¦½ï¼šå·¦æ¬„ä¸­æ–‡ã€é–“è·ç·Šæ¹Šï¼‰\n  let _sidebarOpen = false;\n\n  async function openSidebar() {\n    const html = buildSidebarHTML();\n    await sidebar.open({\n      html,\n      focus: true,\n      onClose: () => { _sidebarOpen = false; },\n    });\n    _sidebarOpen = true;\n  }\n\n  function buildSidebarHTML() {\n    const nonce = Math.random().toString(36).slice(2);\n    return `\n<meta http-equiv=\"Content-Security-Policy\"\n  content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n<style>\n  :root {\n    --fg: var(--vscode-foreground, #ddd);\n    --muted: #9aa0a6;\n    --card: rgba(255,255,255,0.04);\n    --barBg: rgba(255,255,255,0.10);\n  }\n  body { font: 13px/1.6 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; color: var(--fg);}\n  h2 { margin: 0 0 8px; font-size: 16px; }\n  .section { background: var(--card); border-radius: 12px; padding: 12px; margin-bottom: 12px; }\n  /* ç·Šæ¹Šçš„ key/value ä½ˆå±€ï¼ˆå·¦æ¬„ä¸­æ–‡ï¼Œé–“è·ç¸®å°ï¼‰ */\n  .kv { display: grid; grid-template-columns: 90px 1fr; gap: 4px 8px; }\n  .kv div:nth-child(odd){ color: var(--muted); white-space: nowrap; }\n  .cores { display: grid; grid-template-columns: 1fr; gap: 6px; }\n  .bar-row { position: relative; background: var(--barBg); border-radius: 8px; overflow: hidden; height: 16px; }\n  .bar { height: 100%; transition: width 120ms linear; }\n  .label { position: absolute; right: 6px; top: 0; bottom: 0; display:flex; align-items:center; font-size: 12px; text-shadow: 0 1px 2px rgba(0,0,0,.5); }\n  .small { color: var(--muted); font-size: 12px; margin-top: 4px; }\n</style>\n\n<div class=\"section\">\n  <h2>ç³»çµ±ç¸½è¦½</h2>\n  <div class=\"kv\" id=\"sys\"></div>\n</div>\n\n<div class=\"section\">\n  <h2>æ¯æ ¸å¿ƒä½¿ç”¨ç‡</h2>\n  <div class=\"cores\" id=\"cores\"></div>\n  <div class=\"small\" id=\"cores-foot\"></div>\n</div>\n\n<div class=\"section\">\n  <h2>è¨˜æ†¶é«”</h2>\n  <div class=\"kv\" id=\"mem\"></div>\n</div>\n\n<script nonce=\"${nonce}\">\n  const vscode = acquireVsCodeApi();\n  const el = (id) => document.getElementById(id);\n\n  function pct1(p){ return (p*100).toFixed(1) + '%'; }\n  function bytesToGB(n){ return (n / (1024 ** 3)).toFixed(1) + \" GB\"; }\n  function fmtUptime(sec){\n    const d = Math.floor(sec / 86400);\n    const h = Math.floor((sec % 86400) / 3600);\n    const m = Math.floor((sec % 3600) / 60);\n    return \\`\\${d}d \\${h}h \\${m}m\\`;\n  }\n\n  function renderMetrics(m) {\n    const { cpuPct, coresPct, mem, loadavg, uptime, arch, platform, release, cpumodel, elDelay } = m;\n\n    // ç³»çµ±ç¸½è¦½ï¼ˆå·¦æ¬„ä¸­æ–‡ï¼‰\n    el('sys').innerHTML = \\`\n      <div>CPU</div><div>\\${(cpuPct*100).toFixed(1)}% â€” \\${cpumodel || ''}</div>\n      <div>ä½œæ¥­ç³»çµ±</div><div>\\${platform} \\${release} (\\${arch})</div>\n      <div>è² è¼‰å¹³å‡</div><div>\\${(loadavg||[]).map(n=>n.toFixed(2)).join(' / ')}</div>\n      <div>äº‹ä»¶è¿´åœˆ</div><div>å¹³å‡ \\${(elDelay.meanMs||0).toFixed(2)} ms Â· p95 \\${(elDelay.p95Ms||0).toFixed(2)} ms</div>\n      <div>é–‹æ©Ÿæ™‚é–“</div><div>\\${fmtUptime(uptime || 0)}</div>\n      <div>ç¾åœ¨æ™‚é–“</div><div>\\${new Date(m.ts).toLocaleTimeString()}</div>\n    \\`;\n\n    // æ¯æ ¸å¿ƒé•·æ¢åœ–\n    const cores = Array.isArray(coresPct) ? coresPct : [];\n    el('cores').innerHTML = cores.map(p => {\n      const pct = Math.max(0, Math.min(100, p*100));\n      const hue = 120 - Math.round(pct * 1.2); // é«˜ä½¿ç”¨ç‡åç´…\n      return \\`\n        <div class=\"bar-row\">\n          <div class=\"bar\" style=\"width:\\${pct}%; background: hsl(\\${hue},70%,50%);\"></div>\n          <div class=\"label\">\\${pct.toFixed(0)}%</div>\n        </div>\\`;\n    }).join('');\n    el('cores-foot').textContent = \\`\\${cores.length} cores\\`;\n\n    // è¨˜æ†¶é«”ï¼ˆå·¦æ¬„ä¸­æ–‡å·²åœ¨æ¨™é¡Œèˆ‡ keyï¼‰\n    el('mem').innerHTML = \\`\n      <div>ä½¿ç”¨ç‡</div><div>\\${pct1(mem.pct)}</div>\n      <div>å·²ç”¨</div><div>\\${bytesToGB(mem.used)}</div>\n      <div>å¯ç”¨</div><div>\\${bytesToGB(mem.free)}</div>\n      <div>ç¸½è¨ˆ</div><div>\\${bytesToGB(mem.total)}</div>\n    \\`;\n  }\n\n  window.addEventListener('message', (ev) => {\n    const msg = ev.data || {};\n    if (msg.type === 'metrics') renderMetrics(msg.payload || {});\n  });\n</script>\n`;\n  }\n\n  // â”€â”€ çµæŸæ¸…ç†\n  vm.onStop(() => {\n    try { stopLoop(); } catch {}\n    try { item.dispose(); } catch {}\n    try { eld.disable(); } catch {}\n    for (const d of disposables) { try { d.dispose(); } catch {} }\n    try { sidebar.close?.(); } catch {}\n  });\n})();\n",
    "tags": [
      "default",
      "tool"
    ]
  },
  {
    "command": "cmd.cw9jiggqdx",
    "text": "$(window) èƒŒæ™¯åœ–",
    "tooltip": "å¯ä»¥è¨­å®š vscode çš„èƒŒæ™¯åœ–ç‰‡",
    "hidden": true,
    "enableOnInit": false,
    "script": "// SBH â€”â€” JS ç‰ˆï¼šå•Ÿå‹•å¾Œæ³¨å…¥èƒŒæ™¯ï¼ˆæ”¯æ´å¤§å‹åœ–ç‰‡ blob:URLï¼‰+ åŒæ­¥ workbench JS checksum\n//\n// âœ… ç›®æ¨™ï¼šåœ–ç‰‡å¤–çš„å€åŸŸç¶­æŒã€ŒåŸæœ¬ä¸»é¡Œåº•è‰²ã€ï¼Œé€æ˜åº¦åªå½±éŸ¿ã€Œåœ–ç‰‡æœ¬èº«ã€\n// âœ… åŠŸèƒ½ï¼šå¥—ç”¨èƒŒæ™¯åœ–ç‰‡ / èª¿æ•´é€æ˜åº¦ï¼ˆ0ï½1ï¼Œæ•¸å­—è¶Šå¤§â†’è¶Šæ·¡ï¼‰/ é‚„åŸèƒŒæ™¯\n// âœ… è¡Œç‚ºï¼šé¦–æ¬¡å¥—ç”¨æœƒå»ºç«‹ .origï¼ˆæ°¸ä¸è¦†è“‹ï¼‰ï¼›æ¯æ¬¡ä¿®æ”¹æœƒåŒæ­¥ product.json çš„ JS checksum\n// âœ… æ”¯æ´ï¼šPNG / JPG / GIF / WebPï¼›data:URL å¤ªé•·è‡ªå‹•æ”¹ç”¨ blob:URLï¼ˆé¿å… Chromium é•·åº¦é™åˆ¶ï¼‰\n\nconst vscode = require(\"vscode\");\nconst { vm } = statusBarHelper.v1;\nconst fs = require(\"fs\");\nconst fsp = fs.promises;\nconst path = require(\"path\");\nconst crypto = require(\"crypto\");\n\n// ç›®æ¨™è·¯å¾‘ï¼ˆç›¸å° appRootï¼‰\nconst JS_REL_KEY  = \"vs/workbench/workbench.desktop.main.js\";\nconst JS_REL_PATH = \"out/vs/workbench/workbench.desktop.main.js\";\n\n// åŸå§‹å‚™ä»½\nconst JS_BAK_ORIG_EXT  = \".sbhbak.orig\";\nconst PRODUCT_BAK_ORIG = \".sbhbak.product.orig\";\n\n// data:URL é•·åº¦å®‰å…¨é–€æª»ï¼ˆè¶…éå°±æ”¹ç”¨ blobï¼‰\nconst DATAURL_SAFE_LIMIT = 1_800_000; // ~1.8MB\n\nconst MARK_JS_BEGIN = \"/* sbh-background:js-begin */\";\nconst MARK_JS_END   = \"/* sbh-background:js-end */\";\n\n/* ========================= CSS ç”¢ç”Ÿå™¨ ========================= */\n/** ç”¢ CSSï¼šåªæ¸…æ‰ background-imageï¼Œä¸ç ´å£ä¸»é¡Œåº•è‰²ï¼›\n *  ç–Šè‰²èˆ‡åœ–ç‰‡å…©å±¤çš„ background-size ç›¸åŒ â†’ ç–Šè‰²åªè¦†è“‹åœ¨åœ–ç‰‡ä¸Š\n */\nconst makeCssBlock = (\n  dataUrl,\n  {\n    scale = 0.95,                  // è¦–è¦ºç¸®å° 5%\n    basis = \"height\",              // 'height' | 'width'\n    align = \"center center\",\n    // é€æ˜åº¦ï¼š0~1ï¼Œæ•¸å­—è¶Šå¤§â†’è¶Šæ·¡ï¼ˆåœ–ç‰‡æ›´ä¸æ˜é¡¯ï¼›åªå½±éŸ¿åœ–ç‰‡æœ¬èº«ï¼‰\n    overlayOpacity = 0.8,          // ç›¸å®¹ä¿ç•™\n    overlayOpacityDark  = 0.8,     // æš—è‰²é è¨­\n    overlayOpacityLight = 0.8,     // äº®è‰²é è¨­\n    overlayRGB = \"0,0,0\"           // åƒ…ä½œæ¥µèˆŠç’°å¢ƒ fallbackï¼ˆå·²ä¸å†ä½¿ç”¨ä¸Šè‰²ï¼‰\n  } = {}\n) => {\n  const sizeForImg =\n    basis === \"height\"\n      ? \"auto calc(100% * var(--sbh-bg-scale))\"\n      : \"calc(100% * var(--sbh-bg-scale)) auto\";\n\n  return `\n:root{\n  /* sbh-background:vars-begin */\n  --sbh-bg-scale: ${scale};\n\n  /* èˆŠç‰ˆç›¸å®¹åƒæ•¸ */\n  --sbh-bg-overlay-opacity: ${overlayOpacity};\n  --sbh-bg-overlay-rgb: ${overlayRGB};\n\n  /* ä¸»é¡Œå°ˆå±¬ï¼ˆæˆ‘å€‘ç”¨å®ƒç•¶ã€Œæ·¡åŒ–ç¨‹åº¦ã€ä¾†æºï¼‰ */\n  --sbh-bg-overlay-opacity-dark: ${overlayOpacityDark};\n  --sbh-bg-overlay-opacity-light: ${overlayOpacityLight};\n\n  /* ä¸»é¡Œåº•è‰²ï¼ˆçœŸæ­£èƒŒæ™¯è‰²ï¼‰ï¼Œç”± .monaco-workbench ä¾ä¸»é¡Œè¦†å¯« */\n  --sbh-bg-theme: #1e1e1e;\n\n  /* ç•¶å‰ç”Ÿæ•ˆçš„ã€Œæ·¡åŒ–ç¨‹åº¦ã€alphaï¼ˆ0~1ï¼›æ•¸å­—è¶Šå¤§â†’è¶Šæ·¡ï¼‰ */\n  --sbh-bg-overlay-alpha: var(--sbh-bg-overlay-opacity);\n\n  /* å°‡ã€Œæ·¡åŒ–ç¨‹åº¦ã€æ›ç®—æˆåœ–ç‰‡ä¸é€æ˜åº¦ï¼ˆ1 - alphaï¼‰ */\n  --sbh-bg-image-opacity: calc(1 - var(--sbh-bg-overlay-alpha));\n  /* sbh-background:vars-end */\n}\n\n/* ä¸»é¡Œæ„ŸçŸ¥ï¼ˆåœ¨ workbench ç¯„åœå°±åœ°è¦†è“‹ï¼‰ */\n.monaco-workbench.vs-dark{\n  --sbh-bg-overlay-alpha: var(--sbh-bg-overlay-opacity-dark);\n  --sbh-bg-theme: var(--vscode-editor-background, #1e1e1e);\n}\n.monaco-workbench.vs{\n  --sbh-bg-overlay-alpha: var(--sbh-bg-overlay-opacity-light);\n  --sbh-bg-theme: var(--vscode-editor-background, #ffffff);\n}\n.hc-black{\n  --sbh-bg-overlay-alpha: 0.7;\n  --sbh-bg-theme: var(--vscode-editor-background, #000000);\n}\n.hc-light{\n  --sbh-bg-overlay-alpha: 0.5;\n  --sbh-bg-theme: var(--vscode-editor-background, #ffffff);\n}\n\n/* æ¸…æ‰èƒŒæ™¯ã€Œåœ–ã€ï¼Œä¿ç•™ä¸»é¡Œåº•è‰² */\n.monaco-workbench,\n.monaco-editor,\n.monaco-editor-background,\n.editor-instance,\n.monaco-editor .view-lines,\n.monaco-editor .lines-content,\n.monaco-editor .margin,\n.editor .lines-content,\n.monaco-editor .overflow-guard,\n.monaco-editor .monaco-scrollable-element.editor-scrollable{\n  background-image: none !important;\n}\n\n/* å¤–åœå®¹å™¨å›ºå®šç”¨ä¸»é¡Œåº•è‰²ï¼ˆé¿å…é€æ˜ï¼‰ */\n.monaco-workbench .part.editor .editor-group-container,\n.monaco-workbench .part.editor .editor-group-container .monaco-editor,\n.monaco-editor,\n.monaco-editor .overflow-guard,\n.monaco-editor .monaco-scrollable-element.editor-scrollable,\n.monaco-workbench .part.editor .editor-group-container.empty,\n.monaco-workbench .part.editor .editor-group-container .welcomePage,\n.monaco-workbench .part.editor .editor-group-container .gettingStarted,\n.monaco-workbench .part.editor .editor-group-container .gettingStartedContainer{\n  background-color: var(--sbh-bg-theme) !important;\n  position: relative !important; /* ä¾› ::before ç½®åº• */\n}\n\n/* === åœ–ç‰‡å±¤ï¼šæ¬åˆ° ::beforeï¼Œç›´æ¥ç”¨ opacity æ§é€æ˜åº¦ï¼ˆæ•¸å­—è¶Šå¤§â†’è¶Šæ·¡ï¼‰ === */\n.monaco-workbench .part.editor\n  .editor-group-container.active\n  .monaco-editor .monaco-scrollable-element.editor-scrollable::before,\n.monaco-workbench .part.editor .editor-group-container.empty::before,\n.monaco-workbench .part.editor .editor-group-container.active .welcomePage::before,\n.monaco-workbench .part.editor .editor-group-container.active .gettingStarted::before,\n.monaco-workbench .part.editor .editor-group-container.active .gettingStartedContainer::before{\n  content: \"\";\n  position: absolute;\n  inset: 0;\n  pointer-events: none;\n  background-image: url('${dataUrl}');\n  background-repeat: no-repeat;\n  background-position: ${align};\n  background-size: ${sizeForImg};\n  opacity: var(--sbh-bg-image-opacity);  /* â˜… é—œéµï¼šåœ–ç‰‡æœ¬èº«é€æ˜åº¦ */\n}\n\n/* æ’é™¤éç›®æ¨™å®¹å™¨ï¼ˆé¿å…å¤šçµ„ä¸€èµ·é¡¯ç¤ºï¼‰ */\n.monaco-workbench .peekview-widget .monaco-editor .monaco-scrollable-element.editor-scrollable::before,\n.monaco-workbench .search-editor .monaco-scrollable-element.editor-scrollable::before,\n.monaco-workbench .diff-editor .editor.original .monaco-scrollable-element.editor-scrollable::before,\n.monaco-workbench .part.editor\n  .editor-group-container:not(.active)\n  .monaco-editor .monaco-scrollable-element.editor-scrollable::before{\n  content: none;\n}\n\n/* è®“ç·¨è¼¯å™¨å…§å®¹å±¤é€æ˜ï¼ˆåœ–ç‰‡èƒ½é€å‡ºï¼›å¤–åœä»ç‚ºä¸»é¡Œåº•è‰²ï¼‰ */\n.monaco-editor .view-lines,\n.monaco-editor .lines-content,\n.monaco-editor .margin,\n.monaco-editor-background{\n  background-color: transparent !important;\n  background-image: none !important;\n}\n`.replace(/!é‡è¦/g, \"!important\");\n};\n\n\n/* ========================= å°å·¥å…· ========================= */\nconst sha256b64 = (data) =>\n  crypto.createHash(\"sha256\").update(data).digest(\"base64\").replace(/=+$/g, \"\");\n\nconst fileSha256b64 = async (abs, isText = true) =>\n  sha256b64(await fsp.readFile(abs, isText ? \"utf8\" : undefined));\n\nconst escapeRegExp = (s) => s.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n\nfunction findInjectedBlock(text) {\n  const re = new RegExp(\n    `${escapeRegExp(MARK_JS_BEGIN)}[\\\\s\\\\S]*?${escapeRegExp(MARK_JS_END)}`,\n    \"m\"\n  );\n  const m = text.match(re);\n  if (m && m[0]) return { block: m[0] };\n\n  const b = text.indexOf(MARK_JS_BEGIN);\n  if (b === -1) return null;\n  const e = text.indexOf(MARK_JS_END, b);\n  if (e === -1) return null;\n  return { block: text.slice(b, e + MARK_JS_END.length) };\n}\n\nconst guessAppRoots = () => {\n  const roots = new Set();\n  if (vscode?.env?.appRoot) roots.add(vscode.env.appRoot);\n  const exe = process.execPath || \"\";\n\n  if (process.platform === \"darwin\") {\n    roots.add(path.resolve(exe, \"../../Resources/app\"));\n    roots.add(\"/Applications/Visual Studio Code.app/Contents/Resources/app\");\n    roots.add(\"/Applications/Visual Studio Code - Insiders.app/Contents/Resources/app\");\n    roots.add(path.resolve(exe, \"../Resources/app\"));\n    roots.add(path.resolve(exe, \"../../../Resources/app\"));\n  } else if (process.platform === \"win32\") {\n    roots.add(path.join(path.dirname(exe), \"resources\", \"app\"));\n    if (process.env.LOCALAPPDATA) {\n      roots.add(path.join(process.env.LOCALAPPDATA, \"Programs\", \"Microsoft VS Code\", \"resources\", \"app\"));\n      roots.add(path.join(process.env.LOCALAPPDATA, \"Programs\", \"Microsoft VS Code - Insiders\", \"resources\", \"app\"));\n    }\n  } else {\n    roots.add(path.resolve(path.dirname(exe), \"..\", \"resources\", \"app\"));\n    roots.add(\"/usr/share/code/resources/app\");\n    roots.add(\"/usr/lib/code/resources/app\");\n    roots.add(\"/snap/code/current/usr/share/code/resources/app\");\n  }\n  return Array.from(roots);\n};\n\nconst findEnv = () => {\n  for (const r of guessAppRoots()) {\n    const product = path.join(r, \"product.json\");\n    const jsPath = path.join(r, JS_REL_PATH);\n    if (fs.existsSync(product) && fs.existsSync(jsPath)) {\n      return { appRoot: r, productJson: product, jsPath };\n    }\n  }\n  return null;\n};\n\nconst findEnvSmart = () => {\n  const candidates = [];\n  for (const r of guessAppRoots()) {\n    const product = path.join(r, \"product.json\");\n    const jsPath = path.join(r, JS_REL_PATH);\n    if (fs.existsSync(product) && fs.existsSync(jsPath)) {\n      candidates.push({ appRoot: r, productJson: product, jsPath });\n    }\n  }\n  if (candidates.length <= 1) return candidates[0] || null;\n\n  // å„ªå…ˆé¸å·²æ³¨å…¥éçš„ç‰ˆæœ¬\n  for (const c of candidates) {\n    try {\n      const txt = fs.readFileSync(c.jsPath, \"utf8\");\n      if (txt.includes(MARK_JS_BEGIN) && txt.includes(MARK_JS_END)) return c;\n    } catch {}\n  }\n  return candidates[0] || null;\n};\n\nconst hasInjectionMarks = (text) =>\n  text.includes(MARK_JS_BEGIN) && text.includes(MARK_JS_END);\n\nconst makeInjectedIIFE = (dataUrl, opts = {}) => {\n  const css = makeCssBlock(dataUrl, opts)\n    .replace(/\\\\/g, \"\\\\\\\\\")\n    .replace(/`/g, \"\\\\`\");\n  return `\n${MARK_JS_BEGIN}\n(function(){\n  function inject(){\n    try{\n      var id = 'sbh-background-style';\n      var old = document.getElementById(id);\n      if(old && old.parentNode) old.parentNode.removeChild(old);\n      var s = document.createElement('style');\n      s.id = id;\n      s.type = 'text/css';\n      s.appendChild(document.createTextNode(\\`${css}\\`));\n      document.head.appendChild(s);\n    }catch(e){ console && console.warn && console.warn('[sbh] inject failed', e); }\n  }\n  if(typeof document !== 'undefined'){\n    if(document.readyState === 'complete' || document.readyState === 'interactive'){\n      setTimeout(inject, 0);\n    }else{\n      document.addEventListener('DOMContentLoaded', inject, { once:true });\n    }\n  }\n})();\n${MARK_JS_END}\n`;\n};\n\n// å¤§æª” â†’ ç”¨ blob:URLï¼ˆé¿å… data:URL é•·åº¦é™åˆ¶ï¼‰\nconst makeInjectedIIFE_UsingBlob = (mime, b64, opts = {}) => {\n  const cssTpl = makeCssBlock(\"__SBH_BG__\", opts)\n    .replace(/\\\\/g, \"\\\\\\\\\")\n    .replace(/`/g, \"\\\\`\");\n  return `\n${MARK_JS_BEGIN}\n(function(){\n  var _url;\n  function toBlobUrl(b64, mime){\n    try{\n      var bin = atob(b64);\n      var len = bin.length;\n      var arr = new Uint8Array(len);\n      for (var i=0;i<len;i++) arr[i] = bin.charCodeAt(i);\n      return URL.createObjectURL(new Blob([arr], { type: mime || 'application/octet-stream' }));\n    }catch(e){ console && console.warn && console.warn('[sbh] blob fail', e); return ''; }\n  }\n  function inject(){\n    try{\n      if(!_url) _url = toBlobUrl('${b64}', '${mime}');\n      var id = 'sbh-background-style';\n      var old = document.getElementById(id);\n      if(old && old.parentNode) old.parentNode.removeChild(old);\n      var s = document.createElement('style');\n      s.id = id; s.type = 'text/css';\n      var css = \\`${cssTpl}\\`.replace(/__SBH_BG__/g, _url);\n      s.appendChild(document.createTextNode(css));\n      document.head.appendChild(s);\n    }catch(e){ console && console.warn && console.warn('[sbh] inject failed', e); }\n  }\n  if(typeof document !== 'undefined'){\n    if(document.readyState === 'complete' || document.readyState === 'interactive'){\n      setTimeout(inject, 0);\n    }else{\n      document.addEventListener('DOMContentLoaded', inject, { once:true });\n    }\n  }\n})();\n${MARK_JS_END}\n`;\n};\n\nconst stripOldJsInjection = (text) => {\n  const re = new RegExp(\n    `${escapeRegExp(MARK_JS_BEGIN)}[\\\\s\\\\S]*?${escapeRegExp(MARK_JS_END)}\\\\s*`,\n    \"m\"\n  );\n  return text.replace(re, \"\");\n};\n\nconst appendBeforeSourceMap = (text, snippet) => {\n  const i = text.lastIndexOf(\"//# sourceMappingURL=\");\n  if (i > -1) return text.slice(0, i) + \"\\n\" + snippet + \"\\n\" + text.slice(i);\n  return text + \"\\n\" + snippet + \"\\n\";\n};\n\n/* ========================= å‚™ä»½èˆ‡ checksum ========================= */\nasync function ensureCleanOriginalBackups(productJson, jsPath) {\n  const jsOrig = jsPath + JS_BAK_ORIG_EXT;\n  const productOrig = productJson + PRODUCT_BAK_ORIG;\n  if (fs.existsSync(jsOrig) && fs.existsSync(productOrig)) return;\n\n  const [productTxt, jsTxt] = await Promise.all([\n    fsp.readFile(productJson, \"utf8\"),\n    fsp.readFile(jsPath, \"utf8\"),\n  ]);\n\n  let productObj;\n  try { productObj = JSON.parse(productTxt); }\n  catch { return; }\n\n  const expected = productObj?.checksums?.[JS_REL_KEY] || null;\n  if (!expected) return;\n\n  const currentHash = sha256b64(jsTxt);\n  const isClean = currentHash === expected && !hasInjectionMarks(jsTxt);\n  if (!isClean) return;\n\n  try {\n    if (!fs.existsSync(jsOrig))      await fsp.writeFile(jsOrig, jsTxt, \"utf8\");\n    if (!fs.existsSync(productOrig)) await fsp.writeFile(productOrig, productTxt, \"utf8\");\n  } catch {}\n}\n\nconst updateProductChecksumKey = async (productJson, key, fileAbs) => {\n  const src = await fsp.readFile(productJson, \"utf8\");\n  let obj;\n  try { obj = JSON.parse(src); }\n  catch { throw new Error(\"product.json ä¸æ˜¯åˆæ³• JSON\"); }\n  if (!obj.checksums || typeof obj.checksums !== \"object\")\n    throw new Error(\"product.json ç¼ºå°‘ checksums æ¬„ä½\");\n\n  const calc = await fileSha256b64(fileAbs, true);\n  if (obj.checksums[key] === calc) return false;\n\n  await fsp.writeFile(productJson + PRODUCT_BAK_ORIG, src, { flag: \"wx\" }).catch(() => {});\n  obj.checksums[key] = calc;\n  await fsp.writeFile(productJson, JSON.stringify(obj, null, 2), \"utf8\");\n  return true;\n};\n\n/* ========================= é€æ˜åº¦èª¿æ•´ï¼ˆä¸æ›åœ–ï¼‰ ========================= */\nfunction readCurrentOpacityFromJsText(injectedJsBlock){\n  const pick = (re) => {\n    const m = injectedJsBlock.match(re);\n    return m ? parseFloat(m[1]) : null;\n  };\n  return (\n    pick(/--sbh-bg-overlay-opacity-dark:\\s*([0-9]*\\.?[0-9]+)\\s*;/) ??\n    pick(/--sbh-bg-overlay-opacity:\\s*([0-9]*\\.?[0-9]+)\\s*;/) ??\n    pick(/--sbh-bg-overlay-opacity-light:\\s*([0-9]*\\.?[0-9]+)\\s*;/) ??\n    null\n  );\n}\nfunction extractDataUrl(injectedJsBlock){\n  const m = injectedJsBlock.match(/url\\(['\"](data:[^'\"]+)['\"]\\)/);\n  return m ? m[1] : null;\n}\nasync function updateOpacityOnly(productJson, jsPath, newOpacity){\n  const src = await fsp.readFile(jsPath, \"utf8\");\n  if (!hasInjectionMarks(src)) throw new Error(\"æ‰¾ä¸åˆ°å·²æ³¨å…¥çš„æ¨£å¼ï¼Œè«‹å…ˆã€Œå¥—ç”¨èƒŒæ™¯åœ–ç‰‡ã€ã€‚\");\n\n  const found = findInjectedBlock(src);\n  if (!found || !found.block) throw new Error(\"ç„¡æ³•å®šä½æ³¨å…¥å€å¡Šã€‚\");\n  const block = found.block;\n\n  // åŒæ­¥æ›´æ–°ä¸‰å€‹è®Šæ•¸ï¼ˆdark/light/baseï¼‰\n  const rxs = [\n    /(--sbh-bg-overlay-opacity-dark:\\s*)([0-9]*\\.?[0-9]+)(\\s*;)/,\n    /(--sbh-bg-overlay-opacity-light:\\s*)([0-9]*\\.?[0-9]+)(\\s*;)/,\n    /(--sbh-bg-overlay-opacity:\\s*)([0-9]*\\.?[0-9]+)(\\s*;)/\n  ];\n  let replaced = block, hit = 0;\n  for (const rx of rxs) {\n    const before = replaced;\n    replaced = replaced.replace(rx, (_, p1, _old, p3) => `${p1}${newOpacity}${p3}`);\n    if (replaced !== before) hit++;\n  }\n\n  let nextSrc;\n  if (hit > 0) {\n    nextSrc = src.replace(block, replaced);\n  } else {\n    const dataUrl = extractDataUrl(block);\n    if (!dataUrl) throw new Error(\"ç„¡æ³•è§£ææ—¢æœ‰ dataURLï¼Œè«‹æ”¹ç”¨ã€Œå¥—ç”¨èƒŒæ™¯åœ–ç‰‡ã€ã€‚\");\n    const rebuilt = makeInjectedIIFE(dataUrl, {\n      overlayOpacity: newOpacity,\n      overlayOpacityDark: newOpacity,\n      overlayOpacityLight: newOpacity\n    });\n    nextSrc = src.replace(block, rebuilt);\n  }\n\n  await fsp.writeFile(jsPath, nextSrc, \"utf8\");\n  await updateProductChecksumKey(productJson, JS_REL_KEY, jsPath);\n}\n\n/* ========================= é—œé–‰ VS Code ========================= */\nconst quitVSCode = async () => {\n  try { await vscode.commands.executeCommand(\"workbench.action.files.saveAll\"); } catch {}\n  try { await vscode.commands.executeCommand(\"workbench.action.quit\"); }\n  catch { try { await vscode.commands.executeCommand(\"workbench.action.closeWindow\"); } catch {} }\n};\nasync function askToQuit(message) {\n  const btn = await vscode.window.showInformationMessage(\n    message,\n    { modal: true },\n    \"ç«‹å³é—œé–‰ VS Code\", \"ç¨å¾Œ\"\n  );\n  if (btn === \"ç«‹å³é—œé–‰ VS Code\") { await quitVSCode(); return true; }\n  return false;\n}\n\n/* ========================= ä¸»ç¨‹å¼ ========================= */\n(async () => {\n  try {\n    const env = findEnvSmart() || findEnv();\n    if (!env) { await vscode.window.showErrorMessage(\"æ‰¾ä¸åˆ° VS Code å®‰è£æª”æ¡ˆï¼ˆproduct.json / workbench JSï¼‰\"); return; }\n    const { productJson, jsPath } = env;\n\n    const choice = await vscode.window.showQuickPick(\n      [\n        { label: \"ğŸ“‚ å¥—ç”¨èƒŒæ™¯åœ–ç‰‡ï¼ˆå¾æª”æ¡ˆé¸æ“‡ï¼‰\", description: \"æ”¯æ´ PNG/JPG/GIF/WebPï¼›å¯åŒæ™‚è¨­å®šé€æ˜åº¦ï¼›å¤§æª”è‡ªå‹•ç”¨ blob\" },\n        { label: \"ğŸš èª¿æ•´é€æ˜åº¦ï¼ˆ0ï½1ï¼Œæ•¸å­—è¶Šå¤§â†’è¶Šæ·¡ï¼‰\", description: \"ä¸æ›åœ–ï¼Œåªæ”¹ç–Šè‰²é€æ˜åº¦ï¼ˆåƒ…å½±éŸ¿åœ–ç‰‡æœ¬èº«ï¼‰\" },\n        { label: \"ğŸ§¹ é‚„åŸèƒŒæ™¯ï¼ˆæ¢å¾©åˆ°åŸå§‹æª”ï¼‰\", description: \"æœ‰ .orig å°±é‚„åŸï¼›æ²’æœ‰å‰‡ç§»é™¤æ³¨å…¥ä¸¦åŒæ­¥æª¢æŸ¥ç¢¼\" }\n      ],\n      { title: \"Editor Backgroundï¼ˆå¥—ç”¨ / é€æ˜åº¦ / é‚„åŸï¼‰\" }\n    );\n    if (!choice) return;\n\n    const action =\n      choice.label.includes(\"å¥—ç”¨\")   ? \"apply\"   :\n      choice.label.includes(\"é€æ˜åº¦\") ? \"opacity\" :\n      \"restore\";\n\n    if (action === \"restore\") {\n      const jsOrig = jsPath + JS_BAK_ORIG_EXT;\n      const productOrig = productJson + PRODUCT_BAK_ORIG;\n\n      if (fs.existsSync(jsOrig)) {\n        await fsp.copyFile(jsOrig, jsPath);\n        if (fs.existsSync(productOrig)) {\n          await fsp.copyFile(productOrig, productJson);\n        } else {\n          await updateProductChecksumKey(productJson, JS_REL_KEY, jsPath);\n        }\n        const closed = await askToQuit(\"âœ… å·²æ¢å¾©åˆ°åŸå§‹æª”ä¸¦åŒæ­¥æª¢æŸ¥ç¢¼ã€‚è¦è®“è®Šæ›´ç”Ÿæ•ˆï¼Œè«‹é—œé–‰ VS Codeã€‚\");\n        if (closed) return;\n      } else {\n        const txt = await fsp.readFile(jsPath, \"utf8\");\n        const stripped = stripOldJsInjection(txt);\n        if (stripped !== txt) {\n          await fsp.writeFile(jsPath, stripped, \"utf8\");\n          await updateProductChecksumKey(productJson, JS_REL_KEY, jsPath);\n          const closed2 = await askToQuit(\"â„¹ï¸ æœªæ‰¾åˆ° .origï¼Œå·²ç§»é™¤æ³¨å…¥ä¸¦åŒæ­¥æª¢æŸ¥ç¢¼ã€‚è¦è®“è®Šæ›´ç”Ÿæ•ˆï¼Œè«‹é—œé–‰ VS Codeã€‚\");\n          if (closed2) return;\n        } else {\n          await vscode.window.showWarningMessage(\"âš ï¸ æ²’æœ‰ .orig å‚™ä»½ï¼Œä¹Ÿæ‰¾ä¸åˆ°å¯ç§»é™¤çš„æ³¨å…¥æ¨™è¨˜ã€‚\");\n        }\n      }\n      return;\n    }\n\n    if (action === \"opacity\") {\n      const jsText = await fsp.readFile(jsPath, \"utf8\");\n      const found = findInjectedBlock(jsText);\n      const block = found?.block || null;\n      const current = block ? (readCurrentOpacityFromJsText(block) ?? 0.8) : 0.8;\n\n      const input = await vscode.window.showInputBox({\n        title: \"è¨­å®šèƒŒæ™¯é€æ˜åº¦ï¼ˆ0ï½1ï¼Œæ•¸å­—è¶Šå¤§â†’è¶Šæ·¡ï¼‰\",\n        value: String(current),\n        prompt: \"ä¾‹å¦‚ï¼š0.6 ä»£è¡¨æ¯”è¼ƒæ·¡ï¼ˆåœ–ç‰‡è¼ƒä¸æ˜é¡¯ï¼‰ã€‚\",\n        validateInput: (v) => {\n          const n = Number(v);\n          return isFinite(n) && n >= 0 && n <= 1 ? null : \"è«‹è¼¸å…¥ 0ï½1 çš„æ•¸å€¼\";\n        }\n      });\n      if (!input) return;\n\n      const val = Math.max(0, Math.min(1, Number(input)));\n      await updateOpacityOnly(productJson, jsPath, Number(val.toFixed(3)));\n\n      const closed = await askToQuit(\"âœ… å·²æ›´æ–°é€æ˜åº¦ä¸¦åŒæ­¥æª¢æŸ¥ç¢¼ã€‚è¦è®“è®Šæ›´ç”Ÿæ•ˆï¼Œè«‹é—œé–‰ VS Codeã€‚\");\n      if (closed) return;\n      return;\n    }\n\n    // === å¥—ç”¨èƒŒæ™¯åœ–ç‰‡ ===\n    await ensureCleanOriginalBackups(productJson, jsPath);\n\n    const picked = await vscode.window.showOpenDialog({\n      canSelectFiles: true, canSelectMany: false, openLabel: \"é¸æ“‡èƒŒæ™¯åœ–ç‰‡\",\n      filters: { Images: [\"png\", \"jpg\", \"jpeg\", \"gif\", \"webp\"] }\n    });\n    if (!picked || !picked.length) return;\n\n    const buf = await fsp.readFile(picked[0].fsPath);\n    const ext = path.extname(picked[0].fsPath).toLowerCase();\n    const mime =\n      ext === \".png\"  ? \"image/png\"  :\n      ext === \".jpg\" || ext === \".jpeg\" ? \"image/jpeg\" :\n      ext === \".gif\"  ? \"image/gif\"   :\n      ext === \".webp\" ? \"image/webp\"  :\n      \"application/octet-stream\";\n\n    const b64     = buf.toString(\"base64\");\n    const dataUrl = `data:${mime};base64,${b64}`;\n    const USE_BLOB = dataUrl.length > DATAURL_SAFE_LIMIT;\n\n    // è®€æ—¢æœ‰æ³¨å…¥ä¸­çš„é€æ˜åº¦ä½œç‚ºé è¨­å€¼ï¼ˆè‹¥æ²’æœ‰å‰‡ 0.8ï¼‰\n    const jsTextForDefault = await fsp.readFile(jsPath, \"utf8\").catch(() => \"\");\n    const existedBlock = findInjectedBlock(jsTextForDefault)?.block || null;\n    const defaultOpacity = existedBlock\n      ? (readCurrentOpacityFromJsText(existedBlock) ?? 0.8)\n      : 0.8;\n\n    // è©¢å•æ–°é€æ˜åº¦\n    const inputOpacity = await vscode.window.showInputBox({\n      title: \"è¨­å®šèƒŒæ™¯é€æ˜åº¦ï¼ˆ0ï½1ï¼Œæ•¸å­—è¶Šå¤§â†’è¶Šæ·¡ï¼‰\",\n      value: String(defaultOpacity),\n      prompt: \"ä¾‹å¦‚ï¼š0.6ï¼æ¯”è¼ƒæ·¡ï¼›0ï¼å®Œå…¨ä¸æ·¡åŒ–ï¼ˆåœ–ç‰‡æœ€æ¸…æ¥šï¼‰\",\n      validateInput: (v) => {\n        const n = Number(v);\n        return isFinite(n) && n >= 0 && n <= 1 ? null : \"è«‹è¼¸å…¥ 0ï½1 çš„æ•¸å€¼\";\n      }\n    });\n    if (!inputOpacity) return;\n\n    const opacity = Math.max(0, Math.min(1, Number(inputOpacity)));\n    const cssOpts = {\n      overlayOpacity: opacity,\n      overlayOpacityDark: opacity,\n      overlayOpacityLight: opacity\n    };\n\n    const orig = await fsp.readFile(jsPath, \"utf8\");\n    const injected = appendBeforeSourceMap(\n      stripOldJsInjection(orig),\n      USE_BLOB\n        ? makeInjectedIIFE_UsingBlob(mime, b64, cssOpts)\n        : makeInjectedIIFE(dataUrl, cssOpts)\n    );\n    await fsp.writeFile(jsPath, injected, \"utf8\");\n\n    const changed = await updateProductChecksumKey(productJson, JS_REL_KEY, jsPath);\n\n    const closed = await askToQuit(\n      `âœ… å·²å¥—ç”¨èƒŒæ™¯ï¼ˆ${USE_BLOB ? \"blob:URL\" : \"data:URL\"}ï¼Œé€æ˜åº¦=${opacity}ï¼‰${changed ? \"ä¸¦åŒæ­¥æª¢æŸ¥ç¢¼\" : \"\"}ã€‚è¦è®“è®Šæ›´ç”Ÿæ•ˆï¼Œè«‹é—œé–‰ VS Codeã€‚`\n    );\n    if (closed) return;\n\n  } catch (err) {\n    await vscode.window.showErrorMessage(\"âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š\" + (err?.message || err));\n  } finally {\n    vm.stop();\n  }\n})();\n",
    "tags": [
      "default",
      "ui"
    ]
  },
  {
    "command": "cmd.l09e0afws3",
    "text": "$(folder) æª”æ¡ˆç¸½ç®¡è§¸ç™¼å‹•ä½œ",
    "tooltip": "å››åŠŸèƒ½æœ€å°å¯ç”¨ç¯„ä¾‹ï¼ˆæ”¯æ´å¤šé¸ï¼‰",
    "hidden": false,
    "enableOnInit": false,
    "script": "// Explorer Menuï¼šå››åŠŸèƒ½æœ€å°å¯ç”¨ç¯„ä¾‹ï¼ˆæ”¯æ´å¤šé¸ï¼‰\n// - $(file) é¡¯ç¤ºé¸ä¸­çš„æª”æ¡ˆ/è³‡æ–™å¤¾\n// - $(clippy) è¤‡è£½è·¯å¾‘åˆ°å‰ªè²¼ç°¿\n// - $(terminal) åœ¨çµ‚ç«¯æ©Ÿé–‹å•Ÿæ‰€åœ¨è³‡æ–™å¤¾\n// - $(info) é¡¯ç¤ºæª”æ¡ˆ/è³‡æ–™å¤¾æ•¸é‡èˆ‡ç¸½å¤§å°ï¼ˆééè¿´ï¼‰\n//\n// ä½¿ç”¨ï¼šæª”æ¡ˆç¸½ç®¡å°æª”æ¡ˆ/è³‡æ–™å¤¾æŒ‰å³éµ â†’ ã€ŒStatus Bar Helper: è§¸ç™¼å‹•ä½œé¸å–®ã€\n// è‹±æ–‡ä»‹é¢æœƒé¡¯ç¤ºï¼šStatus Bar Helper: Trigger Action Menu\n\nconst vscode = require(\"vscode\");\n// ç”± Status Bar Helper æ³¨å…¥çš„å…¨åŸŸç‰©ä»¶\nconst { explorerAction } = sbh.v1;\n\n(async function main() {\n  // 1) é¡¯ç¤ºé¸ä¸­çš„æª”æ¡ˆ/è³‡æ–™å¤¾\n  await explorerAction.register({\n    description: '$(file) é¡¯ç¤ºé¸ä¸­çš„æª”æ¡ˆ',\n    handler: async ({ uri, uris }) => {\n      const targets = uris?.length ? uris : (uri ? [uri] : []);\n      if (!targets.length) return vscode.window.showWarningMessage('æ²’æœ‰é¸ä¸­ä»»ä½•æª”æ¡ˆ');\n      if (targets.length === 1) {\n        return vscode.window.showInformationMessage(`é¸ä¸­ï¼š${targets[0].fsPath}`);\n      }\n      const paths = targets.map(u => u.fsPath).join('\\n');\n      vscode.window.showInformationMessage(`é¸ä¸­äº† ${targets.length} å€‹é …ç›®ï¼š\\n${paths}`);\n    }\n  });\n\n  // 2) è¤‡è£½è·¯å¾‘åˆ°å‰ªè²¼ç°¿ï¼ˆæ”¯æ´å¤šé¸ï¼‰\n  await explorerAction.register({\n    description: '$(clippy) è¤‡è£½æª”æ¡ˆè·¯å¾‘',\n    handler: async ({ uri, uris }) => {\n      const targets = uris?.length ? uris : (uri ? [uri] : []);\n      if (!targets.length) return vscode.window.showWarningMessage('æ²’æœ‰é¸ä¸­ä»»ä½•æª”æ¡ˆ');\n      const text = targets.map(u => u.fsPath).join('\\n');\n      await vscode.env.clipboard.writeText(text);\n      vscode.window.showInformationMessage(`å·²è¤‡è£½ ${targets.length} å€‹è·¯å¾‘åˆ°å‰ªè²¼ç°¿`);\n    }\n  });\n\n  // 3) åœ¨çµ‚ç«¯æ©Ÿé–‹å•Ÿæ‰€åœ¨è³‡æ–™å¤¾\n  await explorerAction.register({\n    description: '$(terminal) åœ¨çµ‚ç«¯æ©Ÿé–‹å•Ÿ',\n    handler: async ({ uri }) => {\n      if (!uri) return vscode.window.showWarningMessage('è«‹é¸æ“‡ä¸€å€‹æª”æ¡ˆæˆ–è³‡æ–™å¤¾');\n      const fs = require('fs');\n      const path = require('path');\n      let cwd = uri.fsPath;\n      try {\n        const stat = fs.statSync(uri.fsPath);\n        if (!stat.isDirectory()) cwd = path.dirname(uri.fsPath);\n      } catch {}\n      const term = vscode.window.createTerminal('Explorer');\n      term.show();\n      term.sendText(`cd \"${cwd}\"`);\n      vscode.window.showInformationMessage(`å·²åœ¨çµ‚ç«¯æ©Ÿé–‹å•Ÿï¼š${cwd}`);\n    }\n  });\n\n  // 4) é¡¯ç¤ºæª”æ¡ˆè³‡è¨Šï¼ˆæ•¸é‡èˆ‡ç¸½å¤§å°ï¼Œééè¿´ï¼‰\n  await explorerAction.register({\n    description: '$(info) é¡¯ç¤ºæª”æ¡ˆè³‡è¨Š',\n    handler: async ({ uri, uris }) => {\n      const targets = uris?.length ? uris : (uri ? [uri] : []);\n      if (!targets.length) return vscode.window.showWarningMessage('æ²’æœ‰é¸ä¸­ä»»ä½•æª”æ¡ˆ');\n\n      const fs = require('fs');\n      let fileCount = 0, dirCount = 0, totalSize = 0;\n\n      for (const u of targets) {\n        try {\n          const s = fs.statSync(u.fsPath);\n          if (s.isDirectory()) dirCount++;\n          else { fileCount++; totalSize += s.size; }\n        } catch {}\n      }\n\n      const kb = (totalSize / 1024).toFixed(2);\n      const mb = (totalSize / 1024 / 1024).toFixed(2);\n      vscode.window.showInformationMessage(\n        `ğŸ“Š çµ±è¨ˆçµæœ\\n` +\n        `æª”æ¡ˆï¼š${fileCount} å€‹\\n` +\n        `è³‡æ–™å¤¾ï¼š${dirCount} å€‹\\n` +\n        `ç¸½å¤§å°ï¼š${kb} KBï¼ˆ${mb} MBï¼‰`\n      );\n    }\n  });\n\n  // å•Ÿç”¨å¾Œæç¤ºï¼šå‘Šè¨´ä½¿ç”¨è€…å»å“ªè£¡é»\n  vscode.window.showInformationMessage(\n    [\n      'âœ… å·²å•Ÿç”¨ Explorer å³éµé¸å–®ï¼ˆ4 å€‹å‹•ä½œï¼‰',\n      '',\n      'ä½¿ç”¨æ–¹å¼ï¼š',\n      '1) å·¦å´ã€Œæª”æ¡ˆç¸½ç®¡ã€â†’ é¸æ“‡æª”æ¡ˆ/è³‡æ–™å¤¾ï¼ˆå¯å¤šé¸ï¼‰',\n      `2) å³éµ â†’ ã€ŒStatus Bar Helper: è§¸ç™¼å‹•ä½œé¸å–®ã€`,\n      '3) é¸æ“‡è¦åŸ·è¡Œçš„å‹•ä½œ'\n    ].join('\\n')\n  );\n})();\n",
    "tags": [
      "example",
      "explorer"
    ]
  },
  {
    "command": "cmd.s6guks0cbc",
    "text": "$(edit-session) Excel To Markdown",
    "tooltip": "è¼•é¬†å°‡å¾ Excel è¤‡è£½çš„è¡¨æ ¼è³‡æ–™ï¼Œå³æ™‚è½‰æ›ç‚ºçµæ§‹å®Œç¾çš„ Markdown è¡¨æ ¼ã€‚",
    "hidden": false,
    "enableOnInit": false,
    "script": "// ==UserScript==\n// @name Excel è½‰ Markdown è¡¨æ ¼è½‰æ›å™¨\n// @description è²¼ä¸Šå¾ Excel è¤‡è£½çš„è³‡æ–™ï¼Œä¸¦å³æ™‚å°‡å…¶è½‰æ›ç‚º Markdown è¡¨æ ¼ã€‚\n// ==/UserScript==\n\nconst vscode = require(\"vscode\");\nconst { vm } = statusBarHelper.v1;\n\n(function main() {\n  // ä½¿ç”¨ä¸€å€‹è®Šæ•¸ä¾†ä¿å­˜ panel å¯¦ä¾‹ï¼Œé¿å…é‡è¤‡å‰µå»º\n  let panel;\n\n  // è¨»å†Šä¸€å€‹æ¸…ç†å‡½å¼ï¼Œç•¶ VM åœæ­¢æ™‚ï¼Œè‡ªå‹•é—œé–‰ Webview Panel\n  vm.onStop(() => {\n    if (panel) {\n      panel.dispose();\n    }\n  });\n\n  // å‰µå»ºæˆ–é¡¯ç¤º Webview Panel\n  function createOrShowPanel() {\n    // å¦‚æœ panel å·²å­˜åœ¨ï¼Œå‰‡ç›´æ¥é¡¯ç¤ºå®ƒï¼Œè€Œä¸æ˜¯å‰µå»ºæ–°çš„\n    if (panel) {\n      panel.reveal(vscode.ViewColumn.Active);\n      return;\n    }\n\n    panel = vscode.window.createWebviewPanel(\n      \"excelToMarkdownConverter\", // æ¨™è­˜ç¬¦ï¼Œå…§éƒ¨ä½¿ç”¨\n      \"Excel è½‰ Markdown\", // é¡¯ç¤ºåœ¨åˆ†é æ¨™ç±¤ä¸Šçš„æ¨™é¡Œ\n      vscode.ViewColumn.Active, // åœ¨æ´»å‹•çš„åˆ†æ¬„ä¸­é¡¯ç¤º\n      {\n        enableScripts: true, // å•Ÿç”¨ JavaScript\n        retainContextWhenHidden: true, // åœ¨åˆ†é è¢«éš±è—æ™‚ä¿ç•™ç‹€æ…‹\n      }\n    );\n\n    // ç”¢ç”Ÿä¸¦è¨­å®š Webview çš„ HTML å…§å®¹\n    const nonce = Math.random().toString(36).slice(2);\n    panel.webview.html = getWebviewHtml(nonce);\n\n    // è™•ç†å¾ Webview å‚³ä¾†çš„è¨Šæ¯\n    panel.webview.onDidReceiveMessage(\n      (message) => {\n        switch (message.command) {\n          case \"copySuccess\":\n            vscode.window.showInformationMessage(\"Markdown å·²æˆåŠŸè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\");\n            return;\n        }\n      },\n      undefined\n    );\n\n    // è¨­å®šç•¶ panel è¢«ä½¿ç”¨è€…é—œé–‰æ™‚çš„è¡Œç‚º\n    panel.onDidDispose(\n      () => {\n        panel = undefined; // æ¸…ç† panel åƒè€ƒ\n        try {\n          vm.stop(); // åœæ­¢ VMï¼Œé‡‹æ”¾è³‡æº\n        } catch (e) {\n          console.error(\"Failed to stop VM:\", e);\n        }\n      },\n      null\n    );\n  }\n\n  // ç«‹å³åŸ·è¡Œï¼Œæ‰“é–‹ Panel\n  createOrShowPanel();\n})();\n\n/**\n * ç”¢ç”Ÿ Webview çš„å®Œæ•´ HTML å…§å®¹\n * @param {string} nonce - ç”¨æ–¼ CSP çš„éš¨æ©Ÿæ•¸\n * @returns {string} HTML å­—ä¸²\n */\nfunction getWebviewHtml(nonce) {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"zh-TW\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"Content-Security-Policy\" \n              content=\"default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n        <title>Excel è½‰ Markdown</title>\n        <style>\n            :root {\n                --input-bg: rgba(128, 128, 128, 0.1);\n                --border-color: rgba(128, 128, 128, 0.3);\n                --button-bg: #007acc;\n                --button-hover-bg: #005f9e;\n                --button-secondary-bg: #5c5c5c;\n                --button-secondary-hover-bg: #444444;\n            }\n            body {\n                font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n                margin: 0;\n                padding: 1rem;\n                display: flex;\n                flex-direction: column;\n                height: 100vh;\n                box-sizing: border-box;\n                color: var(--vscode-editor-foreground);\n                background-color: var(--vscode-editor-background);\n            }\n            .container {\n                display: flex;\n                gap: 1rem;\n                flex-grow: 1;\n            }\n            .panel {\n                display: flex;\n                flex-direction: column;\n                width: 50%;\n                gap: 0.5rem;\n            }\n            h3 {\n                margin: 0 0 0.5rem 0;\n                font-weight: 600;\n            }\n            textarea {\n                width: 100%;\n                flex-grow: 1;\n                border: 1px solid var(--border-color);\n                border-radius: 4px;\n                padding: 0.5rem;\n                box-sizing: border-box;\n                font-family: \"Consolas\", \"Courier New\", monospace;\n                font-size: 14px;\n                background-color: var(--input-bg);\n                color: var(--vscode-editor-foreground);\n                resize: none;\n            }\n            .button-group {\n                display: flex;\n                gap: 0.5rem;\n                justify-content: flex-end;\n            }\n            button {\n                border: none;\n                padding: 8px 14px;\n                border-radius: 4px;\n                cursor: pointer;\n                color: white;\n                font-size: 14px;\n            }\n            #clearBtn {\n                background-color: var(--button-secondary-bg);\n            }\n            #clearBtn:hover {\n                background-color: var(--button-secondary-hover-bg);\n            }\n            #copyBtn {\n                background-color: var(--button-bg);\n            }\n            #copyBtn:hover {\n                background-color: var(--button-hover-bg);\n            }\n            .quick-start {\n                margin-top: 1.5rem;\n                padding: 1rem;\n                border: 1px solid var(--border-color);\n                border-radius: 4px;\n                background-color: var(--input-bg);\n            }\n            .quick-start h4 {\n                margin-top: 0;\n            }\n            .quick-start ul {\n                padding-left: 20px;\n                margin: 0;\n            }\n        </style>\n    </head>\n    <body>\n\n        <div class=\"container\">\n            <div class=\"panel\">\n                <h3>Excel è³‡æ–™è¼¸å…¥</h3>\n                <textarea id=\"excelInput\" placeholder=\"1. å¾ Excel è¤‡è£½å„²å­˜æ ¼ (Ctrl+C)\\n2. åœ¨é€™è£¡è²¼ä¸Š (Ctrl+V)\"></textarea>\n                <div class=\"button-group\">\n                    <button id=\"clearBtn\">å…¨éƒ¨æ¸…é™¤</button>\n                </div>\n            </div>\n            <div class=\"panel\">\n                <h3>Markdown è¼¸å‡º</h3>\n                <textarea id=\"markdownOutput\" readonly></textarea>\n                <div class=\"button-group\">\n                    <button id=\"copyBtn\">è¤‡è£½ Markdown</button>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"quick-start\">\n            <h4>ğŸš€ å¿«é€Ÿå…¥é–€æŒ‡å—</h4>\n            <ul>\n                <li>å¾ Excel é¸å–ä¸¦è¤‡è£½ä¸€å€‹è¡¨æ ¼ (Ctrl+C)</li>\n                <li>é»æ“Šä¸Šæ–¹çš„æ–‡å­—è¼¸å…¥å€</li>\n                <li>è²¼ä¸Šè³‡æ–™ (Ctrl+V)</li>\n                <li>æª¢è¦–è½‰æ›å¾Œçš„ Markdown è¡¨æ ¼</li>\n            </ul>\n        </div>\n        \n        <script nonce=\"${nonce}\">\n            const vscode = acquireVsCodeApi();\n\n            const excelInput = document.getElementById('excelInput');\n            const markdownOutput = document.getElementById('markdownOutput');\n            const clearBtn = document.getElementById('clearBtn');\n            const copyBtn = document.getElementById('copyBtn');\n\n            function convertToMarkdown(text) {\n                if (!text.trim()) {\n                    return \"\";\n                }\n\n                // å°‡ TSV (Tab-separated values) æ ¼å¼çš„æ–‡å­—è½‰æ›ç‚ºäºŒç¶­é™£åˆ—\n                const rows = text.trim().split('\\\\n').map(row => row.split('\\\\t'));\n                if (rows.length === 0) {\n                    return \"\";\n                }\n\n                const header = rows[0];\n                const separator = header.map(() => '---').join(' | ');\n                \n                const formatRow = (row) => '| ' + row.join(' | ') + ' |';\n\n                const markdownRows = [\n                    formatRow(header),\n                    '| ' + separator + ' |',\n                    ...rows.slice(1).map(formatRow)\n                ];\n\n                return markdownRows.join('\\\\n');\n            }\n\n            excelInput.addEventListener('input', () => {\n                const markdown = convertToMarkdown(excelInput.value);\n                markdownOutput.value = markdown;\n            });\n\n            clearBtn.addEventListener('click', () => {\n                excelInput.value = '';\n                markdownOutput.value = '';\n            });\n\n            copyBtn.addEventListener('click', () => {\n                if (markdownOutput.value) {\n                    navigator.clipboard.writeText(markdownOutput.value).then(() => {\n                        vscode.postMessage({ command: 'copySuccess' });\n                    }).catch(err => {\n                        console.error('è¤‡è£½å¤±æ•—: ', err);\n                    });\n                }\n            });\n\n        </script>\n    </body>\n    </html>\n  `;\n}",
    "tags": [
      "tool"
    ]
  },
  {
    "command": "cmd.x58v15xre3",
    "text": "$(arrow-swap) å‰ç«¯è³‡æ–™è½‰æ›å·¥å…·çµ„",
    "tooltip": "ä¸€å€‹è¼•é‡ã€é«˜æ•ˆçš„å·¥å…·ï¼Œæ•´åˆäº†æ™‚é–“æˆ³ã€Base64ã€URL å’Œ JWT çš„å¸¸ç”¨è½‰æ›èˆ‡è§£ç¢¼åŠŸèƒ½",
    "hidden": false,
    "enableOnInit": false,
    "script": "// ==UserScript==\n// @name å‰ç«¯è³‡æ–™è½‰æ›å·¥å…·çµ„\n// @description ä¸€å€‹è¼•é‡ã€é«˜æ•ˆçš„å·¥å…·ï¼Œæ•´åˆäº†æ™‚é–“æˆ³ã€Base64ã€URL å’Œ JWT çš„å¸¸ç”¨è½‰æ›èˆ‡è§£ç¢¼åŠŸèƒ½ã€‚\n// ==/UserScript==\n\nconst vscode = require(\"vscode\");\nconst { vm } = statusBarHelper.v1;\n\n(function main() {\n  let panel;\n\n  vm.onStop(() => {\n    if (panel) {\n      panel.dispose();\n    }\n  });\n\n  function createOrShowPanel() {\n    if (panel) {\n      panel.reveal(vscode.ViewColumn.Active);\n      return;\n    }\n\n    panel = vscode.window.createWebviewPanel(\n      \"frontendDataToolkit\",\n      \"å‰ç«¯è³‡æ–™è½‰æ›å·¥å…·çµ„\",\n      vscode.ViewColumn.Active,\n      {\n        enableScripts: true,\n        retainContextWhenHidden: true,\n      }\n    );\n\n    const nonce = Math.random().toString(36).slice(2);\n    panel.webview.html = getWebviewHtml(nonce);\n\n    panel.onDidDispose(\n      () => {\n        panel = undefined;\n        try {\n          vm.stop();\n        } catch (e) {\n          console.error(\"Failed to stop VM:\", e);\n        }\n      },\n      null\n    );\n  }\n\n  createOrShowPanel();\n})();\n\n/**\n * ç”¢ç”Ÿ Webview çš„å®Œæ•´ HTML å…§å®¹\n * @param {string} nonce - ç”¨æ–¼ CSP çš„éš¨æ©Ÿæ•¸\n * @returns {string} HTML å­—ä¸²\n */\nfunction getWebviewHtml(nonce) {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"zh-TW\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"Content-Security-Policy\" \n              content=\"default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n        <title>å‰ç«¯è³‡æ–™è½‰æ›å·¥å…·çµ„</title>\n        <style>\n            :root {\n                --input-bg: rgba(128, 128, 128, 0.1);\n                --border-color: rgba(128, 128, 128, 0.3);\n                --tab-active-border: var(--vscode-tab-activeBorder, #007acc);\n                --tab-inactive-fg: var(--vscode-tab-inactiveForeground, #888);\n            }\n            body {\n                font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n                margin: 0;\n                padding: 0;\n                display: flex;\n                flex-direction: column;\n                height: 100vh;\n                color: var(--vscode-editor-foreground);\n                background-color: var(--vscode-editor-background);\n            }\n            .tabs {\n                display: flex;\n                border-bottom: 1px solid var(--border-color);\n                padding: 0 1rem;\n            }\n            .tab-button {\n                padding: 10px 15px;\n                cursor: pointer;\n                border: none;\n                background: none;\n                font-size: 14px;\n                color: var(--tab-inactive-fg);\n                border-bottom: 2px solid transparent;\n            }\n            .tab-button.active {\n                color: var(--vscode-tab-activeForeground);\n                border-bottom-color: var(--tab-active-border);\n            }\n            .tab-content {\n                display: none;\n                padding: 1rem;\n                flex-grow: 1;\n                flex-direction: column;\n                gap: 1rem;\n            }\n            .tab-content.active {\n                display: flex;\n            }\n            .converter-grid {\n                display: grid;\n                grid-template-columns: 1fr auto 1fr;\n                gap: 1rem;\n                align-items: center;\n                flex-grow: 1;\n                height: 100%;\n            }\n            .io-panel {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                gap: 0.5rem;\n            }\n            h4 { margin: 0; font-weight: 600; }\n            textarea, input[type=\"text\"] {\n                width: 100%;\n                border: 1px solid var(--border-color);\n                border-radius: 4px;\n                padding: 0.5rem;\n                box-sizing: border-box;\n                font-family: \"Consolas\", \"Courier New\", monospace;\n                font-size: 14px;\n                background-color: var(--input-bg);\n                color: var(--vscode-editor-foreground);\n            }\n            textarea {\n                flex-grow: 1;\n                resize: none;\n            }\n            .arrow { font-size: 24px; text-align: center; }\n            .jwt-output { \n                white-space: pre-wrap; \n                background-color: var(--input-bg); \n                padding: 10px; \n                border-radius: 4px; \n                overflow-x: auto; \n                flex-grow: 1;\n                font-family: \"Consolas\", \"Courier New\", monospace;\n                font-size: 14px;\n            }\n        </style>\n    </head>\n    <body>\n        <div class=\"tabs\">\n            <button class=\"tab-button active\" data-tab=\"timestamp\">æ™‚é–“æˆ³</button>\n            <button class=\"tab-button\" data-tab=\"base64\">Base64</button>\n            <button class=\"tab-button\" data-tab=\"url\">URL</button>\n            <button class=\"tab-button\" data-tab=\"jwt\">JWT è§£ç¢¼</button>\n        </div>\n\n        <div id=\"timestamp\" class=\"tab-content active\">\n             <div class=\"converter-grid\">\n                <div class=\"io-panel\">\n                    <h4>Unix æ™‚é–“æˆ³ (ç§’/æ¯«ç§’)</h4>\n                    <input type=\"text\" id=\"timestamp-input\">\n                </div>\n                <div class=\"arrow\">â†”</div>\n                <div class=\"io-panel\">\n                    <h4>æœ¬åœ°æ™‚é–“ (YYYY-MM-DD HH:mm:ss)</h4>\n                    <input type=\"text\" id=\"datetime-input\">\n                </div>\n            </div>\n        </div>\n\n        <div id=\"base64\" class=\"tab-content\">\n            <div class=\"converter-grid\">\n                <div class=\"io-panel\">\n                    <h4>åŸå§‹å­—ä¸² (UTF-8)</h4>\n                    <textarea id=\"base64-decode-input\"></textarea>\n                </div>\n                <div class=\"arrow\">â†”</div>\n                <div class=\"io-panel\">\n                    <h4>Base64 ç·¨ç¢¼</h4>\n                    <textarea id=\"base64-encode-input\"></textarea>\n                </div>\n            </div>\n        </div>\n        \n        <div id=\"url\" class=\"tab-content\">\n           <div class=\"converter-grid\">\n                <div class=\"io-panel\">\n                    <h4>åŸå§‹å­—ä¸²</h4>\n                    <textarea id=\"url-decode-input\"></textarea>\n                </div>\n                <div class=\"arrow\">â†”</div>\n                <div class=\"io-panel\">\n                    <h4>URL ç·¨ç¢¼ (Component)</h4>\n                    <textarea id=\"url-encode-input\"></textarea>\n                </div>\n            </div>\n        </div>\n\n        <div id=\"jwt\" class=\"tab-content\">\n            <div class=\"io-panel\" style=\"width:100%; height: 40%;\">\n                <h4>JWT Token</h4>\n                <textarea id=\"jwt-input\"></textarea>\n            </div>\n            <div class=\"io-panel\" style=\"width:100%; height: 60%;\">\n                <h4>Header</h4>\n                <div id=\"jwt-header\" class=\"jwt-output\"></div>\n                <h4>Payload</h4>\n                <div id=\"jwt-payload\" class=\"jwt-output\"></div>\n            </div>\n        </div>\n\n        <script nonce=\"${nonce}\">\n            const tabs = document.querySelectorAll('.tab-button');\n            const contents = document.querySelectorAll('.tab-content');\n            \n            function openTab(tabName) {\n                tabs.forEach(tab => tab.classList.remove('active'));\n                contents.forEach(content => content.classList.remove('active'));\n                document.querySelector(\\`button[data-tab=\"\\${tabName}\"]\\`).classList.add('active');\n                document.getElementById(tabName).classList.add('active');\n            }\n\n            function convert(type) {\n                try {\n                    switch (type) {\n                        case 'timestamp': {\n                            const tsInput = document.getElementById('timestamp-input');\n                            const dtInput = document.getElementById('datetime-input');\n                            const val = tsInput.value.trim();\n                            if (!val || !/^\\\\d+$/.test(val)) {\n                                dtInput.value = ''; return;\n                            }\n                            const ts = parseInt(val, 10);\n                            const date = new Date(val.length === 10 ? ts * 1000 : ts);\n                            if (isNaN(date.getTime())) {\n                                dtInput.value = ''; return;\n                            }\n                            const pad = (n) => n.toString().padStart(2, '0');\n                            dtInput.value = \\`\\${date.getFullYear()}-\\${pad(date.getMonth() + 1)}-\\${pad(date.getDate())} \\${pad(date.getHours())}:\\${pad(date.getMinutes())}:\\${pad(date.getSeconds())}\\`;\n                            break;\n                        }\n                        case 'datetime': {\n                            const tsInput = document.getElementById('timestamp-input');\n                            const dtInput = document.getElementById('datetime-input');\n                            const val = dtInput.value.trim();\n                            const date = new Date(val);\n                            if (!val || isNaN(date.getTime())) {\n                                tsInput.value = ''; return;\n                            }\n                            tsInput.value = Math.floor(date.getTime() / 1000);\n                            break;\n                        }\n                        case 'base64-decode': {\n                            const rawInput = document.getElementById('base64-decode-input');\n                            const b64Input = document.getElementById('base64-encode-input');\n                            b64Input.value = btoa(unescape(encodeURIComponent(rawInput.value)));\n                            break;\n                        }\n                        case 'base64-encode': {\n                            const rawInput = document.getElementById('base64-decode-input');\n                            const b64Input = document.getElementById('base64-encode-input');\n                            rawInput.value = decodeURIComponent(escape(atob(b64Input.value)));\n                            break;\n                        }\n                        case 'url-decode': {\n                            const rawInput = document.getElementById('url-decode-input');\n                            const urlInput = document.getElementById('url-encode-input');\n                            urlInput.value = encodeURIComponent(rawInput.value);\n                            break;\n                        }\n                        case 'url-encode': {\n                            const rawInput = document.getElementById('url-decode-input');\n                            const urlInput = document.getElementById('url-encode-input');\n                            rawInput.value = decodeURIComponent(urlInput.value);\n                            break;\n                        }\n                        case 'jwt': {\n                            const jwtInput = document.getElementById('jwt-input');\n                            const headerOut = document.getElementById('jwt-header');\n                            const payloadOut = document.getElementById('jwt-payload');\n                            const token = jwtInput.value.trim();\n                            if (!token || token.split('.').length < 2) {\n                                headerOut.textContent = ''; payloadOut.textContent = ''; return;\n                            }\n                            const [header, payload] = token.split('.');\n                            const decodedHeader = JSON.stringify(JSON.parse(atob(header.replace(/-/g, '+').replace(/_/g, '/'))), null, 2);\n                            const decodedPayload = JSON.stringify(JSON.parse(atob(payload.replace(/-/g, '+').replace(/_/g, '/'))), null, 2);\n                            headerOut.textContent = decodedHeader;\n                            payloadOut.textContent = decodedPayload;\n                            break;\n                        }\n                    }\n                } catch (e) {\n                    console.error('Conversion Error:', e);\n                }\n            }\n\n            // --- ä¿®æ­£éƒ¨åˆ†ï¼šä½¿ç”¨ addEventListener è¨»å†Šäº‹ä»¶ ---\n            \n            // è¨»å†Š Tab åˆ‡æ›äº‹ä»¶\n            tabs.forEach(tab => {\n                tab.addEventListener('click', () => {\n                    openTab(tab.dataset.tab);\n                });\n            });\n\n            // è¨»å†Šæ‰€æœ‰è¼¸å…¥æ¡†çš„å³æ™‚è½‰æ›äº‹ä»¶\n            document.getElementById('timestamp-input').addEventListener('input', () => convert('timestamp'));\n            document.getElementById('datetime-input').addEventListener('input', () => convert('datetime'));\n            document.getElementById('base64-decode-input').addEventListener('input', () => convert('base64-decode'));\n            document.getElementById('base64-encode-input').addEventListener('input', () => convert('base64-encode'));\n            document.getElementById('url-decode-input').addEventListener('input', () => convert('url-decode'));\n            document.getElementById('url-encode-input').addEventListener('input', () => convert('url-encode'));\n            document.getElementById('jwt-input').addEventListener('input', () => convert('jwt'));\n\n        </script>\n    </body>\n    </html>\n  `;\n}",
    "tags": [
      "tool"
    ]
  },
  {
    "text": "$(game) é‹¼ç´",
    "tooltip": "è¿·ä½ é‹¼ç´",
    "command": "cmd.mdxh39ya48",
    "script": "const vscode = require(\"vscode\");\nconst { vm } = statusBarHelper.v1;\n\n(function main() {\n  let panel;\n\n  vm.onStop(() => {\n    try {\n      panel?.dispose();\n    } catch (e) {\n      console.error(\"Error disposing panel on VM stop:\", e);\n    }\n  });\n\n  panel = vscode.window.createWebviewPanel(\n    \"sbhPianoVirtuoso\",\n    \"è¿·ä½ é‹¼ç´ (æ¼”å¥å®¶ç‰ˆ)\",\n    vscode.ViewColumn.One,\n    {\n      enableScripts: true,\n      retainContextWhenHidden: true,\n    }\n  );\n\n  panel.onDidDispose(() => {\n    try {\n      vm.stop();\n    } catch (e) {\n      console.error(\"Error stopping VM on panel dispose:\", e);\n    }\n  });\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getWebviewHtml(nonce);\n  \n})();\n\n/**\n * ç”¢ç”Ÿ Webview çš„ HTML å…§å®¹ï¼ŒåŒ…å« 100 é¦–çµ‚æ¥µå®Œæ•´æ¨‚è­œå’Œå„ªåŒ– UI\n * @param {string} nonce - ç”¨æ–¼ CSP çš„éš¨æ©Ÿæ•¸\n * @returns {string} HTML å­—ä¸²\n */\nfunction getWebviewHtml(nonce) {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"zh-Hant\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"Content-Security-Policy\" \n              content=\"default-src 'none'; \n                       style-src 'unsafe-inline'; \n                       script-src 'nonce-${nonce}';\">\n        <title>è¿·ä½ é‹¼ç´ (æ¼”å¥å®¶ç‰ˆ)</title>\n        <style>\n            :root {\n                --primary-color: #3498db;\n                --success-color: #2ecc71;\n                --error-color: #e74c3c;\n                --bg-color: #2c3e50;\n                --surface-color: #34495e;\n                --text-color: #ecf0f1;\n            }\n            body {\n                display: flex; flex-direction: column; justify-content: center; align-items: center;\n                height: 100vh; background-color: var(--bg-color); margin: 0;\n                overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                color: var(--text-color);\n            }\n            .controls {\n                display: flex; flex-direction: column; align-items: center;\n                gap: 15px; margin-bottom: 20px; padding: 15px;\n                background: var(--surface-color); border-radius: 12px;\n                width: 600px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);\n            }\n            .control-group { display: flex; align-items: center; gap: 10px; }\n            select, button {\n                padding: 8px 12px; border-radius: 6px; border: 1px solid #7f8c8d;\n                background-color: #5d6d7e; color: var(--text-color); cursor: pointer;\n                transition: background-color 0.2s;\n            }\n            select:hover, button:hover { background-color: #718093; }\n            button { font-weight: bold; }\n            .mode-switch label { margin-right: 5px; cursor: pointer; padding: 5px 10px; border-radius: 6px; }\n            input[type=\"radio\"] { display: none; }\n            input[type=\"radio\"]:checked + label { background-color: var(--primary-color); }\n\n            #sheet-music-area { width: 100%; text-align: center; }\n            #score-display {\n                display: flex; flex-wrap: wrap; justify-content: center; align-items: center;\n                gap: 5px; min-height: 60px; max-height: 150px; overflow-y: auto;\n                background: #2c3a47; padding: 10px; border-radius: 8px; margin-top: 10px;\n            }\n            .note {\n                display: inline-flex; justify-content: center; align-items: center;\n                width: 28px; height: 28px; border: 2px solid #555;\n                background-color: #666; border-radius: 5px; font-weight: bold;\n                transition: all 0.2s ease;\n                font-size: 14px; /* Optimized font size for score */\n            }\n            .note.pause { background: none; border: none; width: 15px; }\n            .note.current { border-color: var(--primary-color); transform: scale(1.15); box-shadow: 0 0 10px var(--primary-color); }\n            .note.correct { background-color: var(--success-color); border-color: #27ae60; }\n            .note.incorrect { animation: shake 0.3s; background-color: var(--error-color); }\n            @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }\n            .completion-message { font-size: 1.2em; font-weight: bold; color: var(--success-color); }\n\n            .piano { display: flex; position: relative; border: 2px solid #111; border-radius: 10px; padding: 10px; background: #222; box-shadow: 0 0 20px rgba(0,0,0,0.5); }\n            .key { cursor: pointer; user-select: none; transition: background-color 0.1s ease; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 10px; }\n            .key-label {\n                font-size: 14px; /* Refined font size for key labels */\n                font-weight: bold;\n            }\n            .key.white { width: 60px; height: 240px; background-color: #f7f7f7; border: 1px solid #000; border-radius: 0 0 5px 5px; }\n            .key.white .key-label { color: #555; } /* Softer color */\n            .key.white.active { background-color: #ccc; }\n            .key.black { width: 38px; height: 140px; background-color: #222; border: 1px solid #000; border-radius: 0 0 4px 4px; position: absolute; z-index: 2; }\n            .key.black .key-label { color: #ccc; } /* Softer color */\n            .key.black.active { background-color: #444; }\n            .key[data-key=\"W\"] { left: 49px; } .key[data-key=\"E\"] { left: 111px; }\n            .key[data-key=\"T\"] { left: 235px; } .key[data-key=\"Y\"] { left: 297px; }\n            .key[data-key=\"U\"] { left: 359px; }\n        </style>\n    </head>\n    <body>\n        <div class=\"controls\">\n            <div class=\"control-group mode-switch\">\n                <input type=\"radio\" id=\"mode-freestyle\" name=\"mode\" value=\"freestyle\" checked>\n                <label for=\"mode-freestyle\">ğŸ¹ è‡ªç”±ç™¼æ®</label>\n                <input type=\"radio\" id=\"mode-sheet\" name=\"mode\" value=\"sheet\">\n                <label for=\"mode-sheet\">ğŸ¼ æ¨‚è­œæŒ‘æˆ°</label>\n            </div>\n            <div id=\"sheet-music-area\" style=\"display: none;\">\n                <div class=\"control-group\">\n                    <select id=\"song-selector\"><option value=\"-1\">-- é¸æ“‡æ­Œæ›² (100é¦–æ¼”å¥å®¶ç‰ˆ) --</option></select>\n                    <button id=\"restart-btn\">ğŸ” é‡ä¾†</button>\n                </div>\n                <div id=\"score-display\"></div>\n            </div>\n        </div>\n        <div class=\"piano-container\">\n            <div class=\"piano\">\n                <div class=\"key white\" data-key=\"A\" data-note=\"C4\"><span class=\"key-label\">A</span></div>\n                <div class=\"key white\" data-key=\"S\" data-note=\"D4\"><span class=\"key-label\">S</span></div>\n                <div class=\"key white\" data-key=\"D\" data-note=\"E4\"><span class=\"key-label\">D</span></div>\n                <div class=\"key white\" data-key=\"F\" data-note=\"F4\"><span class=\"key-label\">F</span></div>\n                <div class=\"key white\" data-key=\"G\" data-note=\"G4\"><span class=\"key-label\">G</span></div>\n                <div class=\"key white\" data-key=\"H\" data-note=\"A4\"><span class=\"key-label\">H</span></div>\n                <div class=\"key white\" data-key=\"J\" data-note=\"B4\"><span class=\"key-label\">J</span></div>\n                <div class=\"key black\" data-key=\"W\" data-note=\"C#4\"><span class=\"key-label\">W</span></div>\n                <div class=\"key black\" data-key=\"E\" data-note=\"D#4\"><span class=\"key-label\">E</span></div>\n                <div class=\"key black\" data-key=\"T\" data-note=\"F#4\"><span class=\"key-label\">T</span></div>\n                <div class=\"key black\" data-key=\"Y\" data-note=\"G#4\"><span class=\"key-label\">Y</span></div>\n                <div class=\"key black\" data-key=\"U\" data-note=\"A#4\"><span class=\"key-label\">U</span></div>\n            </div>\n        </div>\n        <script nonce=\"${nonce}\">\n            const keys = document.querySelectorAll('.key');\n            const keyMap = {};\n            keys.forEach(k => { keyMap[k.dataset.key] = k; });\n            const sheetMusicArea = document.getElementById('sheet-music-area');\n            const songSelector = document.getElementById('song-selector');\n            const restartBtn = document.getElementById('restart-btn');\n            const scoreDisplay = document.getElementById('score-display');\n            let currentMode = 'freestyle';\n            let currentSong = null;\n            let currentNoteIndex = 0;\n            // 100 Songs, Virtuoso Edition. All syntax errors have been meticulously corrected.\n            const songs = [\n                { name: \"ç‘ªè‰æœ‰éš»å°ç¶¿ç¾Š\", score: ['D', 'S', 'A', 'S', ' ', 'D', 'D', 'D', ' ', 'S', 'S', 'S', ' ', 'D', 'G', 'G', ' ', 'D', 'S', 'A', 'S', ' ', 'D', 'D', 'D', ' ', 'D', 'S', 'S', 'D', 'S', 'A', ' ', 'D', 'S', 'A', 'S', ' ', 'D', 'D', 'D', ' ', 'S', 'S', 'S', ' ', 'D', 'G', 'G', ' ', 'D', 'S', 'A', 'S', ' ', 'D', 'D', 'D', ' ', 'D', 'S', 'S', 'D', 'S', 'A'] },\n                { name: \"å°æ˜Ÿæ˜Ÿ\", score: ['A', 'A', 'G', 'G', 'H', 'H', 'G', ' ', 'F', 'F', 'D', 'D', 'S', 'S', 'A', ' ', 'G', 'G', 'F', 'F', 'D', 'D', 'S', ' ', 'G', 'G', 'F', 'F', 'D', 'D', 'S', ' ', 'A', 'A', 'G', 'G', 'H', 'H', 'G', ' ', 'F', 'F', 'D', 'D', 'S', 'S', 'A'] },\n                { name: \"Jingle Bells\", score: ['D', 'D', 'D', ' ', 'D', 'D', 'D', ' ', 'D', 'G', 'A', 'S', 'D', ' ', 'F', 'F', 'F', 'F', 'F', 'D', 'D', 'D', 'S', 'S', 'D', 'S', 'G', ' ', 'D', 'D', 'D', ' ', 'D', 'D', 'D', ' ', 'D', 'G', 'A', 'S', 'D', ' ', 'F', 'F', 'F', 'F', 'F', 'D', 'D', 'D', 'H', 'H', 'G', 'F', 'D', 'A'] },\n                { name: \"Happy Birthday\", score: ['A', 'A', 'S', 'A', 'F', 'D', ' ', 'A', 'A', 'S', 'A', 'G', 'F', ' ', 'A', 'A', 'H', 'F', 'D', 'S', 'A', ' ', 'J', 'J', 'H', 'F', 'G', 'F'] },\n                { name: \"å¿«æ¨‚é Œ\", score: ['D', 'D', 'F', 'G', 'G', 'F', 'D', 'S', 'A', 'A', 'S', 'D', 'D', 'S', 'S', ' ', 'D', 'D', 'F', 'G', 'G', 'F', 'D', 'S', 'A', 'A', 'S', 'D', 'S', 'A', 'A'] },\n                { name: \"åˆ’èˆ¹æ­Œ\", score: ['A', 'A', 'A', 'S', 'D', ' ', 'D', 'S', 'D', 'F', 'G', ' ', 'A', 'W', 'A', 'W', 'A', 'W', 'A', 'W', 'A', 'W', 'A', 'W', ' ', 'G', 'G', 'G', ' ', 'D', 'D', 'D', ' ', 'A', 'A', 'A', ' ', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"å€«æ•¦éµæ©‹\", score: ['G', 'H', 'G', 'F', ' ', 'D', 'F', 'G', ' ', 'S', 'D', 'F', ' ', 'D', 'F', 'G', ' ', 'G', 'H', 'G', 'F', ' ', 'D', 'F', 'G', ' ', 'A', 'D', 'G', ' ', 'A', 'D', 'G'] },\n                { name: \"å°å°èœ˜è››\", score: ['A', 'A', 'A', 'S', 'D', 'D', 'S', 'A', 'S', 'A', ' ', 'D', 'D', 'D', 'F', 'G', 'G', 'F', 'D', 'F', 'D', ' ', 'A', 'A', 'A', 'S', 'D', 'D', 'S', 'A', 'S', 'A'] },\n                { name: \"ç‹è€å…ˆç”Ÿæœ‰å¡Šåœ°\", score: ['G', 'G', 'G', 'D', 'S', 'S', 'D', 'H', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'G', 'D', 'G', 'D', 'G', 'D', ' ', 'G', 'G', 'G', 'D', 'S', 'S', 'D', 'H', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'D', 'A', 'D', 'A', 'D', ' ', 'G', 'G', 'G', 'D', 'S', 'S', 'D', 'H', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"å…©éš»è€è™\", score: ['A', 'S', 'D', 'A', ' ', 'A', 'S', 'D', 'A', ' ', 'D', 'F', 'G', ' ', 'D', 'F', 'G', ' ', 'G', 'H', 'G', 'F', 'D', 'A', ' ', 'G', 'H', 'G', 'F', 'D', 'A', ' ', 'A', 'D', 'A', ' ', 'A', 'D', 'A'] },\n                { name: \"å…¬è»Šä¸Šçš„è¼ªå­\", score: ['A', 'D', 'A', 'D', 'A', 'D', 'G', 'D', 'A', ' ', 'S', 'D', 'S', 'A', ' ', 'A', 'D', 'A', 'D', 'A', 'D', 'G', 'D', 'A', ' ', 'G', 'A', 'G', 'A', 'G', 'A', 'H', 'A', 'G', ' ', 'F', 'G', 'F', 'G', 'F', 'G', 'H', 'G', 'F', ' ', 'A', 'D', 'A', 'D', 'A', 'D', 'G', 'D', 'A'] },\n                { name: \"å’©å’©é»‘ç¾Š\", score: ['A', 'A', 'G', 'G', 'H', 'H', 'G', ' ', 'F', 'F', 'D', 'D', 'S', 'S', 'A', ' ', 'G', 'G', 'F', 'F', 'D', 'D', 'S', ' ', 'A', 'A', 'G', 'G', 'H', 'H', 'G', ' ', 'F', 'F', 'D', 'D', 'S', 'S', 'A'] },\n                { name: \"é¯Šé­šå¯¶å¯¶\", score: ['S', 'D', 'G', 'G', 'G', 'G', 'G', 'G', ' ', 'S', 'D', 'G', 'G', 'G', 'G', 'G', 'G', ' ', 'S', 'D', 'G', 'G', 'G', 'G', 'G', 'G', ' ', 'G', 'F', 'D'] },\n                { name: \"å¥‡ç•°æ©å…¸\", score: ['G', 'A', 'D', 'A', 'D', ' ', 'G', 'F', 'D', ' ', 'S', 'A', ' ', 'A', 'G', ' ', 'G', 'A', 'D', 'A', 'D', ' ', 'G', 'F', 'D', ' ', 'S', 'A', ' ', 'D', 'D', 'A', 'G', ' ', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"æ´‹åŸºæ­Œ\", score: ['A', 'A', 'S', 'D', 'A', 'D', 'S', ' ', 'A', 'A', 'S', 'D', 'A', 'S', ' ', 'A', 'A', 'S', 'D', 'F', 'D', 'S', 'A', 'S', 'D', 'S', 'A', 'A'] },\n                { name: \"ç¡äº†å—\", score: ['A', 'S', 'D', 'A', ' ', 'A', 'S', 'D', 'A', ' ', 'D', 'F', 'G', ' ', 'D', 'F', 'G', ' ', 'G', 'H', 'G', 'F', 'D', 'A', ' ', 'G', 'H', 'G', 'F', 'D', 'A', ' ', 'A', 'D', 'A', ' ', 'A', 'D', 'A'] },\n                { name: \"é€™å€‹è€äºº\", score: ['G', 'D', 'G', ' ', 'G', 'H', 'G', ' ', 'H', 'D', 'S', 'A', ' ', 'A', 'S', 'D', 'F', 'G', ' ', 'F', 'D', 'S', 'A', 'G'] },\n                { name: \"çŸ®èƒ–å­\", score: ['G', 'D', 'D', 'F', 'F', 'D', ' ', 'S', 'S', 'A', 'A', 'G', ' ', 'G', 'D', 'D', 'F', 'F', 'D', ' ', 'S', 'S', 'A', 'A', 'G', ' ', 'G', 'A', 'S', 'D', 'F', 'G', 'H', 'J', 'H', 'G', 'F', 'D', 'S', 'A', 'G'] },\n                { name: \"å¹³å®‰å¤œ\", score: ['G', 'H', 'G', 'D', ' ', 'G', 'H', 'G', 'D', ' ', 'J', 'J', 'H', ' ', 'G', 'H', 'G', 'D', ' ', 'J', 'J', 'H', ' ', 'G', 'H', 'G', 'D', ' ', 'G', 'D', 'G', 'F', 'D', 'S', ' ', 'A', 'A', 'S', 'F', 'D', 'G', 'D'] },\n                { name: \"è£é£¾å¤§å»³\", score: ['G', 'F', 'D', 'S', 'A', 'S', 'D', 'F', ' ', 'D', 'S', 'A', 'G', 'F', 'D', 'S', 'A', ' ', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'F', ' ', 'G', 'G', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"ç¥ä½ è–èª•å¿«æ¨‚\", score: ['A', 'D', 'D', 'F', 'D', 'S', 'A', 'A', ' ', 'S', 'F', 'F', 'G', 'F', 'D', 'S', ' ', 'S', 'G', 'G', 'H', 'G', 'F', 'D', 'A', ' ', 'A', 'S', 'A', 'D', ' ', 'A', 'S', 'D', 'F', ' ', 'G', 'F', 'D', 'A'] },\n                { name: \"å‹èª¼åœ°ä¹…å¤©é•·\", score: ['G', 'A', 'S', 'D', 'S', 'A', 'S', 'D', 'F', 'G', ' ', 'A', 'S', 'D', 'S', 'A', 'S', 'A', 'D', 'G', 'A', ' ', 'G', 'F', 'D', 'D', 'S', 'A', 'S', 'D', 'F', 'G', ' ', 'A', 'S', 'D', 'S', 'A', 'S', 'A', 'D', 'G', 'A'] },\n                { name: \"å“¦ï¼è˜‡çŠå¨œ\", score: ['A', 'S', 'D', 'F', 'G', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'D', 'S', 'A', 'A', ' ', 'A', 'S', 'D', 'F', 'G', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'D', 'S', 'A'] },\n                { name: \"æˆ‘çš„é‚¦å¦®\", score: ['G', 'D', 'F', 'D', 'S', 'A', 'G', ' ', 'D', 'F', 'D', 'S', 'A', 'G', ' ', 'G', 'H', 'J', 'H', 'G', 'F', 'D', ' ', 'F', 'G', 'H', 'G', 'F', 'D', 'S'] },\n                { name: \"è·³çµ¦æˆ‘è¦ªæ„›çš„\", score: ['A', 'A', 'G', 'G', 'F', 'F', 'D', ' ', 'A', 'A', 'G', 'G', 'F', 'F', 'D', ' ', 'A', 'S', 'D', 'F', 'G', 'H', 'J', ' ', 'J', 'H', 'G', 'F', 'D', 'D', 'D'] },\n                { name: \"é¼¬é¼ è·‘äº†\", score: ['A', 'A', 'A', 'S', 'D', 'D', 'D', 'F', 'G', ' ', 'A', 'A', 'A', 'S', 'D', 'S', 'A', ' ', 'A', 'A', 'A', 'S', 'D', 'D', 'D', 'S', 'A', 'S', 'A'] },\n                { name: \"å±±è°·è£¡çš„è¾²å¤«\", score: ['A', 'A', 'A', 'A', 'A', 'S', 'D', ' ', 'D', 'D', 'D', 'D', 'D', 'F', 'G', ' ', 'G', 'G', 'G', 'G', 'G', 'F', 'D', ' ', 'D', 'D', 'D', 'D', 'S', 'A'] },\n                { name: \"å¸¶æˆ‘å»çœ‹æ£’çƒè³½\", score: ['G', 'D', 'A', 'S', 'D', 'F', ' ', 'G', 'D', 'A', 'S', ' ', 'A', 'S', 'D', 'F', 'G', 'H', 'J', ' ', 'J', 'H', 'G', 'F', 'D', 'F', 'G'] },\n                { name: \"é¬†é¤…äºº\", score: ['G', 'D', 'S', 'A', ' ', 'G', 'D', 'S', 'A', ' ', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'A', 'S', 'S', 'D', 'D', 'F', ' ', 'G', 'D', 'S', 'A'] },\n                { name: \"é ­å…’è‚©è†€è†è…³è¶¾\", score: ['G', 'G', 'H', 'J', 'H', 'G', 'D', ' ', 'D', 'D', 'F', 'G', 'F', 'D', ' ', 'A', 'A', 'S', 'S', 'D', 'D', ' ', 'G', 'G', 'H', 'J', 'H', 'G', 'D'] },\n                { name: \"æˆ‘å€‘ç¥ä½ è–èª•å¿«æ¨‚ (å‰¯æ­Œ)\", score: ['G', 'D', 'D', 'S', 'A', 'G', 'F', ' ', 'A', 'A', 'A', 'G', 'G', 'F', 'D', 'S', ' ', 'G', 'D', 'A', 'S', ' ', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"å­—æ¯æ­Œ (ABC Song)\", score: ['A', 'A', 'G', 'G', 'H', 'H', 'G', ' ', 'F', 'F', 'D', 'D', 'S', 'S', 'A', ' ', 'G', 'G', 'F', ' ', 'D', 'D', 'S', ' ', 'A', 'A', 'G', 'G', 'H', 'H', 'G', ' ', 'F', 'F', 'D', 'D', 'S', 'S', 'A'] },\n                { name: \"ç•¶æˆ‘å€‘åŒåœ¨ä¸€èµ·\", score: ['A', 'D', 'F', 'D', 'A', ' ', 'G', 'G', 'G', ' ', 'A', 'D', 'F', 'D', 'A', ' ', 'F', 'F', 'F', ' ', 'A', 'S', 'D', 'F', 'G', 'H', 'J', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"å¡è¾² (ç°¡æ˜“)\", score: ['G', 'F', 'D', 'S', 'A', 'S', 'D', 'F', 'D', 'S', 'A', 'G', 'F', 'D', 'F', 'G', ' ', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'F', 'D', 'S', 'A', 'G', 'F', 'D', 'F', 'G'] },\n                { name: \"çµ¦æ„›éº—çµ² (ç°¡æ˜“)\", score: ['D', 'E', 'D', 'E', 'D', 'S', 'D', 'A', ' ', 'A', 'S', 'D', 'F', 'D', ' ', 'D', 'E', 'D', 'E', 'D', 'S', 'D', 'A', ' ', 'S', 'D', 'F', 'G', 'A'] },\n                { name: \"ç¨»è‰è£¡çš„ç«é›\", score: ['G', 'H', 'G', 'F', 'D', 'S', 'D', ' ', 'G', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'S', 'D', 'F', 'G', 'H', 'H', 'H', ' ', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"è–å¾’é€²è¡Œæ›²\", score: ['A', 'D', 'F', 'G', ' ', 'A', 'D', 'F', 'G', ' ', 'A', 'D', 'F', 'G', 'D', 'A', 'D', 'S', ' ', 'S', 'A', 'G', 'F', 'D', 'F', 'G', 'D', 'A', 'S', 'A'] },\n                { name: \"å¸ƒæ‹‰å§†æ–¯æ–ç±ƒæ›²\", score: ['D', 'D', 'G', ' ', 'D', 'D', 'G', ' ', 'D', 'G', 'J', 'H', 'G', ' ', 'A', 'A', 'F', ' ', 'F', 'F', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"ç´…æ²³è°·\", score: ['A', 'F', 'F', 'F', ' ', 'G', 'D', 'D', 'D', ' ', 'F', 'S', 'S', 'S', ' ', 'D', 'A', 'A', 'A', ' ', 'A', 'S', 'D', 'F', 'G', 'G', 'G'] },\n                { name: \"å…‹èŠé–€æ±€\", score: ['A', 'A', 'A', 'F', ' ', 'S', 'S', 'S', 'D', ' ', 'A', 'S', 'D', 'F', ' ', 'D', 'D', 'D', 'A', ' ', 'A', 'G', 'F', 'D', ' ', 'S', 'A', 'S', 'D'] },\n                { name: \"ä¸‰éš»çè€é¼ \", score: ['D', 'S', 'A', ' ', 'D', 'S', 'A', ' ', 'G', 'F', 'F', 'D', ' ', 'G', 'F', 'F', 'D', ' ', 'J', 'H', 'J', 'G', 'H', 'G', 'F', 'D', ' ', 'J', 'H', 'J', 'G', 'H', 'G', 'F', 'D'] },\n                { name: \"å‚‘å…‹èˆ‡å‰å…’\", score: ['A', 'S', 'D', 'F', 'G', ' ', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'A', 'S', 'D', ' ', 'D', 'S', 'A', ' ', 'G', 'G', 'F', 'D', 'S', 'A', 'A'] },\n                { name: \"éœé»˜ä¹‹è² (é–‹é ­)\", score: ['S', 'D', 'D', 'F', 'F', 'D', 'S', 'F', 'G', 'G', 'F', 'D', 'D', 'S', 'A', ' ', 'S', 'D', 'D', 'F', 'F', 'D', 'S', 'F', 'G', 'G', 'F', 'D', 'D', 'S', 'A'] },\n                { name: \"ç¶ è¢–å­\", score: ['G', 'J', 'Y', 'U', 'Y', 'J', 'H', 'F', 'D', 'E', 'F', 'G', 'J', 'Y', 'U', 'Y', 'J', 'H', 'F', 'E', 'E', 'D', ' ', 'G', 'J', 'Y', 'U', 'Y', 'J', 'H', 'F', 'D', 'E', 'F', 'G', 'J', 'Y', 'U', 'Y', 'J', 'H', 'F', 'E', 'E', 'D'] },\n                { name: \"ç”œèœœçš„å®¶\", score: ['A', 'S', 'D', 'A', ' ', 'D', 'S', 'A', ' ', 'S', 'A', 'S', 'D', ' ', 'A', 'S', 'D', 'D', ' ', 'F', 'D', 'S', 'A', ' ', 'G', 'F', 'D', 'F', 'D', 'S', 'S', 'A'] },\n                { name: \"è€éº¥å…‹å”ç´\", score: ['G', 'G', 'G', 'D', 'S', 'S', 'D', 'H', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'D', 'G', 'G', 'G', 'D', 'S', 'S', 'D'] },\n                { name: \"ç¹è‘—æ¡‘æ¨¹å¢\", score: ['D', 'F', 'D', 'A', 'S', 'A', 'S', 'D', ' ', 'D', 'F', 'D', 'A', 'S', 'A', 'G', ' ', 'D', 'F', 'D', 'A', 'S', 'A', 'S', 'D', ' ', 'A', 'D', 'G', 'F', 'D'] },\n                { name: \"æ­¡æ¨‚çš„éˆ´éº (çƒå…‹è˜­æ°‘è¬ )\", score: ['G', 'F', 'G', 'D', ' ', 'G', 'F', 'G', 'D', ' ', 'H', 'G', 'F', 'D', ' ', 'G', 'A', 'S', 'D', ' ', 'G', 'F', 'G', 'D', ' ', 'G', 'F', 'G', 'D'] },\n                { name: \"æ„›çš„ç¾…æ›¼å² (ç°¡æ˜“)\", score: ['D', 'G', 'H', 'G', 'F', 'D', 'F', 'H', 'J', 'H', 'G', 'D', 'G', 'J', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'D', 'F', 'D', 'S', 'A', 'S', 'F', 'G', 'F', 'D', 'S', 'A', 'D', 'F', 'D', 'S', 'A'] },\n                { name: \"å°æ¯›é©¢\", score: ['G', 'H', 'G', 'F', 'D', 'S', 'D', 'G', 'H', 'G', 'F', 'D', 'S', 'D', ' ', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'D'] },\n                { name: \"åº·åŸè³½é¦¬\", score: ['D', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'D', 'F', 'G', 'H', 'G', 'F', 'D', ' ', 'G', 'G', 'G', 'F', 'D', 'D', 'D', 'S', 'A', 'S', 'D', 'F', 'G', 'H', 'G', 'F', 'D'] },\n                { name: \"å¤©éµæ¹– (ä¸»é¡Œ)\", score: ['H', 'G', 'F', 'D', 'H', 'G', 'F', 'D', ' ', 'J', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'H', 'G', 'F', 'D', 'H', 'G', 'F', 'D', 'J', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"é‡ç«ç‘°\", score: ['A', 'D', 'F', 'D', 'S', 'A', 'S', ' ', 'D', 'F', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'D', 'F', 'D', 'S', 'A', 'S', 'D', 'A'] },\n                { name: \"é©ªæ­Œ (Auld Lang Syne)\", score: ['G', 'D', 'D', 'S', 'A', 'G', 'F', ' ', 'A', 'A', 'A', 'G', 'G', 'F', 'D', 'S', ' ', 'G', 'D', 'A', 'S', ' ', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"å¿µæ•…é„‰ (ä¾†è‡ªæ–°ä¸–ç•Œ)\", score: ['G', 'G', 'F', 'D', 'S', 'A', ' ', 'S', 'D', 'F', 'F', 'D', 'S', ' ', 'G', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'S', 'D', 'F', 'D', 'A'] },\n                { name: \"ç”œèœœçš„å®¶åº­\", score: ['G', 'D', 'D', 'D', 'S', 'A', ' ', 'S', 'F', 'F', 'F', 'D', 'S', ' ', 'A', 'A', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"Do-Re-Mi (ç‰‡æ®µ)\", score: ['A', 'S', 'D', 'A', 'D', 'S', 'D', ' ', 'S', 'D', 'F', 'S', 'F', 'D', 'F', ' ', 'D', 'F', 'G', 'D', 'G', 'F', 'G'] },\n                { name: \"å°ç™½èŠ± (Edelweiss)\", score: ['G', 'D', 'S', 'A', 'S', 'D', 'G', ' ', 'G', 'D', 'S', 'A', 'S', 'G', ' ', 'H', 'J', 'H', 'G', 'D', 'S', 'D', 'F', 'G'] },\n                { name: \"ä½ æ˜¯æˆ‘çš„é™½å…‰\", score: ['A', 'D', 'F', 'G', 'G', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'D', 'F', 'G', 'G', 'G', 'F', 'D', 'S', 'D', ' ', 'A', 'D', 'F', 'G', 'G', 'H', 'H', 'G', 'F', 'D', 'S', 'D'] },\n                { name: \"æœˆå…‰æ›² (ç°¡æ˜“é–‹é ­)\", score: ['G', 'Y', 'J', ' ', 'G', 'Y', 'J', ' ', 'G', 'Y', 'J', ' ', 'G', 'Y', 'J', ' ', 'H', 'T', 'H', ' ', 'H', 'T', 'H'] },\n                { name: \"å°æ­¥èˆæ›² (å·´å“ˆ)\", score: ['G', 'D', 'S', 'A', 'S', 'D', 'G', 'D', 'S', 'A', 'S', 'D', ' ', 'F', 'D', 'S', 'A', 'F', 'D', 'S', 'A', 'G'] },\n                { name: \"æ­¡æ¨‚é Œ (é€²éš)\", score: ['D', 'D', 'F', 'G', 'G', 'F', 'D', 'S', 'A', 'A', 'S', 'D', 'D', 'S', 'S', ' ', 'D', 'D', 'F', 'G', 'G', 'F', 'D', 'S', 'A', 'A', 'S', 'D', 'S', 'A', 'A', ' ', 'S', 'S', 'D', 'A', 'S', 'D', 'F', 'D', 'A', 'S', 'D', 'F', 'D', 'S', 'A', 'D', 'A'] },\n                { name: \"Bingo\", score: ['G', 'D', 'S', 'S', 'D', 'G', 'D', 'S', 'S', 'D', 'G', 'D', 'S', 'S', 'D', ' ', 'F', 'F', 'F', ' ', 'G', 'G', 'G', ' ', 'H', 'H', 'H'] },\n                { name: \"è¢ç«èŸ²\", score: ['G', 'G', 'H', 'H', 'G', 'G', 'D', ' ', 'F', 'F', 'S', 'S', 'A', ' ', 'G', 'G', 'H', 'H', 'G', 'G', 'D', ' ', 'F', 'F', 'S', 'S', 'A'] },\n                { name: \"æ•é­šæ­Œ\", score: ['G', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'F', ' ', 'G', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'A', ' ', 'D', 'D', 'S', 'S', 'A', 'D', 'S', 'A', 'A'] },\n                { name: \"é©ªæ­Œ (è®Šå¥)\", score: ['A', 'D', 'D', 'F', 'D', 'S', 'A', 'S', 'F', 'G', ' ', 'D', 'F', 'F', 'G', 'F', 'D', 'S', 'A', 'D', 'A'] },\n                { name: \"ä¸–ä¸Šåªæœ‰åª½åª½å¥½\", score: ['G', 'H', 'J', 'H', 'G', 'D', ' ', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'D', 'S', 'A', 'S', 'D', ' ', 'A', 'D', 'S'] },\n                { name: \"æœ›æ˜¥é¢¨ (ç°¡æ˜“)\", score: ['G', 'H', 'J', 'D', 'F', 'G', ' ', 'S', 'D', 'F', 'A', 'S', 'D', ' ', 'A', 'S', 'D', 'F', 'G', 'H', 'J'] },\n                { name: \"é›¨å¤œèŠ± (ç°¡æ˜“)\", score: ['G', 'H', 'J', 'H', 'G', ' ', 'D', 'F', 'G', 'F', 'D', ' ', 'S', 'D', 'F', 'S', 'D', 'S', 'A'] },\n                { name: \"èŒ‰è‰èŠ±\", score: ['D', 'F', 'G', 'D', 'F', 'D', 'S', 'A', 'S', 'D', ' ', 'A', 'S', 'D', 'S', 'A', 'S', 'D', ' ', 'D', 'F', 'G', 'D', 'F', 'D', 'S', 'A', 'S', 'A'] },\n                { name: \"æ•¸é´¨å­\", score: ['G', 'F', 'G', 'A', 'S', 'D', 'S', 'A', ' ', 'G', 'F', 'G', 'A', 'S', 'D', 'S', 'A', ' ', 'A', 'A', 'S', 'S', 'D', 'F', 'F', 'G'] },\n                { name: \"è™¹å½©å¦¹å¦¹\", score: ['G', 'G', 'G', 'S', 'D', 'F', ' ', 'F', 'F', 'F', 'D', 'S', 'A', ' ', 'G', 'G', 'G', 'S', 'D', 'F', ' ', 'A', 'A', 'A', 'D', 'S', 'A'] },\n                { name: \"å¦¹å¦¹èƒŒè‘—æ´‹å¨ƒå¨ƒ\", score: ['G', 'G', 'F', 'D', 'S', 'D', 'F', ' ', 'G', 'G', 'F', 'D', 'S', 'D', 'F', ' ', 'D', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"æ€èµ·ä½ çš„è“‹é ­ä¾†\", score: ['A', 'S', 'D', 'S', 'A', ' ', 'S', 'D', 'F', 'F', 'D', ' ', 'A', 'S', 'D', 'S', 'A', ' ', 'D', 'G', 'F', 'D', 'S'] },\n                { name: \"åº·å®šæƒ…æ­Œ\", score: ['G', 'G', 'F', 'D', 'S', 'A', ' ', 'G', 'G', 'H', 'J', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"é³³é™½èŠ±é¼“\", score: ['G', 'D', 'G', 'H', 'G', 'F', 'D', ' ', 'F', 'D', 'F', 'G', 'F', 'D', 'S', ' ', 'G', 'D', 'G', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"ç´«ç«¹èª¿\", score: ['G', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'D', 'S', 'D', 'F', 'D', 'S', 'A', ' ', 'G', 'H', 'J', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"é˜¿æ‹‰æœ¨æ±—\", score: ['G', 'G', 'F', 'D', 'S', 'A', 'S', 'D', ' ', 'G', 'G', 'F', 'D', 'S', 'A', 'S', 'D', ' ', 'A', 'S', 'D', 'F', 'D', 'S', 'A'] },\n                { name: \"é­¯å†°èŠ±\", score: ['G', 'F', 'D', 'S', 'A', 'S', 'D', ' ', 'D', 'F', 'G', 'F', 'D', 'S', 'A', ' ', 'G', 'F', 'D', 'S', 'A', 'S', 'D', ' ', 'D', 'S', 'A', 'S', 'D', 'A'] },\n                { name: \"é€åˆ¥\", score: ['D', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'S', 'D', 'F', 'D', ' ', 'D', 'G', 'F', 'D', 'S', 'A', ' ', 'D', 'S', 'A', 'S', 'A'] },\n                { name: \"é¾çš„å‚³äºº (ç°¡æ˜“)\", score: ['D', 'S', 'D', 'G', 'F', 'D', 'S', ' ', 'D', 'S', 'D', 'G', 'F', 'D', 'S', ' ', 'G', 'F', 'D', 'S', 'A', 'S', 'D', 'A'] },\n                { name: \"è®“æˆ‘å€‘è•©èµ·é›™æ§³\", score: ['D', 'F', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'D', 'F', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'A', 'S', 'D', 'F', 'G', 'H', 'J', 'H', 'G', 'F', 'D'] },\n                { name: \"è˜­èŠ±è‰\", score: ['G', 'D', 'S', 'D', 'G', ' ', 'H', 'J', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'G', 'D', 'S', 'D', 'G', ' ', 'H', 'J', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"å°èœœèœ‚\", score: ['G', 'D', 'D', ' ', 'F', 'S', 'S', ' ', 'D', 'S', 'F', 'G', 'G', 'G', 'G', ' ', 'G', 'D', 'D', ' ', 'F', 'S', 'S', ' ', 'D', 'G', 'D', 'A', 'A', 'A', 'A'] },\n                { name: \"è³£å ±æ­Œ\", score: ['G', 'D', 'G', 'S', 'D', 'A', ' ', 'G', 'D', 'G', 'S', 'D', 'A', ' ', 'D', 'D', 'F', 'F', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"è®€æ›¸éƒ\", score: ['A', 'S', 'D', 'A', 'S', 'D', ' ', 'F', 'F', 'D', 'S', 'A', ' ', 'A', 'S', 'D', 'A', 'S', 'D', ' ', 'F', 'F', 'D', 'S', 'A'] },\n                { name: \"æˆ‘æ˜¯ä¸€å€‹ç²‰åˆ·åŒ \", score: ['G', 'D', 'G', 'D', 'G', 'D', 'S', ' ', 'D', 'F', 'D', 'F', 'D', 'F', 'G', ' ', 'G', 'D', 'G', 'D', 'G', 'D', 'S', ' ', 'D', 'S', 'A', 'S', 'A'] },\n                { name: \"å¨ƒå“ˆå“ˆ\", score: ['G', 'F', 'D', 'F', 'G', 'F', 'D', ' ', 'S', 'D', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'G', 'F', 'D', 'F', 'G', 'F', 'D', ' ', 'S', 'D', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"æ–°å¹´å¥½\", score: ['A', 'A', 'S', 'A', 'G', 'F', ' ', 'S', 'S', 'D', 'S', 'F', 'D', ' ', 'A', 'A', 'S', 'A', 'G', 'F', ' ', 'S', 'D', 'A', 'S', 'A'] },\n                { name: \"ä¸Šå­¸æ­Œ\", score: ['G', 'G', 'H', 'G', 'F', 'D', 'S', ' ', 'D', 'D', 'F', 'G', 'F', 'D', 'S', ' ', 'G', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'S', 'D', 'A', 'S', 'A'] },\n                { name: \"æ˜¥å¤©åœ¨å“ªè£¡\", score: ['G', 'G', 'F', 'D', 'S', 'D', 'F', 'D', 'S', 'A', ' ', 'S', 'D', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'A'] },\n                { name: \"æ„›çˆ¾è˜­æ´—è¡£å©¦\", score: ['G', 'D', 'D', 'D', 'G', 'D', 'D', 'D', ' ', 'H', 'G', 'F', 'D', 'S', 'A', 'S', 'D', ' ', 'G', 'D', 'D', 'D', 'G', 'D', 'D', 'D', ' ', 'H', 'G', 'F', 'D', 'A', 'S', 'A'] },\n                { name: \"æ–¯å¡å¸ƒç¾…å¸‚é›†\", score: ['A', 'G', 'A', ' ', 'D', 'D', 'S', 'A', ' ', 'F', 'D', 'S', 'A', 'S', 'D', ' ', 'A', 'G', 'A', ' ', 'D', 'D', 'S', 'A', ' ', 'F', 'D', 'S', 'A', 'S', 'D'] },\n                { name: \"é¬¥ç‰›å£«ä¹‹æ­Œ\", score: ['G', 'F', 'G', 'H', 'G', 'F', 'D', 'S', 'A', ' ', 'S', 'A', 'S', 'D', 'S', 'A', ' ', 'D', 'S', 'D', 'F', 'D', 'S', 'A', 'G'] },\n                { name: \"å¨å»‰æ³°çˆ¾åºæ›²\", score: ['G', 'G', 'H', 'J', 'H', 'G', 'F', 'D', ' ', 'G', 'G', 'H', 'J', 'H', 'G', 'F', 'D', ' ', 'J', 'H', 'G', 'F', 'D', 'S', 'A'] },\n            ];\n            \n            const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n            const noteFrequencies = { 'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88 };\n            const activeOscillators = {};\n            function playNote(note) { if (!noteFrequencies[note] || activeOscillators[note]) return; const o = audioContext.createOscillator(), g = audioContext.createGain(); o.frequency.setValueAtTime(noteFrequencies[note], audioContext.currentTime); o.type = 'sine'; o.connect(g); g.connect(audioContext.destination); o.start(); activeOscillators[note] = { o, g }; }\n            function stopNote(note) { const a = activeOscillators[note]; if (a) { a.g.gain.exponentialRampToValueAtTime(1e-4, audioContext.currentTime + .05); setTimeout(() => { a.o.stop(); a.o.disconnect(); a.g.disconnect(); }, 100); delete activeOscillators[note]; } }\n            function loadSong() { const songIndex = parseInt(songSelector.value, 10); if (songIndex < 0) { currentSong = null; scoreDisplay.innerHTML = ''; return; } currentSong = songs[songIndex]; restartSong(); }\n            function restartSong() { if (!currentSong) return; currentNoteIndex = 0; renderScore(); skipPauses(); updateScoreHighlight(); }\n            function renderScore() { scoreDisplay.innerHTML = ''; if (!currentSong) return; currentSong.score.forEach((noteKey, index) => { const noteEl = document.createElement('span'); noteEl.className = 'note'; if (noteKey === ' ') { noteEl.classList.add('pause'); } else { noteEl.textContent = noteKey; } noteEl.dataset.index = index; scoreDisplay.appendChild(noteEl); }); scoreDisplay.scrollTop = 0; }\n            function skipPauses() { if (!currentSong) return; while (currentNoteIndex < currentSong.score.length && currentSong.score[currentNoteIndex] === ' ') { currentNoteIndex++; } }\n            function updateScoreHighlight() { document.querySelectorAll('.note').forEach(n => n.classList.remove('current')); if (currentNoteIndex < currentSong.score.length) { const currentNoteEl = scoreDisplay.querySelector(\\`.note[data-index=\"\\${currentNoteIndex}\"]\\`); if (currentNoteEl && !currentNoteEl.classList.contains('pause')) { currentNoteEl.classList.add('current'); } } }\n            function checkScore(pressedKey) { if (!currentSong || currentNoteIndex >= currentSong.score.length) return; const expectedKey = currentSong.score[currentNoteIndex]; const currentNoteEl = scoreDisplay.querySelector(\\`.note[data-index=\"\\${currentNoteIndex}\"]\\`); if (pressedKey === expectedKey) { currentNoteEl.classList.remove('current'); currentNoteEl.classList.add('correct'); currentNoteIndex++; skipPauses(); if (currentNoteIndex >= currentSong.score.length) { setTimeout(() => { scoreDisplay.innerHTML = '<span class=\"completion-message\">ğŸ‰ æ­å–œä½ ï¼Œå®Œæˆäº†ï¼ğŸ‰</span>'; }, 500); } else { updateScoreHighlight(); } } else { const keyEl = keyMap[pressedKey]; if (keyEl) { keyEl.classList.add('incorrect'); setTimeout(() => keyEl.classList.remove('incorrect'), 300); } } }\n            function handleKeyDown(keyElement) { if (keyElement && !keyElement.classList.contains('active')) { keyElement.classList.add('active'); playNote(keyElement.dataset.note); if (currentMode === 'sheet') { checkScore(keyElement.dataset.key); } } }\n            function handleKeyUp(keyElement) { if (keyElement) { keyElement.classList.remove('active'); stopNote(keyElement.dataset.note); } }\n            songs.forEach((song, index) => { const option = document.createElement('option'); option.value = index; option.textContent = song.name; songSelector.appendChild(option); });\n            document.querySelectorAll('input[name=\"mode\"]').forEach(radio => { radio.addEventListener('change', e => { currentMode = e.target.value; sheetMusicArea.style.display = currentMode === 'sheet' ? 'block' : 'none'; if (currentMode === 'sheet') { loadSong(); } else { currentSong = null; scoreDisplay.innerHTML = ''; } }); });\n            songSelector.addEventListener('change', loadSong);\n            restartBtn.addEventListener('click', restartSong);\n            keys.forEach(key => { key.addEventListener('mousedown', () => handleKeyDown(key)); key.addEventListener('mouseup', () => handleKeyUp(key)); key.addEventListener('mouseleave', () => handleKeyUp(key)); });\n            window.addEventListener('keydown', e => { if (e.repeat) return; const keyElement = keyMap[e.key.toUpperCase()]; if (keyElement) handleKeyDown(keyElement); });\n            window.addEventListener('keyup', e => { const keyElement = keyMap[e.key.toUpperCase()]; if (keyElement) handleKeyUp(keyElement); });\n        </script>\n    </body>\n    </html>\n  `;\n}",
    "enableOnInit": false,
    "hidden": false,
    "tags": [
      "game"
    ]
  },
  {
    "command": "cmd.7k3ari1rqqa",
    "text": "$(squirrel) çˆ¬èŸ²ç¤ºç¯„",
    "tooltip": "ç¤ºç¯„ä½¿ç”¨ shb.v1.packages å®‰è£ playwright èˆ‡é€²è¡Œçˆ¬èŸ²",
    "hidden": false,
    "enableOnInit": false,
    "tags": [
      "npm",
      "playwright",
      "example"
    ],
    "script": "const vscode = require(\"vscode\");\nconst { vm, packages, files } = statusBarHelper.v1;\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst cp = require(\"child_process\");\n\nconst DELAY_MS = 200;\nconst SCROLL_TIMES = 10;\nconst UA = \"Mozilla/5.0 (Macintosh; Intel Mac OS X) AppleWebKit/537.36 (KHTML, like Gecko) SBH-PlaywrightListDemo/1.0 Safari/537.36\";\nconst TAG_URL = \"https://academy.openai.com/public/tags/prompt-packs-6849a0f98c613939acef841c\";\n\nconst sleep = (ms) => new Promise((r) => setTimeout(r, ms));\n\n/**\n * ğŸ› ï¸ å°‹æ‰¾ Chromium åŸ·è¡Œæª”\n */\nfunction findChromiumExecutable(browsersPath) {\n  if (!fs.existsSync(browsersPath)) return null;\n\n  const dirs = fs.readdirSync(browsersPath)\n    .filter(d => d.startsWith('chromium-') && !d.includes('headless'))\n    .sort().reverse();\n\n  if (dirs.length === 0) return null;\n\n  const platform = process.platform;\n  for (const chromiumDir of dirs) {\n    const basePath = path.join(browsersPath, chromiumDir);\n    let execPath = null;\n\n    if (platform === 'win32') {\n      const possibleFolders = ['chrome-win', 'chrome-win64'];\n      for (const folderName of possibleFolders) {\n        const tryPath = path.join(basePath, folderName, 'chrome.exe');\n        if (fs.existsSync(tryPath)) { execPath = tryPath; break; }\n      }\n    } else if (platform === 'darwin') {\n      const macBaseContents = fs.readdirSync(basePath);\n      const chromeMacDir = macBaseContents.find(d => d.startsWith('chrome-mac'));\n      if (chromeMacDir) {\n        const chromeMacPath = path.join(basePath, chromeMacDir);\n        const newPath = path.join(chromeMacPath, 'Google Chrome for Testing.app', 'Contents', 'MacOS', 'Google Chrome for Testing');\n        const oldPath = path.join(chromeMacPath, 'Chromium.app', 'Contents', 'MacOS', 'Chromium');\n        execPath = fs.existsSync(newPath) ? newPath : (fs.existsSync(oldPath) ? oldPath : null);\n      }\n    } else {\n      const linuxPath = path.join(basePath, 'chrome-linux', 'chrome');\n      if (fs.existsSync(linuxPath)) execPath = linuxPath;\n    }\n\n    if (execPath) return execPath;\n  }\n  return null;\n}\n\n/**\n * ğŸ› ï¸ æ‰‹å‹•åŸ·è¡Œ Playwright ä¸‹è¼‰æŒ‡ä»¤ (æ”¯æ´é€²åº¦é¡¯ç¤º)\n */\nasync function installBrowserManually(pkgRoot, targetPath, progress) {\n  const cliPath = path.join(pkgRoot, 'node_modules', 'playwright-core', 'cli.js');\n  \n  if (!fs.existsSync(cliPath)) {\n    throw new Error(`æ‰¾ä¸åˆ° Playwright CLI: ${cliPath}`);\n  }\n\n  return new Promise((resolve, reject) => {\n    const child = cp.fork(cliPath, ['install', 'chromium'], {\n      env: { ...process.env, PLAYWRIGHT_BROWSERS_PATH: targetPath },\n      stdio: 'pipe',\n      silent: true\n    });\n\n    let currentComponent = \"\"; \n\n    const handleOutput = (data) => {\n      const output = data.toString();\n      const nameMatch = output.match(/Downloading ([A-Za-z0-9]+)/i);\n      if (nameMatch) {\n        currentComponent = nameMatch[1]; \n      }\n\n      const percentMatch = output.match(/\\b(\\d{1,3})%/);\n      if (percentMatch) {\n        const label = currentComponent ? `${currentComponent} ` : \"ä¸‹è¼‰ä¸­... \";\n        progress.report({ message: `${label}${percentMatch[1]}%` });\n      } else {\n        const cleanText = output.trim().split('\\n').pop();\n        if (cleanText && cleanText.length < 40 && !cleanText.includes('%')) {\n           progress.report({ message: cleanText });\n        }\n      }\n    };\n\n    if (child.stdout) child.stdout.on('data', handleOutput);\n    if (child.stderr) child.stderr.on('data', handleOutput);\n\n    child.on('exit', (code) => {\n      if (code === 0) resolve();\n      else reject(new Error(`å®‰è£ç¨‹åºç•°å¸¸é€€å‡ºï¼Œä»£ç¢¼: ${code}`));\n    });\n  });\n}\n\n(async function main() {\n  // 1. è¨­å®šå…¨åŸŸå„²å­˜è·¯å¾‘\n  const globalDirs = await files.dirs();\n  const browsersPath = path.join(globalDirs.global, 'sbh-playwright-browsers');\n  \n  if (!fs.existsSync(browsersPath)) {\n    fs.mkdirSync(browsersPath, { recursive: true });\n  }\n\n  process.env.PLAYWRIGHT_BROWSERS_PATH = browsersPath;\n  console.log(`[SBH] ç€è¦½å™¨è·¯å¾‘: ${browsersPath}`);\n\n  // 2. å®‰è£ playwright-core (æ ¸å¿ƒå¥—ä»¶)\n  // âœ… ä¿®æ­£ï¼šåŠ ä¸Šé€²åº¦æ¢èˆ‡å®Œæˆæç¤º\n  if (!await packages.exists('playwright-core')) {\n    await vscode.window.withProgress({\n      location: vscode.ProgressLocation.Notification,\n      title: \"ğŸ“¦ æ­£åœ¨å®‰è£æ ¸å¿ƒå¥—ä»¶ (playwright-core)...\",\n      cancellable: false\n    }, async () => {\n      await packages.install('playwright-core');\n    });\n    // âœ… æ–°å¢ï¼šæ˜ç¢ºå‘Šè¨´ä½¿ç”¨è€…é€™ä¸€æ­¥å®Œæˆäº†\n    vscode.window.showInformationMessage('âœ… æ ¸å¿ƒå¥—ä»¶å®‰è£å®Œæˆï¼Œæº–å‚™æª¢æŸ¥ç€è¦½å™¨...');\n  }\n\n  await sleep(200);\n\n // 3. æª¢æŸ¥ä¸¦æ‰‹å‹•ä¸‹è¼‰ç€è¦½å™¨\n  let execPath = findChromiumExecutable(browsersPath);\n\n  if (!execPath) {\n    const pkgDir = await packages.dir();\n    \n    await vscode.window.withProgress({\n      location: vscode.ProgressLocation.Notification,\n      title: \"æ­£åœ¨åˆå§‹åŒ– Chromium ç’°å¢ƒ\",\n      cancellable: false\n    }, async (progress) => {\n      progress.report({ message: \"æº–å‚™é–‹å§‹ä¸‹è¼‰...\" });\n      try {\n        await installBrowserManually(pkgDir, browsersPath, progress);\n        vscode.window.showInformationMessage('âœ… Chromium ç’°å¢ƒæº–å‚™å®Œæˆ');\n      } catch (err) {\n        vscode.window.showErrorMessage(`âŒ ä¸‹è¼‰å¤±æ•—: ${err.message}`);\n        console.error(err);\n      }\n    });\n\n    await sleep(1000);\n    execPath = findChromiumExecutable(browsersPath);\n  }\n\n  // 4. Fallback\n  if (!execPath) {\n    console.log('è‡ªè¨‚è·¯å¾‘æœªæ‰¾åˆ°ï¼Œå˜—è©¦ç³»çµ±é è¨­è·¯å¾‘...');\n    const home = process.env.HOME || process.env.USERPROFILE;\n    let defaultPaths = [];\n    if (process.platform === 'darwin') defaultPaths.push(path.join(home, 'Library/Caches/ms-playwright'));\n    if (process.platform === 'win32') defaultPaths.push(path.join(process.env.LOCALAPPDATA, 'ms-playwright'));\n    \n    for (const defPath of defaultPaths) {\n      const fallbackExec = findChromiumExecutable(defPath);\n      if (fallbackExec) {\n        execPath = fallbackExec;\n        vscode.window.showWarningMessage('âš ï¸ ä½¿ç”¨ç³»çµ±é è¨­è·¯å¾‘ (å…¨åŸŸä¸‹è¼‰å¯èƒ½å¤±æ•—)');\n        break;\n      }\n    }\n  }\n\n  if (!execPath || !fs.existsSync(execPath)) {\n    vscode.window.showErrorMessage(`âŒ ç„¡æ³•å®šä½ Chromiumã€‚è·¯å¾‘: ${browsersPath}`);\n    return vm.stop();\n  }\n\n  const { chromium } = packages.require('playwright-core');\n\n  // ... (UI èˆ‡ æ¥­å‹™é‚è¼¯) ...\n  const panel = vscode.window.createWebviewPanel(\n    \"sbhPlaywrightList\",\n    \"Playwright æŠ“å–åˆ—è¡¨\",\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  panel.onDidDispose(() => vm.stop());\n  vm.onStop(() => panel.dispose());\n  const nonce = Math.random().toString(36).slice(2);\n\n  panel.webview.html = `\n<!doctype html>\n<meta charset=\"utf-8\">\n<style>\n:root { color-scheme: dark; }\nbody { font: 14px/1.6 system-ui; background: #1e1e1e; color: #ddd; padding: 0; margin: 0; }\nheader { padding: 12px 16px; background: #111; border-bottom: 1px solid #333; position: sticky; top: 0; display: flex; justify-content: space-between; }\ntable { width: 100%; border-collapse: collapse; table-layout: fixed; }\nth, td { border-bottom: 1px solid #2b2b2b; padding: 6px 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\nth { text-align: left; color: #bbb; background: #181818; }\n.url { color: #4fc3f7; cursor: pointer; } .url:hover { text-decoration: underline; }\n</style>\n<header><strong id=\"title\">ğŸš€ æº–å‚™ä¸­...</strong><span id=\"stats\">0</span></header>\n<table><thead><tr><th style=\"width:40px\">#</th><th>Title</th><th>URL</th></tr></thead><tbody id=\"rows\"></tbody></table>\n<script nonce=\"${nonce}\">\nconst vscode = acquireVsCodeApi();\nconst rows = document.getElementById('rows');\nwindow.addEventListener('message', e => {\n  const m = e.data;\n  if(m.type==='append'){\n    const tr = document.createElement('tr');\n    tr.innerHTML = \\`<td>\\${m.count}</td><td>\\${m.title}</td><td><span class=\"url\">\\${m.url}</span></td>\\`;\n    rows.appendChild(tr);\n    tr.querySelector('.url').onclick = () => vscode.postMessage({type:'open', href:m.url});\n    document.getElementById('title').textContent = 'ğŸš€ æŠ“å–ä¸­...';\n    document.getElementById('stats').textContent = m.count;\n  } else if (m.type === 'done') {\n    document.getElementById('title').textContent = 'âœ… å®Œæˆ';\n  }\n});\n</script>\n`;\n\n  panel.webview.onDidReceiveMessage(m => {\n    if(m.type==='open') vscode.env.openExternal(vscode.Uri.parse(m.href));\n  });\n\n  console.log('å•Ÿå‹•ç€è¦½å™¨:', execPath);\n  const browser = await chromium.launch({ \n    headless: false,\n    executablePath: execPath\n  });\n\n  try {\n    const ctx = await browser.newContext({ userAgent: UA });\n    const page = await ctx.newPage();\n    const found = new Map();\n\n    await page.goto(TAG_URL, { waitUntil: \"domcontentloaded\", timeout: 60000 });\n    await page.waitForTimeout(1000);\n\n    for (let i = 0; i < SCROLL_TIMES; i++) {\n      await page.evaluate((y) => window.scrollBy(0, y), 900);\n      await sleep(DELAY_MS);\n\n      const partial = await page.evaluate(() => {\n        return Array.from(document.querySelectorAll(\"a[href]\"))\n          .filter(a => /\\/public\\/(resources\\/|clubs\\/)/.test(a.href))\n          .map(a => ({ \n             title: a.innerText.trim() || a.parentElement.innerText.trim(), \n             url: a.href.split('#')[0] \n          }));\n      });\n\n      for (const c of partial) {\n        if (!found.has(c.url) && /ChatGPT/i.test(c.title)) {\n          found.set(c.url, c);\n          panel.webview.postMessage({ type: \"append\", count: found.size, title: c.title, url: c.url });\n        }\n      }\n    }\n    panel.webview.postMessage({ type: \"done\", count: found.size });\n    await ctx.close();\n  } catch (e) {\n    vscode.window.showErrorMessage(\"éŒ¯èª¤ï¼š\" + e.message);\n  } finally {\n    await browser.close();\n  }\n})();"
  },
  {
    "command": "cmd.nfdd39hhti",
    "text": "Axios ç¤ºç¯„",
    "tooltip": "",
    "hidden": false,
    "enableOnInit": false,
    "tags": [
      "npm",
      "axios",
      "example"
    ],
    "script": "const vscode = require(\"vscode\");\nconst { packages, vm } = statusBarHelper.v1;\n\n(async () => {\n  if (!await packages.exists(\"axios\")) await packages.install(\"axios\");\n  \n  // Axios v1.x ç›¸å®¹æ€§ä¿®æ­£\n  let axios = packages.require(\"axios\");\n  if (axios.default) axios = axios.default;\n\n  // å®šç¾©åŸå¸‚åº§æ¨™ (Open-Meteo éœ€è¦ç¶“ç·¯åº¦)\n  const cities = {\n    \"Taipei\": { name: \"å°åŒ—\", lat: 25.0330, lon: 121.5654 },\n    \"Tokyo\": { name: \"æ±äº¬\", lat: 35.6762, lon: 139.6503 },\n    \"NewYork\": { name: \"ç´ç´„\", lat: 40.7128, lon: -74.0060 },\n    \"London\": { name: \"å€«æ•¦\", lat: 51.5074, lon: -0.1278 }\n  };\n\n  // 1. è®“ä½¿ç”¨è€…é¸æ“‡åŸå¸‚\n  const selected = await vscode.window.showQuickPick(Object.keys(cities), {\n    placeHolder: \"è«‹é¸æ“‡è¦æŸ¥è©¢å¤©æ°£çš„åŸå¸‚\"\n  });\n\n  if (!selected) return vm.stop(); // ä½¿ç”¨è€…å–æ¶ˆ\n\n  const city = cities[selected];\n  // API åƒæ•¸: current_weather=true ä»£è¡¨åªæŠ“ç›®å‰å¤©æ°£\n  const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true`;\n\n  try {\n    vscode.window.setStatusBarMessage(`æ­£åœ¨æŸ¥è©¢ ${city.name} çš„å¤©æ°£...`, 2000);\n    \n    // 2. å‘¼å« API\n    const res = await axios.get(apiUrl);\n    const weather = res.data.current_weather;\n\n    // 3. ç°¡å–®çš„å¤©æ°£ä»£ç¢¼è½‰æ› (WMO Weather interpretation codes)\n    let icon = \"ğŸŒ¤ï¸\";\n    if (weather.weathercode >= 61) icon = \"ğŸŒ§ï¸\"; // ä¸‹é›¨\n    else if (weather.weathercode === 0) icon = \"â˜€ï¸\"; // æ™´å¤©\n    else if (weather.weathercode <= 3) icon = \"â˜ï¸\"; // å¤šé›²\n\n    // 4. é¡¯ç¤ºçµæœ\n    vscode.window.showInformationMessage(\n      `${icon} ${city.name} ç›®å‰å¤©æ°£`,\n      {\n        modal: true,\n        detail: `æº«åº¦: ${weather.temperature}Â°C\\né¢¨é€Ÿ: ${weather.windspeed} km/h\\nä»£ç¢¼: ${weather.weathercode}`\n      }\n    );\n\n  } catch (error) {\n    vscode.window.showErrorMessage(\"å¤©æ°£æŸ¥è©¢å¤±æ•—: \" + error.message);\n  }\n\n  vm.stop();\n})();"
  },
  {
    "command": "cmd.gi7h1ceopn",
    "text": "QrCode",
    "tooltip": "",
    "hidden": false,
    "enableOnInit": false,
    "tags": [
      "npm",
      "example"
    ],
    "script": "const vscode = require(\"vscode\");\nconst { packages, vm } = statusBarHelper.v1;\n\n(async () => {\n  // 1. å®‰è£ qrcode å¥—ä»¶\n  if (!await packages.exists(\"qrcode\")) {\n    vscode.window.showInformationMessage(\"æ­£åœ¨ä¸‹è¼‰ QR Code ç”¢ç”Ÿå™¨...\");\n    await packages.install(\"qrcode\");\n  }\n\n  const QRCode = packages.require(\"qrcode\");\n  const text = \"https://github.com/jiahongl/status-bar-helper\"; // æƒ³è¦è½‰æˆ QR Code çš„ç¶²å€\n\n  try {\n    // 2. ç”¢ç”Ÿ Data URL (Base64åœ–ç‰‡)\n    const dataUrl = await QRCode.toDataURL(text, { width: 300, margin: 2 });\n\n    // 3. å»ºç«‹ Webview é¡¯ç¤ºçµæœ\n    const panel = vscode.window.createWebviewPanel(\n      \"sbhQRCode\",\n      \"QR Code Generator\",\n      vscode.ViewColumn.One,\n      {}\n    );\n\n    panel.webview.html = `\n      <div style=\"display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#fff;color:#333;\">\n        <h2>Scan Me!</h2>\n        <img src=\"${dataUrl}\" />\n        <p style=\"margin-top:20px;font-family:monospace;\">${text}</p>\n      </div>\n    `;\n\n    // ç•¶é¢æ¿é—œé–‰æ™‚åœæ­¢è…³æœ¬\n    panel.onDidDispose(() => vm.stop());\n    \n  } catch (err) {\n    console.error(err);\n    vm.stop();\n  }\n})();"
  }
]