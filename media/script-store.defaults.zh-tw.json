[
  {
    "command": "sbh.demo.logMinimalPlus",
    "text": "$(output) Log",
    "tooltip": "VS Code + Node å¿«é€Ÿç¤ºç¯„ï¼šåŒæ™‚è¼¸å‡ºåˆ° Output èˆ‡åº•éƒ¨æ—¥èªŒ",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "default",
      "core"
    ],
    "script": "// Minimal Log: VS Code + Node (read-only, one-click, dual output)\n// Example: Demonstrates how to log messages in a VS Code extension\n// 1. Create a custom Output Channel in VS Code\n// 2. Define a helper function to log to both Output Channel and console\n// 3. Show environment info (Node version, platform, architecture)\n// 4. List a few files/directories from the current workspace\n// 5. Show the currently active file and its language\n// 6. Display a completion message in VS Code's UI\n\n// Import VS Code API\nconst vscode = require('vscode');\n// Import Node.js file system and path modules\nconst fs = require('fs');\nconst path = require('path');\n// Inject VM API\nconst { vm } = statusBarHelper.v1; \n\n(function main(){\n  // Create a new Output Channel named \"SBH Minimal Log\"\n  const ch = vscode.window.createOutputChannel('SBH Minimal Log');\n\n  // Helper function: log to both Output Channel and console\n  const emit = (...a) => {\n    const line = a.join(' ');\n    ch.appendLine(line);\n    console.log(line);\n  };\n\n  // Show the Output Channel immediately\n  ch.show(true);\n\n  // Start logging\n  emit('â–¶ Start');\n\n  // Show Node.js version, platform, and architecture\n  emit('Node: ' + process.version + '  Platform: ' + process.platform + '/' + process.arch);\n\n  // Get current workspace root (or fallback to process.cwd())\n  const ws = vscode.workspace.workspaceFolders;\n  const root = ws && ws.length ? ws[0].uri.fsPath : process.cwd();\n  emit('Workdir: ' + root);\n\n  // Try listing the first 8 entries in the workspace folder\n  try {\n    const entries = fs.readdirSync(root, { withFileTypes: true }).slice(0, 8);\n    entries.forEach(e => emit((e.isDirectory() ? '[D] ' : '[F] ') + e.name));\n  } catch (e) {\n    emit('readdir failed: ' + e.message);\n  }\n\n  // Show the active file name and language if available\n  const ed = vscode.window.activeTextEditor;\n  if (ed && ed.document.uri.scheme === 'file') {\n    emit('Active file: ' + path.basename(ed.document.uri.fsPath) + ' (' + ed.document.languageId + ')');\n  }\n\n  // Final message\n  emit('âœ” Done');\n\n  // Show a success message in VS Code\n  vscode.window.showInformationMessage('Log demo finished. Check \"SBH Minimal Log\" and the bottom run log.');\n\n  // Stop VM explicitly after completion\n  vm.stop();\n})();"
  },
  {
    "command": "sbh.demo.gitAdd",
    "text": "$(diff-added) Git Add",
    "tooltip": "å¿«é€ŸåŸ·è¡Œ git add .ï¼ˆç¬¬ä¸€å€‹å·¥ä½œå€ï¼‰",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "default",
      "git"
    ],
    "script": "// Git Add: stage all in first workspace (one-click)\n// Example: How to run a terminal command from a VS Code extension\n// 1. Get the first opened workspace folder path\n// 2. Use Node.js child_process.exec to execute a system command (git add .)\n// 3. Convert the command output (stdout/stderr) to string and handle it\n// 4. Show messages in the VS Code UI\n\n// Import VS Code API\nconst vscode = require('vscode');\n// Import exec from Node.js (used to run system commands)\nconst { exec } = require('child_process');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  // Get the opened workspace folders\n  const ws = vscode.workspace.workspaceFolders;\n  if (!ws || !ws.length) {\n    console.log('[GitAdd] No workspace folder.');\n    vscode.window.showWarningMessage('No workspace folder â€” cannot run git add.');\n    vm.stop();\n    return;\n  }\n\n  // Get the first workspace's filesystem path\n  const cwd = ws[0].uri.fsPath;\n  console.log('[GitAdd] cwd:', cwd);\n\n  // Execute the git add . command in the workspace directory\n  exec('git add .', { cwd }, (err, stdout, stderr) => {\n    if (err) {\n      // stderr usually contains error messages\n      console.error('[GitAdd] error:', stderr || err.message);\n      vscode.window.showErrorMessage('Git add failed: ' + (stderr || err.message));\n      vm.stop();\n      return;\n    }\n\n    // stdout contains the command output (Buffer â†’ string)\n    if (stdout && stdout.trim()) console.log(stdout.trim());\n    console.log('[GitAdd] done.');\n\n    // Show a success message in VS Code\n    vscode.window.showInformationMessage('âœ… git add . done');\n\n    vm.stop();\n  });\n})();"
  },
  {
    "command": "sbh.demo.storage",
    "text": "$(database) Storage",
    "tooltip": "storage / files API ç¯„ä¾‹ï¼šæ–‡å­—ã€JSONã€ä½å…ƒçµ„ã€éµå€¼",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "default",
      "storage"
    ],
    "script": "// Status Bar Helper v1: Demonstrates how to use the custom statusBarHelper API\n// Purpose:\n//  1. Show how to use custom storage (global & workspace) for key-value data\n//  2. Show how to use custom file APIs to read/write text, JSON, and binary data\n//  3. Show how to check existence, calculate file sizes, and log results\n//  4. Intended for demo/testing inside a VS Code extension with SBH enabled\n\n// Import Node.js Buffer (for binary and base64 handling)\nconst { Buffer } = require('buffer');\n\n// Destructure storage and files API from statusBarHelper v1\nconst { storage, files, vm } = statusBarHelper.v1;\n\nfunction main() {\n\n  // Helper: current timestamp in readable format\n  const now = () => new Date().toISOString().replace('T', ' ').replace('Z', '');\n\n  // Helper: pretty-print any value for logging\n  const dump = (x) => {\n    if (x instanceof Uint8Array)\n      return `Uint8Array(${x.length}) [${Array.from(x).slice(0, 16).join(',')}${x.length > 16 ? ',â€¦' : ''}]`;\n    try { return JSON.stringify(x, null, 2); } catch { return String(x); }\n  };\n\n  // Helper: prefixed log output\n  const log = (...a) => console.log('[SBH]', ...a.map(dump));\n\n  (async () => {\n    log('â–¶ start', now());\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ storage / global â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    log('â€” storage / global â€”');\n    const gPrev = await storage.global.get('demo.keep', { runs: 0 });\n    await storage.global.set('demo.keep', { ...gPrev, runs: (gPrev.runs || 0) + 1, ts: now(), from: 'global' });\n    log('get keep =', await storage.global.get('demo.keep', null));\n    log('keys =', await storage.global.keys());\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ storage / workspace â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    log('â€” storage / workspace â€”');\n    try {\n      const wPrev = await storage.workspace.get('demo.keep', { runs: 0 });\n      await storage.workspace.set('demo.keep', { ...wPrev, runs: (wPrev.runs || 0) + 1, ts: now(), from: 'workspace' });\n      log('get keep =', await storage.workspace.get('demo.keep', null));\n      log('keys =', await storage.workspace.keys());\n    } catch (e) {\n      log('workspace storage not available:', e?.message || e);\n    }\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ files API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    const dirs = await files.dirs();\n    log('dirs =', dirs);\n\n    // Text file (global scope)\n    const txtRel = 'demo/notes/hello.txt';\n    const txtOld = (await files.exists('global', txtRel)) ? await files.readText('global', txtRel) : '';\n    await files.writeText('global', txtRel, txtOld + `hello @ ${now()}\\n`);\n    log('readText:', await files.readText('global', txtRel));\n\n    // JSON file (workspace if available, otherwise global)\n    /** @type {'global'|'workspace'} */\n    const jsonScope = dirs.workspace ? 'workspace' : 'global';\n    const jsonRel = 'demo/data/sample.json';\n    const cur = (await files.exists(jsonScope, jsonRel))\n      ? await files.readJSON(jsonScope, jsonRel)\n      : { a: 1, createdAt: now() };\n    cur.updatedAt = now();\n    cur.count = (cur.count || 0) + 1;\n    await files.writeJSON(jsonScope, jsonRel, cur);\n    log('readJSON:', await files.readJSON(jsonScope, jsonRel));\n\n    // Binary file (Uint8Array)\n    const binRel = 'demo/bin/demo.bin';\n    await files.writeBytes('global', binRel, new Uint8Array([1, 2, 3, 4, 5, 254, 255]));\n    log('readBytes demo.bin:', await files.readBytes('global', binRel));\n\n    // Binary file (base64 string)\n    const b64Rel = 'demo/bin/base64.bin';\n    await files.writeBytes('global', b64Rel, Buffer.from([9, 8, 7, 6]).toString('base64'));\n    log('exists base64.bin:', await files.exists('global', b64Rel));\n\n    // Simulated list of known demo files + calculate size\n    /** @type {Array<{scope:'global'|'workspace', rel:string, type:'text'|'json'|'bytes'}>} */\n    const candidates = [\n      { scope: 'global', rel: 'demo/notes/hello.txt', type: 'text' },\n      { scope: jsonScope, rel: 'demo/data/sample.json', type: 'json' },\n      { scope: 'global', rel: 'demo/bin/demo.bin', type: 'bytes' },\n      { scope: 'global', rel: 'demo/bin/base64.bin', type: 'bytes' },\n      { scope: 'global', rel: 'demo/tmp/kept.txt', type: 'text' },\n    ];\n\n    /** @type {Array<{scope:string, path:string, type:string, size:number}>} */\n    const rows = [];\n    for (const c of candidates) {\n      if (await files.exists(c.scope, c.rel)) {\n        let size = 0;\n        if (c.type === 'text') {\n          const s = await files.readText(c.scope, c.rel);\n          size = Buffer.byteLength(s, 'utf8');\n        } else if (c.type === 'json') {\n          const obj = await files.readJSON(c.scope, c.rel);\n          size = Buffer.byteLength(JSON.stringify(obj), 'utf8');\n        } else {\n          const b = await files.readBytes(c.scope, c.rel);\n          size = b?.length || 0;\n        }\n        rows.push({ scope: c.scope, path: c.rel, type: c.type, size });\n      }\n    }\n    log('files (simulated list):', rows);\n\n    // // Optional cleanup â€” user can delete via UI or uncomment below:\n    // await storage.global.remove('demo.keep');\n    // await storage.workspace.remove('demo.keep').catch(()=>{});\n    // await files.remove('global', b64Rel);\n\n    log('âœ” done', now());\n    vm.stop();\n  })().catch(e => {\n    console.error('âŒ', e);\n    vm.stop();\n  });\n}\n\nmain();"
  },
  {
    "command": "sbh.demo.toggleTheme",
    "text": "$(color-mode)",
    "tooltip": "åˆ‡æ›äº®/æš—è‰²ä¸»é¡Œ",
    "hidden": false,
    "enableOnInit": false,
    "tags": [
      "default",
      "ui"
    ],
    "script": "// Toggle between Light and Dark themes in VS Code (one-click)\n// Purpose: Demonstrates how to trigger a built-in VS Code command from a script\n// Note: This uses 'workbench.action.toggleLightDarkThemes' which toggles the current color theme\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(async () => {\n  try {\n    // Execute the built-in toggle theme command\n    await vscode.commands.executeCommand('workbench.action.toggleLightDarkThemes');\n  } catch (e) {\n    // Show an error message in VS Code if the command fails\n    vscode.window.showErrorMessage('Toggle theme failed: ' + (e?.message || e));\n  } finally {\n    vm.stop();\n  }\n})();"
  },
  {
    "command": "sbh.demo.whiteboard",
    "text": "$(paintcan) Board",
    "tooltip": "ç°¡æ˜“ç™½æ¿ Webviewï¼ˆç¯„ä¾‹ï¼‰",
    "hidden": false,
    "enableOnInit": false,
    "tags": [
      "default",
      "ui"
    ],
    "script": "// Whiteboard (no save): draw-only Webview + Export PNG + correct Undo/Redo scaling\nconst vscode = require('vscode');\nconst fs = require('fs');\nconst path = require('path');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhWhiteboard',\n    'Whiteboard â€” Draw Only',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  vm.onStop(reason => {\n    try { panel.dispose(); } catch {}\n  });\n\n  panel.onDidDispose(() => {\n    vm.stop();\n  });\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n\n  // æ¥æ”¶ webview çš„åŒ¯å‡ºè«‹æ±‚ â†’ å­˜æª”\n  panel.webview.onDidReceiveMessage(async (msg) => {\n    if (msg?.type !== 'exportPNG' || typeof msg.dataURL !== 'string') return;\n    try {\n      const now = new Date();\n      const y = now.getFullYear();\n      const m = String(now.getMonth()+1).padStart(2,'0');\n      const d = String(now.getDate()).padStart(2,'0');\n      const hh = String(now.getHours()).padStart(2,'0');\n      const mm = String(now.getMinutes()).padStart(2,'0');\n      const ss = String(now.getSeconds()).padStart(2,'0');\n      const defaultName = `whiteboard-${y}${m}${d}-${hh}${mm}${ss}.png`;\n\n      const uri = await vscode.window.showSaveDialog({\n        saveLabel: 'Export PNG',\n        defaultUri: vscode.Uri.file(path.join(process.cwd(), defaultName)),\n        filters: { 'PNG Image': ['png'] }\n      });\n      if (!uri) return;\n\n      const base64 = msg.dataURL.split(',')[1] || '';\n      fs.writeFileSync(uri.fsPath, Buffer.from(base64, 'base64'));\n\n      vscode.window.showInformationMessage(`âœ… Exported: ${path.basename(uri.fsPath)}`);\n      panel.webview.postMessage({ type: 'exported', file: uri.fsPath });\n    } catch (e) {\n      vscode.window.showErrorMessage('Export failed: ' + (e?.message || e));\n    }\n  });\n\n  function getHtml(nonce){\n    return `<!doctype html>\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n<title>Whiteboard (Draw Only)</title>\n<style>\n  :root{ --h:32px }\n  body{font-family:var(--vscode-font-family);color:var(--vscode-foreground);background:var(--vscode-editor-background);margin:0}\n  .bar{display:flex;align-items:center;gap:8px;border-bottom:1px solid var(--vscode-editorGroup-border);padding:6px 8px;height:var(--h);user-select:none;background:var(--vscode-sideBar-background)}\n  .bar input[type=\"color\"]{width:28px;height:20px;border:1px solid var(--vscode-input-border);background:var(--vscode-input-background)}\n  .bar input[type=\"range\"]{width:120px}\n  button{background:var(--vscode-button-background);color:var(--vscode-button-foreground);border:1px solid var(--vscode-button-border,transparent);padding:4px 10px;border-radius:4px;cursor:pointer}\n  button:hover{background:var(--vscode-button-hoverBackground)}\n  #wrap{position:relative;height:calc(100vh - var(--h) - 2px)}\n  canvas{width:100%;height:100%}\n  #grid{position:absolute;inset:0;background:\n        linear-gradient(to right, transparent 99%, var(--vscode-editorGroup-border) 0) 0 0/20px 20px,\n        linear-gradient(to bottom, transparent 99%, var(--vscode-editorGroup-border) 0) 0 0/20px 20px;pointer-events:none;opacity:.2}\n  #msg{margin-left:auto;opacity:.85;font-size:.9em}\n</style>\n<div class=\"bar\">\n  <span>Color</span><input id=\"color\" type=\"color\" value=\"#00d3a7\">\n  <span>Size</span><input id=\"size\" type=\"range\" min=\"1\" max=\"32\" value=\"4\">\n  <button id=\"undo\">Undo</button>\n  <button id=\"redo\">Redo</button>\n  <button id=\"clear\">Clear</button>\n  <span style=\"flex:1\"></span>\n  <button id=\"export\">Export PNG</button>\n  <span id=\"msg\"></span>\n</div>\n<div id=\"wrap\">\n  <canvas id=\"c\"></canvas>\n  <div id=\"grid\"></div>\n</div>\n<script nonce=\"${nonce}\">\n  const vscode = acquireVsCodeApi();\n  const c = document.getElementById('c');\n  const ctx = c.getContext('2d');\n  let drawing=false, last=null;\n  let color=document.getElementById('color').value;\n  let size=+document.getElementById('size').value;\n  const undoStack=[], redoStack=[];\n  const msgEl = document.getElementById('msg');\n\n  function flash(t){ msgEl.textContent=t; setTimeout(()=>msgEl.textContent='', 2000); }\n  function dpr(){ return window.devicePixelRatio || 1; }\n  function applyScale(){ ctx.setTransform(1,0,0,1,0,0); ctx.scale(dpr(), dpr()); }\n\n  function resize(){\n    const r=c.getBoundingClientRect();\n    const tmp=document.createElement('canvas');\n    tmp.width=c.width; tmp.height=c.height;\n    tmp.getContext('2d').drawImage(c,0,0);\n\n    c.width = Math.max(1, Math.round(r.width  * dpr()));\n    c.height= Math.max(1, Math.round(r.height * dpr()));\n    applyScale();\n    try { ctx.drawImage(tmp, 0,0, tmp.width, tmp.height, 0,0, c.width, c.height); } catch {}\n  }\n  new ResizeObserver(resize).observe(document.getElementById('wrap'));\n  setTimeout(resize,0);\n\n  function line(p1,p2){\n    ctx.strokeStyle=color; ctx.lineWidth=size; ctx.lineCap='round'; ctx.lineJoin='round';\n    ctx.beginPath(); ctx.moveTo(p1.x,p1.y); ctx.lineTo(p2.x,p2.y); ctx.stroke();\n  }\n  function pos(e){ const r=c.getBoundingClientRect(); return { x:e.clientX-r.left, y:e.clientY-r.top }; }\n\n  function makeSnap(){ return { w: c.width, h: c.height, url: c.toDataURL('image/png') }; }\n  function snapshot(){ try{ undoStack.push(makeSnap()); if(undoStack.length>30) undoStack.shift(); }catch{} redoStack.length=0; }\n  function restore(snap){\n    return new Promise(res=>{\n      const img=new Image();\n      img.onload=()=>{\n        ctx.setTransform(1,0,0,1,0,0);\n        ctx.clearRect(0,0,c.width,c.height);\n        ctx.drawImage(img, 0,0, snap.w, snap.h, 0,0, c.width, c.height);\n        applyScale();\n        res();\n      };\n      img.src=snap.url;\n    });\n  }\n\n  c.addEventListener('pointerdown', e=>{ e.preventDefault(); snapshot(); drawing=true; last=pos(e); });\n  c.addEventListener('pointermove', e=>{ if(!drawing) return; const p=pos(e); line(last,p); last=p; });\n  c.addEventListener('pointerup',   ()=>{ drawing=false; last=null; });\n  c.addEventListener('pointerleave',()=>{ drawing=false; last=null; });\n\n  document.getElementById('color').oninput=e=>color=e.target.value;\n  document.getElementById('size').oninput =e=>size=+e.target.value;\n\n  document.getElementById('undo').onclick = async ()=>{\n    if(!undoStack.length) return;\n    const snap = undoStack.pop();\n    redoStack.push(makeSnap());\n    await restore(snap);\n  };\n  document.getElementById('redo').onclick = async ()=>{\n    if(!redoStack.length) return;\n    const snap = redoStack.pop();\n    undoStack.push(makeSnap());\n    await restore(snap);\n  };\n  document.getElementById('clear').onclick = ()=>{\n    snapshot();\n    ctx.setTransform(1,0,0,1,0,0);\n    ctx.clearRect(0,0,c.width,c.height);\n    applyScale();\n  };\n\n  document.getElementById('export').onclick= ()=>{\n    try{\n      const url=c.toDataURL('image/png');\n      vscode.postMessage({ type:'exportPNG', dataURL: url });\n      flash('Exportingâ€¦');\n    }catch(e){ flash('Export failed'); }\n  };\n  window.addEventListener('message', e=>{\n    const m=e.data||{};\n    if(m.type==='exported'){\n      const name=(m.file||'').split(/[\\\\/]/).pop()||m.file;\n      flash('Saved: '+name);\n    }\n  });\n<\\/script>`;\n  }\n})();"
  },
  {
    "command": "sbh.demo.pomodoro",
    "text": "ğŸ… Pomodoro",
    "tooltip": "ç•ªèŒ„é˜è¨ˆæ™‚å™¨ï¼ˆç‹€æ…‹åˆ—ï¼‰",
    "hidden": true,
    "enableOnInit": true,
    "tags": [
      "default",
      "productivity"
    ],
    "script": "// @ts-check\n// ğŸ… Pomodoro in Status Bar â€” Quick Pick (Start / Stop, auto-clean on abort)\nconst vscode = require('vscode');\nconst { setInterval, clearInterval } = require('timers');\nconst { randomUUID } = require('crypto');\nconst { vm } = statusBarHelper.v1;\n\n(function () {\n  const DEFAULT_MIN = 25;\n  const PRIORITY = 1000;\n  const KEY = '__SBH_POMODORO_SINGLETON__';\n  /** @type {{\n   *  item?: vscode.StatusBarItem,\n   *  timer?: NodeJS.Timeout|null,\n   *  endAt?: number,\n   *  mode?: 'idle'|'running',\n   *  minutes?: number,\n   *  cmdId?: string,\n   *  disposable?: vscode.Disposable|null\n   * }} */\n  const S = (globalThis[KEY] ||= {\n    timer: null, endAt: 0, mode: 'idle', minutes: DEFAULT_MIN, disposable: null\n  });\n\n  const fmt = (secs) => {\n    const m = Math.floor(secs / 60);\n    const s = secs % 60;\n    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;\n  };\n\n  const createItem = () => {\n    if (!S.item) {\n      S.item = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right, PRIORITY);\n      S.item.command = getCommandId();\n      S.item.tooltip = 'Pomodoro â€” click to open menu';\n      S.item.show();\n    }\n  };\n\n  const getCommandId = () => {\n    if (!S.cmdId) S.cmdId = `sbh.pomodoro.menu.${randomUUID()}`;\n    if (!S.disposable) {\n      try {\n        S.disposable = vscode.commands.registerCommand(S.cmdId, openMenu);\n      } catch {}\n    }\n    return S.cmdId;\n  };\n\n  const update = () => {\n    if (!S.item) return;\n    if (S.mode !== 'running') {\n      S.item.text = `ğŸ… ${String(S.minutes).padStart(2,'0')}:00`;\n      S.item.tooltip = 'Pomodoro â€” click to open menu';\n      return;\n    }\n    const remain = Math.max(0, Math.ceil((S.endAt - Date.now()) / 1000));\n    S.item.text = `ğŸ… ${fmt(remain)}`;\n    S.item.tooltip = 'Counting down â€” click to open menu';\n    if (remain <= 0) finish();\n  };\n\n  const start = (minutes = S.minutes) => {\n    createItem();\n    clearTimer();\n    S.minutes = minutes;\n    S.endAt = Date.now() + minutes * 60 * 1000;\n    S.mode = 'running';\n    update();\n    S.timer = setInterval(update, 1000);\n    vscode.window.showInformationMessage(`ğŸ… Started ${minutes} minutes`);\n  };\n\n  const finish = () => {\n    clearTimer();\n    S.mode = 'idle';\n    update();\n    vscode.window.showInformationMessage('â° Timeâ€™s up! Take a break.');\n    vscode.window.showWarningMessage('â° Pomodoro is over! Start another round?', 'Restart', 'Cancel')\n      .then(choice => { if (choice === 'Restart') start(S.minutes); });\n  };\n\n  const closeAll = () => {\n    clearTimer();\n    S.mode = 'idle';\n    if (S.item) { S.item.dispose(); S.item = undefined; }\n    if (S.disposable) { S.disposable.dispose(); S.disposable = null; }\n    S.cmdId = undefined;\n  };\n\n  const clearTimer = () => {\n    if (S.timer) { clearInterval(S.timer); S.timer = null; }\n  };\n\n  async function openMenu() {\n    const remain = S.mode === 'running' ? Math.max(0, Math.ceil((S.endAt - Date.now())/1000)) : null;\n    /** @type {Array<{label:string, detail?:string, action:'start'|'close'|'custom'|'stop'}>} */\n    const picks = [];\n\n    if (S.mode === 'running') {\n      picks.push({ label: 'Stop', detail: `Stop current timer (remaining ${fmt(remain)})`, action: 'stop' });\n      picks.push({ label: 'Start', detail: `Restart ${S.minutes} minutes`, action: 'start' });\n    } else {\n      picks.push({ label: 'Start', detail: `Start ${S.minutes} minute timer`, action: 'start' });\n    }\n    picks.push({ label: 'Custom minutesâ€¦', detail: 'Enter 1â€“120 minutes to start', action: 'custom' });\n    picks.push({ label: 'Close', detail: 'Remove status bar item', action: 'close' });\n\n    const picked = await vscode.window.showQuickPick(picks, {\n      placeHolder: 'Pomodoro â€” choose an action',\n      ignoreFocusOut: true\n    });\n    if (!picked) return;\n\n    if (picked.action === 'start') start(S.minutes);\n    else if (picked.action === 'stop') { clearTimer(); S.mode = 'idle'; update(); }\n    else if (picked.action === 'close') closeAll();\n    else if (picked.action === 'custom') {\n      const v = await vscode.window.showInputBox({\n        prompt: 'Enter minutes (1â€“120)',\n        value: String(S.minutes),\n        validateInput: (s) => {\n          const n = Number(s);\n          if (!Number.isFinite(n) || n < 1 || n > 120) return 'Enter an integer between 1 and 120';\n          return null;\n        }\n      });\n      if (v) start(Number(v));\n    }\n  }\n\n  // Automatically clean up when externally stopped (e.g., rerun, delete, hide, script change, or disable).\n  vm.onStop(reason => {\n    try { closeAll(); } catch {}\n  });\n\n  createItem();\n  update();\n})();"
  },
  {
    "command": "sbh.demo.vmChatA",
    "text": "$(comment) Chat A",
    "tooltip": "VM è¨Šæ¯å‚³éç¤ºä¾‹ (A) â€” vm.open / sendMessage / onMessage",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "default",
      "vm"
    ],
    "script": "// VM Chat A â€” demonstrates vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop\n// Commands assumed:\n//   A: sbh.demo.vmChatA\n//   B: sbh.demo.vmChatB\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  const SELF = 'sbh.demo.vmChatA';\n  const PEER = 'sbh.demo.vmChatB';\n  let panel;\n\n  vm.onStop(() => { try { panel?.dispose(); } catch {} });\n\n  function ensurePanel () {\n    if (panel) return panel;\n    panel = vscode.window.createWebviewPanel(\n      'sbhVmChatA',\n      'VM Chat A',\n      vscode.ViewColumn.Active,\n      { enableScripts: true, retainContextWhenHidden: true }\n    );\n    panel.onDidDispose(() => { try { vm.stop(); } catch {} });\n\n    const nonce = Math.random().toString(36).slice(2);\n    panel.webview.html = getHtml(nonce, 'A', SELF, PEER);\n    panel.webview.onDidReceiveMessage(onWebviewMessage);\n    return panel;\n  }\n\n  function log (line) { try { panel?.webview.postMessage({ type: 'append', line }); } catch {} }\n\n  function onWebviewMessage (msg) {\n    if (!msg || typeof msg !== 'object') return;\n\n    if (msg.type === 'send') {\n      const text = String(msg.text || '').trim();\n      if (!text) return;\n      vm.sendMessage(PEER, { from: SELF, text, at: Date.now() });\n      log('[me -> B] ' + text);\n    } else if (msg.type === 'openPeer') {\n      vm.open(PEER, { from: SELF, text: 'ğŸ‘‹ Hello (started from A)', at: Date.now() })\n        .catch(e => log('[open error] ' + (e?.message || e)));\n      log('[system] Requested to open B');\n    } else if (msg.type === 'stopPeer') {\n      try { vm.stopByCommand(PEER, { type: 'peerStop', from: SELF, at: Date.now() }); }\n      catch (e) { log('[stopPeer error] ' + (e?.message || e)); }\n      log('[system] Requested to stop B');\n    } else if (msg.type === 'stopSelf') {\n      try { vm.stop({ type: 'selfStop', from: SELF, at: Date.now() }); } catch {}\n    }\n  }\n\n  // Receive messages from peer\n  vm.onMessage((from, payload) => {\n    try {\n      if (from !== PEER) return; // Only show peer messages\n      const text = (payload && payload.text != null) ? String(payload.text) : JSON.stringify(payload);\n      const ts = new Date(payload?.at || Date.now()).toLocaleTimeString();\n      log('[B -> me @ ' + ts + '] ' + text);\n    } catch (e) {\n      log('[recv error] ' + (e?.message || e));\n    }\n  });\n\n  ensurePanel();\n  log('[system] Chat A ready. Use the buttons to interact with Chat B.');\n})();\n\nfunction getHtml (nonce, label, selfCmd, peerCmd) {\n  return `<!doctype html>\n<meta charset=\"utf-8\" />\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'\">\n<title>VM Chat ${label}</title>\n<style>\n  body{font-family:var(--vscode-font-family);margin:0;background:var(--vscode-editor-background);color:var(--vscode-foreground);}\n  header{padding:8px;border-bottom:1px solid var(--vscode-editorGroup-border);display:flex;gap:8px;align-items:center;flex-wrap:wrap;}\n  button{background:var(--vscode-button-background);color:var(--vscode-button-foreground);border:1px solid var(--vscode-button-border,transparent);padding:4px 10px;border-radius:4px;cursor:pointer;font-size:.9em;}\n  button:hover{background:var(--vscode-button-hoverBackground);}\n  input{flex:1;min-width:160px;padding:4px 6px;background:var(--vscode-input-background);color:var(--vscode-input-foreground);border:1px solid var(--vscode-input-border);border-radius:3px;}\n  #log{padding:8px;font:12px var(--vscode-editor-font-family,monospace);white-space:pre-wrap;overflow:auto;max-height:60vh;}\n  footer{padding:6px 8px;border-top:1px solid var(--vscode-editorGroup-border);font-size:11px;opacity:.7;}\n  .cmd{opacity:.7;font-size:.8em}\n</style>\n<header>\n  <strong>Chat ${label}</strong>\n  <button id=\"openPeer\" title=\"Start peer script if not running\">Open Peer</button>\n  <button id=\"stopPeer\" title=\"Stop peer script\">Stop Peer</button>\n  <button id=\"stopSelf\" title=\"Stop this script\">Stop Self</button>\n  <input id=\"msg\" placeholder=\"Type messageâ€¦\" />\n  <button id=\"send\">Send</button>\n</header>\n<div id=\"log\" tabindex=\"0\"></div>\n<footer>self: <code>${selfCmd}</code> &nbsp; peer: <code>${peerCmd}</code> â€” Demonstrating vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop</footer>\n<script nonce=\"${nonce}\">\n  const vscode = acquireVsCodeApi();\n  const logEl = document.getElementById('log');\n\n  function append(line){\n    const at = new Date().toLocaleTimeString();\n    logEl.textContent += \\`[\\${at}] \\${line}\\\\n\\`;\n    logEl.scrollTop = logEl.scrollHeight;\n  }\n\n  append('script injected');\n\n  window.addEventListener('message', e => {\n    const m = e.data || {};\n    if (m.type === 'append') append(m.line);\n  });\n\n  document.getElementById('send').onclick = () => {\n    const el = document.getElementById('msg');\n    vscode.postMessage({ type: 'send', text: el.value });\n    el.value = '';\n  };\n\n  document.getElementById('openPeer').onclick = () => vscode.postMessage({ type: 'openPeer' });\n  document.getElementById('stopPeer').onclick = () => vscode.postMessage({ type: 'stopPeer' });\n  document.getElementById('stopSelf').onclick = () => vscode.postMessage({ type: 'stopSelf' });\n\n  document.getElementById('msg').addEventListener('keydown', e => {\n    if (e.key === 'Enter') document.getElementById('send').click();\n  });\n\n  append('UI loaded.');\n</script>`;\n}\n"
  },
  {
    "command": "sbh.demo.vmChatB",
    "text": "$(comment-discussion) Chat B",
    "tooltip": "VM è¨Šæ¯å‚³éç¤ºä¾‹ (B) â€” vm.open / sendMessage / onMessage",
    "hidden": true,
    "enableOnInit": false,
    "tags": [
      "default",
      "vm"
    ],
    "script": "// VM Chat B â€” demonstrates vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop\n// Commands assumed:\n//   A: sbh.demo.vmChatA\n//   B: sbh.demo.vmChatB\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  const SELF = 'sbh.demo.vmChatB';\n  const PEER = 'sbh.demo.vmChatA';\n  let panel;\n\n  vm.onStop(() => { try { panel?.dispose(); } catch {} });\n\n  function ensurePanel () {\n    if (panel) return panel;\n    panel = vscode.window.createWebviewPanel(\n      'sbhVmChatB',\n      'VM Chat B',\n      vscode.ViewColumn.Active,\n      { enableScripts: true, retainContextWhenHidden: true }\n    );\n    panel.onDidDispose(() => { try { vm.stop(); } catch {} });\n\n    const nonce = Math.random().toString(36).slice(2);\n    panel.webview.html = getHtml(nonce, 'B', SELF, PEER);\n    panel.webview.onDidReceiveMessage(onWebviewMessage);\n    return panel;\n  }\n\n  function log (line) { try { panel?.webview.postMessage({ type: 'append', line }); } catch {} }\n\n  function onWebviewMessage (msg) {\n    if (!msg || typeof msg !== 'object') return;\n\n    if (msg.type === 'send') {\n      const text = String(msg.text || '').trim();\n      if (!text) return;\n      vm.sendMessage(PEER, { from: SELF, text, at: Date.now() });\n      log('[me -> A] ' + text);\n    } else if (msg.type === 'openPeer') {\n      vm.open(PEER, { from: SELF, text: 'ğŸ‘‹ Hello (started from B)', at: Date.now() })\n        .catch(e => log('[open error] ' + (e?.message || e)));\n      log('[system] Requested to open A');\n    } else if (msg.type === 'stopPeer') {\n      try { vm.stopByCommand(PEER, { type: 'peerStop', from: SELF, at: Date.now() }); }\n      catch (e) { log('[stopPeer error] ' + (e?.message || e)); }\n      log('[system] Requested to stop A');\n    } else if (msg.type === 'stopSelf') {\n      try { vm.stop({ type: 'selfStop', from: SELF, at: Date.now() }); } catch {}\n    }\n  }\n\n  // Receive messages from peer\n  vm.onMessage((from, payload) => {\n    try {\n      if (from !== PEER) return; // Only show peer messages\n      const text = (payload && payload.text != null) ? String(payload.text) : JSON.stringify(payload);\n      const ts = new Date(payload?.at || Date.now()).toLocaleTimeString();\n      log('[A -> me @ ' + ts + '] ' + text);\n    } catch (e) {\n      log('[recv error] ' + (e?.message || e));\n    }\n  });\n\n  ensurePanel();\n  log('[system] Chat B ready. Use the buttons to interact with Chat A.');\n})();\n\nfunction getHtml (nonce, label, selfCmd, peerCmd) {\n  return `<!doctype html>\n<meta charset=\"utf-8\" />\n<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'\">\n<title>VM Chat ${label}</title>\n<style>\n  body{font-family:var(--vscode-font-family);margin:0;background:var(--vscode-editor-background);color:var(--vscode-foreground);}\n  header{padding:8px;border-bottom:1px solid var(--vscode-editorGroup-border);display:flex;gap:8px;align-items:center;flex-wrap:wrap;}\n  button{background:var(--vscode-button-background);color:var(--vscode-button-foreground);border:1px solid var(--vscode-button-border,transparent);padding:4px 10px;border-radius:4px;cursor:pointer;font-size:.9em;}\n  button:hover{background:var(--vscode-button-hoverBackground);}\n  input{flex:1;min-width:160px;padding:4px 6px;background:var(--vscode-input-background);color:var(--vscode-input-foreground);border:1px solid var(--vscode-input-border);border-radius:3px;}\n  #log{padding:8px;font:12px var(--vscode-editor-font-family,monospace);white-space:pre-wrap;overflow:auto;max-height:60vh;}\n  footer{padding:6px 8px;border-top:1px solid var(--vscode-editorGroup-border);font-size:11px;opacity:.7;}\n  .cmd{opacity:.7;font-size:.8em}\n</style>\n<header>\n  <strong>Chat ${label}</strong>\n  <button id=\"openPeer\" title=\"Start peer script if not running\">Open Peer</button>\n  <button id=\"stopPeer\" title=\"Stop peer script\">Stop Peer</button>\n  <button id=\"stopSelf\" title=\"Stop this script\">Stop Self</button>\n  <input id=\"msg\" placeholder=\"Type messageâ€¦\" />\n  <button id=\"send\">Send</button>\n</header>\n<div id=\"log\" tabindex=\"0\"></div>\n<footer>self: <code>${selfCmd}</code> &nbsp; peer: <code>${peerCmd}</code> â€” Demonstrating vm.open / vm.sendMessage / vm.onMessage / vm.stopByCommand / vm.stop</footer>\n<script nonce=\"${nonce}\">\n  const vscode = acquireVsCodeApi();\n  const logEl = document.getElementById('log');\n\n  function append(line){\n    const at = new Date().toLocaleTimeString();\n    logEl.textContent += \\`[\\${at}] \\${line}\\\\n\\`;\n    logEl.scrollTop = logEl.scrollHeight;\n  }\n\n  append('script injected');\n\n  window.addEventListener('message', e => {\n    const m = e.data || {};\n    if (m.type === 'append') append(m.line);\n  });\n\n  document.getElementById('send').onclick = () => {\n    const el = document.getElementById('msg');\n    vscode.postMessage({ type: 'send', text: el.value });\n    el.value = '';\n  };\n\n  document.getElementById('openPeer').onclick = () => vscode.postMessage({ type: 'openPeer' });\n  document.getElementById('stopPeer').onclick = () => vscode.postMessage({ type: 'stopPeer' });\n  document.getElementById('stopSelf').onclick = () => vscode.postMessage({ type: 'stopSelf' });\n\n  document.getElementById('msg').addEventListener('keydown', e => {\n    if (e.key === 'Enter') document.getElementById('send').click();\n  });\n\n  append('UI loaded.');\n</script>`;\n}\n"
  },
    {
    "command": "cmd.nsg81ahcgm",
    "text": "â›… å¤©æ°£é å ±",
    "tooltip": "é»æ“ŠæŸ¥çœ‹å¤©æ°£é å ±",
    "hidden": false,
    "enableOnInit": false,
    "script": "// Weather Forecast â€” Webview (Open-Meteo, no API key)\n// ç›´æ¥è²¼åˆ° status-bar-helper çš„æŸå€‹ Script æ¬„ä½å³å¯ä½¿ç”¨\n// é»æ“Šç‹€æ…‹åˆ— â†’ é–‹å•Ÿå¤©æ°£é å ± Webview\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  // é»æ“Šå°±é–‹ä¸€å€‹ webview é¢æ¿\n  const panel = vscode.window.createWebviewPanel(\n    'sbhWeather',\n    'Weather â€” å¤©æ°£é å ±',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  // é—œé–‰/åœæ­¢æ™‚æ¸…ç†\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\n/** ---------- HTML (Webview) ---------- */\nfunction getHtml (nonce) {\n  // åŸå¸‚æ¸…å–®ï¼ˆå¯è‡ªè¡Œå¢æ¸›ï¼‰\n  const cities = [\n    { name: 'å°åŒ—',   lat: 25.0375, lon: 121.5637, tz: 'Asia/Taipei' },\n    { name: 'æ–°ç«¹',   lat: 24.8066, lon: 120.9686, tz: 'Asia/Taipei' },\n    { name: 'å°ä¸­',   lat: 24.1477, lon: 120.6736, tz: 'Asia/Taipei' },\n    { name: 'å°å—',   lat: 22.9997, lon: 120.2270, tz: 'Asia/Taipei' },\n    { name: 'é«˜é›„',   lat: 22.6273, lon: 120.3014, tz: 'Asia/Taipei' },\n    { name: 'èŠ±è“®',   lat: 23.9872, lon: 121.6015, tz: 'Asia/Taipei' },\n    { name: 'å°æ±',   lat: 22.7972, lon: 121.0717, tz: 'Asia/Taipei' },\n    { name: 'æ±äº¬',   lat: 35.6762, lon: 139.6503, tz: 'Asia/Tokyo' },\n    { name: 'é¦–çˆ¾',   lat: 37.5665, lon: 126.9780, tz: 'Asia/Seoul' },\n    { name: 'ç´ç´„',   lat: 40.7128, lon: -74.0060, tz: 'America/New_York' },\n  ];\n\n  // è½‰æˆ <option>\n  const options = cities.map((c, i) =>\n    `<option value=\"${i}\">${c.name}</option>`).join('');\n\n  return /* html */`\n  <!doctype html>\n  <html lang=\"zh-Hant\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"Content-Security-Policy\"\n          content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'; connect-src https:;\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n    <title>Weather â€” å¤©æ°£é å ±</title>\n    <style>\n      :root { --fg:#e7e7e7; --muted:#a7a7a7; --bg:#1e1e1e; --card:#252526; --accent:#5da5ff; }\n      body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Noto Sans TC\", Arial; background:var(--bg); color:var(--fg); }\n      .wrap { padding:14px 16px 24px; max-width: 980px; margin: 0 auto; }\n      .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }\n      select, button, input { background:var(--card); color:var(--fg); border:1px solid #333; border-radius:10px; padding:8px 10px; }\n      button { cursor:pointer; }\n      .card { background:var(--card); border:1px solid #333; border-radius:16px; padding:14px; margin-top:14px; box-shadow: 0 8px 24px rgba(0,0,0,.2); }\n      .title { font-weight:700; font-size:18px; margin-bottom:8px; }\n      .muted { color:var(--muted); }\n      .grid { display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:10px; }\n      .day { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:14px; padding:10px; text-align:center; }\n      .big { font-size:32px; font-weight:800; line-height:1; }\n      .kpis { display:flex; gap:16px; flex-wrap:wrap; }\n      .kpi { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:14px; padding:12px 14px; min-width: 130px; }\n      canvas { width:100%; height:160px; }\n      .sp { flex:1 }\n      .link { color:var(--accent); text-decoration:none; }\n      .row-right { margin-left:auto; display:flex; gap:10px; }\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"row\">\n        <div class=\"title\" style=\"margin:0;\">ğŸŒ¤ï¸ å¤©æ°£é å ±</div>\n        <div class=\"sp\"></div>\n        <select id=\"city\">${options}</select>\n        <button id=\"useCustom\">è‡ªè¨‚åº§æ¨™</button>\n        <input id=\"lat\" placeholder=\"lat\" style=\"width:110px; display:none;\">\n        <input id=\"lon\" placeholder=\"lon\" style=\"width:110px; display:none;\">\n        <button id=\"saveCustom\" style=\"display:none;\">å¥—ç”¨</button>\n        <button id=\"refresh\">é‡æ–°æ•´ç†</button>\n      </div>\n\n      <div id=\"now\" class=\"card\">\n        <div class=\"row\">\n          <div class=\"title\" style=\"margin:0;\">ç›®å‰å¤©æ°£</div>\n          <div class=\"row-right\"><span id=\"updateAt\" class=\"muted\"></span></div>\n        </div>\n        <div class=\"row\" style=\"align-items:flex-end;\">\n          <div class=\"big\" id=\"nowTemp\">--Â°</div>\n          <div id=\"nowText\" style=\"font-size:16px; margin-left:6px;\">--</div>\n        </div>\n        <div class=\"kpis\" style=\"margin-top:8px;\">\n          <div class=\"kpi\">ğŸ’¨ é¢¨é€Ÿ <b id=\"nowWind\">-- m/s</b></div>\n          <div class=\"kpi\">ğŸŒ§ï¸ é™é›¨é‡(ä»Šæ—¥) <b id=\"dayRain\">-- mm</b></div>\n          <div class=\"kpi\">ğŸ”º é«˜æº« <b id=\"dayMax\">--Â°</b></div>\n          <div class=\"kpi\">ğŸ”» ä½æº« <b id=\"dayMin\">--Â°</b></div>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">24 å°æ™‚æº«åº¦èµ°å‹¢</div>\n        <canvas id=\"hourlyChart\" width=\"1000\" height=\"200\"></canvas>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">æœªä¾† 5 æ—¥</div>\n        <div id=\"days\" class=\"grid\"></div>\n      </div>\n\n      <p class=\"muted\" style=\"margin-top:14px;\">\n        è³‡æ–™ä¾†æºï¼š<a class=\"link\" href=\"https://open-meteo.com/\" target=\"_blank\" rel=\"noreferrer\">Open-Meteo</a>ï¼ˆå…é‡‘é‘°ï¼‰\n      </p>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // --- å·¥å…· & å¸¸æ•¸ ---\n      const CITIES = ${JSON.stringify(cities)};\n      const $ = (id) => document.getElementById(id);\n      const fmtTime = (d) => new Date(d).toLocaleString();\n      const WMO = {\n        // ç°¡æ˜“å°ç…§ (WMO weathercode)\n        0:'æ™´æœ—',1:'å¤šé›²',2:'å¤šé›²',3:'é™°',45:'éœ§',48:'éœ§éœœ',\n        51:'æ¯›æ¯›é›¨',53:'æ¯›æ¯›é›¨',55:'æ¯›æ¯›é›¨',56:'å‡éœ§é›¨',57:'å‡éœ§é›¨',\n        61:'å°é›¨',63:'ä¸­é›¨',65:'å¤§é›¨',66:'å‡é›¨',67:'å‡é›¨',\n        71:'å°é›ª',73:'ä¸­é›ª',75:'å¤§é›ª',77:'éœ°',\n        80:'çŸ­æš«å°é›¨',81:'çŸ­æš«ä¸­é›¨',82:'çŸ­æš«å¤§é›¨',\n        85:'çŸ­æš«å°é›ª',86:'çŸ­æš«å¤§é›ª',\n        95:'é›·é›¨',96:'é›·é›¨å¤¾é›¹',99:'å¼·é›·é›¨å¤¾é›¹'\n      };\n      const ICON = (code) => {\n        if ([0].includes(code)) return 'â˜€ï¸';\n        if ([1,2].includes(code)) return 'â›…';\n        if ([3].includes(code)) return 'â˜ï¸';\n        if ([45,48].includes(code)) return 'ğŸŒ«ï¸';\n        if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return 'ğŸŒ§ï¸';\n        if ([71,73,75,77,85,86].includes(code)) return 'â„ï¸';\n        if ([95,96,99].includes(code)) return 'â›ˆï¸';\n        return 'ğŸŒ¡ï¸';\n      };\n\n      // å„²å­˜åå¥½\n      const LS_KEY = 'sbh_weather_pref';\n      function savePref(obj){ localStorage.setItem(LS_KEY, JSON.stringify(obj)); }\n      function loadPref(){ try { return JSON.parse(localStorage.getItem(LS_KEY)||'{}'); } catch { return {}; } }\n\n      // ç•«ç°¡æ˜“æŠ˜ç·š (ä¸ä¾è³´å¤–éƒ¨å¥—ä»¶)\n      function drawLine(canvas, values, labels){\n        const ctx = canvas.getContext('2d');\n        const W = canvas.width, H = canvas.height;\n        ctx.clearRect(0,0,W,H);\n        if (!values || !values.length) return;\n        const min = Math.min(...values), max = Math.max(...values);\n        const padL=40, padR=10, padT=20, padB=24;\n        const X = (i)=> padL + (W - padL - padR) * (i/(values.length-1));\n        const Y = (v)=> padT + (H - padT - padB) * (1 - (v - min) / Math.max(0.0001, (max - min)));\n        // è»¸ç·š\n        ctx.globalAlpha=0.5; ctx.strokeStyle = '#444'; ctx.beginPath();\n        ctx.moveTo(padL, padT); ctx.lineTo(padL, H - padB); ctx.lineTo(W - padR, H - padB); ctx.stroke();\n        ctx.globalAlpha=1;\n        // y æ¨™ç±¤\n        ctx.fillStyle = '#a7a7a7'; ctx.font='12px system-ui';\n        [min, (min+max)/2, max].forEach((v, idx) => {\n          const y = Y(v);\n          ctx.fillText(v.toFixed(1)+'Â°', 6, y+4);\n          ctx.globalAlpha=0.15; ctx.strokeStyle='#888'; ctx.beginPath();\n          ctx.moveTo(padL, y); ctx.lineTo(W-padR, y); ctx.stroke(); ctx.globalAlpha=1;\n        });\n        // æŠ˜ç·š\n        ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });\n        ctx.stroke();\n        // ç¯€é»\n        ctx.fillStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); ctx.beginPath(); ctx.arc(x,y,2.5,0,Math.PI*2); ctx.fill(); });\n        // x æ¨™ç±¤ï¼ˆæ¯ 3 å°æ™‚ï¼‰\n        ctx.fillStyle='#a7a7a7'; ctx.textAlign='center';\n        labels.forEach((t,i)=>{ if(i%3===0){ const x=X(i); ctx.fillText(t, x, H-6); } });\n        ctx.textAlign='left';\n      }\n\n      // API è«‹æ±‚\n      async function fetchWeather(lat, lon, tz){\n        const url = new URL('https://api.open-meteo.com/v1/forecast');\n        url.searchParams.set('latitude', lat);\n        url.searchParams.set('longitude', lon);\n        url.searchParams.set('timezone', tz || 'auto');\n        url.searchParams.set('current_weather', 'true');\n        url.searchParams.set('hourly', 'temperature_2m');\n        url.searchParams.set('daily', 'weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum');\n        url.searchParams.set('forecast_days', '5');\n        const res = await fetch(url.toString(), { cache:'no-store' });\n        if (!res.ok) throw new Error('Network error: ' + res.status);\n        return res.json();\n      }\n\n      // UI ç¶å®š\n      const citySel = $('city');\n      const useCustomBtn = $('useCustom');\n      const latIn = $('lat'), lonIn = $('lon'), saveCustomBtn = $('saveCustom');\n      const refreshBtn = $('refresh');\n      const nowTemp = $('nowTemp'), nowText = $('nowText');\n      const nowWind = $('nowWind'), dayRain = $('dayRain'), dayMax = $('dayMax'), dayMin = $('dayMin'), updAt = $('updateAt');\n      const hourlyChart = $('hourlyChart');\n      const daysWrap = $('days');\n\n      // åˆå§‹åŒ–ï¼šè¼‰å…¥åå¥½\n      const pref = loadPref();\n      if (pref.mode === 'custom' && typeof pref.lat === 'number' && typeof pref.lon === 'number') {\n        citySel.value = String(Math.max(0, Math.min(CITIES.length-1, pref.cityIndex||0))); // UI ä»æŒ‡å‘ä¸€å€‹åŸå¸‚ï¼Œä½†å¯¦éš›ç”¨è‡ªè¨‚\n        latIn.value = String(pref.lat);\n        lonIn.value = String(pref.lon);\n      } else {\n        citySel.value = String(pref.cityIndex ?? 0);\n      }\n\n      let timer = null;\n      async function refresh(){\n        try {\n          const mode = (pref.mode || 'city');\n          const idx = Number(citySel.value) || 0;\n          const city = CITIES[idx];\n          let lat = city.lat, lon = city.lon, tz = city.tz;\n          if (mode === 'custom') {\n            const cla = parseFloat(latIn.value), clo = parseFloat(lonIn.value);\n            if (!Number.isFinite(cla) || !Number.isFinite(clo)) throw new Error('è‡ªè¨‚åº§æ¨™æ ¼å¼éŒ¯èª¤');\n            lat = cla; lon = clo;\n          }\n          const data = await fetchWeather(lat, lon, tz);\n          render(data);\n        } catch (err) {\n          console.error(err);\n          vscode?.postMessage?.({ type:'error', message: String(err) });\n          updAt.textContent = 'æ›´æ–°å¤±æ•—ï¼š' + String(err).slice(0, 80);\n        }\n      }\n\n      function render(data){\n        // ç›®å‰\n        const cw = data.current_weather || {};\n        nowTemp.textContent = (cw.temperature != null ? cw.temperature.toFixed(1) : '--') + 'Â°';\n        nowText.textContent = (ICON(cw.weathercode) + ' ' + (WMO[cw.weathercode] || 'â€”'));\n        nowWind.textContent = (cw.windspeed != null ? cw.windspeed : '--') + ' m/s';\n        updAt.textContent = 'æ›´æ–°æ–¼ ' + fmtTime(new Date());\n\n        // ä»Šæ—¥æ¯æ—¥è³‡è¨Š\n        const d = data.daily || {};\n        if (d.temperature_2m_max && d.temperature_2m_max.length) {\n          dayMax.textContent = d.temperature_2m_max[0].toFixed(1) + 'Â°';\n          dayMin.textContent = d.temperature_2m_min[0].toFixed(1) + 'Â°';\n          dayRain.textContent = (d.precipitation_sum?.[0] ?? 0).toFixed(1) + ' mm';\n        }\n\n        // 24 å°æ™‚\n        const h = data.hourly || {};\n        const nowISO = data.current_weather?.time || new Date().toISOString();\n        const startIdx = Math.max(0, (h.time||[]).indexOf(nowISO));\n        const range = 24;\n        const temps = (h.temperature_2m||[]).slice(startIdx, startIdx+range);\n        const labels = (h.time||[]).slice(startIdx, startIdx+range).map(t => {\n          const dt = new Date(t); return dt.getHours().toString().padStart(2,'0') + ':00';\n        });\n        drawLine(hourlyChart, temps, labels);\n\n        // æœªä¾† 5 æ—¥\n        const days = [];\n        for (let i=0; i<Math.min(5, (d.time||[]).length); i++){\n          const code = d.weathercode?.[i];\n          days.push({\n            date: d.time[i],\n            icon: ICON(code),\n            text: WMO[code] || 'â€”',\n            max: d.temperature_2m_max?.[i],\n            min: d.temperature_2m_min?.[i],\n            rain: d.precipitation_sum?.[i] ?? 0\n          });\n        }\n        daysWrap.innerHTML = days.map(x => {\n          const dd = new Date(x.date);\n          const md = (dd.getMonth()+1) + '/' + dd.getDate();\n          return \\`\n            <div class=\"day\">\n              <div class=\"muted\">\\${md}</div>\n              <div style=\"font-size:24px\">\\${x.icon}</div>\n              <div style=\"margin:2px 0;\">\\${x.text}</div>\n              <div>ğŸ”º \\${x.max?.toFixed?.(1)??'--'}Â°</div>\n              <div>ğŸ”» \\${x.min?.toFixed?.(1)??'--'}Â°</div>\n              <div>ğŸŒ§ï¸ \\${x.rain?.toFixed?.(1)??'--'} mm</div>\n            </div>\\`;\n        }).join('');\n      }\n\n      // äº‹ä»¶\n      citySel.addEventListener('change', () => {\n        const idx = Number(citySel.value)||0;\n        const city = CITIES[idx];\n        // åˆ‡æ›åŸå¸‚ â†’ è‡ªå‹•æ”¹ç‚º city æ¨¡å¼\n        const p = loadPref();\n        p.cityIndex = idx;\n        p.mode = 'city';\n        savePref(p);\n        latIn.style.display='none'; lonIn.style.display='none'; saveCustomBtn.style.display='none';\n        refresh();\n      });\n\n      useCustomBtn.addEventListener('click', () => {\n        // æ‰“é–‹è‡ªè¨‚åº§æ¨™è¼¸å…¥\n        latIn.style.display='inline-block';\n        lonIn.style.display='inline-block';\n        saveCustomBtn.style.display='inline-block';\n        if (!latIn.value || !lonIn.value) {\n          // é å¡«ç›®å‰é¸ä¸­åŸå¸‚åº§æ¨™\n          const c = CITIES[Number(citySel.value)||0];\n          latIn.value = c.lat; lonIn.value = c.lon;\n        }\n      });\n\n      saveCustomBtn.addEventListener('click', () => {\n        const la = parseFloat(latIn.value), lo = parseFloat(lonIn.value);\n        if (!Number.isFinite(la) || !Number.isFinite(lo)) {\n          alert('è«‹è¼¸å…¥æ­£ç¢ºçš„ç¶“ç·¯åº¦');\n          return;\n        }\n        const p = loadPref();\n        p.mode = 'custom';\n        p.lat = la; p.lon = lo;\n        savePref(p);\n        refresh();\n      });\n\n      refreshBtn.addEventListener('click', refresh);\n\n      // å®šæ™‚æ›´æ–°ï¼ˆæ¯ 20 åˆ†é˜ï¼‰\n      clearInterval(timer);\n      timer = setInterval(refresh, 20 * 60 * 1000);\n\n      // é¦–æ¬¡è¼‰å…¥\n      refresh();\n    </script>\n  </body>\n  </html>`;\n}\n"
  },
  {
    "command": "cmd.n69fhe52nu",
    "text": "â›… Weather",
    "tooltip": "Click to view weather forecast",
    "hidden": false,
    "enableOnInit": false,
    "script": "// Weather Forecast â€” Webview (Open-Meteo, no API key, English version, fixed hourly chart)\n// Paste this into status-bar-helper's Script field\n// Click on the status bar â†’ open weather forecast Webview\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  const panel = vscode.window.createWebviewPanel(\n    'sbhWeather',\n    'Weather Forecast',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml (nonce) {\n  const cities = [\n    { name: 'Taipei',    lat: 25.0375, lon: 121.5637, tz: 'Asia/Taipei' },\n    { name: 'Hsinchu',   lat: 24.8066, lon: 120.9686, tz: 'Asia/Taipei' },\n    { name: 'Taichung',  lat: 24.1477, lon: 120.6736, tz: 'Asia/Taipei' },\n    { name: 'Tainan',    lat: 22.9997, lon: 120.2270, tz: 'Asia/Taipei' },\n    { name: 'Kaohsiung', lat: 22.6273, lon: 120.3014, tz: 'Asia/Taipei' },\n    { name: 'Hualien',   lat: 23.9872, lon: 121.6015, tz: 'Asia/Taipei' },\n    { name: 'Taitung',   lat: 22.7972, lon: 121.0717, tz: 'Asia/Taipei' },\n    { name: 'Tokyo',     lat: 35.6762, lon: 139.6503, tz: 'Asia/Tokyo' },\n    { name: 'Seoul',     lat: 37.5665, lon: 126.9780, tz: 'Asia/Seoul' },\n    { name: 'New York',  lat: 40.7128, lon: -74.0060, tz: 'America/New_York' },\n  ];\n\n  const options = cities.map((c, i) =>\n    `<option value=\"${i}\">${c.name}</option>`).join('');\n\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"Content-Security-Policy\"\n          content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'; connect-src https:;\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n    <title>Weather Forecast</title>\n    <style>\n      :root { --fg:#e7e7e7; --muted:#a7a7a7; --bg:#151515; --card:#222; --accent:#5da5ff; --border:#333; }\n      body { background:var(--bg); color:var(--fg); margin:0; font-family: ui-sans-serif, system-ui, -apple-system, \"Segoe UI\", Roboto, Arial; }\n      .wrap { padding:16px; max-width:1080px; margin:0 auto; }\n      .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }\n      select, button, input { background:var(--card); color:var(--fg); border:1px solid var(--border); border-radius:10px; padding:8px 10px; }\n      button { cursor:pointer; }\n      .card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; margin-top:14px; box-shadow: 0 8px 24px rgba(0,0,0,.24); }\n      .title { font-weight:700; font-size:18px; margin-bottom:6px; }\n      .muted { color:var(--muted); }\n      .grid { display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:12px; }\n      .day { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:12px; padding:10px; text-align:center; }\n      .big { font-size:32px; font-weight:800; line-height:1; }\n      .kpis { display:flex; gap:16px; flex-wrap:wrap; margin-top:8px; }\n      .kpi { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:12px; padding:10px 12px; min-width: 140px; }\n      canvas { width:100%; height:180px; }\n      a { color: var(--accent); text-decoration: none; }\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"row\">\n        <div class=\"title\" style=\"margin:0;\">ğŸŒ¤ï¸ Weather Forecast</div>\n        <div style=\"flex:1\"></div>\n        <select id=\"city\">${options}</select>\n        <button id=\"refresh\">Refresh</button>\n      </div>\n\n      <div id=\"now\" class=\"card\">\n        <div class=\"row\">\n          <div class=\"title\" style=\"margin:0;\">Current Weather</div>\n          <div style=\"margin-left:auto\"><span id=\"updateAt\" class=\"muted\"></span></div>\n        </div>\n        <div class=\"row\" style=\"align-items:flex-end;\">\n          <div class=\"big\" id=\"nowTemp\">--Â°</div>\n          <div id=\"nowText\" style=\"margin-left:6px;\">--</div>\n        </div>\n        <div class=\"kpis\">\n          <div class=\"kpi\">ğŸ’¨ Wind <b id=\"nowWind\">-- m/s</b></div>\n          <div class=\"kpi\">ğŸŒ§ï¸ Daily Rain <b id=\"dayRain\">-- mm</b></div>\n          <div class=\"kpi\">ğŸ”º High <b id=\"dayMax\">--Â°</b></div>\n          <div class=\"kpi\">ğŸ”» Low <b id=\"dayMin\">--Â°</b></div>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">Next 24h (Hourly)</div>\n        <canvas id=\"hourlyChart\" width=\"1200\" height=\"220\"></canvas>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">Next 5 Days</div>\n        <div id=\"days\" class=\"grid\"></div>\n      </div>\n\n      <p class=\"muted\" style=\"margin-top:14px;\">Data: <a href=\"https://open-meteo.com/\" target=\"_blank\" rel=\"noreferrer\">Open-Meteo</a></p>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // --- helpers & constants ---\n      const CITIES = ${JSON.stringify(cities)};\n      const $ = (id) => document.getElementById(id);\n      const fmtTime = (d) => new Date(d).toLocaleString();\n      const WMO = {\n        0:'Clear',1:'Mostly clear',2:'Partly cloudy',3:'Cloudy',45:'Fog',48:'Rime fog',\n        51:'Light drizzle',53:'Drizzle',55:'Heavy drizzle',56:'Freezing drizzle',57:'Freezing drizzle',\n        61:'Light rain',63:'Rain',65:'Heavy rain',66:'Freezing rain',67:'Freezing rain',\n        71:'Light snow',73:'Snow',75:'Heavy snow',77:'Snow grains',\n        80:'Showers (light)',81:'Showers (moderate)',82:'Showers (heavy)',\n        85:'Snow showers (light)',86:'Snow showers (heavy)',\n        95:'Thunderstorm',96:'Thunderstorm w/ hail',99:'Severe thunderstorm w/ hail'\n      };\n      const ICON = (code) => {\n        if ([0].includes(code)) return 'â˜€ï¸';\n        if ([1,2].includes(code)) return 'â›…';\n        if ([3].includes(code)) return 'â˜ï¸';\n        if ([45,48].includes(code)) return 'ğŸŒ«ï¸';\n        if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return 'ğŸŒ§ï¸';\n        if ([71,73,75,77,85,86].includes(code)) return 'â„ï¸';\n        if ([95,96,99].includes(code)) return 'â›ˆï¸';\n        return 'ğŸŒ¡ï¸';\n      };\n\n      // simple canvas line chart (no external deps)\n      function drawLine(canvas, values, labels){\n        const ctx = canvas.getContext('2d');\n        const W = canvas.width, H = canvas.height;\n        ctx.clearRect(0,0,W,H);\n        if (!values || !values.length) return;\n\n        const min = Math.min(...values), max = Math.max(...values);\n        const padL=44, padR=12, padT=18, padB=28;\n        const X = (i)=> padL + (W - padL - padR) * (i/(values.length-1));\n        const Y = (v)=> padT + (H - padT - padB) * (1 - (v - min) / Math.max(0.0001, (max - min)));\n\n        // axes & grid\n        ctx.globalAlpha=0.5; ctx.strokeStyle = '#444'; ctx.beginPath();\n        ctx.moveTo(padL, padT); ctx.lineTo(padL, H - padB); ctx.lineTo(W - padR, H - padB); ctx.stroke();\n        ctx.globalAlpha=1;\n\n        // y labels & gridlines\n        ctx.fillStyle = '#a7a7a7'; ctx.font='12px system-ui';\n        [min, (min+max)/2, max].forEach((v) => {\n          const y = Y(v);\n          ctx.fillText(v.toFixed(1)+'Â°', 6, y+4);\n          ctx.globalAlpha=0.15; ctx.strokeStyle='#888'; ctx.beginPath();\n          ctx.moveTo(padL, y); ctx.lineTo(W-padR, y); ctx.stroke(); ctx.globalAlpha=1;\n        });\n\n        // line\n        ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });\n        ctx.stroke();\n\n        // points\n        ctx.fillStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); ctx.beginPath(); ctx.arc(x,y,2.5,0,Math.PI*2); ctx.fill(); });\n\n        // x labels every 3 hours\n        ctx.fillStyle='#a7a7a7'; ctx.textAlign='center';\n        labels.forEach((t,i)=>{ if(i%3===0){ const x=X(i); ctx.fillText(t, x, H-6); } });\n        ctx.textAlign='left';\n      }\n\n      async function fetchWeather(lat, lon, tz){\n        const url = new URL('https://api.open-meteo.com/v1/forecast');\n        url.searchParams.set('latitude', lat);\n        url.searchParams.set('longitude', lon);\n        url.searchParams.set('timezone', tz || 'auto');\n        url.searchParams.set('current_weather', 'true');\n        url.searchParams.set('hourly', 'temperature_2m');\n        url.searchParams.set('daily', 'weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum');\n        url.searchParams.set('forecast_days', '5');\n        url.searchParams.set('past_days', '1'); // include recent past hours to ensure coverage near \"now\"\n        const res = await fetch(url.toString(), { cache:'no-store' });\n        if (!res.ok) throw new Error('Network error: ' + res.status);\n        return res.json();\n      }\n\n      const citySel = $('city'), refreshBtn=$('refresh');\n      const nowTemp=$('nowTemp'), nowText=$('nowText'), nowWind=$('nowWind'), dayRain=$('dayRain'), dayMax=$('dayMax'), dayMin=$('dayMin'), updAt=$('updateAt');\n      const hourlyChart=$('hourlyChart'), daysWrap=$('days');\n\n      async function refresh(){\n        try{\n          const c=CITIES[Number(citySel.value)||0];\n          const d=await fetchWeather(c.lat,c.lon,c.tz);\n          const cw=d.current_weather||{};\n          nowTemp.textContent=(cw.temperature!=null ? cw.temperature.toFixed(1) : '--')+'Â°';\n          nowText.textContent=ICON(cw.weathercode)+' '+(WMO[cw.weathercode]||'--');\n          nowWind.textContent=(cw.windspeed!=null ? cw.windspeed : '--')+' m/s';\n          updAt.textContent='Updated '+fmtTime(new Date());\n\n          if(d.daily){\n            dayMax.textContent=(d.daily.temperature_2m_max?.[0]??'--')+'Â°';\n            dayMin.textContent=(d.daily.temperature_2m_min?.[0]??'--')+'Â°';\n            dayRain.textContent=((d.daily.precipitation_sum?.[0]??0))+' mm';\n          }\n\n          // ---- hourly: pick the closest hour to \"now\" instead of exact indexOf match ----\n          const times = d.hourly?.time || [];\n          const tempsAll = d.hourly?.temperature_2m || [];\n          const nowISO = cw.time || new Date().toISOString();\n          const nowMs = new Date(nowISO).getTime();\n          let start = 0, best = Infinity;\n          for (let i = 0; i < times.length; i++) {\n            const diff = Math.abs(new Date(times[i]).getTime() - nowMs);\n            if (diff < best) { best = diff; start = i; }\n          }\n          const end = Math.min(times.length, start + 24);\n          const temps = tempsAll.slice(start, end);\n          const labels = times.slice(start, end).map(t => {\n            const h = new Date(t).getHours().toString().padStart(2,'0');\n            return \\`\\${h}:00\\`;\n          });\n          drawLine(hourlyChart, temps, labels);\n\n          // ---- 5-day summary ----\n          const days = [];\n          const D = d.daily || {};\n          const n = Math.min(5, (D.time||[]).length);\n          for (let i=0;i<n;i++){\n            days.push({\n              date: D.time[i],\n              icon: ICON(D.weathercode?.[i]),\n              text: WMO[D.weathercode?.[i]] || 'â€”',\n              max: D.temperature_2m_max?.[i],\n              min: D.temperature_2m_min?.[i],\n              rain: D.precipitation_sum?.[i] ?? 0\n            });\n          }\n          daysWrap.innerHTML = days.map(x => {\n            const dd = new Date(x.date);\n            const md = (dd.getMonth()+1) + '/' + dd.getDate();\n            return \\`\n              <div class=\"day\">\n                <div class=\"muted\">\\${md}</div>\n                <div style=\"font-size:24px\">\\${x.icon}</div>\n                <div style=\"margin:2px 0;\">\\${x.text}</div>\n                <div>H: \\${x.max?.toFixed?.(1)??'--'}Â°</div>\n                <div>L: \\${x.min?.toFixed?.(1)??'--'}Â°</div>\n                <div>Rain: \\${x.rain?.toFixed?.(1)??'--'} mm</div>\n              </div>\\`;\n          }).join('');\n        }catch(err){\n          console.error(err);\n          vscode?.postMessage?.({ type:'error', message:String(err) });\n          updAt.textContent = 'Update failed: ' + String(err).slice(0,80);\n        }\n      }\n\n      citySel.onchange = refresh;\n      refreshBtn.onclick = refresh;\n      refresh();\n    </script>\n  </body>\n  </html>`;\n}\n"
  },
  {
    "text": "$(game) è²ªåƒè›‡",
    "tooltip": "é»æ“Šé–‹å§‹ç©è²ªåƒè›‡",
    "command": "cmd.bwfywnftv1",
    "script": "// Snake â€” Webview Game (English UI, for status-bar-helper)\n// Features: Walls Kill/Wrap toggle (persistent), Pause/Resume, Restart, Speed, High Score\n// Canvas 400x400, grid 25x25 (smaller cells)\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhSnake',\n    'ğŸ Snake â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Snake</title>\n    <style>\n      :root {\n        --bg:#0f1115; --card:#161a22; --line:#222838; --fg:#e6e6e6; --muted:#9aa2b1;\n        --accent:#7bd88f; --danger:#ff6b6b; --btn:#1d2330; --btnBorder:#2a3247;\n      }\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:760px;margin:0 auto;padding:16px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px;box-shadow:0 10px 24px rgba(0,0,0,.25)}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:10px 12px;min-width:100px}\n      .btn{background:var(--btn);border:1px solid var(--btnBorder);border-radius:10px;padding:8px 12px;cursor:pointer;color:var(--fg)}\n      .btn:hover{filter:brightness(1.1)}\n      .btn-danger{background:#2a1212;border-color:#502222;color:#ffbbbb}\n      .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .muted{color:var(--muted)}\n      canvas{width:100%;height:auto;display:block;background:#000;border-radius:12px}\n      input[type=range]{accent-color:var(--accent)}\n      .legend{font-size:12px;color:var(--muted)}\n      .title{font-size:18px;font-weight:700}\n      .frame{padding:10px;border-radius:14px;border:1px solid #2b3144;background:#0e1219}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ Snake â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnWalls\" class=\"btn\">ğŸ§± Walls: Kill</button>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn btn-danger\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n          <div class=\"kpi\">Speed: <b id=\"speedLabel\">120ms</b></div>\n          <input id=\"speed\" type=\"range\" min=\"60\" max=\"220\" step=\"10\" value=\"120\">\n        </div>\n      </div>\n\n      <div class=\"card frame\">\n        <canvas id=\"game\" width=\"600\" height=\"500\"></canvas>\n        <div class=\"legend\" style=\"margin-top:8px\">\n          Controls: Arrow keys / WASD Â· P = Pause/Resume Â· R = Restart Â· Walls: Kill/Wrap (toggle above)\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Config & Elements ======\n      const $ = (id)=>document.getElementById(id);\n      const cvs = $('game'), ctx = cvs.getContext('2d');\n      const scoreEl=$('score'), bestEl=$('best');\n      const btnWalls=$('btnWalls'), btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const speedRange=$('speed'), speedLabel=$('speedLabel');\n\n      const GRID = 30;                       // grid size (NxN)\n      const CELL = Math.floor(cvs.width/GRID); // pixels per cell, derived from canvas size\n      const BEST_LS_KEY = 'sbh_snake_best';\n      const WALL_LS_KEY = 'sbh_snake_wall_mode'; // 'kill' | 'wrap'\n\n      // ====== State ======\n      let snake, dir, nextDir, food, score, best, timer, tickMs, paused, dead;\n      let wallMode; // 'kill' or 'wrap'\n\n      function loadWallMode(){ const v = localStorage.getItem(WALL_LS_KEY); return v==='wrap'?'wrap':'kill'; }\n      function saveWallMode(v){ localStorage.setItem(WALL_LS_KEY, v); }\n      function updateWallBtn(){ btnWalls.textContent = (wallMode==='kill') ? 'ğŸ§± Walls: Kill' : 'ğŸŒ€ Walls: Wrap'; }\n\n      function init(){\n        snake = [\n          {x: Math.floor(GRID/2),   y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-1, y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-2, y: Math.floor(GRID/2)},\n        ];\n        dir='RIGHT'; nextDir='RIGHT';\n        score=0; paused=false; dead=false;\n        spawnFood();\n        updateScore();\n        tickMs = Number(speedRange.value);\n        wallMode = loadWallMode();\n        updateWallBtn();\n        loopStart();\n      }\n\n      function loopStart(){ clearInterval(timer); timer=setInterval(tick, tickMs); }\n      function loopPause(p=true){\n        paused=p;\n        if (paused){ clearInterval(timer); btnPause.textContent='â–¶ï¸ Resume'; }\n        else { loopStart(); btnPause.textContent='â¸ï¸ Pause'; }\n      }\n\n      function updateScore(){\n        scoreEl.textContent = String(score);\n        best = Math.max(Number(localStorage.getItem(BEST_LS_KEY)||0), score);\n        localStorage.setItem(BEST_LS_KEY, best);\n        bestEl.textContent = String(best);\n      }\n\n      function spawnFood(){\n        while(true){\n          const fx = Math.floor(Math.random()*GRID);\n          const fy = Math.floor(Math.random()*GRID);\n          if (!snake.some(s=>s.x===fx && s.y===fy)){ food={x:fx,y:fy}; break; }\n        }\n      }\n\n      // ====== Input ======\n      const dirMap = {\n        'ArrowLeft':'LEFT','ArrowUp':'UP','ArrowRight':'RIGHT','ArrowDown':'DOWN',\n        'a':'LEFT','w':'UP','d':'RIGHT','s':'DOWN','A':'LEFT','W':'UP','D':'RIGHT','S':'DOWN'\n      };\n      window.addEventListener('keydown', e=>{\n        if (e.key==='p'||e.key==='P'){ loopPause(!paused); return; }\n        if (e.key==='r'||e.key==='R'){ restart(); return; }\n        const nd = dirMap[e.key];\n        if (!nd) return;\n        if ((dir==='LEFT' && nd==='RIGHT')||(dir==='RIGHT'&&nd==='LEFT')||\n            (dir==='UP'&&nd==='DOWN')||(dir==='DOWN'&&nd==='UP')) return;\n        nextDir = nd;\n      });\n      window.addEventListener('blur', ()=>{ if(!dead) loopPause(true); });\n      window.addEventListener('focus', ()=>{ if(!dead) loopPause(false); });\n\n      // ====== Game Loop ======\n      function tick(){\n        if (paused || dead) return;\n\n        dir = nextDir;\n        const head = {...snake[0]};\n        if (dir==='LEFT') head.x--;\n        else if (dir==='RIGHT') head.x++;\n        else if (dir==='UP') head.y--;\n        else if (dir==='DOWN') head.y++;\n\n        // Walls: Kill or Wrap\n        if (wallMode === 'kill') {\n          if (head.x<0 || head.y<0 || head.x>=GRID || head.y>=GRID){ return gameOver(); }\n        } else {\n          head.x = (head.x + GRID) % GRID;\n          head.y = (head.y + GRID) % GRID;\n        }\n\n        // Self-collision\n        if (snake.some(s=>s.x===head.x && s.y===head.y)){ return gameOver(); }\n\n        // Eat\n        const ate = (head.x===food.x && head.y===food.y);\n        snake.unshift(head);\n        if (ate){ score++; updateScore(); spawnFood(); } else { snake.pop(); }\n\n        draw();\n      }\n\n      // ====== Drawing ======\n      function draw(){\n        ctx.fillStyle='#000'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        for (let y=0;y<GRID;y++){\n          for (let x=0;x<GRID;x++){\n            ctx.fillStyle = ((x+y)%2===0)?'#0a0a0a':'#0c0c0c';\n            ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n          }\n        }\n        // food\n        ctx.fillStyle='#ff5252'; roundRect(xpx(food.x), ypx(food.y), CELL, CELL, 4);\n        // snake\n        for (let i=0;i<snake.length;i++){\n          const s=snake[i];\n          ctx.fillStyle = (i===0)?'#7bd88f':'#57c274';\n          roundRect(xpx(s.x), ypx(s.y), CELL, CELL, i===0?6:4);\n        }\n      }\n\n      function xpx(gx){ return gx*CELL; }\n      function ypx(gy){ return gy*CELL; }\n      function roundRect(x,y,w,h,r){\n        ctx.beginPath();\n        ctx.moveTo(x+r,y);\n        ctx.arcTo(x+w,y,x+w,y+h,r);\n        ctx.arcTo(x+w,y+h,x,y+h,r);\n        ctx.arcTo(x,y+h,x,y,r);\n        ctx.arcTo(x,y,x+w,y,r);\n        ctx.closePath();\n        ctx.fill();\n      }\n\n      function gameOver(){\n        dead = true; clearInterval(timer);\n        ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        ctx.fillStyle='#fff'; ctx.textAlign='center';\n        ctx.font='bold 28px system-ui'; ctx.fillText('Game Over', cvs.width/2, cvs.height/2 - 10);\n        ctx.font='16px system-ui'; ctx.fillText('Press R to Restart', cvs.width/2, cvs.height/2 + 18);\n        return true;\n      }\n\n      function restart(){ clearInterval(timer); init(); draw(); }\n\n      // ====== UI Events ======\n      btnPause.addEventListener('click', ()=> loopPause(!paused));\n      btnRestart.addEventListener('click', restart);\n      btnWalls.addEventListener('click', ()=>{\n        wallMode = (wallMode==='kill') ? 'wrap' : 'kill';\n        saveWallMode(wallMode);\n        updateWallBtn();\n      });\n\n      speedRange.addEventListener('input', ()=>{\n        tickMs = Number(speedRange.value);\n        speedLabel.textContent = tickMs + 'ms';\n        if (!paused && !dead) loopStart();\n      });\n\n      // init\n      speedLabel.textContent = speedRange.value + 'ms';\n      bestEl.textContent = String(localStorage.getItem(BEST_LS_KEY)||0);\n      init();\n      draw();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": false,
    "tags": []
  },
  {
    "text": "$(game) Snake",
    "tooltip": "Click to play Snake",
    "command": "cmd.2k9yg2blib",
    "script": "// Snake â€” Webview Game (English UI, for status-bar-helper)\n// Features: Walls Kill/Wrap toggle (persistent), Pause/Resume, Restart, Speed, High Score\n// Canvas 400x400, grid 25x25 (smaller cells)\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhSnake',\n    'ğŸ Snake â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Snake</title>\n    <style>\n      :root {\n        --bg:#0f1115; --card:#161a22; --line:#222838; --fg:#e6e6e6; --muted:#9aa2b1;\n        --accent:#7bd88f; --danger:#ff6b6b; --btn:#1d2330; --btnBorder:#2a3247;\n      }\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:760px;margin:0 auto;padding:16px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px;box-shadow:0 10px 24px rgba(0,0,0,.25)}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:10px 12px;min-width:100px}\n      .btn{background:var(--btn);border:1px solid var(--btnBorder);border-radius:10px;padding:8px 12px;cursor:pointer;color:var(--fg)}\n      .btn:hover{filter:brightness(1.1)}\n      .btn-danger{background:#2a1212;border-color:#502222;color:#ffbbbb}\n      .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .muted{color:var(--muted)}\n      canvas{width:100%;height:auto;display:block;background:#000;border-radius:12px}\n      input[type=range]{accent-color:var(--accent)}\n      .legend{font-size:12px;color:var(--muted)}\n      .title{font-size:18px;font-weight:700}\n      .frame{padding:10px;border-radius:14px;border:1px solid #2b3144;background:#0e1219}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ Snake â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnWalls\" class=\"btn\">ğŸ§± Walls: Kill</button>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn btn-danger\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n          <div class=\"kpi\">Speed: <b id=\"speedLabel\">120ms</b></div>\n          <input id=\"speed\" type=\"range\" min=\"60\" max=\"220\" step=\"10\" value=\"120\">\n        </div>\n      </div>\n\n      <div class=\"card frame\">\n        <canvas id=\"game\" width=\"600\" height=\"500\"></canvas>\n        <div class=\"legend\" style=\"margin-top:8px\">\n          Controls: Arrow keys / WASD Â· P = Pause/Resume Â· R = Restart Â· Walls: Kill/Wrap (toggle above)\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Config & Elements ======\n      const $ = (id)=>document.getElementById(id);\n      const cvs = $('game'), ctx = cvs.getContext('2d');\n      const scoreEl=$('score'), bestEl=$('best');\n      const btnWalls=$('btnWalls'), btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const speedRange=$('speed'), speedLabel=$('speedLabel');\n\n      const GRID = 30;                       // grid size (NxN)\n      const CELL = Math.floor(cvs.width/GRID); // pixels per cell, derived from canvas size\n      const BEST_LS_KEY = 'sbh_snake_best';\n      const WALL_LS_KEY = 'sbh_snake_wall_mode'; // 'kill' | 'wrap'\n\n      // ====== State ======\n      let snake, dir, nextDir, food, score, best, timer, tickMs, paused, dead;\n      let wallMode; // 'kill' or 'wrap'\n\n      function loadWallMode(){ const v = localStorage.getItem(WALL_LS_KEY); return v==='wrap'?'wrap':'kill'; }\n      function saveWallMode(v){ localStorage.setItem(WALL_LS_KEY, v); }\n      function updateWallBtn(){ btnWalls.textContent = (wallMode==='kill') ? 'ğŸ§± Walls: Kill' : 'ğŸŒ€ Walls: Wrap'; }\n\n      function init(){\n        snake = [\n          {x: Math.floor(GRID/2),   y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-1, y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-2, y: Math.floor(GRID/2)},\n        ];\n        dir='RIGHT'; nextDir='RIGHT';\n        score=0; paused=false; dead=false;\n        spawnFood();\n        updateScore();\n        tickMs = Number(speedRange.value);\n        wallMode = loadWallMode();\n        updateWallBtn();\n        loopStart();\n      }\n\n      function loopStart(){ clearInterval(timer); timer=setInterval(tick, tickMs); }\n      function loopPause(p=true){\n        paused=p;\n        if (paused){ clearInterval(timer); btnPause.textContent='â–¶ï¸ Resume'; }\n        else { loopStart(); btnPause.textContent='â¸ï¸ Pause'; }\n      }\n\n      function updateScore(){\n        scoreEl.textContent = String(score);\n        best = Math.max(Number(localStorage.getItem(BEST_LS_KEY)||0), score);\n        localStorage.setItem(BEST_LS_KEY, best);\n        bestEl.textContent = String(best);\n      }\n\n      function spawnFood(){\n        while(true){\n          const fx = Math.floor(Math.random()*GRID);\n          const fy = Math.floor(Math.random()*GRID);\n          if (!snake.some(s=>s.x===fx && s.y===fy)){ food={x:fx,y:fy}; break; }\n        }\n      }\n\n      // ====== Input ======\n      const dirMap = {\n        'ArrowLeft':'LEFT','ArrowUp':'UP','ArrowRight':'RIGHT','ArrowDown':'DOWN',\n        'a':'LEFT','w':'UP','d':'RIGHT','s':'DOWN','A':'LEFT','W':'UP','D':'RIGHT','S':'DOWN'\n      };\n      window.addEventListener('keydown', e=>{\n        if (e.key==='p'||e.key==='P'){ loopPause(!paused); return; }\n        if (e.key==='r'||e.key==='R'){ restart(); return; }\n        const nd = dirMap[e.key];\n        if (!nd) return;\n        if ((dir==='LEFT' && nd==='RIGHT')||(dir==='RIGHT'&&nd==='LEFT')||\n            (dir==='UP'&&nd==='DOWN')||(dir==='DOWN'&&nd==='UP')) return;\n        nextDir = nd;\n      });\n      window.addEventListener('blur', ()=>{ if(!dead) loopPause(true); });\n      window.addEventListener('focus', ()=>{ if(!dead) loopPause(false); });\n\n      // ====== Game Loop ======\n      function tick(){\n        if (paused || dead) return;\n\n        dir = nextDir;\n        const head = {...snake[0]};\n        if (dir==='LEFT') head.x--;\n        else if (dir==='RIGHT') head.x++;\n        else if (dir==='UP') head.y--;\n        else if (dir==='DOWN') head.y++;\n\n        // Walls: Kill or Wrap\n        if (wallMode === 'kill') {\n          if (head.x<0 || head.y<0 || head.x>=GRID || head.y>=GRID){ return gameOver(); }\n        } else {\n          head.x = (head.x + GRID) % GRID;\n          head.y = (head.y + GRID) % GRID;\n        }\n\n        // Self-collision\n        if (snake.some(s=>s.x===head.x && s.y===head.y)){ return gameOver(); }\n\n        // Eat\n        const ate = (head.x===food.x && head.y===food.y);\n        snake.unshift(head);\n        if (ate){ score++; updateScore(); spawnFood(); } else { snake.pop(); }\n\n        draw();\n      }\n\n      // ====== Drawing ======\n      function draw(){\n        ctx.fillStyle='#000'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        for (let y=0;y<GRID;y++){\n          for (let x=0;x<GRID;x++){\n            ctx.fillStyle = ((x+y)%2===0)?'#0a0a0a':'#0c0c0c';\n            ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n          }\n        }\n        // food\n        ctx.fillStyle='#ff5252'; roundRect(xpx(food.x), ypx(food.y), CELL, CELL, 4);\n        // snake\n        for (let i=0;i<snake.length;i++){\n          const s=snake[i];\n          ctx.fillStyle = (i===0)?'#7bd88f':'#57c274';\n          roundRect(xpx(s.x), ypx(s.y), CELL, CELL, i===0?6:4);\n        }\n      }\n\n      function xpx(gx){ return gx*CELL; }\n      function ypx(gy){ return gy*CELL; }\n      function roundRect(x,y,w,h,r){\n        ctx.beginPath();\n        ctx.moveTo(x+r,y);\n        ctx.arcTo(x+w,y,x+w,y+h,r);\n        ctx.arcTo(x+w,y+h,x,y+h,r);\n        ctx.arcTo(x,y+h,x,y,r);\n        ctx.arcTo(x,y,x+w,y,r);\n        ctx.closePath();\n        ctx.fill();\n      }\n\n      function gameOver(){\n        dead = true; clearInterval(timer);\n        ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        ctx.fillStyle='#fff'; ctx.textAlign='center';\n        ctx.font='bold 28px system-ui'; ctx.fillText('Game Over', cvs.width/2, cvs.height/2 - 10);\n        ctx.font='16px system-ui'; ctx.fillText('Press R to Restart', cvs.width/2, cvs.height/2 + 18);\n        return true;\n      }\n\n      function restart(){ clearInterval(timer); init(); draw(); }\n\n      // ====== UI Events ======\n      btnPause.addEventListener('click', ()=> loopPause(!paused));\n      btnRestart.addEventListener('click', restart);\n      btnWalls.addEventListener('click', ()=>{\n        wallMode = (wallMode==='kill') ? 'wrap' : 'kill';\n        saveWallMode(wallMode);\n        updateWallBtn();\n      });\n\n      speedRange.addEventListener('input', ()=>{\n        tickMs = Number(speedRange.value);\n        speedLabel.textContent = tickMs + 'ms';\n        if (!paused && !dead) loopStart();\n      });\n\n      // init\n      speedLabel.textContent = speedRange.value + 'ms';\n      bestEl.textContent = String(localStorage.getItem(BEST_LS_KEY)||0);\n      init();\n      draw();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": false,
    "tags": []
  },
  {
    "text": "$(game) Tetris",
    "tooltip": "Click to start playing Tetris",
    "command": "cmd.altyz8fux1",
    "script": "// Tetris â€” Webview Game (centered board + lock delay so you can rotate on landing)\n// Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n// Canvas 240x480 (10x20, 24px cell). Start Level adjustable. Gravity base 700ms (âˆ’60ms/level, min 80). Soft drop 60ms.\n// NEW: Lock Delay 500ms â†’ when piece touches the ground, you can still rotate/move before it locks.\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhTetris',\n    'ğŸ§± Tetris â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Tetris</title>\n    <style>\n      :root{--bg:#0f1115;--fg:#e6e6e6;--muted:#9aa2b1;--card:#161a22;--line:#222838;--btn:#1d2330;--btnb:#2a3247;--accent:#7bd88f}\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:860px;margin:0 auto;padding:14px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .btn{background:var(--btn);border:1px solid var(--btnb);border-radius:10px;padding:8px 12px;color:var(--fg);cursor:pointer}\n      .btn:hover{filter:brightness(1.1)}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:8px 12px;min-width:120px}\n      .title{font-weight:700}\n      .legend{font-size:12px;color:var(--muted)}\n      canvas{display:block;background:#000;border-radius:8px}\n      /* éŠæˆ²å€å¡Šç½®ä¸­ */\n      .board{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap;justify-content:center}\n      .side{display:flex;flex-direction:column;gap:10px}\n      .panel{background:#0e1219;border:1px solid #2b3144;border-radius:12px;padding:8px}\n      .grid{display:grid;grid-template-columns:repeat(2,auto);gap:10px;align-items:center}\n      input[type=range]{accent-color:var(--accent)}\n      .num{min-width:42px;display:inline-block;text-align:right}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ§± Tetris â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">Lines: <b id=\"lines\">0</b></div>\n          <div class=\"kpi\">Level: <b id=\"level\">1</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n        </div>\n        <div class=\"legend\" style=\"margin-top:6px\">\n          Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n        </div>\n      </div>\n\n      <!-- Settingsï¼šåªä¿ç•™ Start Level -->\n      <div class=\"card\">\n        <div class=\"title\" style=\"margin-bottom:8px\">Settings</div>\n        <div class=\"grid\">\n          <div>Start Level</div>\n          <div style=\"display:flex;align-items:center;gap:8px\">\n            <input id=\"startLevel\" type=\"range\" min=\"1\" max=\"20\" step=\"1\" value=\"1\">\n            <span id=\"startLevelLabel\" class=\"num\">1</span>\n          </div>\n        </div>\n        <div style=\"margin-top:10px;display:flex;gap:10px;align-items:center\">\n          <button id=\"btnApply\" class=\"btn\">âœ… Apply & Restart</button>\n          <span class=\"legend\">Gravity speeds up by 60ms per level (min 80ms).</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"board\">\n          <!-- å°ç•«é¢ï¼š240x480 / 10x20 / 24px cell -->\n          <canvas id=\"game\" width=\"240\" height=\"480\"></canvas>\n          <div class=\"side\">\n            <div class=\"panel\">\n              <div class=\"title\">Hold</div>\n              <canvas id=\"hold\" width=\"96\" height=\"96\" style=\"margin-top:6px\"></canvas>\n            </div>\n            <div class=\"panel\">\n              <div class=\"title\">Next</div>\n              <canvas id=\"next\" width=\"96\" height=\"240\" style=\"margin-top:6px\"></canvas>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Elements / Persistent Setting ======\n      const $ = id => document.getElementById(id);\n      const gc = $('game').getContext('2d');\n      const hc = $('hold').getContext('2d');\n      const nc = $('next').getContext('2d');\n\n      const scoreEl=$('score'), linesEl=$('lines'), levelEl=$('level'), bestEl=$('best');\n      const btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const startLevelInput=$('startLevel'), startLevelLabel=$('startLevelLabel');\n      const btnApply=$('btnApply');\n\n      const SETTINGS_KEY = 'sbh_tetris_settings_v3';\n      function loadSettings(){\n        try{\n          const v = JSON.parse(localStorage.getItem(SETTINGS_KEY)||'{}');\n          return { startLevel: Number.isFinite(v.startLevel)? v.startLevel : 1 };\n        }catch{ return { startLevel:1 }; }\n      }\n      function saveSettings(s){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(s)); }\n\n      const S = loadSettings();\n      startLevelInput.value = String(S.startLevel);\n      startLevelLabel.textContent = S.startLevel;\n\n      // å›ºå®šåƒæ•¸\n      const BASE_MS  = 700; // åŸºç¤é‡åŠ›ï¼ˆms/æ ¼ï¼‰\n      const SOFT_MS  = 60;  // æŒ‰ä½â†“ çš„é€£çºŒ soft drop é–“éš”ï¼ˆms/æ ¼ï¼‰\n      const MIN_MS   = 80;  // æœ€å¿«é‡åŠ›\n      const LOCK_DELAY_MS = 500; // â˜… è½åœ°å¾Œçš„ã€Œå»¶é²é–å®šã€æ™‚é–“ï¼Œå¯åœ¨é€™è£¡èª¿æ•´\n\n      // ====== Game Constants ======\n      const W = 10, H = 20, CELL = 24;\n      const BEST_KEY = 'sbh_tetris_high';\n      const COLORS = {\n        I:'#00f0f0', O:'#f0f000', T:'#a020f0', S:'#00d000', Z:'#d00000', J:'#0000d0', L:'#f0a000', GHOST:'rgba(255,255,255,0.15)'\n      };\n      const ROT = {\n        I: [\n          [[0,1],[1,1],[2,1],[3,1]],\n          [[2,0],[2,1],[2,2],[2,3]],\n          [[0,2],[1,2],[2,2],[3,2]],\n          [[1,0],[1,1],[1,2],[1,3]],\n        ],\n        O: [[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]]],\n        T: [\n          [[1,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[2,1],[1,2]],\n          [[1,0],[0,1],[1,1],[1,2]],\n        ],\n        S: [\n          [[1,0],[2,0],[0,1],[1,1]],\n          [[1,0],[1,1],[2,1],[2,2]],\n          [[1,1],[2,1],[0,2],[1,2]],\n          [[0,0],[0,1],[1,1],[1,2]],\n        ],\n        Z: [\n          [[0,0],[1,0],[1,1],[2,1]],\n          [[2,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[1,2],[2,2]],\n          [[1,0],[0,1],[1,1],[0,2]],\n        ],\n        J: [\n          [[0,0],[0,1],[1,1],[2,1]],\n          [[1,0],[2,0],[1,1],[1,2]],\n          [[0,1],[1,1],[2,1],[2,2]],\n          [[1,0],[1,1],[0,2],[1,2]],\n        ],\n        L: [\n          [[2,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[1,2],[2,2]],\n          [[0,1],[1,1],[2,1],[0,2]],\n          [[0,0],[1,0],[1,1],[1,2]],\n        ]\n      };\n      const TYPES = Object.keys(ROT);\n\n      // ====== Game State ======\n      let board, queue, cur, hold=null, canHold=true;\n      let score=0, lines=0, level=S.startLevel, best=Number(localStorage.getItem(BEST_KEY)||0);\n      let paused=false, over=false, timer=null;\n\n      // Soft drop\n      let softHeld=false, softTimer=null;\n\n      // â˜… Lock Delay ç‹€æ…‹\n      let grounded=false;      // æ˜¯å¦å·²ç¶“ã€Œæ¥åœ°ã€ï¼ˆä¸‹ä¸€æ ¼ä¸‹ä¸å»ï¼‰\n      let lockExpire=0;        // ä½•æ™‚åˆ°æœŸé–å®šï¼ˆtime msï¼‰\n\n      bestEl.textContent = String(best);\n\n      // ====== Helpers ======\n      function emptyBoard(){ return Array.from({length:H},()=>Array(W).fill(null)); }\n      function newBag(){ const a=[...TYPES]; for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]] } return a; }\n      function ensureQueue(){ if(queue.length<7) queue.push(...newBag()); }\n      function spawn(){\n        const type = queue.shift(); ensureQueue();\n        cur = { type, r:0, x:3, y:0 };\n        grounded=false; lockExpire=0;\n        if (!canPlace(cur, cur.x, cur.y)){ gameOver(); }\n        canHold = true;\n      }\n      function cells(p){ return ROT[p.type][p.r]; }\n      function canPlace(p, nx, ny, nr=p.r){\n        const shape = ROT[p.type][nr];\n        for(const [dx,dy] of shape){\n          const x = nx+dx, y = ny+dy;\n          if (x<0 || x>=W || y<0 || y>=H) return false;\n          if (board[y][x]) return false;\n        }\n        return true;\n      }\n      function startLockDelay(){ grounded=true; lockExpire = Date.now() + LOCK_DELAY_MS; }\n      function clearLock(){ grounded=false; lockExpire=0; }\n\n      function lock(){\n        for(const [dx,dy] of cells(cur)){\n          const x=cur.x+dx, y=cur.y+dy;\n          if (y>=0 && y<H) board[y][x] = cur.type;\n        }\n        grounded=false; lockExpire=0;\n        clearLines(); spawn();\n      }\n      function clearLines(){\n        let cleared=0;\n        for(let y=H-1;y>=0;){\n          if (board[y].every(Boolean)){ board.splice(y,1); board.unshift(Array(W).fill(null)); cleared++; }\n          else y--;\n        }\n        if (cleared>0){\n          score += [0,100,300,500,800][cleared] * level;\n          lines += cleared;\n          const newLevel = Math.max(1, S.startLevel + Math.floor(lines/10));\n          if (newLevel!==level){ level=newLevel; restartGravity(); }\n          updateHUD();\n        }\n      }\n      function holdSwap(){\n        if (!canHold || over) return;\n        if (hold===null){ hold=cur.type; spawn(); }\n        else { const t=hold; hold=cur.type; cur={type:t, r:0, x:3, y:0}; if(!canPlace(cur,cur.x,cur.y)){ gameOver(); return; } }\n        canHold=false; drawSide();\n      }\n\n      // æˆåŠŸç§»å‹•/æ—‹è½‰å¾Œï¼Œæ›´æ–°æ¥åœ°ç‹€æ…‹ï¼šå¦‚æœä»æ¥åœ°å°±é‡ç½® lock delay\n      function refreshLockAfterAction(){\n        if (canPlace(cur, cur.x, cur.y+1)) {\n          clearLock();\n        } else {\n          startLockDelay(); // still grounded â†’ reset timer\n        }\n      }\n\n      function rotate(dir){ // +1 CW / -1 CCW\n        if (over) return;\n        const nr = (cur.r + (dir>0?1:3)) % 4;\n        const kicks = [[0,0],[1,0],[-1,0],[0,-1],[2,0],[-2,0]];\n        for (const [kx,ky] of kicks){\n          const nx = cur.x+kx, ny=cur.y+ky;\n          if (canPlace(cur,nx,ny,nr)){ cur.r=nr; cur.x=nx; cur.y=ny; refreshLockAfterAction(); draw(); return; }\n        }\n      }\n\n      function move(dx){\n        if (over) return;\n        const nx = cur.x + dx;\n        if (canPlace(cur, nx, cur.y)){ cur.x = nx; refreshLockAfterAction(); draw(); }\n      }\n\n      function softDropStep(){\n        if (paused || over) return;\n        if (canPlace(cur, cur.x, cur.y+1)){\n          cur.y++; score += 1; updateHUD(false);\n          clearLock(); // ä¸€æ—¦å¾€ä¸‹æˆåŠŸï¼Œå–æ¶ˆæ¥åœ°ç‹€æ…‹\n          draw();\n        } else {\n          if (!grounded) { startLockDelay(); }\n          // å·²æ¥åœ°ï¼šç­‰åˆ°æ™‚é–“åˆ°æ‰ lock\n          if (Date.now() >= lockExpire){ lock(); }\n          draw();\n        }\n      }\n\n      function hardDrop(){\n        if (over) return;\n        let dist=0; while (canPlace(cur,cur.x,cur.y+1)){ cur.y++; dist++; }\n        score += dist*2; updateHUD(false);\n        lock(); draw(); // Hard drop ç«‹å³é–å®š\n      }\n\n      // ====== Gravity ======\n      function gravityMs(lv){\n        return Math.max(MIN_MS, BASE_MS - (lv-1)*60);\n      }\n      function restartGravity(){\n        clearInterval(timer);\n        timer = setInterval(()=>{\n          if (paused || over) return;\n          if (canPlace(cur, cur.x, cur.y+1)){\n            cur.y++;\n            clearLock();\n          } else {\n            if (!grounded) { startLockDelay(); }\n            else if (Date.now() >= lockExpire) { lock(); }\n          }\n          draw();\n        }, gravityMs(level));\n      }\n\n      // ====== Drawing ======\n      function drawCell(ctx,x,y,color){\n        ctx.fillStyle=color;\n        ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n        ctx.fillStyle='rgba(255,255,255,0.07)';\n        ctx.fillRect(x*CELL, y*CELL, CELL, Math.max(2, CELL*0.18));\n      }\n      function ghostY(){ let gy=cur.y; while (canPlace(cur,cur.x,gy+1)) gy++; return gy; }\n      function draw(){\n        const c = gc.canvas; gc.clearRect(0,0,c.width,c.height);\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ gc.fillStyle=((x+y)%2===0)?'#0a0a0a':'#0c0c0c'; gc.fillRect(x*CELL,y*CELL,CELL,CELL); } }\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ const t=board[y][x]; if(t) drawCell(gc,x,y,COLORS[t]); } }\n        const gy = ghostY();\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=gy+dy; gc.fillStyle=COLORS.GHOST; gc.fillRect(x*CELL,y*CELL,CELL,CELL); }\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=cur.y+dy; drawCell(gc,x,y,COLORS[cur.type]); }\n\n        // å¦‚æœæ¥åœ°ä¸­ï¼Œå¯åœ¨åº•éƒ¨ç•«ä¸€åœˆæ·¡é‚Šæç¤ºï¼ˆå¯é¸ï¼‰\n        // if (grounded) { gc.strokeStyle='rgba(255,255,255,.15)'; gc.lineWidth=2; gc.strokeRect(0, (H-1)*CELL+1, W*CELL, CELL-2); }\n\n        drawSide();\n        if (over) drawGameOver();\n      }\n      function drawGameOver(){\n        const c = gc.canvas; gc.fillStyle='rgba(0,0,0,0.6)'; gc.fillRect(0,0,c.width,c.height);\n        gc.fillStyle='#fff'; gc.textAlign='center'; gc.font='bold 22px system-ui'; gc.fillText('Game Over', c.width/2, c.height/2 - 10);\n        gc.font='14px system-ui'; gc.fillText('Press R to Restart', c.width/2, c.height/2 + 16);\n      }\n      function drawMini(ctx,type,cell=16){\n        ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);\n        if(!type) return;\n        const shape=ROT[type][0]; const ox=2, oy=2;\n        for(const [dx,dy] of shape){\n          ctx.fillStyle=COLORS[type]; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,cell);\n          ctx.fillStyle='rgba(255,255,255,0.08)'; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,Math.max(2,cell*0.18));\n        }\n      }\n      function drawSide(){\n        drawMini(hc, hold, 16);\n        nc.clearRect(0,0,nc.canvas.width,nc.canvas.height);\n        const show = queue.slice(0,5), cell=14;\n        show.forEach((t,i)=>{\n          const offY = i*46 + 4;\n          const shape = ROT[t][0];\n          for(const [dx,dy] of shape){\n            nc.fillStyle=COLORS[t];\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, cell);\n            nc.fillStyle='rgba(255,255,255,0.08)';\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, Math.max(2,cell*0.18));\n          }\n        });\n      }\n\n      // ====== HUD ======\n      function updateHUD(updateBest=true){\n        scoreEl.textContent = String(score);\n        linesEl.textContent = String(lines);\n        levelEl.textContent = String(level);\n        if (updateBest){\n          const b = Math.max(Number(localStorage.getItem(BEST_KEY)||0), score);\n          localStorage.setItem(BEST_KEY, b);\n          bestEl.textContent = String(b);\n        }\n      }\n      function gameOver(){ over=true; clearInterval(timer); stopSoftHeld(); updateHUD(); draw(); }\n\n      // ====== Reset / Init ======\n      function resetGame(){\n        board = emptyBoard();\n        queue = [...newBag(), ...newBag()];\n        cur=null; hold=null; canHold=true;\n        score=0; lines=0; level=S.startLevel; paused=false; over=false;\n        grounded=false; lockExpire=0;\n        updateHUD();\n        spawn();\n        restartGravity();\n        draw();\n      }\n\n      // ====== Input ======\n      function stopSoftHeld(){ softHeld=false; clearInterval(softTimer); softTimer=null; }\n      window.addEventListener('keydown', (e)=>{\n        if (e.key===' '){ e.preventDefault(); }\n        if (over){ if (e.key==='r'||e.key==='R'){ resetGame(); } return; }\n\n        if (e.key==='p'||e.key==='P'){ paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; return; }\n        if (paused) return;\n\n        if (e.key==='ArrowLeft'){ move(-1); }\n        else if (e.key==='ArrowRight'){ move(1); }\n        else if (e.key==='ArrowDown'){\n          if (!softHeld){ softHeld=true; softDropStep(); softTimer=setInterval(softDropStep, Math.max(10, SOFT_MS)); }\n        }\n        else if (e.key==='ArrowUp' || e.key==='x' || e.key==='X'){ rotate(+1); }\n        else if (e.key==='z' || e.key==='Z'){ rotate(-1); }\n        else if (e.key==='c' || e.key==='C' || e.key==='Shift'){ holdSwap(); }\n        else if (e.key===' '){ hardDrop(); }\n        else if (e.key==='r' || e.key==='R'){ resetGame(); }\n      });\n      window.addEventListener('keyup', (e)=>{ if (e.key==='ArrowDown'){ stopSoftHeld(); } });\n      window.addEventListener('blur', ()=>{ if(!over){ paused=true; btnPause.textContent='â–¶ï¸ Resume'; stopSoftHeld(); } });\n\n      // Buttons\n      btnPause.addEventListener('click', ()=>{ if(over) return; paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; });\n      btnRestart.addEventListener('click', resetGame);\n\n      // Settings UI\n      startLevelInput.addEventListener('input', ()=> startLevelLabel.textContent = startLevelInput.value);\n      btnApply.addEventListener('click', ()=>{\n        S.startLevel = Number(startLevelInput.value);\n        saveSettings(S);\n        resetGame();\n      });\n\n      // Init\n      resetGame();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": false,
    "tags": []
  },
  {
    "text": "$(game) ä¿„ç¾…æ–¯æ–¹å¡Š",
    "tooltip": "é»æ“Šé–‹å§‹ç©ä¿„ç¾…æ–¯æ–¹å¡Š",
    "command": "cmd.mv36wj9976",
    "script": "// Tetris â€” Webview Game (centered board + lock delay so you can rotate on landing)\n// Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n// Canvas 240x480 (10x20, 24px cell). Start Level adjustable. Gravity base 700ms (âˆ’60ms/level, min 80). Soft drop 60ms.\n// NEW: Lock Delay 500ms â†’ when piece touches the ground, you can still rotate/move before it locks.\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhTetris',\n    'ğŸ§± Tetris â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Tetris</title>\n    <style>\n      :root{--bg:#0f1115;--fg:#e6e6e6;--muted:#9aa2b1;--card:#161a22;--line:#222838;--btn:#1d2330;--btnb:#2a3247;--accent:#7bd88f}\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:860px;margin:0 auto;padding:14px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .btn{background:var(--btn);border:1px solid var(--btnb);border-radius:10px;padding:8px 12px;color:var(--fg);cursor:pointer}\n      .btn:hover{filter:brightness(1.1)}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:8px 12px;min-width:120px}\n      .title{font-weight:700}\n      .legend{font-size:12px;color:var(--muted)}\n      canvas{display:block;background:#000;border-radius:8px}\n      /* éŠæˆ²å€å¡Šç½®ä¸­ */\n      .board{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap;justify-content:center}\n      .side{display:flex;flex-direction:column;gap:10px}\n      .panel{background:#0e1219;border:1px solid #2b3144;border-radius:12px;padding:8px}\n      .grid{display:grid;grid-template-columns:repeat(2,auto);gap:10px;align-items:center}\n      input[type=range]{accent-color:var(--accent)}\n      .num{min-width:42px;display:inline-block;text-align:right}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ§± Tetris â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">Lines: <b id=\"lines\">0</b></div>\n          <div class=\"kpi\">Level: <b id=\"level\">1</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n        </div>\n        <div class=\"legend\" style=\"margin-top:6px\">\n          Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n        </div>\n      </div>\n\n      <!-- Settingsï¼šåªä¿ç•™ Start Level -->\n      <div class=\"card\">\n        <div class=\"title\" style=\"margin-bottom:8px\">Settings</div>\n        <div class=\"grid\">\n          <div>Start Level</div>\n          <div style=\"display:flex;align-items:center;gap:8px\">\n            <input id=\"startLevel\" type=\"range\" min=\"1\" max=\"20\" step=\"1\" value=\"1\">\n            <span id=\"startLevelLabel\" class=\"num\">1</span>\n          </div>\n        </div>\n        <div style=\"margin-top:10px;display:flex;gap:10px;align-items:center\">\n          <button id=\"btnApply\" class=\"btn\">âœ… Apply & Restart</button>\n          <span class=\"legend\">Gravity speeds up by 60ms per level (min 80ms).</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"board\">\n          <!-- å°ç•«é¢ï¼š240x480 / 10x20 / 24px cell -->\n          <canvas id=\"game\" width=\"240\" height=\"480\"></canvas>\n          <div class=\"side\">\n            <div class=\"panel\">\n              <div class=\"title\">Hold</div>\n              <canvas id=\"hold\" width=\"96\" height=\"96\" style=\"margin-top:6px\"></canvas>\n            </div>\n            <div class=\"panel\">\n              <div class=\"title\">Next</div>\n              <canvas id=\"next\" width=\"96\" height=\"240\" style=\"margin-top:6px\"></canvas>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Elements / Persistent Setting ======\n      const $ = id => document.getElementById(id);\n      const gc = $('game').getContext('2d');\n      const hc = $('hold').getContext('2d');\n      const nc = $('next').getContext('2d');\n\n      const scoreEl=$('score'), linesEl=$('lines'), levelEl=$('level'), bestEl=$('best');\n      const btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const startLevelInput=$('startLevel'), startLevelLabel=$('startLevelLabel');\n      const btnApply=$('btnApply');\n\n      const SETTINGS_KEY = 'sbh_tetris_settings_v3';\n      function loadSettings(){\n        try{\n          const v = JSON.parse(localStorage.getItem(SETTINGS_KEY)||'{}');\n          return { startLevel: Number.isFinite(v.startLevel)? v.startLevel : 1 };\n        }catch{ return { startLevel:1 }; }\n      }\n      function saveSettings(s){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(s)); }\n\n      const S = loadSettings();\n      startLevelInput.value = String(S.startLevel);\n      startLevelLabel.textContent = S.startLevel;\n\n      // å›ºå®šåƒæ•¸\n      const BASE_MS  = 700; // åŸºç¤é‡åŠ›ï¼ˆms/æ ¼ï¼‰\n      const SOFT_MS  = 60;  // æŒ‰ä½â†“ çš„é€£çºŒ soft drop é–“éš”ï¼ˆms/æ ¼ï¼‰\n      const MIN_MS   = 80;  // æœ€å¿«é‡åŠ›\n      const LOCK_DELAY_MS = 500; // â˜… è½åœ°å¾Œçš„ã€Œå»¶é²é–å®šã€æ™‚é–“ï¼Œå¯åœ¨é€™è£¡èª¿æ•´\n\n      // ====== Game Constants ======\n      const W = 10, H = 20, CELL = 24;\n      const BEST_KEY = 'sbh_tetris_high';\n      const COLORS = {\n        I:'#00f0f0', O:'#f0f000', T:'#a020f0', S:'#00d000', Z:'#d00000', J:'#0000d0', L:'#f0a000', GHOST:'rgba(255,255,255,0.15)'\n      };\n      const ROT = {\n        I: [\n          [[0,1],[1,1],[2,1],[3,1]],\n          [[2,0],[2,1],[2,2],[2,3]],\n          [[0,2],[1,2],[2,2],[3,2]],\n          [[1,0],[1,1],[1,2],[1,3]],\n        ],\n        O: [[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]]],\n        T: [\n          [[1,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[2,1],[1,2]],\n          [[1,0],[0,1],[1,1],[1,2]],\n        ],\n        S: [\n          [[1,0],[2,0],[0,1],[1,1]],\n          [[1,0],[1,1],[2,1],[2,2]],\n          [[1,1],[2,1],[0,2],[1,2]],\n          [[0,0],[0,1],[1,1],[1,2]],\n        ],\n        Z: [\n          [[0,0],[1,0],[1,1],[2,1]],\n          [[2,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[1,2],[2,2]],\n          [[1,0],[0,1],[1,1],[0,2]],\n        ],\n        J: [\n          [[0,0],[0,1],[1,1],[2,1]],\n          [[1,0],[2,0],[1,1],[1,2]],\n          [[0,1],[1,1],[2,1],[2,2]],\n          [[1,0],[1,1],[0,2],[1,2]],\n        ],\n        L: [\n          [[2,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[1,2],[2,2]],\n          [[0,1],[1,1],[2,1],[0,2]],\n          [[0,0],[1,0],[1,1],[1,2]],\n        ]\n      };\n      const TYPES = Object.keys(ROT);\n\n      // ====== Game State ======\n      let board, queue, cur, hold=null, canHold=true;\n      let score=0, lines=0, level=S.startLevel, best=Number(localStorage.getItem(BEST_KEY)||0);\n      let paused=false, over=false, timer=null;\n\n      // Soft drop\n      let softHeld=false, softTimer=null;\n\n      // â˜… Lock Delay ç‹€æ…‹\n      let grounded=false;      // æ˜¯å¦å·²ç¶“ã€Œæ¥åœ°ã€ï¼ˆä¸‹ä¸€æ ¼ä¸‹ä¸å»ï¼‰\n      let lockExpire=0;        // ä½•æ™‚åˆ°æœŸé–å®šï¼ˆtime msï¼‰\n\n      bestEl.textContent = String(best);\n\n      // ====== Helpers ======\n      function emptyBoard(){ return Array.from({length:H},()=>Array(W).fill(null)); }\n      function newBag(){ const a=[...TYPES]; for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]] } return a; }\n      function ensureQueue(){ if(queue.length<7) queue.push(...newBag()); }\n      function spawn(){\n        const type = queue.shift(); ensureQueue();\n        cur = { type, r:0, x:3, y:0 };\n        grounded=false; lockExpire=0;\n        if (!canPlace(cur, cur.x, cur.y)){ gameOver(); }\n        canHold = true;\n      }\n      function cells(p){ return ROT[p.type][p.r]; }\n      function canPlace(p, nx, ny, nr=p.r){\n        const shape = ROT[p.type][nr];\n        for(const [dx,dy] of shape){\n          const x = nx+dx, y = ny+dy;\n          if (x<0 || x>=W || y<0 || y>=H) return false;\n          if (board[y][x]) return false;\n        }\n        return true;\n      }\n      function startLockDelay(){ grounded=true; lockExpire = Date.now() + LOCK_DELAY_MS; }\n      function clearLock(){ grounded=false; lockExpire=0; }\n\n      function lock(){\n        for(const [dx,dy] of cells(cur)){\n          const x=cur.x+dx, y=cur.y+dy;\n          if (y>=0 && y<H) board[y][x] = cur.type;\n        }\n        grounded=false; lockExpire=0;\n        clearLines(); spawn();\n      }\n      function clearLines(){\n        let cleared=0;\n        for(let y=H-1;y>=0;){\n          if (board[y].every(Boolean)){ board.splice(y,1); board.unshift(Array(W).fill(null)); cleared++; }\n          else y--;\n        }\n        if (cleared>0){\n          score += [0,100,300,500,800][cleared] * level;\n          lines += cleared;\n          const newLevel = Math.max(1, S.startLevel + Math.floor(lines/10));\n          if (newLevel!==level){ level=newLevel; restartGravity(); }\n          updateHUD();\n        }\n      }\n      function holdSwap(){\n        if (!canHold || over) return;\n        if (hold===null){ hold=cur.type; spawn(); }\n        else { const t=hold; hold=cur.type; cur={type:t, r:0, x:3, y:0}; if(!canPlace(cur,cur.x,cur.y)){ gameOver(); return; } }\n        canHold=false; drawSide();\n      }\n\n      // æˆåŠŸç§»å‹•/æ—‹è½‰å¾Œï¼Œæ›´æ–°æ¥åœ°ç‹€æ…‹ï¼šå¦‚æœä»æ¥åœ°å°±é‡ç½® lock delay\n      function refreshLockAfterAction(){\n        if (canPlace(cur, cur.x, cur.y+1)) {\n          clearLock();\n        } else {\n          startLockDelay(); // still grounded â†’ reset timer\n        }\n      }\n\n      function rotate(dir){ // +1 CW / -1 CCW\n        if (over) return;\n        const nr = (cur.r + (dir>0?1:3)) % 4;\n        const kicks = [[0,0],[1,0],[-1,0],[0,-1],[2,0],[-2,0]];\n        for (const [kx,ky] of kicks){\n          const nx = cur.x+kx, ny=cur.y+ky;\n          if (canPlace(cur,nx,ny,nr)){ cur.r=nr; cur.x=nx; cur.y=ny; refreshLockAfterAction(); draw(); return; }\n        }\n      }\n\n      function move(dx){\n        if (over) return;\n        const nx = cur.x + dx;\n        if (canPlace(cur, nx, cur.y)){ cur.x = nx; refreshLockAfterAction(); draw(); }\n      }\n\n      function softDropStep(){\n        if (paused || over) return;\n        if (canPlace(cur, cur.x, cur.y+1)){\n          cur.y++; score += 1; updateHUD(false);\n          clearLock(); // ä¸€æ—¦å¾€ä¸‹æˆåŠŸï¼Œå–æ¶ˆæ¥åœ°ç‹€æ…‹\n          draw();\n        } else {\n          if (!grounded) { startLockDelay(); }\n          // å·²æ¥åœ°ï¼šç­‰åˆ°æ™‚é–“åˆ°æ‰ lock\n          if (Date.now() >= lockExpire){ lock(); }\n          draw();\n        }\n      }\n\n      function hardDrop(){\n        if (over) return;\n        let dist=0; while (canPlace(cur,cur.x,cur.y+1)){ cur.y++; dist++; }\n        score += dist*2; updateHUD(false);\n        lock(); draw(); // Hard drop ç«‹å³é–å®š\n      }\n\n      // ====== Gravity ======\n      function gravityMs(lv){\n        return Math.max(MIN_MS, BASE_MS - (lv-1)*60);\n      }\n      function restartGravity(){\n        clearInterval(timer);\n        timer = setInterval(()=>{\n          if (paused || over) return;\n          if (canPlace(cur, cur.x, cur.y+1)){\n            cur.y++;\n            clearLock();\n          } else {\n            if (!grounded) { startLockDelay(); }\n            else if (Date.now() >= lockExpire) { lock(); }\n          }\n          draw();\n        }, gravityMs(level));\n      }\n\n      // ====== Drawing ======\n      function drawCell(ctx,x,y,color){\n        ctx.fillStyle=color;\n        ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n        ctx.fillStyle='rgba(255,255,255,0.07)';\n        ctx.fillRect(x*CELL, y*CELL, CELL, Math.max(2, CELL*0.18));\n      }\n      function ghostY(){ let gy=cur.y; while (canPlace(cur,cur.x,gy+1)) gy++; return gy; }\n      function draw(){\n        const c = gc.canvas; gc.clearRect(0,0,c.width,c.height);\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ gc.fillStyle=((x+y)%2===0)?'#0a0a0a':'#0c0c0c'; gc.fillRect(x*CELL,y*CELL,CELL,CELL); } }\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ const t=board[y][x]; if(t) drawCell(gc,x,y,COLORS[t]); } }\n        const gy = ghostY();\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=gy+dy; gc.fillStyle=COLORS.GHOST; gc.fillRect(x*CELL,y*CELL,CELL,CELL); }\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=cur.y+dy; drawCell(gc,x,y,COLORS[cur.type]); }\n\n        // å¦‚æœæ¥åœ°ä¸­ï¼Œå¯åœ¨åº•éƒ¨ç•«ä¸€åœˆæ·¡é‚Šæç¤ºï¼ˆå¯é¸ï¼‰\n        // if (grounded) { gc.strokeStyle='rgba(255,255,255,.15)'; gc.lineWidth=2; gc.strokeRect(0, (H-1)*CELL+1, W*CELL, CELL-2); }\n\n        drawSide();\n        if (over) drawGameOver();\n      }\n      function drawGameOver(){\n        const c = gc.canvas; gc.fillStyle='rgba(0,0,0,0.6)'; gc.fillRect(0,0,c.width,c.height);\n        gc.fillStyle='#fff'; gc.textAlign='center'; gc.font='bold 22px system-ui'; gc.fillText('Game Over', c.width/2, c.height/2 - 10);\n        gc.font='14px system-ui'; gc.fillText('Press R to Restart', c.width/2, c.height/2 + 16);\n      }\n      function drawMini(ctx,type,cell=16){\n        ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);\n        if(!type) return;\n        const shape=ROT[type][0]; const ox=2, oy=2;\n        for(const [dx,dy] of shape){\n          ctx.fillStyle=COLORS[type]; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,cell);\n          ctx.fillStyle='rgba(255,255,255,0.08)'; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,Math.max(2,cell*0.18));\n        }\n      }\n      function drawSide(){\n        drawMini(hc, hold, 16);\n        nc.clearRect(0,0,nc.canvas.width,nc.canvas.height);\n        const show = queue.slice(0,5), cell=14;\n        show.forEach((t,i)=>{\n          const offY = i*46 + 4;\n          const shape = ROT[t][0];\n          for(const [dx,dy] of shape){\n            nc.fillStyle=COLORS[t];\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, cell);\n            nc.fillStyle='rgba(255,255,255,0.08)';\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, Math.max(2,cell*0.18));\n          }\n        });\n      }\n\n      // ====== HUD ======\n      function updateHUD(updateBest=true){\n        scoreEl.textContent = String(score);\n        linesEl.textContent = String(lines);\n        levelEl.textContent = String(level);\n        if (updateBest){\n          const b = Math.max(Number(localStorage.getItem(BEST_KEY)||0), score);\n          localStorage.setItem(BEST_KEY, b);\n          bestEl.textContent = String(b);\n        }\n      }\n      function gameOver(){ over=true; clearInterval(timer); stopSoftHeld(); updateHUD(); draw(); }\n\n      // ====== Reset / Init ======\n      function resetGame(){\n        board = emptyBoard();\n        queue = [...newBag(), ...newBag()];\n        cur=null; hold=null; canHold=true;\n        score=0; lines=0; level=S.startLevel; paused=false; over=false;\n        grounded=false; lockExpire=0;\n        updateHUD();\n        spawn();\n        restartGravity();\n        draw();\n      }\n\n      // ====== Input ======\n      function stopSoftHeld(){ softHeld=false; clearInterval(softTimer); softTimer=null; }\n      window.addEventListener('keydown', (e)=>{\n        if (e.key===' '){ e.preventDefault(); }\n        if (over){ if (e.key==='r'||e.key==='R'){ resetGame(); } return; }\n\n        if (e.key==='p'||e.key==='P'){ paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; return; }\n        if (paused) return;\n\n        if (e.key==='ArrowLeft'){ move(-1); }\n        else if (e.key==='ArrowRight'){ move(1); }\n        else if (e.key==='ArrowDown'){\n          if (!softHeld){ softHeld=true; softDropStep(); softTimer=setInterval(softDropStep, Math.max(10, SOFT_MS)); }\n        }\n        else if (e.key==='ArrowUp' || e.key==='x' || e.key==='X'){ rotate(+1); }\n        else if (e.key==='z' || e.key==='Z'){ rotate(-1); }\n        else if (e.key==='c' || e.key==='C' || e.key==='Shift'){ holdSwap(); }\n        else if (e.key===' '){ hardDrop(); }\n        else if (e.key==='r' || e.key==='R'){ resetGame(); }\n      });\n      window.addEventListener('keyup', (e)=>{ if (e.key==='ArrowDown'){ stopSoftHeld(); } });\n      window.addEventListener('blur', ()=>{ if(!over){ paused=true; btnPause.textContent='â–¶ï¸ Resume'; stopSoftHeld(); } });\n\n      // Buttons\n      btnPause.addEventListener('click', ()=>{ if(over) return; paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; });\n      btnRestart.addEventListener('click', resetGame);\n\n      // Settings UI\n      startLevelInput.addEventListener('input', ()=> startLevelLabel.textContent = startLevelInput.value);\n      btnApply.addEventListener('click', ()=>{\n        S.startLevel = Number(startLevelInput.value);\n        saveSettings(S);\n        resetGame();\n      });\n\n      // Init\n      resetGame();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": false,
    "tags": []
  },
    {
    "command": "cmd.nsg81ahcgm",
    "text": "â›… å¤©æ°£é å ±",
    "tooltip": "é»æ“ŠæŸ¥çœ‹å¤©æ°£é å ±",
    "hidden": false,
    "enableOnInit": false,
    "script": "// Weather Forecast â€” Webview (Open-Meteo, no API key)\n// ç›´æ¥è²¼åˆ° status-bar-helper çš„æŸå€‹ Script æ¬„ä½å³å¯ä½¿ç”¨\n// é»æ“Šç‹€æ…‹åˆ— â†’ é–‹å•Ÿå¤©æ°£é å ± Webview\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main () {\n  // é»æ“Šå°±é–‹ä¸€å€‹ webview é¢æ¿\n  const panel = vscode.window.createWebviewPanel(\n    'sbhWeather',\n    'Weather â€” å¤©æ°£é å ±',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  // é—œé–‰/åœæ­¢æ™‚æ¸…ç†\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\n/** ---------- HTML (Webview) ---------- */\nfunction getHtml (nonce) {\n  // åŸå¸‚æ¸…å–®ï¼ˆå¯è‡ªè¡Œå¢æ¸›ï¼‰\n  const cities = [\n    { name: 'å°åŒ—',   lat: 25.0375, lon: 121.5637, tz: 'Asia/Taipei' },\n    { name: 'æ–°ç«¹',   lat: 24.8066, lon: 120.9686, tz: 'Asia/Taipei' },\n    { name: 'å°ä¸­',   lat: 24.1477, lon: 120.6736, tz: 'Asia/Taipei' },\n    { name: 'å°å—',   lat: 22.9997, lon: 120.2270, tz: 'Asia/Taipei' },\n    { name: 'é«˜é›„',   lat: 22.6273, lon: 120.3014, tz: 'Asia/Taipei' },\n    { name: 'èŠ±è“®',   lat: 23.9872, lon: 121.6015, tz: 'Asia/Taipei' },\n    { name: 'å°æ±',   lat: 22.7972, lon: 121.0717, tz: 'Asia/Taipei' },\n    { name: 'æ±äº¬',   lat: 35.6762, lon: 139.6503, tz: 'Asia/Tokyo' },\n    { name: 'é¦–çˆ¾',   lat: 37.5665, lon: 126.9780, tz: 'Asia/Seoul' },\n    { name: 'ç´ç´„',   lat: 40.7128, lon: -74.0060, tz: 'America/New_York' },\n  ];\n\n  // è½‰æˆ <option>\n  const options = cities.map((c, i) =>\n    `<option value=\"${i}\">${c.name}</option>`).join('');\n\n  return /* html */`\n  <!doctype html>\n  <html lang=\"zh-Hant\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"Content-Security-Policy\"\n          content=\"default-src 'none'; img-src https: data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}'; connect-src https:;\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n    <title>Weather â€” å¤©æ°£é å ±</title>\n    <style>\n      :root { --fg:#e7e7e7; --muted:#a7a7a7; --bg:#1e1e1e; --card:#252526; --accent:#5da5ff; }\n      body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Noto Sans TC\", Arial; background:var(--bg); color:var(--fg); }\n      .wrap { padding:14px 16px 24px; max-width: 980px; margin: 0 auto; }\n      .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }\n      select, button, input { background:var(--card); color:var(--fg); border:1px solid #333; border-radius:10px; padding:8px 10px; }\n      button { cursor:pointer; }\n      .card { background:var(--card); border:1px solid #333; border-radius:16px; padding:14px; margin-top:14px; box-shadow: 0 8px 24px rgba(0,0,0,.2); }\n      .title { font-weight:700; font-size:18px; margin-bottom:8px; }\n      .muted { color:var(--muted); }\n      .grid { display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:10px; }\n      .day { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:14px; padding:10px; text-align:center; }\n      .big { font-size:32px; font-weight:800; line-height:1; }\n      .kpis { display:flex; gap:16px; flex-wrap:wrap; }\n      .kpi { background:#1b1b1b; border:1px solid #2d2d2d; border-radius:14px; padding:12px 14px; min-width: 130px; }\n      canvas { width:100%; height:160px; }\n      .sp { flex:1 }\n      .link { color:var(--accent); text-decoration:none; }\n      .row-right { margin-left:auto; display:flex; gap:10px; }\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"row\">\n        <div class=\"title\" style=\"margin:0;\">ğŸŒ¤ï¸ å¤©æ°£é å ±</div>\n        <div class=\"sp\"></div>\n        <select id=\"city\">${options}</select>\n        <button id=\"useCustom\">è‡ªè¨‚åº§æ¨™</button>\n        <input id=\"lat\" placeholder=\"lat\" style=\"width:110px; display:none;\">\n        <input id=\"lon\" placeholder=\"lon\" style=\"width:110px; display:none;\">\n        <button id=\"saveCustom\" style=\"display:none;\">å¥—ç”¨</button>\n        <button id=\"refresh\">é‡æ–°æ•´ç†</button>\n      </div>\n\n      <div id=\"now\" class=\"card\">\n        <div class=\"row\">\n          <div class=\"title\" style=\"margin:0;\">ç›®å‰å¤©æ°£</div>\n          <div class=\"row-right\"><span id=\"updateAt\" class=\"muted\"></span></div>\n        </div>\n        <div class=\"row\" style=\"align-items:flex-end;\">\n          <div class=\"big\" id=\"nowTemp\">--Â°</div>\n          <div id=\"nowText\" style=\"font-size:16px; margin-left:6px;\">--</div>\n        </div>\n        <div class=\"kpis\" style=\"margin-top:8px;\">\n          <div class=\"kpi\">ğŸ’¨ é¢¨é€Ÿ <b id=\"nowWind\">-- m/s</b></div>\n          <div class=\"kpi\">ğŸŒ§ï¸ é™é›¨é‡(ä»Šæ—¥) <b id=\"dayRain\">-- mm</b></div>\n          <div class=\"kpi\">ğŸ”º é«˜æº« <b id=\"dayMax\">--Â°</b></div>\n          <div class=\"kpi\">ğŸ”» ä½æº« <b id=\"dayMin\">--Â°</b></div>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">24 å°æ™‚æº«åº¦èµ°å‹¢</div>\n        <canvas id=\"hourlyChart\" width=\"1000\" height=\"200\"></canvas>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"title\">æœªä¾† 5 æ—¥</div>\n        <div id=\"days\" class=\"grid\"></div>\n      </div>\n\n      <p class=\"muted\" style=\"margin-top:14px;\">\n        è³‡æ–™ä¾†æºï¼š<a class=\"link\" href=\"https://open-meteo.com/\" target=\"_blank\" rel=\"noreferrer\">Open-Meteo</a>ï¼ˆå…é‡‘é‘°ï¼‰\n      </p>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // --- å·¥å…· & å¸¸æ•¸ ---\n      const CITIES = ${JSON.stringify(cities)};\n      const $ = (id) => document.getElementById(id);\n      const fmtTime = (d) => new Date(d).toLocaleString();\n      const WMO = {\n        // ç°¡æ˜“å°ç…§ (WMO weathercode)\n        0:'æ™´æœ—',1:'å¤šé›²',2:'å¤šé›²',3:'é™°',45:'éœ§',48:'éœ§éœœ',\n        51:'æ¯›æ¯›é›¨',53:'æ¯›æ¯›é›¨',55:'æ¯›æ¯›é›¨',56:'å‡éœ§é›¨',57:'å‡éœ§é›¨',\n        61:'å°é›¨',63:'ä¸­é›¨',65:'å¤§é›¨',66:'å‡é›¨',67:'å‡é›¨',\n        71:'å°é›ª',73:'ä¸­é›ª',75:'å¤§é›ª',77:'éœ°',\n        80:'çŸ­æš«å°é›¨',81:'çŸ­æš«ä¸­é›¨',82:'çŸ­æš«å¤§é›¨',\n        85:'çŸ­æš«å°é›ª',86:'çŸ­æš«å¤§é›ª',\n        95:'é›·é›¨',96:'é›·é›¨å¤¾é›¹',99:'å¼·é›·é›¨å¤¾é›¹'\n      };\n      const ICON = (code) => {\n        if ([0].includes(code)) return 'â˜€ï¸';\n        if ([1,2].includes(code)) return 'â›…';\n        if ([3].includes(code)) return 'â˜ï¸';\n        if ([45,48].includes(code)) return 'ğŸŒ«ï¸';\n        if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return 'ğŸŒ§ï¸';\n        if ([71,73,75,77,85,86].includes(code)) return 'â„ï¸';\n        if ([95,96,99].includes(code)) return 'â›ˆï¸';\n        return 'ğŸŒ¡ï¸';\n      };\n\n      // å„²å­˜åå¥½\n      const LS_KEY = 'sbh_weather_pref';\n      function savePref(obj){ localStorage.setItem(LS_KEY, JSON.stringify(obj)); }\n      function loadPref(){ try { return JSON.parse(localStorage.getItem(LS_KEY)||'{}'); } catch { return {}; } }\n\n      // ç•«ç°¡æ˜“æŠ˜ç·š (ä¸ä¾è³´å¤–éƒ¨å¥—ä»¶)\n      function drawLine(canvas, values, labels){\n        const ctx = canvas.getContext('2d');\n        const W = canvas.width, H = canvas.height;\n        ctx.clearRect(0,0,W,H);\n        if (!values || !values.length) return;\n        const min = Math.min(...values), max = Math.max(...values);\n        const padL=40, padR=10, padT=20, padB=24;\n        const X = (i)=> padL + (W - padL - padR) * (i/(values.length-1));\n        const Y = (v)=> padT + (H - padT - padB) * (1 - (v - min) / Math.max(0.0001, (max - min)));\n        // è»¸ç·š\n        ctx.globalAlpha=0.5; ctx.strokeStyle = '#444'; ctx.beginPath();\n        ctx.moveTo(padL, padT); ctx.lineTo(padL, H - padB); ctx.lineTo(W - padR, H - padB); ctx.stroke();\n        ctx.globalAlpha=1;\n        // y æ¨™ç±¤\n        ctx.fillStyle = '#a7a7a7'; ctx.font='12px system-ui';\n        [min, (min+max)/2, max].forEach((v, idx) => {\n          const y = Y(v);\n          ctx.fillText(v.toFixed(1)+'Â°', 6, y+4);\n          ctx.globalAlpha=0.15; ctx.strokeStyle='#888'; ctx.beginPath();\n          ctx.moveTo(padL, y); ctx.lineTo(W-padR, y); ctx.stroke(); ctx.globalAlpha=1;\n        });\n        // æŠ˜ç·š\n        ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });\n        ctx.stroke();\n        // ç¯€é»\n        ctx.fillStyle='#5da5ff';\n        values.forEach((v,i)=>{ const x=X(i), y=Y(v); ctx.beginPath(); ctx.arc(x,y,2.5,0,Math.PI*2); ctx.fill(); });\n        // x æ¨™ç±¤ï¼ˆæ¯ 3 å°æ™‚ï¼‰\n        ctx.fillStyle='#a7a7a7'; ctx.textAlign='center';\n        labels.forEach((t,i)=>{ if(i%3===0){ const x=X(i); ctx.fillText(t, x, H-6); } });\n        ctx.textAlign='left';\n      }\n\n      // API è«‹æ±‚\n      async function fetchWeather(lat, lon, tz){\n        const url = new URL('https://api.open-meteo.com/v1/forecast');\n        url.searchParams.set('latitude', lat);\n        url.searchParams.set('longitude', lon);\n        url.searchParams.set('timezone', tz || 'auto');\n        url.searchParams.set('current_weather', 'true');\n        url.searchParams.set('hourly', 'temperature_2m');\n        url.searchParams.set('daily', 'weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum');\n        url.searchParams.set('forecast_days', '5');\n        const res = await fetch(url.toString(), { cache:'no-store' });\n        if (!res.ok) throw new Error('Network error: ' + res.status);\n        return res.json();\n      }\n\n      // UI ç¶å®š\n      const citySel = $('city');\n      const useCustomBtn = $('useCustom');\n      const latIn = $('lat'), lonIn = $('lon'), saveCustomBtn = $('saveCustom');\n      const refreshBtn = $('refresh');\n      const nowTemp = $('nowTemp'), nowText = $('nowText');\n      const nowWind = $('nowWind'), dayRain = $('dayRain'), dayMax = $('dayMax'), dayMin = $('dayMin'), updAt = $('updateAt');\n      const hourlyChart = $('hourlyChart');\n      const daysWrap = $('days');\n\n      // åˆå§‹åŒ–ï¼šè¼‰å…¥åå¥½\n      const pref = loadPref();\n      if (pref.mode === 'custom' && typeof pref.lat === 'number' && typeof pref.lon === 'number') {\n        citySel.value = String(Math.max(0, Math.min(CITIES.length-1, pref.cityIndex||0))); // UI ä»æŒ‡å‘ä¸€å€‹åŸå¸‚ï¼Œä½†å¯¦éš›ç”¨è‡ªè¨‚\n        latIn.value = String(pref.lat);\n        lonIn.value = String(pref.lon);\n      } else {\n        citySel.value = String(pref.cityIndex ?? 0);\n      }\n\n      let timer = null;\n      async function refresh(){\n        try {\n          const mode = (pref.mode || 'city');\n          const idx = Number(citySel.value) || 0;\n          const city = CITIES[idx];\n          let lat = city.lat, lon = city.lon, tz = city.tz;\n          if (mode === 'custom') {\n            const cla = parseFloat(latIn.value), clo = parseFloat(lonIn.value);\n            if (!Number.isFinite(cla) || !Number.isFinite(clo)) throw new Error('è‡ªè¨‚åº§æ¨™æ ¼å¼éŒ¯èª¤');\n            lat = cla; lon = clo;\n          }\n          const data = await fetchWeather(lat, lon, tz);\n          render(data);\n        } catch (err) {\n          console.error(err);\n          vscode?.postMessage?.({ type:'error', message: String(err) });\n          updAt.textContent = 'æ›´æ–°å¤±æ•—ï¼š' + String(err).slice(0, 80);\n        }\n      }\n\n      function render(data){\n        // ç›®å‰\n        const cw = data.current_weather || {};\n        nowTemp.textContent = (cw.temperature != null ? cw.temperature.toFixed(1) : '--') + 'Â°';\n        nowText.textContent = (ICON(cw.weathercode) + ' ' + (WMO[cw.weathercode] || 'â€”'));\n        nowWind.textContent = (cw.windspeed != null ? cw.windspeed : '--') + ' m/s';\n        updAt.textContent = 'æ›´æ–°æ–¼ ' + fmtTime(new Date());\n\n        // ä»Šæ—¥æ¯æ—¥è³‡è¨Š\n        const d = data.daily || {};\n        if (d.temperature_2m_max && d.temperature_2m_max.length) {\n          dayMax.textContent = d.temperature_2m_max[0].toFixed(1) + 'Â°';\n          dayMin.textContent = d.temperature_2m_min[0].toFixed(1) + 'Â°';\n          dayRain.textContent = (d.precipitation_sum?.[0] ?? 0).toFixed(1) + ' mm';\n        }\n\n        // 24 å°æ™‚\n        const h = data.hourly || {};\n        const nowISO = data.current_weather?.time || new Date().toISOString();\n        const startIdx = Math.max(0, (h.time||[]).indexOf(nowISO));\n        const range = 24;\n        const temps = (h.temperature_2m||[]).slice(startIdx, startIdx+range);\n        const labels = (h.time||[]).slice(startIdx, startIdx+range).map(t => {\n          const dt = new Date(t); return dt.getHours().toString().padStart(2,'0') + ':00';\n        });\n        drawLine(hourlyChart, temps, labels);\n\n        // æœªä¾† 5 æ—¥\n        const days = [];\n        for (let i=0; i<Math.min(5, (d.time||[]).length); i++){\n          const code = d.weathercode?.[i];\n          days.push({\n            date: d.time[i],\n            icon: ICON(code),\n            text: WMO[code] || 'â€”',\n            max: d.temperature_2m_max?.[i],\n            min: d.temperature_2m_min?.[i],\n            rain: d.precipitation_sum?.[i] ?? 0\n          });\n        }\n        daysWrap.innerHTML = days.map(x => {\n          const dd = new Date(x.date);\n          const md = (dd.getMonth()+1) + '/' + dd.getDate();\n          return \\`\n            <div class=\"day\">\n              <div class=\"muted\">\\${md}</div>\n              <div style=\"font-size:24px\">\\${x.icon}</div>\n              <div style=\"margin:2px 0;\">\\${x.text}</div>\n              <div>ğŸ”º \\${x.max?.toFixed?.(1)??'--'}Â°</div>\n              <div>ğŸ”» \\${x.min?.toFixed?.(1)??'--'}Â°</div>\n              <div>ğŸŒ§ï¸ \\${x.rain?.toFixed?.(1)??'--'} mm</div>\n            </div>\\`;\n        }).join('');\n      }\n\n      // äº‹ä»¶\n      citySel.addEventListener('change', () => {\n        const idx = Number(citySel.value)||0;\n        const city = CITIES[idx];\n        // åˆ‡æ›åŸå¸‚ â†’ è‡ªå‹•æ”¹ç‚º city æ¨¡å¼\n        const p = loadPref();\n        p.cityIndex = idx;\n        p.mode = 'city';\n        savePref(p);\n        latIn.style.display='none'; lonIn.style.display='none'; saveCustomBtn.style.display='none';\n        refresh();\n      });\n\n      useCustomBtn.addEventListener('click', () => {\n        // æ‰“é–‹è‡ªè¨‚åº§æ¨™è¼¸å…¥\n        latIn.style.display='inline-block';\n        lonIn.style.display='inline-block';\n        saveCustomBtn.style.display='inline-block';\n        if (!latIn.value || !lonIn.value) {\n          // é å¡«ç›®å‰é¸ä¸­åŸå¸‚åº§æ¨™\n          const c = CITIES[Number(citySel.value)||0];\n          latIn.value = c.lat; lonIn.value = c.lon;\n        }\n      });\n\n      saveCustomBtn.addEventListener('click', () => {\n        const la = parseFloat(latIn.value), lo = parseFloat(lonIn.value);\n        if (!Number.isFinite(la) || !Number.isFinite(lo)) {\n          alert('è«‹è¼¸å…¥æ­£ç¢ºçš„ç¶“ç·¯åº¦');\n          return;\n        }\n        const p = loadPref();\n        p.mode = 'custom';\n        p.lat = la; p.lon = lo;\n        savePref(p);\n        refresh();\n      });\n\n      refreshBtn.addEventListener('click', refresh);\n\n      // å®šæ™‚æ›´æ–°ï¼ˆæ¯ 20 åˆ†é˜ï¼‰\n      clearInterval(timer);\n      timer = setInterval(refresh, 20 * 60 * 1000);\n\n      // é¦–æ¬¡è¼‰å…¥\n      refresh();\n    </script>\n  </body>\n  </html>`;\n}\n"
  },
  {
    "text": "$(game) è²ªåƒè›‡",
    "tooltip": "é»æ“Šé–‹å§‹ç©è²ªåƒè›‡",
    "command": "cmd.bwfywnftv1",
    "script": "// Snake â€” Webview Game (English UI, for status-bar-helper)\n// Features: Walls Kill/Wrap toggle (persistent), Pause/Resume, Restart, Speed, High Score\n// Canvas 400x400, grid 25x25 (smaller cells)\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhSnake',\n    'ğŸ Snake â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Snake</title>\n    <style>\n      :root {\n        --bg:#0f1115; --card:#161a22; --line:#222838; --fg:#e6e6e6; --muted:#9aa2b1;\n        --accent:#7bd88f; --danger:#ff6b6b; --btn:#1d2330; --btnBorder:#2a3247;\n      }\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:760px;margin:0 auto;padding:16px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px;box-shadow:0 10px 24px rgba(0,0,0,.25)}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:10px 12px;min-width:100px}\n      .btn{background:var(--btn);border:1px solid var(--btnBorder);border-radius:10px;padding:8px 12px;cursor:pointer;color:var(--fg)}\n      .btn:hover{filter:brightness(1.1)}\n      .btn-danger{background:#2a1212;border-color:#502222;color:#ffbbbb}\n      .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .muted{color:var(--muted)}\n      canvas{width:100%;height:auto;display:block;background:#000;border-radius:12px}\n      input[type=range]{accent-color:var(--accent)}\n      .legend{font-size:12px;color:var(--muted)}\n      .title{font-size:18px;font-weight:700}\n      .frame{padding:10px;border-radius:14px;border:1px solid #2b3144;background:#0e1219}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ Snake â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnWalls\" class=\"btn\">ğŸ§± Walls: Kill</button>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn btn-danger\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n          <div class=\"kpi\">Speed: <b id=\"speedLabel\">120ms</b></div>\n          <input id=\"speed\" type=\"range\" min=\"60\" max=\"220\" step=\"10\" value=\"120\">\n        </div>\n      </div>\n\n      <div class=\"card frame\">\n        <canvas id=\"game\" width=\"600\" height=\"500\"></canvas>\n        <div class=\"legend\" style=\"margin-top:8px\">\n          Controls: Arrow keys / WASD Â· P = Pause/Resume Â· R = Restart Â· Walls: Kill/Wrap (toggle above)\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Config & Elements ======\n      const $ = (id)=>document.getElementById(id);\n      const cvs = $('game'), ctx = cvs.getContext('2d');\n      const scoreEl=$('score'), bestEl=$('best');\n      const btnWalls=$('btnWalls'), btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const speedRange=$('speed'), speedLabel=$('speedLabel');\n\n      const GRID = 30;                       // grid size (NxN)\n      const CELL = Math.floor(cvs.width/GRID); // pixels per cell, derived from canvas size\n      const BEST_LS_KEY = 'sbh_snake_best';\n      const WALL_LS_KEY = 'sbh_snake_wall_mode'; // 'kill' | 'wrap'\n\n      // ====== State ======\n      let snake, dir, nextDir, food, score, best, timer, tickMs, paused, dead;\n      let wallMode; // 'kill' or 'wrap'\n\n      function loadWallMode(){ const v = localStorage.getItem(WALL_LS_KEY); return v==='wrap'?'wrap':'kill'; }\n      function saveWallMode(v){ localStorage.setItem(WALL_LS_KEY, v); }\n      function updateWallBtn(){ btnWalls.textContent = (wallMode==='kill') ? 'ğŸ§± Walls: Kill' : 'ğŸŒ€ Walls: Wrap'; }\n\n      function init(){\n        snake = [\n          {x: Math.floor(GRID/2),   y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-1, y: Math.floor(GRID/2)},\n          {x: Math.floor(GRID/2)-2, y: Math.floor(GRID/2)},\n        ];\n        dir='RIGHT'; nextDir='RIGHT';\n        score=0; paused=false; dead=false;\n        spawnFood();\n        updateScore();\n        tickMs = Number(speedRange.value);\n        wallMode = loadWallMode();\n        updateWallBtn();\n        loopStart();\n      }\n\n      function loopStart(){ clearInterval(timer); timer=setInterval(tick, tickMs); }\n      function loopPause(p=true){\n        paused=p;\n        if (paused){ clearInterval(timer); btnPause.textContent='â–¶ï¸ Resume'; }\n        else { loopStart(); btnPause.textContent='â¸ï¸ Pause'; }\n      }\n\n      function updateScore(){\n        scoreEl.textContent = String(score);\n        best = Math.max(Number(localStorage.getItem(BEST_LS_KEY)||0), score);\n        localStorage.setItem(BEST_LS_KEY, best);\n        bestEl.textContent = String(best);\n      }\n\n      function spawnFood(){\n        while(true){\n          const fx = Math.floor(Math.random()*GRID);\n          const fy = Math.floor(Math.random()*GRID);\n          if (!snake.some(s=>s.x===fx && s.y===fy)){ food={x:fx,y:fy}; break; }\n        }\n      }\n\n      // ====== Input ======\n      const dirMap = {\n        'ArrowLeft':'LEFT','ArrowUp':'UP','ArrowRight':'RIGHT','ArrowDown':'DOWN',\n        'a':'LEFT','w':'UP','d':'RIGHT','s':'DOWN','A':'LEFT','W':'UP','D':'RIGHT','S':'DOWN'\n      };\n      window.addEventListener('keydown', e=>{\n        if (e.key==='p'||e.key==='P'){ loopPause(!paused); return; }\n        if (e.key==='r'||e.key==='R'){ restart(); return; }\n        const nd = dirMap[e.key];\n        if (!nd) return;\n        if ((dir==='LEFT' && nd==='RIGHT')||(dir==='RIGHT'&&nd==='LEFT')||\n            (dir==='UP'&&nd==='DOWN')||(dir==='DOWN'&&nd==='UP')) return;\n        nextDir = nd;\n      });\n      window.addEventListener('blur', ()=>{ if(!dead) loopPause(true); });\n      window.addEventListener('focus', ()=>{ if(!dead) loopPause(false); });\n\n      // ====== Game Loop ======\n      function tick(){\n        if (paused || dead) return;\n\n        dir = nextDir;\n        const head = {...snake[0]};\n        if (dir==='LEFT') head.x--;\n        else if (dir==='RIGHT') head.x++;\n        else if (dir==='UP') head.y--;\n        else if (dir==='DOWN') head.y++;\n\n        // Walls: Kill or Wrap\n        if (wallMode === 'kill') {\n          if (head.x<0 || head.y<0 || head.x>=GRID || head.y>=GRID){ return gameOver(); }\n        } else {\n          head.x = (head.x + GRID) % GRID;\n          head.y = (head.y + GRID) % GRID;\n        }\n\n        // Self-collision\n        if (snake.some(s=>s.x===head.x && s.y===head.y)){ return gameOver(); }\n\n        // Eat\n        const ate = (head.x===food.x && head.y===food.y);\n        snake.unshift(head);\n        if (ate){ score++; updateScore(); spawnFood(); } else { snake.pop(); }\n\n        draw();\n      }\n\n      // ====== Drawing ======\n      function draw(){\n        ctx.fillStyle='#000'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        for (let y=0;y<GRID;y++){\n          for (let x=0;x<GRID;x++){\n            ctx.fillStyle = ((x+y)%2===0)?'#0a0a0a':'#0c0c0c';\n            ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n          }\n        }\n        // food\n        ctx.fillStyle='#ff5252'; roundRect(xpx(food.x), ypx(food.y), CELL, CELL, 4);\n        // snake\n        for (let i=0;i<snake.length;i++){\n          const s=snake[i];\n          ctx.fillStyle = (i===0)?'#7bd88f':'#57c274';\n          roundRect(xpx(s.x), ypx(s.y), CELL, CELL, i===0?6:4);\n        }\n      }\n\n      function xpx(gx){ return gx*CELL; }\n      function ypx(gy){ return gy*CELL; }\n      function roundRect(x,y,w,h,r){\n        ctx.beginPath();\n        ctx.moveTo(x+r,y);\n        ctx.arcTo(x+w,y,x+w,y+h,r);\n        ctx.arcTo(x+w,y+h,x,y+h,r);\n        ctx.arcTo(x,y+h,x,y,r);\n        ctx.arcTo(x,y,x+w,y,r);\n        ctx.closePath();\n        ctx.fill();\n      }\n\n      function gameOver(){\n        dead = true; clearInterval(timer);\n        ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(0,0,cvs.width,cvs.height);\n        ctx.fillStyle='#fff'; ctx.textAlign='center';\n        ctx.font='bold 28px system-ui'; ctx.fillText('Game Over', cvs.width/2, cvs.height/2 - 10);\n        ctx.font='16px system-ui'; ctx.fillText('Press R to Restart', cvs.width/2, cvs.height/2 + 18);\n        return true;\n      }\n\n      function restart(){ clearInterval(timer); init(); draw(); }\n\n      // ====== UI Events ======\n      btnPause.addEventListener('click', ()=> loopPause(!paused));\n      btnRestart.addEventListener('click', restart);\n      btnWalls.addEventListener('click', ()=>{\n        wallMode = (wallMode==='kill') ? 'wrap' : 'kill';\n        saveWallMode(wallMode);\n        updateWallBtn();\n      });\n\n      speedRange.addEventListener('input', ()=>{\n        tickMs = Number(speedRange.value);\n        speedLabel.textContent = tickMs + 'ms';\n        if (!paused && !dead) loopStart();\n      });\n\n      // init\n      speedLabel.textContent = speedRange.value + 'ms';\n      bestEl.textContent = String(localStorage.getItem(BEST_LS_KEY)||0);\n      init();\n      draw();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": false,
    "tags": []
  },
  {
    "text": "$(game) ä¿„ç¾…æ–¯æ–¹å¡Š",
    "tooltip": "é»æ“Šé–‹å§‹ç©ä¿„ç¾…æ–¯æ–¹å¡Š",
    "command": "cmd.mv36wj9976",
    "script": "// Tetris â€” Webview Game (centered board + lock delay so you can rotate on landing)\n// Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n// Canvas 240x480 (10x20, 24px cell). Start Level adjustable. Gravity base 700ms (âˆ’60ms/level, min 80). Soft drop 60ms.\n// NEW: Lock Delay 500ms â†’ when piece touches the ground, you can still rotate/move before it locks.\n\nconst vscode = require('vscode');\nconst { vm } = statusBarHelper.v1;\n\n(function main(){\n  const panel = vscode.window.createWebviewPanel(\n    'sbhTetris',\n    'ğŸ§± Tetris â€” Game',\n    vscode.ViewColumn.Active,\n    { enableScripts: true, retainContextWhenHidden: true }\n  );\n  vm.onStop(() => { try { panel.dispose(); } catch {} });\n  panel.onDidDispose(() => vm.stop());\n  const nonce = Math.random().toString(36).slice(2);\n  panel.webview.html = getHtml(nonce);\n})();\n\nfunction getHtml(nonce){\n  return /* html */`\n  <!doctype html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\"\n      content=\"default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'nonce-${nonce}';\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Tetris</title>\n    <style>\n      :root{--bg:#0f1115;--fg:#e6e6e6;--muted:#9aa2b1;--card:#161a22;--line:#222838;--btn:#1d2330;--btnb:#2a3247;--accent:#7bd88f}\n      html,body{height:100%}\n      body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,Arial}\n      .wrap{max-width:860px;margin:0 auto;padding:14px}\n      .top{display:flex;align-items:center;gap:10px;flex-wrap:wrap}\n      .sp{flex:1}\n      .btn{background:var(--btn);border:1px solid var(--btnb);border-radius:10px;padding:8px 12px;color:var(--fg);cursor:pointer}\n      .btn:hover{filter:brightness(1.1)}\n      .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px}\n      .kpis{display:flex;gap:12px;flex-wrap:wrap}\n      .kpi{background:#121620;border:1px solid var(--line);border-radius:12px;padding:8px 12px;min-width:120px}\n      .title{font-weight:700}\n      .legend{font-size:12px;color:var(--muted)}\n      canvas{display:block;background:#000;border-radius:8px}\n      /* éŠæˆ²å€å¡Šç½®ä¸­ */\n      .board{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap;justify-content:center}\n      .side{display:flex;flex-direction:column;gap:10px}\n      .panel{background:#0e1219;border:1px solid #2b3144;border-radius:12px;padding:8px}\n      .grid{display:grid;grid-template-columns:repeat(2,auto);gap:10px;align-items:center}\n      input[type=range]{accent-color:var(--accent)}\n      .num{min-width:42px;display:inline-block;text-align:right}\n    </style>\n  </head>\n  <body>\n    <div class=\"wrap\">\n      <div class=\"top\">\n        <div class=\"title\">ğŸ§± Tetris â€” Game</div>\n        <div class=\"sp\"></div>\n        <button id=\"btnPause\" class=\"btn\">â¸ï¸ Pause</button>\n        <button id=\"btnRestart\" class=\"btn\">ğŸ”„ Restart</button>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"kpis\">\n          <div class=\"kpi\">Score: <b id=\"score\">0</b></div>\n          <div class=\"kpi\">Lines: <b id=\"lines\">0</b></div>\n          <div class=\"kpi\">Level: <b id=\"level\">1</b></div>\n          <div class=\"kpi\">High Score: <b id=\"best\">0</b></div>\n        </div>\n        <div class=\"legend\" style=\"margin-top:6px\">\n          Controls: â† â†’ move Â· â†‘/X rotate CW Â· Z rotate CCW Â· â†“ (hold) soft drop Â· Space hard drop Â· C/Shift Hold Â· P pause Â· R restart\n        </div>\n      </div>\n\n      <!-- Settingsï¼šåªä¿ç•™ Start Level -->\n      <div class=\"card\">\n        <div class=\"title\" style=\"margin-bottom:8px\">Settings</div>\n        <div class=\"grid\">\n          <div>Start Level</div>\n          <div style=\"display:flex;align-items:center;gap:8px\">\n            <input id=\"startLevel\" type=\"range\" min=\"1\" max=\"20\" step=\"1\" value=\"1\">\n            <span id=\"startLevelLabel\" class=\"num\">1</span>\n          </div>\n        </div>\n        <div style=\"margin-top:10px;display:flex;gap:10px;align-items:center\">\n          <button id=\"btnApply\" class=\"btn\">âœ… Apply & Restart</button>\n          <span class=\"legend\">Gravity speeds up by 60ms per level (min 80ms).</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"board\">\n          <!-- å°ç•«é¢ï¼š240x480 / 10x20 / 24px cell -->\n          <canvas id=\"game\" width=\"240\" height=\"480\"></canvas>\n          <div class=\"side\">\n            <div class=\"panel\">\n              <div class=\"title\">Hold</div>\n              <canvas id=\"hold\" width=\"96\" height=\"96\" style=\"margin-top:6px\"></canvas>\n            </div>\n            <div class=\"panel\">\n              <div class=\"title\">Next</div>\n              <canvas id=\"next\" width=\"96\" height=\"240\" style=\"margin-top:6px\"></canvas>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <script nonce=\"${nonce}\">\n      // ====== Elements / Persistent Setting ======\n      const $ = id => document.getElementById(id);\n      const gc = $('game').getContext('2d');\n      const hc = $('hold').getContext('2d');\n      const nc = $('next').getContext('2d');\n\n      const scoreEl=$('score'), linesEl=$('lines'), levelEl=$('level'), bestEl=$('best');\n      const btnPause=$('btnPause'), btnRestart=$('btnRestart');\n      const startLevelInput=$('startLevel'), startLevelLabel=$('startLevelLabel');\n      const btnApply=$('btnApply');\n\n      const SETTINGS_KEY = 'sbh_tetris_settings_v3';\n      function loadSettings(){\n        try{\n          const v = JSON.parse(localStorage.getItem(SETTINGS_KEY)||'{}');\n          return { startLevel: Number.isFinite(v.startLevel)? v.startLevel : 1 };\n        }catch{ return { startLevel:1 }; }\n      }\n      function saveSettings(s){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(s)); }\n\n      const S = loadSettings();\n      startLevelInput.value = String(S.startLevel);\n      startLevelLabel.textContent = S.startLevel;\n\n      // å›ºå®šåƒæ•¸\n      const BASE_MS  = 700; // åŸºç¤é‡åŠ›ï¼ˆms/æ ¼ï¼‰\n      const SOFT_MS  = 60;  // æŒ‰ä½â†“ çš„é€£çºŒ soft drop é–“éš”ï¼ˆms/æ ¼ï¼‰\n      const MIN_MS   = 80;  // æœ€å¿«é‡åŠ›\n      const LOCK_DELAY_MS = 500; // â˜… è½åœ°å¾Œçš„ã€Œå»¶é²é–å®šã€æ™‚é–“ï¼Œå¯åœ¨é€™è£¡èª¿æ•´\n\n      // ====== Game Constants ======\n      const W = 10, H = 20, CELL = 24;\n      const BEST_KEY = 'sbh_tetris_high';\n      const COLORS = {\n        I:'#00f0f0', O:'#f0f000', T:'#a020f0', S:'#00d000', Z:'#d00000', J:'#0000d0', L:'#f0a000', GHOST:'rgba(255,255,255,0.15)'\n      };\n      const ROT = {\n        I: [\n          [[0,1],[1,1],[2,1],[3,1]],\n          [[2,0],[2,1],[2,2],[2,3]],\n          [[0,2],[1,2],[2,2],[3,2]],\n          [[1,0],[1,1],[1,2],[1,3]],\n        ],\n        O: [[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]],[[1,0],[2,0],[1,1],[2,1]]],\n        T: [\n          [[1,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[2,1],[1,2]],\n          [[1,0],[0,1],[1,1],[1,2]],\n        ],\n        S: [\n          [[1,0],[2,0],[0,1],[1,1]],\n          [[1,0],[1,1],[2,1],[2,2]],\n          [[1,1],[2,1],[0,2],[1,2]],\n          [[0,0],[0,1],[1,1],[1,2]],\n        ],\n        Z: [\n          [[0,0],[1,0],[1,1],[2,1]],\n          [[2,0],[1,1],[2,1],[1,2]],\n          [[0,1],[1,1],[1,2],[2,2]],\n          [[1,0],[0,1],[1,1],[0,2]],\n        ],\n        J: [\n          [[0,0],[0,1],[1,1],[2,1]],\n          [[1,0],[2,0],[1,1],[1,2]],\n          [[0,1],[1,1],[2,1],[2,2]],\n          [[1,0],[1,1],[0,2],[1,2]],\n        ],\n        L: [\n          [[2,0],[0,1],[1,1],[2,1]],\n          [[1,0],[1,1],[1,2],[2,2]],\n          [[0,1],[1,1],[2,1],[0,2]],\n          [[0,0],[1,0],[1,1],[1,2]],\n        ]\n      };\n      const TYPES = Object.keys(ROT);\n\n      // ====== Game State ======\n      let board, queue, cur, hold=null, canHold=true;\n      let score=0, lines=0, level=S.startLevel, best=Number(localStorage.getItem(BEST_KEY)||0);\n      let paused=false, over=false, timer=null;\n\n      // Soft drop\n      let softHeld=false, softTimer=null;\n\n      // â˜… Lock Delay ç‹€æ…‹\n      let grounded=false;      // æ˜¯å¦å·²ç¶“ã€Œæ¥åœ°ã€ï¼ˆä¸‹ä¸€æ ¼ä¸‹ä¸å»ï¼‰\n      let lockExpire=0;        // ä½•æ™‚åˆ°æœŸé–å®šï¼ˆtime msï¼‰\n\n      bestEl.textContent = String(best);\n\n      // ====== Helpers ======\n      function emptyBoard(){ return Array.from({length:H},()=>Array(W).fill(null)); }\n      function newBag(){ const a=[...TYPES]; for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]] } return a; }\n      function ensureQueue(){ if(queue.length<7) queue.push(...newBag()); }\n      function spawn(){\n        const type = queue.shift(); ensureQueue();\n        cur = { type, r:0, x:3, y:0 };\n        grounded=false; lockExpire=0;\n        if (!canPlace(cur, cur.x, cur.y)){ gameOver(); }\n        canHold = true;\n      }\n      function cells(p){ return ROT[p.type][p.r]; }\n      function canPlace(p, nx, ny, nr=p.r){\n        const shape = ROT[p.type][nr];\n        for(const [dx,dy] of shape){\n          const x = nx+dx, y = ny+dy;\n          if (x<0 || x>=W || y<0 || y>=H) return false;\n          if (board[y][x]) return false;\n        }\n        return true;\n      }\n      function startLockDelay(){ grounded=true; lockExpire = Date.now() + LOCK_DELAY_MS; }\n      function clearLock(){ grounded=false; lockExpire=0; }\n\n      function lock(){\n        for(const [dx,dy] of cells(cur)){\n          const x=cur.x+dx, y=cur.y+dy;\n          if (y>=0 && y<H) board[y][x] = cur.type;\n        }\n        grounded=false; lockExpire=0;\n        clearLines(); spawn();\n      }\n      function clearLines(){\n        let cleared=0;\n        for(let y=H-1;y>=0;){\n          if (board[y].every(Boolean)){ board.splice(y,1); board.unshift(Array(W).fill(null)); cleared++; }\n          else y--;\n        }\n        if (cleared>0){\n          score += [0,100,300,500,800][cleared] * level;\n          lines += cleared;\n          const newLevel = Math.max(1, S.startLevel + Math.floor(lines/10));\n          if (newLevel!==level){ level=newLevel; restartGravity(); }\n          updateHUD();\n        }\n      }\n      function holdSwap(){\n        if (!canHold || over) return;\n        if (hold===null){ hold=cur.type; spawn(); }\n        else { const t=hold; hold=cur.type; cur={type:t, r:0, x:3, y:0}; if(!canPlace(cur,cur.x,cur.y)){ gameOver(); return; } }\n        canHold=false; drawSide();\n      }\n\n      // æˆåŠŸç§»å‹•/æ—‹è½‰å¾Œï¼Œæ›´æ–°æ¥åœ°ç‹€æ…‹ï¼šå¦‚æœä»æ¥åœ°å°±é‡ç½® lock delay\n      function refreshLockAfterAction(){\n        if (canPlace(cur, cur.x, cur.y+1)) {\n          clearLock();\n        } else {\n          startLockDelay(); // still grounded â†’ reset timer\n        }\n      }\n\n      function rotate(dir){ // +1 CW / -1 CCW\n        if (over) return;\n        const nr = (cur.r + (dir>0?1:3)) % 4;\n        const kicks = [[0,0],[1,0],[-1,0],[0,-1],[2,0],[-2,0]];\n        for (const [kx,ky] of kicks){\n          const nx = cur.x+kx, ny=cur.y+ky;\n          if (canPlace(cur,nx,ny,nr)){ cur.r=nr; cur.x=nx; cur.y=ny; refreshLockAfterAction(); draw(); return; }\n        }\n      }\n\n      function move(dx){\n        if (over) return;\n        const nx = cur.x + dx;\n        if (canPlace(cur, nx, cur.y)){ cur.x = nx; refreshLockAfterAction(); draw(); }\n      }\n\n      function softDropStep(){\n        if (paused || over) return;\n        if (canPlace(cur, cur.x, cur.y+1)){\n          cur.y++; score += 1; updateHUD(false);\n          clearLock(); // ä¸€æ—¦å¾€ä¸‹æˆåŠŸï¼Œå–æ¶ˆæ¥åœ°ç‹€æ…‹\n          draw();\n        } else {\n          if (!grounded) { startLockDelay(); }\n          // å·²æ¥åœ°ï¼šç­‰åˆ°æ™‚é–“åˆ°æ‰ lock\n          if (Date.now() >= lockExpire){ lock(); }\n          draw();\n        }\n      }\n\n      function hardDrop(){\n        if (over) return;\n        let dist=0; while (canPlace(cur,cur.x,cur.y+1)){ cur.y++; dist++; }\n        score += dist*2; updateHUD(false);\n        lock(); draw(); // Hard drop ç«‹å³é–å®š\n      }\n\n      // ====== Gravity ======\n      function gravityMs(lv){\n        return Math.max(MIN_MS, BASE_MS - (lv-1)*60);\n      }\n      function restartGravity(){\n        clearInterval(timer);\n        timer = setInterval(()=>{\n          if (paused || over) return;\n          if (canPlace(cur, cur.x, cur.y+1)){\n            cur.y++;\n            clearLock();\n          } else {\n            if (!grounded) { startLockDelay(); }\n            else if (Date.now() >= lockExpire) { lock(); }\n          }\n          draw();\n        }, gravityMs(level));\n      }\n\n      // ====== Drawing ======\n      function drawCell(ctx,x,y,color){\n        ctx.fillStyle=color;\n        ctx.fillRect(x*CELL, y*CELL, CELL, CELL);\n        ctx.fillStyle='rgba(255,255,255,0.07)';\n        ctx.fillRect(x*CELL, y*CELL, CELL, Math.max(2, CELL*0.18));\n      }\n      function ghostY(){ let gy=cur.y; while (canPlace(cur,cur.x,gy+1)) gy++; return gy; }\n      function draw(){\n        const c = gc.canvas; gc.clearRect(0,0,c.width,c.height);\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ gc.fillStyle=((x+y)%2===0)?'#0a0a0a':'#0c0c0c'; gc.fillRect(x*CELL,y*CELL,CELL,CELL); } }\n        for(let y=0;y<H;y++){ for(let x=0;x<W;x++){ const t=board[y][x]; if(t) drawCell(gc,x,y,COLORS[t]); } }\n        const gy = ghostY();\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=gy+dy; gc.fillStyle=COLORS.GHOST; gc.fillRect(x*CELL,y*CELL,CELL,CELL); }\n        for(const [dx,dy] of cells(cur)){ const x=cur.x+dx,y=cur.y+dy; drawCell(gc,x,y,COLORS[cur.type]); }\n\n        // å¦‚æœæ¥åœ°ä¸­ï¼Œå¯åœ¨åº•éƒ¨ç•«ä¸€åœˆæ·¡é‚Šæç¤ºï¼ˆå¯é¸ï¼‰\n        // if (grounded) { gc.strokeStyle='rgba(255,255,255,.15)'; gc.lineWidth=2; gc.strokeRect(0, (H-1)*CELL+1, W*CELL, CELL-2); }\n\n        drawSide();\n        if (over) drawGameOver();\n      }\n      function drawGameOver(){\n        const c = gc.canvas; gc.fillStyle='rgba(0,0,0,0.6)'; gc.fillRect(0,0,c.width,c.height);\n        gc.fillStyle='#fff'; gc.textAlign='center'; gc.font='bold 22px system-ui'; gc.fillText('Game Over', c.width/2, c.height/2 - 10);\n        gc.font='14px system-ui'; gc.fillText('Press R to Restart', c.width/2, c.height/2 + 16);\n      }\n      function drawMini(ctx,type,cell=16){\n        ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);\n        if(!type) return;\n        const shape=ROT[type][0]; const ox=2, oy=2;\n        for(const [dx,dy] of shape){\n          ctx.fillStyle=COLORS[type]; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,cell);\n          ctx.fillStyle='rgba(255,255,255,0.08)'; ctx.fillRect((ox+dx)*cell,(oy+dy)*cell,cell,Math.max(2,cell*0.18));\n        }\n      }\n      function drawSide(){\n        drawMini(hc, hold, 16);\n        nc.clearRect(0,0,nc.canvas.width,nc.canvas.height);\n        const show = queue.slice(0,5), cell=14;\n        show.forEach((t,i)=>{\n          const offY = i*46 + 4;\n          const shape = ROT[t][0];\n          for(const [dx,dy] of shape){\n            nc.fillStyle=COLORS[t];\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, cell);\n            nc.fillStyle='rgba(255,255,255,0.08)';\n            nc.fillRect((2+dx)*cell, (1+dy)*cell + offY, cell, Math.max(2,cell*0.18));\n          }\n        });\n      }\n\n      // ====== HUD ======\n      function updateHUD(updateBest=true){\n        scoreEl.textContent = String(score);\n        linesEl.textContent = String(lines);\n        levelEl.textContent = String(level);\n        if (updateBest){\n          const b = Math.max(Number(localStorage.getItem(BEST_KEY)||0), score);\n          localStorage.setItem(BEST_KEY, b);\n          bestEl.textContent = String(b);\n        }\n      }\n      function gameOver(){ over=true; clearInterval(timer); stopSoftHeld(); updateHUD(); draw(); }\n\n      // ====== Reset / Init ======\n      function resetGame(){\n        board = emptyBoard();\n        queue = [...newBag(), ...newBag()];\n        cur=null; hold=null; canHold=true;\n        score=0; lines=0; level=S.startLevel; paused=false; over=false;\n        grounded=false; lockExpire=0;\n        updateHUD();\n        spawn();\n        restartGravity();\n        draw();\n      }\n\n      // ====== Input ======\n      function stopSoftHeld(){ softHeld=false; clearInterval(softTimer); softTimer=null; }\n      window.addEventListener('keydown', (e)=>{\n        if (e.key===' '){ e.preventDefault(); }\n        if (over){ if (e.key==='r'||e.key==='R'){ resetGame(); } return; }\n\n        if (e.key==='p'||e.key==='P'){ paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; return; }\n        if (paused) return;\n\n        if (e.key==='ArrowLeft'){ move(-1); }\n        else if (e.key==='ArrowRight'){ move(1); }\n        else if (e.key==='ArrowDown'){\n          if (!softHeld){ softHeld=true; softDropStep(); softTimer=setInterval(softDropStep, Math.max(10, SOFT_MS)); }\n        }\n        else if (e.key==='ArrowUp' || e.key==='x' || e.key==='X'){ rotate(+1); }\n        else if (e.key==='z' || e.key==='Z'){ rotate(-1); }\n        else if (e.key==='c' || e.key==='C' || e.key==='Shift'){ holdSwap(); }\n        else if (e.key===' '){ hardDrop(); }\n        else if (e.key==='r' || e.key==='R'){ resetGame(); }\n      });\n      window.addEventListener('keyup', (e)=>{ if (e.key==='ArrowDown'){ stopSoftHeld(); } });\n      window.addEventListener('blur', ()=>{ if(!over){ paused=true; btnPause.textContent='â–¶ï¸ Resume'; stopSoftHeld(); } });\n\n      // Buttons\n      btnPause.addEventListener('click', ()=>{ if(over) return; paused=!paused; btnPause.textContent = paused?'â–¶ï¸ Resume':'â¸ï¸ Pause'; });\n      btnRestart.addEventListener('click', resetGame);\n\n      // Settings UI\n      startLevelInput.addEventListener('input', ()=> startLevelLabel.textContent = startLevelInput.value);\n      btnApply.addEventListener('click', ()=>{\n        S.startLevel = Number(startLevelInput.value);\n        saveSettings(S);\n        resetGame();\n      });\n\n      // Init\n      resetGame();\n    </script>\n  </body>\n  </html>`;\n}\n",
    "enableOnInit": false,
    "hidden": false,
    "tags": []
  }
]